import{r as m,j as o,R as ut,a as on}from"./react-vendor-CkISVyWX.js";import{A as an,P as cn,S as ln,F as un,a as dn,I as fn,b as hn,C as St,T as mn,c as xn,d as pn,e as Pt,Z as gn,f as yn,L as bn,H as vn,M as wn,g as Mn,R as jn,h as Nn,i as kn,j as Sn,k as Pn,l as En,G as In,W as Cn,m as Rn,n as Tn}from"./icons-vendor-bBDW9dcb.js";import{k as Je}from"./math-vendor-Ca7EfnBD.js";import"./vendor-Bb8JjhAW.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function n(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(r){if(r.ep)return;r.ep=!0;const c=n(r);fetch(r.href,c)}})();const Fn=e=>{const t=[],n=e.length;for(let a=0;a<n;a++){let r=0,c=0;for(let h=0;h<n;h++){const l=Math.PI*2*a*h/n,p=Math.cos(l),w=Math.sin(l),v=e[h].re,y=e[h].im;r+=v*p+y*w,c+=y*p-v*w}r=r/n,c=c/n;const u=a>n/2?a-n:a,d=Math.sqrt(r*r+c*c),f=Math.atan2(c,r);t.push({re:r,im:c,freq:u,amp:d,phase:f})}return t.sort((a,r)=>r.amp-a.amp)},Ln=(e,t)=>{if(t<=0||e.length<2)return[...e];const n=[];for(let a=0;a<e.length;a++){let r=0,c=0,u=0;for(let d=-t;d<=t;d++){const f=a+d;f>=0&&f<e.length&&(r+=e[f].x,c+=e[f].y,u++)}n.push({x:r/u,y:c/u})}return n},An=()=>{const e=[];for(let a=0;a<50;a++)e.push({x:-200+a*2*200/50,y:-200});for(let a=0;a<50;a++)e.push({x:200,y:-200+a*2*200/50});for(let a=0;a<50;a++)e.push({x:200-a*2*200/50,y:200});for(let a=0;a<50;a++)e.push({x:-200,y:200-a*2*200/50});return e},zn=()=>{const e=[];for(let a=0;a<200;a++){const r=Math.PI*2*a/200;e.push({x:200*Math.cos(r),y:200*Math.sin(r)})}return e},_n=()=>{const e=[];for(let n=0;n<300;n++){const a=Math.PI*2*n/300,r=16*Math.pow(Math.sin(a),3),c=-(13*Math.cos(a)-5*Math.cos(2*a)-2*Math.cos(3*a)-Math.cos(4*a));e.push({x:r*15,y:c*15})}return e},Dn=()=>{const e=[];for(let a=0;a<300;a++){const r=Math.PI*2*a/300,c=150*Math.cos(r),u=150*Math.sin(r)*Math.cos(r);e.push({x:c,y:u})}return e},On=()=>{const e=[];for(let n=0;n<100;n++){const a=Math.PI*2*n/100;e.push({x:40*Math.cos(a)-50,y:30*Math.sin(a)+100})}for(let n=0;n<20;n++)e.push({x:-10,y:100-200*n/20});for(let n=0;n<30;n++){const a=n/30;e.push({x:-10+50*Math.sin(a*Math.PI),y:-100+50*a})}for(let n=0;n<20;n++)e.push({x:-10,y:-50+150*n/20});return e},Xn={threshold:30,sampleRate:2,maxPoints:1500,smoothingWindow:4,blurRadius:1,morphRadius:2,detail:.9},Un=e=>{if(e.length===0)return[];const t=[],n=new Set;let a=0;for(t.push(e[0]),n.add(0);t.length<e.length;){let r=1/0,c=-1;const u=e[a];for(let d=0;d<e.length;d++)if(!n.has(d)){const f=e[d],h=(u.x-f.x)**2+(u.y-f.y)**2;h<r&&(r=h,c=d)}if(c!==-1)n.add(c),t.push(e[c]),a=c;else break}return t},je=(e,t,n)=>Math.max(t,Math.min(n,e)),Wn=e=>Math.max(0,Math.min(1,e)),Te=(e,t,n)=>e+(t-e)*n,$n=(e,t,n,a)=>{const r=Math.max(1,Math.floor(a||1)),c=Math.max(1,Math.floor(t/r)),u=Math.max(1,Math.floor(n/r)),d=new Uint8Array(c*u);for(let f=0;f<u;f++){const h=je(f*r,0,n-1);for(let l=0;l<c;l++){const p=je(l*r,0,t-1),w=(h*t+p)*4,v=e[w]??0,y=e[w+1]??0,M=e[w+2]??0;d[f*c+l]=Math.round(.2126*v+.7152*y+.0722*M)}}return{gray:d,w:c,h:u,step:r}},qn=(e,t,n,a)=>{const r=Math.max(1,Math.floor(a||1)),c=new Uint8Array(e.length);for(let u=0;u<n;u++)for(let d=0;d<t;d++){let f=0;for(let h=-r;h<=r&&!f;h++){const l=u+h;if(!(l<0||l>=n))for(let p=-r;p<=r;p++){const w=d+p;if(!(w<0||w>=t)&&e[l*t+w]){f=1;break}}}c[u*t+d]=f}return c},Vn=(e,t,n,a)=>{const r=Math.max(1,Math.floor(a||1)),c=new Uint8Array(e.length);for(let u=0;u<n;u++)for(let d=0;d<t;d++){let f=1;for(let h=-r;h<=r&&f;h++){const l=u+h;if(l<0||l>=n){f=0;break}for(let p=-r;p<=r;p++){const w=d+p;if(w<0||w>=t||!e[l*t+w]){f=0;break}}}c[u*t+d]=f}return c},Yn=(e,t,n,a)=>{const r=Math.max(1,Math.floor(a||1));return Vn(qn(e,t,n,r),t,n,r)},Bn=(e,t)=>{const n=Math.max(0,Math.floor(t||0));if(n<=0||e.length<3)return e;const a=[],r=e.length;for(let c=0;c<r;c++){let u=0,d=0,f=0;for(let h=-n;h<=n;h++){const l=(c+h+r)%r;u+=e[l].x,d+=e[l].y,f++}a.push({x:u/f,y:d/f})}return a},Oe=e=>{if(e.length<2)return e;const t=e[0],n=e[e.length-1];return t.x===n.x&&t.y===n.y?e:[...e,{...t}]},Hn=(e,t,n)=>{if(t<3||n<3)return new Uint8Array(e.length);const a=new Uint16Array(e.length),r=new Uint32Array(1025);for(let l=1;l<n-1;l++)for(let p=1;p<t-1;p++){const w=l*t+p,v=e[w-t-1],y=e[w-t],M=e[w-t+1],N=e[w-1],k=e[w+1],b=e[w+t-1],j=e[w+t],I=e[w+t+1],O=-v+M-2*N+2*k-b+I,_=-v-2*y-M+b+2*j+I,U=Math.min(1024,Math.abs(O)+Math.abs(_));a[w]=U,r[U]++}const c=(t-2)*(n-2);let u=Math.floor(c*.08);u=je(u,50,c);let d=0,f=1024;for(let l=1024;l>=0;l--)if(d+=r[l],d>=u){f=l;break}const h=new Uint8Array(e.length);for(let l=0;l<a.length;l++)h[l]=a[l]>=f&&a[l]>0?1:0;return h},Zn=e=>{let t=0;for(let n=0;n<e.length;n++)t+=e[n]?1:0;return t},Gn=e=>{const t=Math.max(.01,e),n=Math.max(1,Math.ceil(3*t)),a=n*2+1,r=new Float32Array(a),c=2*t*t;let u=0;for(let d=-n;d<=n;d++){const f=Math.exp(-(d*d)/c);r[d+n]=f,u+=f}if(u>0)for(let d=0;d<r.length;d++)r[d]/=u;return r},Et=(e,t,n,a)=>{const r=t*n,c=Math.max(0,a);if(r===0)return new Float32Array(0);if(c<=.01){const l=new Float32Array(r);for(let p=0;p<r;p++)l[p]=e[p];return l}const u=Gn(c),d=(u.length-1)/2,f=new Float32Array(r),h=new Float32Array(r);for(let l=0;l<n;l++){const p=l*t;for(let w=0;w<t;w++){let v=0;for(let y=-d;y<=d;y++){const M=je(w+y,0,t-1);v+=u[y+d]*(e[p+M]??0)}f[p+w]=v}}for(let l=0;l<n;l++){const p=l*t;for(let w=0;w<t;w++){let v=0;for(let y=-d;y<=d;y++){const M=je(l+y,0,n-1);v+=u[y+d]*(f[M*t+w]??0)}h[p+w]=v}}return h},Kn=(e,t,n,a,r)=>{const c=t*n;if(t<3||n<3||c===0)return new Uint8Array(c);const u=Math.min(t,n),d=Math.max(.35,r||1),f=Te(2.4,.7,a)*d,h=Math.max(.35,u/4),l=Math.min(Math.max(.35,f),h),p=Math.min(Math.max(l*1.6,l+.15),h*1.6),w=Et(e,t,n,l),v=Et(e,t,n,p),y=new Float32Array(c);for(let E=0;E<c;E++)y[E]=w[E]-v[E];const M=new Uint16Array(c),N=new Uint32Array(1025);let k=0;const b=4,j=[-t-1,-t,-t+1,-1,1,t-1,t,t+1];for(let E=1;E<n-1;E++){const W=E*t;for(let Y=1;Y<t-1;Y++){const Q=W+Y,B=y[Q],ce=B>=0;let $=0;for(let ne=0;ne<j.length;ne++){const ye=Q+j[ne],de=y[ye];if(de>=0===ce)continue;const Ne=Math.abs(B-de);Ne>$&&($=Ne)}if($>0){const ne=je(Math.round($*b),0,1024);M[Q]=ne,N[ne]++,k++}}}if(k===0)return new Uint8Array(c);const I=Te(.02,.08,a),O=je(Math.floor(k*I),1,k);let _=0,U=1024;for(let E=1024;E>=1;E--)if(_+=N[E],_>=O){U=E;break}const D=Te(.6,.22,a),te=Math.max(1,Math.floor(U*D)),X=new Uint8Array(c),J=[];for(let E=0;E<c;E++)M[E]>=U&&(X[E]=1,J.push(E));const T=[1,1,0,-1,-1,-1,0,1],C=[0,1,1,1,0,-1,-1,-1];for(;J.length;){const E=J.pop(),W=E%t,Y=(E-W)/t;for(let Q=0;Q<8;Q++){const B=W+T[Q],ce=Y+C[Q];if(B<0||B>=t||ce<0||ce>=n)continue;const $=ce*t+B;X[$]||M[$]>=te&&(X[$]=1,J.push($))}}return X},Jn=(e,t,n)=>{const a=[1,1,0,-1,-1,-1,0,1],r=[0,1,1,1,0,-1,-1,-1],c=[4,5,6,7,0,1,2,3],u=new Uint8Array(e.length),d=[];for(let v=0;v<e.length;v++){if(!e[v])continue;const y=v%t,M=(v-y)/t;let N=0;for(let k=0;k<8;k++){const b=y+a[k],j=M+r[k];b<0||b>=t||j<0||j>=n||e[j*t+b]&&N++}u[v]=N,N>0&&d.push(v)}const f=new Uint8Array(e.length),h=[],l=(v,y)=>{const M=v%t,N=(v-M)/t,k=M+a[y],b=N+r[y];if(k<0||k>=t||b<0||b>=n)return-1;const j=b*t+k;return e[j]?j:-1},p=(v,y,M)=>{f[v]|=1<<y,f[M]|=1<<c[y]},w=(v,y,M)=>{const N=l(v,y);if(N<0)return[];const k=[v];let b=y,j=N;p(v,y,j),k.push(j);const I=t*n*2;for(let O=0;O<I;O++){const _=u[j];if(M&&_!==2)break;const U=c[b];let D=-1;for(let X=0;X<8;X++){if(X===U)continue;if(l(j,X)>=0){D=X;break}}if(D<0||f[j]&1<<D)break;const te=l(j,D);if(te<0||(p(j,D,te),j=te,b=D,k.push(j),!M&&j===v))break}return k};for(const v of d){const y=u[v];if(!(y===0||y===2))for(let M=0;M<8;M++){if(l(v,M)<0||f[v]&1<<M)continue;const k=w(v,M,!0);k.length>1&&h.push(k)}}for(const v of d)for(let y=0;y<8;y++){if(l(v,y)<0||f[v]&1<<y)continue;const N=w(v,y,!1);N.length>1&&(N[0]===N[N.length-1]?h.push(N):h.push([...N,N[0]]))}return h},Qn=(e,t,n,a,r)=>{const c=e%t,u=(e-c)/t;return{x:c*n-a/2,y:u*n-r/2}},lt=e=>{if(e.length===0)return[];const t=[e[0]];for(let n=1;n<e.length;n++){const a=t[t.length-1],r=e[n];(a.x!==r.x||a.y!==r.y)&&t.push(r)}return t},It=(e,t)=>{if(e.length<3||t<=0)return e;const n=t*t,a=new Uint8Array(e.length);a[0]=1,a[e.length-1]=1;const r=(d,f,h)=>{const l=h.x-f.x,p=h.y-f.y,w=d.x-f.x,v=d.y-f.y,y=l*w+p*v;if(y<=0)return w*w+v*v;const M=l*l+p*p;if(M<=y){const O=d.x-h.x,_=d.y-h.y;return O*O+_*_}const N=y/M,k=f.x+N*l,b=f.y+N*p,j=d.x-k,I=d.y-b;return j*j+I*I},c=[[0,e.length-1]];for(;c.length;){const[d,f]=c.pop();let h=0,l=-1;const p=e[d],w=e[f];for(let v=d+1;v<f;v++){const y=r(e[v],p,w);y>h&&(h=y,l=v)}l!==-1&&h>n&&(a[l]=1,c.push([d,l],[l,f]))}const u=[];for(let d=0;d<e.length;d++)a[d]&&u.push(e[d]);return u},es=(e,t)=>{if(e.length===0)return[];const n=[...e].sort((u,d)=>d.length-u.length);let a=[...n.shift()];const r=(u,d)=>{const f=u.x-d.x,h=u.y-d.y;return f*f+h*h},c=je(Math.round(Te(2,10,t)),2,12);for(;n.length;){const u=a[a.length-1];let d=0,f=!1,h=1/0;for(let M=0;M<n.length;M++){const N=n[M],k=r(u,N[0]),b=r(u,N[N.length-1]);k<h&&(h=k,d=M,f=!1),b<h&&(h=b,d=M,f=!0)}const l=n.splice(d,1)[0];f&&l.reverse();const p=l[0],w=p.x-u.x,v=p.y-u.y;if(Math.hypot(w,v)>1e-6)for(let M=1;M<=c;M++){const N=M/(c+1);a.push({x:u.x+w*N,y:u.y+v*N})}a[a.length-1].x===p.x&&a[a.length-1].y===p.y?a.push(...l.slice(1)):a.push(...l)}return a},ts=(e,t)=>{const n=Math.max(8,Math.floor(t)),a=Oe(lt(e));if(a.length<4)return a;const r=a.slice(0,-1),c=r.length,u=new Float64Array(c);let d=0;for(let b=0;b<c;b++){const j=r[b],I=r[(b+1)%c],O=Math.hypot(I.x-j.x,I.y-j.y);u[b]=O,d+=O}if(!Number.isFinite(d)||d<=0)return Oe(r);const f=d/n,h=[{...r[0]}];let l=0,p=r[0],w=r[1%c],v=u[0],y=0,M=f;const N=n*(c+4);let k=0;for(;h.length<n&&k++<N;){if(v===0){l=(l+1)%c,p=r[l],w=r[(l+1)%c],v=u[l];continue}if(y+v>=M-1e-9){const b=(M-y)/v;h.push({x:p.x+(w.x-p.x)*b,y:p.y+(w.y-p.y)*b}),M+=f}else y+=v,l=(l+1)%c,p=r[l],w=r[(l+1)%c],v=u[l]}return h.length>n&&(h.length=n),Oe(h)},ns=(e,t,n,a={})=>{const r={...Xn,...a},c=Wn(r.detail),u=typeof a.sampleRate=="number"?Math.max(1,Math.floor(r.sampleRate)):c>=.88?1:c>=.55?2:3,d=Math.max(200,Math.floor(r.maxPoints)),f=Math.max(0,Math.floor(r.smoothingWindow)),h=Math.max(0,Math.floor(r.blurRadius)),l=Math.max(0,Math.floor(r.morphRadius)),p=Math.max(1,Math.floor(r.threshold)),{gray:w,w:v,h:y,step:M}=$n(e,t,n,u),N=w;let k=Kn(N,v,y,c,h);Zn(k)<Math.max(10,Math.floor(v*y*.001))&&(k=Hn(N,v,y)),l>0&&(k=Yn(k,v,y,l));const b=Jn(k,v,y),j=je(Math.round(Te(40,10,c)),6,80),I=Te(6,1.2,c)*M,O=b.filter(T=>T.length>=j).map(T=>T.map(C=>Qn(C,v,M,t,n))).map(T=>{const C=lt(T);if(C.length>2&&C[0].x===C[C.length-1].x&&C[0].y===C[C.length-1].y){const W=C.slice(0,-1);return Oe(It(W,I))}return It(C,I)}).filter(T=>T.length>=2);if(O.length>0){const T=es(O,c),C=Oe(lt(T)),E=f>0?Bn(C,f):C,W=je(Math.round(Te(400,d,c)),120,d);return ts(E,W)}const _=[],U=T=>(e[T]+e[T+1]+e[T+2])/3;for(let T=0;T<n;T+=u)for(let C=0;C<t;C+=u){if(C<=0||T<=0)continue;const E=(T*t+C)*4,W=(T*t+(C-1))*4,Y=((T-1)*t+C)*4,Q=U(E),B=U(W),ce=U(Y);Math.abs(Q-B)+Math.abs(Q-ce)>p&&_.push({x:C-t/2,y:T-n/2})}if(_.length===0)return[];const D=_.length>d?Math.ceil(_.length/d):1,te=D===1?_:_.filter((T,C)=>C%D===0),X=Un(te),J=[];for(let T=0;T<X.length;T++){let C=0,E=0,W=0;for(let Y=-f;Y<=f;Y++){const Q=(T+Y+X.length)%X.length;C+=X[Q].x,E+=X[Q].y,W++}J.push({x:C/W,y:E/W})}return Oe(J)},Ct=async(e,t=900,n={})=>new Promise((a,r)=>{const c=new Image,u=URL.createObjectURL(e);c.onload=()=>{const d=document.createElement("canvas"),f=d.getContext("2d");if(!f){r(new Error("Could not get canvas context"));return}let h=c.width,l=c.height;const p=Math.max(h,l),w=t&&t>0?t:900;if(p>w){const M=w/p;h=Math.round(h*M),l=Math.round(l*M)}d.width=h,d.height=l,f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.drawImage(c,0,0,h,l);const v=f.getImageData(0,0,h,l),y=ns(v.data,h,l,n);URL.revokeObjectURL(u),a(y)},c.onerror=d=>r(d),c.src=u}),dt=1500,ss=300,rs=600,os=e=>e.map(t=>({re:t.x,im:t.y})),as=e=>e&&e>0?e:dt,ft=(e,t)=>Math.hypot(e.x-t.x,e.y-t.y),ht=(e,t,n)=>Math.max(t,Math.min(n,Math.round(e))),cs=e=>{let t=1/0,n=1/0,a=-1/0,r=-1/0;for(const c of e)c.x<t&&(t=c.x),c.y<n&&(n=c.y),c.x>a&&(a=c.x),c.y>r&&(r=c.y);return!Number.isFinite(t)||!Number.isFinite(n)||!Number.isFinite(a)||!Number.isFinite(r)?0:Math.hypot(a-t,r-n)},ls=e=>{if(e.length<3)return!1;const t=e[0],n=e[e.length-1],a=cs(e),r=Math.max(10,a*.04);return ft(t,n)<=r},is=(e,t=.25)=>{if(e.length<2)return[...e];const n=[e[0]];for(let a=1;a<e.length;a++){const r=n[n.length-1],c=e[a];ft(r,c)>=t&&n.push(c)}return n},us=(e,t,n)=>{const a=e.length;if(a===0)return[];if(a===1)return[{...e[0]}];const r=ht(t,2,1e4),c=n?a:a-1,u=new Array(c);let d=0;for(let p=0;p<c;p++){const w=e[p],v=e[(p+1)%a],y=ft(w,v);u[p]=y,d+=y}if(d<=0)return Array.from({length:r},()=>({...e[0]}));const f=d/(n?r:r-1),h=[],l=p=>{let w=0,v=0;for(;w<c-1&&v+u[w]<p;)v+=u[w],w++;const y=e[w],M=e[(w+1)%a],N=u[w]||1,k=Math.max(0,Math.min(1,(p-v)/N));return{x:y.x+(M.x-y.x)*k,y:y.y+(M.y-y.y)*k}};if(n){for(let p=0;p<r;p++)h.push(l(f*p));return h}h.push({...e[0]});for(let p=1;p<r-1;p++)h.push(l(f*p));return h.push({...e[a-1]}),h},ds=(e,t)=>{if(t<=0||e.length<2)return[...e];const n=e.length,a=ht(t,1,Math.floor(n/2)),r=[];for(let c=0;c<n;c++){let u=0,d=0,f=0;for(let h=-a;h<=a;h++){const l=(c+h+n)%n;u+=e[l].x,d+=e[l].y,f++}r.push({x:u/f,y:d/f})}return r},fs=(e,t,n=dt)=>{const a=as(n),r=is(e);if(r.length===0)return[];const c=ls(r),u=c?rs:ss,d=Math.min(a,Math.max(r.length,u)),f=us(r,d,c),h=t>0?ht(t,0,999):0;return c?ds(f,h):Ln(f,h)},hs=(e,t={})=>{const{smoothing:n=0,limit:a=dt}=t,r=fs(e,n,a),c=Fn(os(r));return{prepared:r,spectrum:c}},ms=(e,t,n,a=600)=>{if(!e.length||!t.length)return{energyPct:0,rmsError:0,topTerms:[],breakdown:[]};const r=e.map(b=>b.amp*b.amp),c=r.reduce((b,j)=>b+j,0)||1,u=Math.max(Math.min(n||e.length,e.length),1),d=r.slice(0,u).reduce((b,j)=>b+j,0);let f=0;const h=r.map(b=>(f+=b,{energyPct:b/c*100,cumulativePct:f/c*100}));let l=0;const p=e.slice(0,6).map((b,j)=>{const I=r[j];return l+=I,{freq:b.freq,amp:b.amp,phase:b.phase,energyPct:I/c*100,cumulativePct:l/c*100}}),w=t.length,v=Math.max(1,Math.floor(w/a)),y=e.slice(0,u);let M=0,N=0;for(let b=0;b<w;b+=v){let j=0,I=0;for(let U=0;U<y.length;U++){const D=y[U],te=2*Math.PI*D.freq*b/w,X=Math.cos(te),J=Math.sin(te);j+=D.re*X-D.im*J,I+=D.re*J+D.im*X}const O=j-t[b].x,_=I-t[b].y;M+=O*O+_*_,N++}const k=Math.sqrt(M/Math.max(N,1));return{energyPct:Number((d/c*100).toFixed(2)),rmsError:Number(k.toFixed(2)),topTerms:p,breakdown:h}},Re={scale:1,offsetX:0,offsetY:0},it=(e,t,n)=>Math.max(t,Math.min(n,e)),At=(e,t,n)=>Number.isFinite(e)?it(e,t,n):it(1,t,n),De=e=>Number.isFinite(e.width)&&Number.isFinite(e.height)&&e.width>0&&e.height>0,Be=(e,t,n)=>{const a=t.width/2,r=t.height/2,c=n.scale!==0?1/n.scale:1;return{x:(e.x-a-n.offsetX)*c,y:(e.y-r-n.offsetY)*c}},zt=(e,t,n,a,r,c)=>{const u=At(a,r,c),d=t.width/2,f=t.height/2;return{scale:u,offsetX:n.x-d-e.x*u,offsetY:n.y-f-e.y*u}},xs=(e,t,n,a,r,c)=>{const u=Be(n,t,e);return zt(u,t,n,a,r,c)},Rt=(e,t,n,a,r,c)=>{const u=e.scale*a;return xs(e,t,n,u,r,c)},Tt=(e,t,n={padding:.9,minScale:.25,maxScale:6})=>{if(!De(t)||e.length===0)return Re;let a=1/0,r=1/0,c=-1/0,u=-1/0;for(const y of e)y.x<a&&(a=y.x),y.y<r&&(r=y.y),y.x>c&&(c=y.x),y.y>u&&(u=y.y);if(!Number.isFinite(a)||!Number.isFinite(r)||!Number.isFinite(c)||!Number.isFinite(u))return Re;const d=Math.max(c-a,1e-6),f=Math.max(u-r,1e-6),l=it(n.padding??.9,.1,1)*Math.min(t.width/d,t.height/f),p=At(l,n.minScale,n.maxScale),w=(a+c)/2,v=(r+u)/2;return{scale:p,offsetX:-w*p,offsetY:-v*p}},ps=e=>Math.min(1,Math.max(0,e)),gs=(e,t)=>!isFinite(e)||t<=0?0:ps(e/t),et=(e,t,n=!1)=>{const a=gs(e,t),r=210+110*a,c=n?62:48+6*a,u=n?.95:.6;return`hsla(${r.toFixed(1)}, 82%, ${c.toFixed(1)}%, ${u})`},ys=e=>`linear-gradient(90deg, ${et(0,e)} 0%, ${et(e*.5,e)} 50%, ${et(e,e,!0)} 100%)`,bs=(e,t,n)=>et(e.amp,t,n),vs=({mode:e,setMode:t,isPlaying:n,setIsPlaying:a,clear:r,numEpicycles:c,maxEpicycles:u,setNumEpicycles:d,onUpload:f,showMath:h,setShowMath:l,onPreset:p,speed:w,setSpeed:v,onReset:y,brushColor:M,setBrushColor:N,brushSize:k,setBrushSize:b,smoothing:j,setSmoothing:I,outlineDetail:O,setOutlineDetail:_,isDrawing:U,onSave:D,onLoad:te,savedDrawings:X,isFullscreen:J,onToggleFullscreen:T,safeMode:C,onToggleSafeMode:E,stepMode:W,onToggleStepMode:Y,stepIndex:Q,stepMax:B,onStepPrev:ce,onStepNext:$,onStepPlayOnce:ne,viewScale:ye,onZoomIn:de,onZoomOut:Ne,onFitView:tt,onResetView:Fe})=>{const He=m.useRef(null),Xe=m.useRef(null),ke=m.useRef(null),[fe,q]=m.useState(null),[Ee,he]=m.useState(!0),[Z,me]=m.useState(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return!0;const S=window.matchMedia("(hover: none)").matches,ee=window.matchMedia("(hover: hover)").matches,ie=window.matchMedia("(pointer: fine)").matches;return S||!ee||!ie});m.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const S=window.matchMedia("(hover: none)"),ee=window.matchMedia("(hover: hover)"),ie=window.matchMedia("(pointer: fine)"),xe=()=>{const ue=S.matches,We=ee.matches,Le=ie.matches;me(ue||!We||!Le)},we=ue=>{typeof ue.addEventListener=="function"?ue.addEventListener("change",xe):typeof ue.addListener=="function"&&ue.addListener(xe)},H=ue=>{typeof ue.removeEventListener=="function"?ue.removeEventListener("change",xe):typeof ue.removeListener=="function"&&ue.removeListener(xe)};return we(S),we(ee),we(ie),xe(),()=>{H(S),H(ee),H(ie)}},[]),m.useEffect(()=>{if(!fe)return;const S=ie=>{var we,H;const xe=ie.target;xe instanceof Node&&((we=Xe.current)!=null&&we.contains(xe)||(H=ke.current)!=null&&H.contains(xe)||q(null))},ee=ie=>{ie.key==="Escape"&&q(null)};return document.addEventListener("pointerdown",S),document.addEventListener("keydown",ee),()=>{document.removeEventListener("pointerdown",S),document.removeEventListener("keydown",ee)}},[fe]);const Ue=m.useCallback(S=>{q(ee=>ee===S?null:S)},[]),se=S=>`
    p-2.5 rounded-lg transition-all duration-200 flex items-center justify-center
    ${S?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50 shadow-[0_0_15px_rgba(6,182,212,0.3)]":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 hover:text-slate-200 border border-transparent"}
  `;return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"fourier-toolbar fourier-toolbar--top",children:[o.jsxs("div",{className:"flex gap-1 mr-4 pl-2",children:[o.jsx(an,{className:"w-5 h-5 text-fuchsia-500"}),o.jsxs("span",{className:"font-bold text-slate-100 hidden sm:block",children:["Fourier",o.jsx("span",{className:"text-fuchsia-500",children:"Viz"})]})]}),o.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),o.jsx("button",{onClick:()=>t("DRAW"),className:se(e==="DRAW"),title:"Freehand Draw",children:o.jsx(cn,{size:20})}),o.jsxs("div",{className:"relative",ref:Xe,onPointerEnter:()=>{Z||q("presets")},onPointerLeave:()=>{Z||q(S=>S==="presets"?null:S)},children:[o.jsx("button",{type:"button",className:se(e==="PRESET"),title:"Presets","aria-expanded":fe==="presets","aria-controls":"fourier-presets-menu",onClick:()=>Ue("presets"),children:o.jsx(ln,{size:20})}),o.jsxs("div",{id:"fourier-presets-menu",role:"menu",style:{display:fe==="presets"?"block":"none"},className:"absolute top-full left-0 w-32 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden z-50",children:[o.jsx("button",{type:"button",role:"menuitem",onClick:()=>{p("circle"),q(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Circle"}),o.jsx("button",{type:"button",role:"menuitem",onClick:()=>{p("square"),q(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Square"}),o.jsx("button",{type:"button",role:"menuitem",onClick:()=>{p("heart"),q(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Heart"}),o.jsx("button",{type:"button",role:"menuitem",onClick:()=>{p("infinity"),q(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Infinity"}),o.jsx("button",{type:"button",role:"menuitem",onClick:()=>{p("note"),q(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Note"})]})]}),o.jsxs("div",{className:"relative",ref:ke,onPointerEnter:()=>{Z||q("load")},onPointerLeave:()=>{Z||q(S=>S==="load"?null:S)},children:[o.jsx("button",{type:"button",className:se(!1),title:"Load Saved Drawing","aria-expanded":fe==="load","aria-controls":"fourier-load-menu",onClick:()=>Ue("load"),children:o.jsx(un,{size:20})}),o.jsx("div",{id:"fourier-load-menu",role:"menu",style:{display:fe==="load"?"block":"none"},className:"absolute top-full left-0 w-48 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden max-h-60 overflow-y-auto custom-scrollbar z-50",children:X.length===0?o.jsx("div",{className:"px-4 py-2 text-sm text-slate-500 italic",children:"No saved drawings"}):X.map(S=>o.jsx("button",{type:"button",role:"menuitem",onClick:()=>{te(S),q(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400 truncate border-b border-slate-800 last:border-0",children:S},S))})]}),o.jsx("button",{onClick:D,className:se(!1),title:"Save Current Drawing",children:o.jsx(dn,{size:20})}),o.jsx("button",{onClick:()=>{var S;return(S=He.current)==null?void 0:S.click()},className:se(e==="UPLOAD"),title:"Upload Image",children:o.jsx(fn,{size:20})}),o.jsx("input",{type:"file",ref:He,onChange:f,accept:"image/*",className:"hidden"}),o.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),o.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-lg transition-all duration-300 ${U?"bg-fuchsia-900/20 ring-1 ring-fuchsia-500/50":""}`,children:[o.jsxs("div",{className:"relative flex items-center group",title:"Brush Color",children:[o.jsx(hn,{size:18,className:`${U?"text-fuchsia-400":"text-slate-400"} mr-2 transition-colors`}),o.jsx("input",{type:"color",value:M,onChange:S=>N(S.target.value),className:"w-6 h-6 rounded border-none cursor-pointer bg-transparent"})]}),o.jsxs("div",{className:"flex items-center gap-2",title:"Brush Size",children:[o.jsx(St,{size:10,className:"text-slate-400"}),o.jsx("input",{type:"range",min:"1",max:"10",step:"0.5",value:k,onChange:S=>b(parseFloat(S.target.value)),className:"w-16 h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-slate-400"}),o.jsx(St,{size:16,className:`text-slate-400 transition-all ${U?"scale-110 text-fuchsia-300":""}`})]})]}),o.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),o.jsx("button",{onClick:r,className:"p-2.5 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors",title:"Clear Canvas",children:o.jsx(mn,{size:20})}),o.jsx("button",{onClick:()=>l(!h),className:se(h),title:"Toggle Math Panel",children:o.jsx(xn,{size:20})}),o.jsx("button",{onClick:E,className:se(C),title:"Toggle safe mode (cap epicycles / lighten rendering)",children:o.jsx(pn,{size:20})}),o.jsx("button",{onClick:Y,className:se(W),title:"Toggle step-through playback",children:o.jsx(Pt,{size:20})}),o.jsx("button",{onClick:Ne,className:se(!1),title:"Zoom Out","aria-label":"Zoom out",children:o.jsx(gn,{size:20})}),o.jsx("button",{onClick:de,className:se(!1),title:"Zoom In","aria-label":"Zoom in",children:o.jsx(yn,{size:20})}),o.jsx("button",{onClick:tt,className:se(!1),title:"Fit View","aria-label":"Fit view to drawing",children:o.jsx(bn,{size:20})}),o.jsx("button",{onClick:Fe,className:se(!1),title:"Reset View","aria-label":`Reset view (${Math.round(ye*100)}%)`,children:o.jsx(vn,{size:20})}),o.jsx("button",{onClick:T,className:se(J),title:J?"Exit Fullscreen":"Fullscreen Play",children:J?o.jsx(wn,{size:20}):o.jsx(Mn,{size:20})})]}),o.jsx("div",{className:"fourier-toolbar fourier-toolbar--bottom",children:o.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[o.jsxs("div",{className:"flex items-center justify-between w-full md:w-auto gap-3",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("button",{onClick:y,className:"p-3 rounded-full bg-slate-800 text-slate-300 hover:bg-slate-700 hover:text-white transition-all",title:"Reset Animation",children:o.jsx(jn,{size:18})}),o.jsx("button",{onClick:()=>a(!n),className:"w-14 h-14 flex items-center justify-center rounded-full bg-cyan-500 text-slate-950 hover:bg-cyan-400 transition-all shadow-[0_0_20px_rgba(6,182,212,0.4)]",children:n?o.jsx(Nn,{fill:"currentColor",size:24}):o.jsx(kn,{fill:"currentColor",className:"ml-1",size:24})}),W&&o.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/70 rounded-full px-3 py-2 border border-slate-700",children:[o.jsx("button",{onClick:ce,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Previous term",children:o.jsx(Sn,{size:16})}),o.jsx("button",{onClick:ne,className:"px-3 py-2 rounded-full bg-amber-400 text-slate-900 font-semibold hover:bg-amber-300 transition",title:"Play this term once",children:"Step"}),o.jsx("button",{onClick:$,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Next term",children:o.jsx(Pn,{size:16})}),o.jsxs("span",{className:"text-xs text-slate-300 font-semibold ml-1",children:["Term ",Q+1," / ",Math.max(B,1)]})]})]}),o.jsx("button",{type:"button",onClick:()=>he(S=>!S),className:`md:hidden ${se(Ee)}`,title:"Toggle sliders","aria-label":"Toggle sliders","aria-controls":"fourier-sliders","aria-expanded":Ee,children:o.jsx(En,{size:20})})]}),o.jsxs("div",{id:"fourier-sliders",className:`${Ee?"grid":"hidden"} md:grid flex-1 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 w-full`,children:[o.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[o.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[o.jsx("span",{children:"Precision"}),o.jsxs("span",{className:"text-cyan-400",children:[c," / ",u,C?" (capped)":""]})]}),o.jsx("input",{type:"range",min:"1",max:u||1,value:c,onChange:S=>d(parseInt(S.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),o.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[o.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(In,{size:12}),o.jsx("span",{children:"Speed"})]}),o.jsxs("span",{className:"text-amber-400",children:[w.toFixed(2),"x"]})]}),o.jsx("input",{type:"range",min:"0.05",max:"3",step:"0.05",value:w,onChange:S=>v(parseFloat(S.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-amber-500"})]}),o.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[o.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(Cn,{size:12}),o.jsx("span",{children:"Smoothness"})]}),o.jsxs("span",{className:"text-emerald-400",children:[j,"px"]})]}),o.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:j,onChange:S=>I(parseInt(S.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]}),o.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[o.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(Pt,{size:12}),o.jsx("span",{children:"Outline detail"})]}),o.jsxs("span",{className:"text-violet-300",children:[O,"%"]})]}),o.jsx("input",{type:"range",min:"10",max:"100",step:"1",value:O,onChange:S=>_(parseInt(S.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-violet-400"})]})]})]})})]})},ws=({terms:e,time:t,epicycles:n,metrics:a,focusIndex:r,stepMode:c=!1})=>{var k;const u=m.useRef(null),d=(b,j)=>Math.max(Math.min(b-1,j-1),0),[f,h]=m.useState("dft"),[l,p]=m.useState(()=>d(n,e.length)),w=m.useRef(d(n,e.length)),v=m.useMemo(()=>{const b=e[0],j=e.length||1,I=(t/(2*Math.PI)).toFixed(2);return{n:j,largestRadius:b?b.amp.toFixed(1):"0.0",maxFreq:b?b.freq:0,phaseTurns:I,dominantPhase:b?b.phase.toFixed(2):"0.00"}},[e,t]),y=m.useMemo(()=>{const b=e[Math.min(l,Math.max(e.length-1,0))];return b||{freq:0,amp:0,phase:0}},[l,e]),M=a.breakdown?a.breakdown[Math.min(l,Math.max(a.breakdown.length-1,0))]??{energyPct:0,cumulativePct:0}:{energyPct:0,cumulativePct:0},N=m.useMemo(()=>{const b={throwOnError:!1},j=v.n||1,I=y.freq,O=y.amp.toFixed(3),_=y.phase.toFixed(3),U=M.energyPct.toFixed(2),D=M.cumulativePct.toFixed(2);return{paramsHtml:Je.renderToString(`k = ${I},\\quad |X_k| = ${O},\\quad \\phi_k = ${_}\\,\\text{rad}`,b),vectorHtml:Je.renderToString(`\\text{Vector}_k(t) = |X_k|\\,e^{i\\left(2\\pi k t/${j} + \\phi_k\\right)}`,b),energyHtml:Je.renderToString(`\\Delta\\text{energy} = ${U}\\%\\quad \\text{cum.} = ${D}\\%`,b)}},[M,y.amp,y.freq,y.phase,v.n]);return m.useEffect(()=>{var te,X;if(!u.current)return;const{n:b,phaseTurns:j,dominantPhase:I}=v,O=Math.max(n,1),_=((te=e[0])==null?void 0:te.freq)??0,U=((X=e[0])==null?void 0:X.amp)??0,D={dft:`
      \\begin{aligned}
        X_k &= \\frac{1}{N} \\sum_{n=0}^{N-1} x_n e^{-i 2\\pi kn / N} \\\\
        &\\textcolor{#f472b6}{N = ${b}},\\; \\textcolor{#22c55e}{k \\in [0, N-1]}
      \\end{aligned}
      `,reconstruction:`
      \\begin{aligned}
        x(t) &\\approx \\sum_{j=1}^{${O}} \\left|X_{k_j}\\right| e^{i\\left(k_j t + \\phi_{k_j}\\right)} \\\\
        t &= 2\\pi n/N,\\; k_j \\in \\left[-\\frac{N}{2}, \\frac{N}{2}\\right] \\\\
        &\\textcolor{#22c55e}{\\left|X_{${_}}\\right| = ${U.toFixed(2)}},\\;
          \\textcolor{#f472b6}{\\phi_{${_}} = ${I}}\\;\\text{rad}
      \\end{aligned}
      `,phasor:`
      \\begin{aligned}
        \\text{Epicycle}_k(t) &= r_k \\\\
        &\\cdot e^{i(\\omega_k t + \\phi_k)} \\\\
        r_k &= \\left|X_k\\right| \\\\
        \\omega_k &= k \\\\
        t &= ${j}\\,\\tau
      \\end{aligned}
      `};Je.render(D[f],u.current,{throwOnError:!1,displayMode:!0})},[f,n,v,e]),m.useEffect(()=>{h("dft");const b=d(n,e.length);w.current=b,p(b)},[e.length]),m.useEffect(()=>{const b=d(n,e.length),j=w.current;w.current=b,typeof r!="number"&&p(I=>I===j?b:I)},[n,r,e.length]),m.useEffect(()=>{if(typeof r=="number"&&e.length>0){const b=Math.min(Math.max(r,0),e.length-1);p(b)}},[r,e.length]),o.jsxs("div",{className:"fourier-math-panel custom-scrollbar",children:[o.jsx("h3",{className:"text-xl font-bold mb-4 text-cyan-400",children:"Fourier Engine"}),o.jsxs("div",{className:"fourier-math-toggle",role:"group","aria-label":"Toggle formulas",children:[o.jsx("button",{type:"button",className:f==="dft"?"is-active":"",onClick:()=>h("dft"),children:"DFT basis"}),o.jsx("button",{type:"button",className:f==="reconstruction"?"is-active":"",onClick:()=>h("reconstruction"),children:"Reconstruction"}),o.jsx("button",{type:"button",className:f==="phasor"?"is-active":"",onClick:()=>h("phasor"),children:"Phasor anatomy"})]}),o.jsx("div",{className:"mb-4",ref:u,"aria-live":"polite"}),o.jsxs("div",{className:"space-y-4 text-sm font-mono",children:[o.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[o.jsx("span",{className:"text-slate-400",children:"Total Vectors (N)"}),o.jsx("span",{className:"text-cyan-300",children:e.length})]}),o.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[o.jsx("span",{className:"text-slate-400",children:"Active Epicycles"}),o.jsx("span",{className:"text-fuchsia-400",children:n})]}),o.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[o.jsx("span",{className:"text-slate-400",children:"Current Phase (t)"}),o.jsxs("span",{className:"text-amber-400",children:[(t/(2*Math.PI)).toFixed(2),"Ï„"]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-400",children:"Largest Radius"}),o.jsxs("span",{className:"text-emerald-400",children:[e.length>0?e[0].amp.toFixed(1):"0.0"," px"]})]})]}),o.jsxs("div",{className:"mt-4",children:[o.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Amplitude color map"}),o.jsx("div",{className:"fourier-legend",style:{backgroundImage:ys(((k=e[0])==null?void 0:k.amp)||1)},"aria-label":"Amplitude legend from low to high magnitude"}),o.jsxs("div",{className:"flex justify-between text-[11px] text-slate-500 mt-1",children:[o.jsx("span",{children:"low |X_k|"}),o.jsx("span",{children:"high |X_k|"})]})]}),o.jsxs("div",{className:"mt-4 space-y-2 text-sm font-mono",children:[o.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[o.jsx("span",{className:"text-slate-400",children:"Energy captured (M terms)"}),o.jsxs("span",{className:"text-cyan-300",children:[a.energyPct.toFixed(2),"%"]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-400",children:"RMS error vs. original path"}),o.jsxs("span",{className:"text-amber-300",children:[a.rmsError.toFixed(2)," px"]})]})]}),a.topTerms.length>0&&o.jsxs("div",{className:"mt-4",children:[o.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Top terms (by amplitude)"}),o.jsxs("div",{className:"grid grid-cols-5 text-[11px] text-slate-300 gap-2 border border-slate-800 rounded-lg p-2",children:[o.jsx("span",{className:"font-semibold text-slate-200",children:"k"}),o.jsx("span",{className:"font-semibold text-slate-200",children:"|X_k|"}),o.jsx("span",{className:"font-semibold text-slate-200",children:"phase"}),o.jsx("span",{className:"font-semibold text-slate-200",children:"energy"}),o.jsx("span",{className:"font-semibold text-slate-200",children:"cum."}),a.topTerms.map((b,j)=>o.jsxs(ut.Fragment,{children:[o.jsx("span",{children:b.freq}),o.jsx("span",{children:b.amp.toFixed(2)}),o.jsxs("span",{children:[b.phase.toFixed(2)," rad"]}),o.jsxs("span",{children:[b.energyPct.toFixed(1),"%"]}),o.jsxs("span",{children:[b.cumulativePct.toFixed(1),"%"]})]},j))]})]}),o.jsxs("div",{className:"mt-5 border border-slate-800 rounded-lg p-3 space-y-2 bg-slate-900/40",children:[o.jsxs("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-slate-400",children:[o.jsx("span",{children:"Term inspector"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>p(b=>Math.max(0,b-1)),"aria-label":"Previous term",children:o.jsx(Rn,{size:18,"aria-hidden":"true"})}),o.jsxs("span",{className:"text-slate-200",children:[l+1," / ",e.length||1]}),o.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>p(b=>Math.min(e.length-1,b+1)),"aria-label":"Next term",children:o.jsx(Tn,{size:18,"aria-hidden":"true"})})]})]}),o.jsxs("div",{className:"text-xs text-slate-200 leading-relaxed space-y-2",children:[o.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:N.paramsHtml}}),o.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:N.vectorHtml}}),o.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:N.energyHtml}}),o.jsx("p",{children:c?"Step mode: play once to view this term, then advance.":"Track this circle while playing to see how its phase and magnitude shape the trace."})]})]}),o.jsxs("div",{className:"mt-5 text-xs text-slate-500 italic space-y-2",children:[o.jsx("p",{children:"* Sorted by amplitude so the largest circles draw first."}),o.jsx("p",{children:"Tip: switch formulas to see how truncating to M epicycles shapes the path."})]})]})},Ms=2400,Qe=700,js=1.75,Ns=.45,ks=1e7,Ft="fourier_viz__last_session",Ve=.25,Ye=6,Lt=1.25,Ss=()=>{var wt,Mt,jt,Nt,kt;const[e,t]=m.useState("DRAW"),[n,a]=m.useState([]),[r,c]=m.useState([]),[u,d]=m.useState(0),[f,h]=m.useState(!1),[l,p]=m.useState(0),[w,v]=m.useState(!1),[y,M]=m.useState(!1),[N,k]=m.useState("#0f172a"),[b,j]=m.useState("rgba(148, 163, 184, 0.22)"),[I,O]=m.useState(Ns),[_,U]=m.useState(0),[D,te]=m.useState(90),[X,J]=m.useState([]),[T,C]=m.useState(!1),[E,W]=m.useState(!1),[Y,Q]=m.useState(!1),[B,ce]=m.useState(!1),[$,ne]=m.useState(0),[ye,de]=m.useState(Re),[Ne,tt]=m.useState("#ec4899"),[Fe,He]=m.useState(2),[Xe,ke]=m.useState(!1),fe=m.useRef(null),q=m.useRef(null),Ee=m.useRef(),he=m.useRef([]),Z=m.useRef(!1),me=m.useRef(null),Ue=m.useRef(1),se=m.useRef(null),S=m.useRef(0),ee=m.useRef(null),ie=m.useRef(null),xe=m.useRef(!1),we=m.useRef(!0),H=m.useRef(null),ue=m.useRef(null),We=m.useRef([]),Le=m.useRef(!1),Me=m.useRef(null),pe=m.useRef(null),ge=m.useRef(new Map),be=m.useRef(null),Ze=m.useRef(!1),Ie=m.useRef({mode:e,points:n,fourierX:r,time:u,isPlaying:f,numEpicycles:l,showMath:w,canvasBg:N,gridColor:b,speed:I,brushColor:Ne,brushSize:Fe,stepMode:B,safeMode:Y,stepIndex:$,view:ye}),ve=m.useCallback(()=>{if(H.current){const s=H.current.getContext("2d");s&&(s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,H.current.width,H.current.height))}ue.current=null,We.current=[],Le.current=!1},[]),Ae=m.useCallback(()=>{const s=q.current,g=fe.current;if(!s||!g)return;const{width:i,height:x}=s.getBoundingClientRect(),P=Math.max(1,Math.floor(i)),V=Math.max(1,Math.floor(x));if(P<=1||V<=1)return;const F=window.devicePixelRatio||1;Ue.current=F,s.width=Math.round(P*F),s.height=Math.round(V*F),H.current||(H.current=document.createElement("canvas")),H.current.width=s.width,H.current.height=s.height,ve()},[ve]),nt=m.useCallback(s=>{S.current=s,ee.current=null,ie.current=null,d(s)},[]),st=m.useCallback(()=>{nt(0),ve()},[ve,nt]),Dt=()=>{st()},Ot=m.useCallback(()=>{de(Re)},[]),Xt=m.useCallback(()=>{const s=q.current;if(!s)return;const g=s.getBoundingClientRect(),i={width:g.width,height:g.height};if(!De(i))return;const x=he.current.length?he.current:n;if(!x.length){de(Re);return}de(Tt(x,i,{padding:.9,minScale:Ve,maxScale:Ye}))},[n]),Ge=m.useCallback(s=>{const g=q.current;if(!g)return;const i=g.getBoundingClientRect(),x={width:i.width,height:i.height};if(!De(x))return;const P={x:x.width/2,y:x.height/2};de(V=>Rt(V,x,P,s,Ve,Ye))},[]),Ut=m.useCallback(()=>Ge(Lt),[Ge]),Wt=m.useCallback(()=>Ge(1/Lt),[Ge]),Se=m.useCallback(s=>{var L;if(s.length===0)return;const g=Y?Qe:Ms,{prepared:i,spectrum:x}=hs(s,{smoothing:_,limit:g});a(i),c(x);const P=Math.min(x.length,g);p(Math.max(1,P));const V=(L=q.current)==null?void 0:L.getBoundingClientRect(),F=V?{width:V.width,height:V.height}:null;de(F&&De(F)?Tt(i,F,{padding:.9,minScale:Ve,maxScale:Ye}):Re);try{localStorage.setItem(Ft,JSON.stringify(i))}catch{}st(),h(!0),ne(0)},[st,Y,_]);m.useEffect(()=>{const s=Object.keys(localStorage).filter(i=>i.startsWith("fourier_viz_")).map(i=>i.replace("fourier_viz_","")).sort();J(s);const g=localStorage.getItem(Ft);if(g)try{const i=JSON.parse(g);i.length&&(t("PRESET"),a(i),Se(i))}catch{}},[]),m.useEffect(()=>{const s=()=>{const i=getComputedStyle(document.documentElement),x=i.getPropertyValue("--color-code-bg").trim(),P=i.getPropertyValue("--fourier-grid").trim();k(x||"#0f172a"),j(P||"rgba(148, 163, 184, 0.22)")};s();const g=typeof MutationObserver<"u"?new MutationObserver(s):null;return g&&(g.observe(document.documentElement,{attributes:!0,attributeFilter:["class","data-theme"]}),g.observe(document.body,{attributes:!0,attributeFilter:["class","data-theme"]})),()=>g==null?void 0:g.disconnect()},[]),m.useEffect(()=>{const s=Y?Math.min(r.length,Qe):r.length;s!==0&&p(g=>Math.min(Math.max(g||1,1),s))},[r.length,Y]),m.useEffect(()=>{!B&&$!==0&&ne(0)},[B,$]),m.useEffect(()=>{const s=()=>{C(document.fullscreenElement===fe.current),document.fullscreenElement&&W(!1),Ae()};return document.addEventListener("fullscreenchange",s),()=>document.removeEventListener("fullscreenchange",s)},[Ae]),m.useEffect(()=>{document.body.classList.toggle("fourier-pseudo-fullscreen",E);const s=window.requestAnimationFrame(()=>{Ae()});return()=>{window.cancelAnimationFrame(s),document.body.classList.remove("fourier-pseudo-fullscreen")}},[E,Ae]),m.useEffect(()=>{if(!E)return;const s=g=>{g.key==="Escape"&&W(!1)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[E]);const $t=m.useCallback(()=>{const s=fe.current;if(!s)return;const g=document.fullscreenElement===s;if(g||E){g?document.exitFullscreen().catch(()=>{}):W(!1);return}if(typeof s.requestFullscreen=="function"){const i=window.setTimeout(()=>{document.fullscreenElement!==s&&W(!0)},450);let x=null;try{x=s.requestFullscreen()}catch{window.clearTimeout(i),W(!0);return}Promise.resolve(x).catch(()=>{W(!0)}).finally(()=>{window.clearTimeout(i),document.fullscreenElement!==s&&W(!0)});return}W(!0)},[E]),ze=ut.useMemo(()=>ms(r,n,l),[r,l,n]),mt=(s,g)=>{const i=q.current;if(!i)return null;const x=i.getBoundingClientRect(),P={width:x.width,height:x.height};return De(P)?{viewport:P,screen:{x:s-x.left,y:g-x.top}}:null},xt=(s,g)=>{const i=Ie.current.view;Me.current={pointerId:s,start:g,startOffsetX:i.offsetX,startOffsetY:i.offsetY}},qt=s=>{const g=Array.from(ge.current.entries());if(g.length<2)return;const[i,x]=g,P=i[0],V=x[0],F=i[1],L=x[1],re=L.x-F.x,A=L.y-F.y,oe=Math.hypot(re,A);if(!Number.isFinite(oe)||oe<2)return;const z=Ie.current.view,le={x:(F.x+L.x)/2,y:(F.y+L.y)/2};be.current={ids:[P,V],startDist:oe,startView:z,worldAtMid:Be(le,s,z),viewport:s},Me.current=null},Vt=s=>{const g=mt(s.clientX,s.clientY);if(!g)return;const{viewport:i,screen:x}=g;if(s.pointerType==="touch"){if(Z.current&&me.current!==s.pointerId)return;if(ge.current.set(s.pointerId,x),ge.current.size===2){pe.current=null,qt(i);try{s.currentTarget.setPointerCapture(s.pointerId)}catch{}return}if(ge.current.size>1)return;if(e!=="DRAW"){pe.current=null,xt(s.pointerId,x);try{s.currentTarget.setPointerCapture(s.pointerId)}catch{}return}pe.current={pointerId:s.pointerId,start:x,viewport:i,startView:Ie.current.view};try{s.currentTarget.setPointerCapture(s.pointerId)}catch{}return}if(s.pointerType==="mouse"&&s.button===0&&Ze.current){xt(s.pointerId,x);try{s.currentTarget.setPointerCapture(s.pointerId)}catch{}return}if(e!=="DRAW"||Z.current||s.pointerType==="mouse"&&s.button!==0)return;Z.current=!0,me.current=s.pointerId,ke(!0),a([]),ve(),c([]),h(!1),ne(0),ce(!1);const P=Be(x,i,Ie.current.view);a([P]),he.current=[P],pe.current=null;try{s.currentTarget.setPointerCapture(s.pointerId)}catch{}},Yt=s=>{const g=mt(s.clientX,s.clientY);if(!g)return;const{viewport:i,screen:x}=g;if(s.pointerType==="touch"&&ge.current.has(s.pointerId)){ge.current.set(s.pointerId,x);const A=be.current;if(A&&(s.pointerId===A.ids[0]||s.pointerId===A.ids[1])){const oe=ge.current.get(A.ids[0]),z=ge.current.get(A.ids[1]);if(!oe||!z)return;const le=z.x-oe.x,R=z.y-oe.y,G=Math.hypot(le,R);if(!Number.isFinite(G)||G<2)return;const ae={x:(oe.x+z.x)/2,y:(oe.y+z.y)/2},K=G/A.startDist,Ce=A.startView.scale*K;de(()=>zt(A.worldAtMid,A.viewport,ae,Ce,Ve,Ye));return}}const P=Me.current;if(P&&P.pointerId===s.pointerId){const A=x.x-P.start.x,oe=x.y-P.start.y;de(z=>({...z,offsetX:P.startOffsetX+A,offsetY:P.startOffsetY+oe}));return}if(s.pointerType==="touch"&&e==="DRAW"&&!Z.current){const A=pe.current;if(A&&A.pointerId===s.pointerId&&ge.current.size===1){if(Math.hypot(x.x-A.start.x,x.y-A.start.y)<3)return;Z.current=!0,me.current=s.pointerId,ke(!0),ve(),c([]),h(!1),ne(0),ce(!1);const z=Be(A.start,A.viewport,A.startView);he.current=[z],a([z]),pe.current=null}}if(!Z.current||e!=="DRAW"||me.current!==s.pointerId)return;if(s.pointerType==="mouse"&&(s.buttons&1)===0){Z.current=!1,me.current=null,ke(!1);return}const V=Ie.current.view,F=Be(x,i,V),L=he.current[he.current.length-1],re=js/Math.max(V.scale,.001);Math.hypot(F.x-L.x,F.y-L.y)>re&&he.current.push(F)},Bt=s=>{var i,x;if(!s)return;if(s.pointerType==="touch"&&(ge.current.delete(s.pointerId),be.current&&(be.current.ids[0]===s.pointerId||be.current.ids[1]===s.pointerId)&&(be.current=null),!Z.current&&((i=pe.current)==null?void 0:i.pointerId)===s.pointerId)){pe.current=null;return}if(((x=Me.current)==null?void 0:x.pointerId)===s.pointerId&&(Me.current=null),!Z.current||typeof s.pointerId=="number"&&me.current!==s.pointerId)return;Z.current=!1,me.current=null,ke(!1);const g=he.current;g.length>1?Se(g):(a([]),c([]),h(!1))},Ht=s=>{var g,i;(s==null?void 0:s.pointerType)==="touch"&&(ge.current.delete(s.pointerId),be.current=null,typeof s.pointerId=="number"&&((g=pe.current)==null?void 0:g.pointerId)===s.pointerId&&(pe.current=null)),typeof(s==null?void 0:s.pointerId)=="number"&&((i=Me.current)==null?void 0:i.pointerId)===s.pointerId&&(Me.current=null),Z.current&&(Z.current=!1,me.current=null,ke(!1))},rt=m.useCallback(s=>{if(!s.ctrlKey&&!s.metaKey)return;const g=q.current;if(!g)return;const i=g.getBoundingClientRect(),x={width:i.width,height:i.height};if(!De(x))return;const P={x:s.clientX-i.left,y:s.clientY-i.top};s.preventDefault();const V=Math.exp(-s.deltaY*.0015);de(F=>Rt(F,x,P,V,Ve,Ye))},[]);m.useEffect(()=>{const s=q.current;if(s)return s.addEventListener("wheel",rt,{passive:!1}),()=>{s.removeEventListener("wheel",rt)}},[rt]),m.useEffect(()=>{const s=i=>{var V,F;const x=i.pointerId;if(typeof x=="number"&&(ge.current.delete(x),((V=pe.current)==null?void 0:V.pointerId)===x&&(pe.current=null),((F=Me.current)==null?void 0:F.pointerId)===x&&(Me.current=null),be.current&&(be.current.ids[0]===x||be.current.ids[1]===x)&&(be.current=null)),!Z.current||typeof x=="number"&&me.current!==null&&x!==me.current)return;Z.current=!1,me.current=null,ke(!1);const P=he.current;P.length>1?Se(P):(a([]),c([]),h(!1))},g=()=>{Me.current=null,be.current=null,ge.current.clear(),pe.current=null,Ze.current=!1,s(new Event("blur"))};return window.addEventListener("pointerup",s),window.addEventListener("pointercancel",s),window.addEventListener("blur",g),()=>{window.removeEventListener("pointerup",s),window.removeEventListener("pointercancel",s),window.removeEventListener("blur",g)}},[Se]),m.useEffect(()=>{const s=x=>{if(!(x instanceof HTMLElement))return!1;const P=x.tagName.toLowerCase();return P==="input"||P==="textarea"||P==="select"?!0:x.isContentEditable},g=x=>{x.code==="Space"&&(s(x.target)||(Ze.current=!0,x.preventDefault()))},i=x=>{x.code==="Space"&&(Ze.current=!1)};return window.addEventListener("keydown",g),window.addEventListener("keyup",i),()=>{window.removeEventListener("keydown",g),window.removeEventListener("keyup",i)}},[]);const Zt=()=>{a([]),ve(),c([]),h(!1),t("DRAW"),ne(0),ce(!1),de(Re),he.current=[]},Gt=s=>{let g=[];switch(s){case"circle":g=zn();break;case"square":g=An();break;case"heart":g=_n();break;case"infinity":g=Dn();break;case"note":g=On();break}t("PRESET"),a(g),Se(g)},Kt=()=>{if(n.length<2){alert("Draw something first!");return}const s=prompt("Enter a name for this drawing:");if(s)try{localStorage.setItem(`fourier_viz_${s}`,JSON.stringify(n)),J(g=>{const i=[...g];return i.includes(s)||i.push(s),i.sort()})}catch{alert("Failed to save. Storage might be full.")}},Jt=s=>{const g=localStorage.getItem(`fourier_viz_${s}`);if(g)try{const i=JSON.parse(g);a(i),t("PRESET"),Se(i)}catch(i){console.error("Error loading drawing",i)}},Qt=async s=>{if(s.target.files&&s.target.files[0]){const g=s.target.files[0];if(g.type&&!g.type.startsWith("image/")){alert("Please upload an image file.");return}if(g.size>ks){alert("File too large for in-browser processing. Please pick an image under 10MB.");return}M(!0),se.current=g;try{const i=await Ct(g,900,{detail:D/100});i.length>0?(a(i),t("UPLOAD"),Se(i)):alert("No clear shape found. Try an image with higher contrast.")}catch(i){console.error(i),alert("Error processing image.")}finally{M(!1),s.target.value=""}}};m.useEffect(()=>{if(e!=="UPLOAD")return;const s=se.current;if(!s)return;const g=window.setTimeout(async()=>{M(!0);try{const i=await Ct(s,900,{detail:D/100});i.length>0&&(a(i),Se(i))}catch(i){console.error(i)}finally{M(!1)}},250);return()=>window.clearTimeout(g)},[e,D,Se]);const pt=s=>{if(!r.length)return;ce(!0);const g=Math.min(Math.max(s,0),Math.max(Pe-1,0));ne(g);const i=g+1;l!==i&&p(i),nt(0),ve()},en=()=>pt($-1),tn=()=>pt($+1),nn=()=>{B||ce(!0),h(!0)},gt=m.useCallback((s,g,i,x,P,V)=>{var le;let F=0,L=0;const re=g.slice(0,Math.max(i,1)),A=Math.max(re.length-1,0),oe=((le=g[0])==null?void 0:le.amp)||1,z=1/Math.max(V,.001);for(let R=0;R<re.length;R++){const G=F,ae=L,{freq:K,amp:Ce,phase:at}=re[R],$e=K*x+at,Ke=R===A,qe=bs(re[R],oe,Ke),ct=P&&Ke?1+.25*Math.sin(x*6):1;F+=Ce*Math.cos($e),L+=Ce*Math.sin($e),s.strokeStyle=qe,s.lineWidth=(Ke?1.6*ct:1)*z,s.beginPath(),s.arc(G,ae,Ce,0,2*Math.PI),s.stroke(),s.strokeStyle=qe,s.beginPath(),s.moveTo(G,ae),s.lineTo(F,L),s.stroke(),R===re.length-1&&(s.fillStyle=qe,s.beginPath(),s.arc(F,L,3*z,0,2*Math.PI),s.fill())}return{x:F,y:L}},[]),yt=m.useCallback(s=>{const g=q.current;if(!g)return;const i=g.getContext("2d");if(!i)return;const x=Ie.current,P=Ue.current||1,V=g.width/P,F=g.height/P,L=Math.max(x.view.scale,.001),re=V/2+x.view.offsetX,A=F/2+x.view.offsetY;i.setTransform(1,0,0,1,0,0),i.scale(P,P),i.lineCap="round",i.lineJoin="round",i.fillStyle=x.canvasBg,i.fillRect(0,0,V,F),i.strokeStyle=x.gridColor,i.lineWidth=.5,i.beginPath(),i.moveTo(re,0),i.lineTo(re,F),i.moveTo(0,A),i.lineTo(V,A),i.stroke(),x.points.length>0&&x.mode!=="DRAW"&&(i.save(),i.translate(re,A),i.scale(L,L),i.strokeStyle="rgba(255, 255, 255, 0.1)",i.lineWidth=1/L,i.beginPath(),x.points.forEach((z,le)=>{le===0?i.moveTo(z.x,z.y):i.lineTo(z.x,z.y)}),i.stroke(),i.restore()),x.mode==="DRAW"&&Z.current&&(i.save(),i.translate(re,A),i.scale(L,L),i.strokeStyle=x.brushColor,i.lineWidth=x.brushSize/L,i.beginPath(),he.current.forEach((z,le)=>{le===0?i.moveTo(z.x,z.y):i.lineTo(z.x,z.y)}),i.stroke(),i.restore());const oe=S.current;if(x.fourierX.length>0){if(H.current){const R=H.current.getContext("2d");if(R&&Le.current){Le.current=!1,R.setTransform(1,0,0,1,0,0),R.clearRect(0,0,H.current.width,H.current.height);const G=We.current;if(G.length>1){R.setTransform(1,0,0,1,0,0),R.scale(P,P),R.lineCap="round",R.lineJoin="round",R.translate(re,A),R.scale(L,L),R.strokeStyle=x.brushColor,R.lineWidth=x.brushSize/L,R.beginPath(),R.moveTo(G[0].x,G[0].y);for(let ae=1;ae<G.length;ae++)R.lineTo(G[ae].x,G[ae].y);R.stroke()}}i.drawImage(H.current,0,0,V,F)}const z=Math.min(Math.max(x.numEpicycles,1),x.fourierX.length);i.save(),i.translate(re,A),i.scale(L,L);const le=gt(i,x.fourierX,z,oe,x.stepMode,L);if(i.restore(),x.isPlaying){const R={x:le.x,y:le.y},G=We.current;if(G.length===0)G.push(R);else{const ae=G[G.length-1];if((ae.x!==R.x||ae.y!==R.y)&&(G.push(R),H.current)){const K=H.current.getContext("2d");K&&(K.setTransform(1,0,0,1,0,0),K.scale(P,P),K.lineCap="round",K.lineJoin="round",K.translate(re,A),K.scale(L,L),K.strokeStyle=x.brushColor,K.lineWidth=x.brushSize/L,K.beginPath(),K.moveTo(ae.x,ae.y),K.lineTo(R.x,R.y),K.stroke())}}ue.current=R}else ue.current={x:le.x,y:le.y};if(x.isPlaying){const R=Math.max(x.points.length||x.fourierX.length,1),G=2*Math.PI/R,ae=ee.current,K=ae==null?0:Math.min(Math.max(s-ae,0),80);ee.current=s;const Ce=K/(1e3/60),at=G*x.speed*Ce,$e=oe+at;if($e>=2*Math.PI){if(S.current=0,ve(),x.stepMode){h(!1);const qe=x.safeMode?Math.min(x.fourierX.length,Qe):x.fourierX.length;ne(ct=>Math.min(ct+1,Math.max(qe-1,0)))}}else S.current=$e}else ee.current=s}else ee.current=s;if(x.showMath){const z=ie.current;(z==null||s-z>=50)&&(d(S.current),ie.current=s)}else ie.current=null},[ve,gt]),ot=m.useCallback(s=>{const i=Ie.current.isPlaying||Z.current;(we.current||i)&&(yt(s),we.current=!1),i?Ee.current=requestAnimationFrame(ot):(xe.current=!1,ee.current=null,ie.current=null)},[yt]),_e=m.useCallback(()=>{we.current=!0,!xe.current&&(xe.current=!0,ee.current=null,Ee.current=requestAnimationFrame(ot))},[ot]);m.useEffect(()=>{Ie.current={mode:e,points:n,fourierX:r,time:u,isPlaying:f,numEpicycles:l,showMath:w,canvasBg:N,gridColor:b,speed:I,brushColor:Ne,brushSize:Fe,stepMode:B,safeMode:Y,stepIndex:$,view:ye},_e()},[e,n,r,u,f,l,w,N,b,I,Ne,Fe,B,Y,$,ye,_e]),m.useEffect(()=>{Le.current=!0},[ye.offsetX,ye.offsetY,ye.scale]),m.useEffect(()=>(_e(),()=>{Ee.current&&cancelAnimationFrame(Ee.current)}),[_e]),m.useEffect(()=>{const s=()=>{Ae(),_e()};s();const g=typeof ResizeObserver<"u"?new ResizeObserver(s):null;return g&&(fe.current&&g.observe(fe.current),q.current&&g.observe(q.current)),window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s),g==null||g.disconnect()}},[Ae,_e]),m.useEffect(()=>{ve()},[l,r]),m.useEffect(()=>{const s=document.getElementById("fourier-root");return s==null||s.classList.add("is-mounted"),()=>{s==null||s.classList.remove("is-mounted")}},[]);const Pe=Y?Math.min(r.length,Qe):r.length,bt=Math.max(Math.min(l-1,(((wt=ze.breakdown)==null?void 0:wt.length)||1)-1),0),sn=((jt=(Mt=ze.breakdown)==null?void 0:Mt[bt])==null?void 0:jt.energyPct)??0,rn=((kt=(Nt=ze.breakdown)==null?void 0:Nt[bt])==null?void 0:kt.cumulativePct)??ze.energyPct,vt=T||E;return m.useEffect(()=>{if(!B)return;const s=Math.min(Math.max($+1,1),Math.max(Pe,1));l!==s&&p(s)},[B,$,Pe,l]),m.useEffect(()=>{const s=Math.max(Math.min(l-1,Pe-1),0);$>s&&ne(s)},[l,Pe,$]),o.jsxs("div",{className:`fourier-stage select-none ${vt?"is-fullscreen":""} ${E?"is-pseudo-fullscreen":""}`,ref:fe,"data-mode":e,"data-drawing":Xe?"true":"false","data-has-spectrum":r.length>0?"true":"false","data-points":n.length,"data-epicycles":l,"data-terms":r.length,"data-view-scale":ye.scale.toFixed(4),children:[o.jsx("canvas",{ref:q,onPointerDown:Vt,onPointerMove:Yt,onPointerUp:Bt,onPointerCancel:Ht,className:`fourier-canvas cursor-${e==="DRAW"?"crosshair":"default"}`}),o.jsx(vs,{mode:e,setMode:t,isPlaying:f,setIsPlaying:h,clear:Zt,numEpicycles:l,maxEpicycles:Pe,setNumEpicycles:p,onUpload:Qt,showMath:w,setShowMath:v,onPreset:Gt,speed:I,setSpeed:O,onReset:Dt,brushColor:Ne,setBrushColor:tt,brushSize:Fe,setBrushSize:He,smoothing:_,setSmoothing:U,outlineDetail:D,setOutlineDetail:te,isDrawing:Xe,onSave:Kt,onLoad:Jt,savedDrawings:X,isFullscreen:vt,onToggleFullscreen:$t,safeMode:Y,onToggleSafeMode:()=>Q(s=>!s),stepMode:B,onToggleStepMode:()=>ce(s=>!s),stepIndex:$,stepMax:Pe,onStepPrev:en,onStepNext:tn,onStepPlayOnce:nn,viewScale:ye.scale,onZoomIn:Ut,onZoomOut:Wt,onFitView:Xt,onResetView:Ot}),w&&r.length>0&&o.jsx(ws,{terms:r,time:u,epicycles:l,metrics:ze,focusIndex:B?Math.max(l-1,0):void 0,stepMode:B}),B&&r.length>0&&o.jsxs("div",{className:"absolute top-4 left-4 z-[60] bg-slate-900/80 text-slate-100 border border-slate-700 rounded-lg px-4 py-3 shadow-lg space-y-1",children:[o.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Step mode"}),o.jsxs("div",{className:"text-sm font-semibold",children:["Term ",Math.min(l,Pe)," / ",Math.max(Pe,1)]}),o.jsxs("div",{className:"text-xs text-slate-200",children:["Î”energy ",sn.toFixed(2),"% Â· Cumulative ",rn.toFixed(2),"% Â· RMS ",ze.rmsError.toFixed(2)," px"]})]}),y&&o.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100]",children:o.jsx("div",{className:"text-cyan-400 font-mono text-xl animate-pulse",children:"Processing Image..."})}),e==="DRAW"&&n.length===0&&o.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none text-center",children:[o.jsx("h1",{className:"text-4xl font-bold text-slate-200 mb-2 drop-shadow",children:"Draw Something"}),o.jsx("p",{className:"text-slate-300",children:"Trace a continuous line to begin"})]})]})};async function Ps(){try{const e=new URL("../../assets/js/layout/siteShell.js",window.location.href).toString(),{initSiteShell:t}=await import(e);t("fourier-epicycles")}catch(e){console.error("Site shell failed to initialize:",e)}}const _t=document.getElementById("fourier-root");if(!_t)throw new Error("Could not find root element to mount to");const Es=on.createRoot(_t);Ps().finally(()=>{Es.render(o.jsx(ut.StrictMode,{children:o.jsx(Ss,{})}))});
