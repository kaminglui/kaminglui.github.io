import{r as p,j as n,R as Se,a as gt}from"./react-vendor-CkISVyWX.js";import{A as xt,P as bt,S as yt,F as vt,a as wt,I as jt,b as Mt,C as De,T as Et,c as kt,d as Nt,e as St,M as Pt,f as Lt,R as Tt,g as Ct,h as Rt,i as _t,j as It,G as At,W as $t,k as Ft,l as zt}from"./icons-vendor-D7oP6Icu.js";import{k as me}from"./math-vendor-Ca7EfnBD.js";import"./vendor-Bb8JjhAW.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();const qt=[{id:"about",label:"About"},{id:"learning",label:"Learning"},{id:"posts",label:"Posts"},{id:"projects",label:"Projects"},{id:"experience",label:"Experience"},{id:"education",label:"Education"},{id:"contact",label:"Contact"}],Ve=[{id:"circuit-lab",label:"Circuit Lab",href:"pages/circuit-lab/"},{id:"transformer-lab",label:"Transformer Lab",href:"pages/transformer-lab/"},{id:"ml-playground",label:"ML Playground",href:"pages/ml-playground/"},{id:"fourier-epicycles",label:"Fourier Epicycles",href:"pages/fourier-epicycles/"},{id:"endless-depths",label:"Endless Depths",href:"pages/endless-depths/"}],Ot="Ka Ming Lui";function Ye(e){return e?e==="/"?"/":e.endsWith("/")?e:`${e}/`:""}function Pe(e=""){var i,d;const t=((i=document.documentElement)==null?void 0:i.dataset.navRoot)??((d=document.body)==null?void 0:d.dataset.navRoot)??null;if(typeof t=="string"&&t.trim())return Ye(t.trim());const r=(typeof e=="string"?e:"").split(/[?#]/)[0].replace(/\\/g,"/").split("/").filter(Boolean);return r.length&&r[r.length-1].includes(".")&&r.pop(),r.length===0?"":"../".repeat(r.length)}function Dt(e=""){var i,d;const t=((i=document.body)==null?void 0:i.dataset.currentLab)??((d=document.documentElement)==null?void 0:d.dataset.currentLab)??null;if(t)return t;const a=(typeof e=="string"?e:"").toLowerCase().replace(/\\/g,"/"),r=Ve.find(u=>a.includes(`/${u.id.toLowerCase()}/`));return(r==null?void 0:r.id)??null}function Bt({rootPrefix:e,useLocalAnchors:t}){return qt.map(({id:s,label:a})=>`<li><a href="${t?`#${s}`:`${e}index.html#${s}`}">${a}</a></li>`).join("")}function Ht({rootPrefix:e,currentLabId:t}){return Ve.map(({id:s,label:a,href:r})=>`<li><a href="${r.startsWith("http")?r:`${e}${r}`}"${s===t?' aria-current="page"':""}>${a}</a></li>`).join("")}function Ge(e={}){var w,E,f;const t=e.target??document.querySelector("[data-site-header]")??document.querySelector(".site-header");if(!t)return null;const s=t.querySelector(".nav");if(!(t.hasAttribute("data-site-header")||e.forceRender===!0)&&s||t.dataset.navRendered==="true"&&s)return s;const r=typeof e.rootPrefix=="string"&&e.rootPrefix.trim()||typeof((w=t==null?void 0:t.dataset)==null?void 0:w.navRoot)=="string"&&t.dataset.navRoot.trim(),i=Ye(r??Pe((E=window.location)==null?void 0:E.pathname)),d=e.useLocalAnchors??(i===""||t.dataset.useLocalAnchors==="true"),u=e.currentLab??t.dataset.currentLab??Dt((f=window.location)==null?void 0:f.pathname),h=e.showEditToggle===!0||t.dataset.showEditToggle==="true",c=d?"#hero":`${i}index.html#hero`,m=Bt({rootPrefix:i,useLocalAnchors:d}),x=Ht({rootPrefix:i,currentLabId:u}),b=`
    <div class="container">
      <nav class="nav" aria-label="Primary">
        <a class="logo" href="${c}">${Ot}</a>
        <button class="nav-toggle" type="button" aria-expanded="false" aria-controls="primary-navigation">
          <span class="nav-toggle__bar"></span>
          <span class="nav-toggle__bar"></span>
          <span class="nav-toggle__bar"></span>
          <span class="sr-only">Toggle navigation</span>
        </button>
        <ul class="nav-links" id="primary-navigation" data-visible="false">
          <li class="nav-item nav-item--dropdown">
            <button class="nav-dropdown-toggle nav-pill" type="button" aria-expanded="false" aria-controls="section-menu">
              Sections
              <svg class="nav-dropdown__icon" aria-hidden="true" focusable="false" viewBox="0 0 12 12">
                <path d="M2.47 4.47a.75.75 0 0 1 1.06 0L6 6.94l2.47-2.47a.75.75 0 0 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 0 1 0-1.06Z" />
              </svg>
            </button>
            <ul class="nav-dropdown-menu" id="section-menu" hidden>
              ${m}
            </ul>
          </li>
          <li class="nav-item nav-item--dropdown">
            <button class="nav-dropdown-toggle nav-pill" type="button" aria-expanded="false" aria-controls="labs-menu">
              Labs
              <svg class="nav-dropdown__icon" aria-hidden="true" focusable="false" viewBox="0 0 12 12">
                <path d="M2.47 4.47a.75.75 0 0 1 1.06 0L6 6.94l2.47-2.47a.75.75 0 0 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 0 1 0-1.06Z" />
              </svg>
            </button>
            <ul class="nav-dropdown-menu" id="labs-menu" hidden>
              ${x}
            </ul>
          </li>
        </ul>
        <div class="nav-actions">
          ${h?'<button class="edit-toggle" type="button" aria-pressed="false" hidden>Edit mode</button>':""}
          <button class="theme-toggle" type="button" aria-label="Toggle color theme">
            <span aria-hidden="true">üåô</span>
          </button>
        </div>
      </nav>
    </div>
  `;return t.innerHTML=b.trim(),t.id=t.id||"top",t.classList.add("site-header"),t.dataset.navRendered="true",t.querySelector(".nav")}const be='&copy; <span id="year"></span> Ka Ming Lui. Built with accessibility and performance in mind.',Be={home:{id:"home",layoutClass:"footer__layout",useContentBindings:!0,backToTopLabel:"Back to top"},"ml-playground":{layoutClass:"footer__layout",heading:"Want to explore more ML demos?",body:"Try the transformer lab or reach out to share your favorite visualization ideas.",actions:[{label:"Visit Transformer Lab",href:"pages/transformer-lab/",variant:"primary"},{label:"Email Ka-Ming",href:"mailto:contact@kaminglui.com",variant:"ghost"}],meta:["Curious how this playground works? Inspect the source on GitHub to tweak the algorithm.",be]},"transformer-lab":{layoutClass:"footer__layout",heading:"Ready for more machine learning stories?",body:"Head back to the main site to explore projects, journal entries, and the learning roadmap behind this transformer lab.",actions:[{label:"View projects",href:"index.html#projects",variant:"primary"},{label:"Get in touch",href:"index.html#contact",variant:"ghost"}],meta:["Enjoyed the walkthrough? Share it with fellow ML explorers.",be]},"endless-depths":{layoutClass:"footer__layout",heading:"Back to the main site?",body:"Check out projects, posts, and the ML roadmap that inspired this mini-game.",actions:[{label:"View projects",href:"index.html#projects",variant:"primary"},{label:"Get in touch",href:"index.html#contact",variant:"ghost"}],meta:["Progress saves to your browser so you can pick up where you left off.",'&copy; <span id="year"></span> Ka Ming Lui. Built for performance and accessibility.']}};function ge(e){return e?e==="/"?"/":e.endsWith("/")?e:`${e}/`:""}function Wt(e,t){var a,r,i;if(typeof t=="string"&&t.trim())return ge(t.trim());const s=((a=e==null?void 0:e.dataset)==null?void 0:a.footerRoot)||((r=e==null?void 0:e.dataset)==null?void 0:r.navRoot);return typeof s=="string"&&s.trim()?ge(s.trim()):ge(Pe((i=window.location)==null?void 0:i.pathname))}function Xt(e,t){var a,r;const s=t||((a=e==null?void 0:e.dataset)==null?void 0:a.footerId)||((r=e==null?void 0:e.dataset)==null?void 0:r.footerPreset)||"home";return Be[s]||Be.home}function Ut(e=[],t=""){if(!Array.isArray(e)||e.length===0)return"";const s=ge(t);return e.map(({label:a,href:r,variant:i})=>{if(!a||!r)return"";const u=/^(https?:)?\/\//i.test(r)||r.startsWith("mailto:")||r.startsWith("#")?r:`${s}${r}`,h=["button"];return i==="primary"&&h.push("button--primary"),i==="ghost"&&h.push("button--ghost"),`<a class="${h.join(" ")}" href="${u}">${a}</a>`}).filter(Boolean).join("")}function He(e=[]){return!Array.isArray(e)||e.length===0?"":e.map(t=>`<p>${t}</p>`).join("")}function Vt(e={}){const t=e.target??document.querySelector("[data-site-footer]")??document.querySelector(".site-footer");if(!t)return null;if(t.dataset.footerRendered==="true"||!t.hasAttribute("data-site-footer")&&e.forceRender!==!0)return t;const s=Xt(t,e.preset),a=Wt(t,e.rootPrefix),r=s.layoutClass||"footer__layout";let i="",d="",u="",h="";s.useContentBindings?(i='<h2 data-content="contact.title"></h2>',d='<p data-content="contact.body"></p>',u='<div class="footer__actions" data-contact-actions></div>',h='<p data-content="contact.meta"></p>'+He([be])):(i=s.heading?`<h2>${s.heading}</h2>`:"",d=s.body?`<p>${s.body}</p>`:"",u=`<div class="footer__actions">${Ut(s.actions,a)}</div>`,h=He(s.meta||[be]));const c=s.backToTopLabel||"Back to top";return t.innerHTML=`
    <div class="container ${r}">
      <div>
        ${i}
        ${d}
        ${u}
      </div>
      <div class="footer__meta">
        ${h}
      </div>
    </div>
    <a class="back-to-top" href="#top">${c}</a>
  `.trim(),t.classList.add("site-footer"),t.dataset.footerRendered="true",t}function Yt(){const e=document.getElementById("year")||document.querySelector("[data-year]");e&&(e.textContent=String(new Date().getFullYear()))}const Le=["theme","circuitforge-theme"];function Gt(){if(typeof localStorage>"u")return null;for(const e of Le){const t=localStorage.getItem(e);if(t==="dark"||t==="light")return t}return null}function Jt(e){typeof localStorage>"u"||Le.forEach(t=>{try{localStorage.setItem(t,e)}catch(s){console.warn("Unable to store theme preference",s)}})}function Ee(e){const t=e==="light"?"light":"dark";return typeof document>"u"||(document.body.classList.toggle("theme-dark",t==="dark"),document.body.classList.toggle("theme-light",t==="light"),document.documentElement.classList.toggle("dark",t==="dark"),Jt(t)),t}function ke(e,t){e&&(e.setAttribute("aria-pressed",t==="dark"?"true":"false"),e.innerHTML=t==="dark"?'<span aria-hidden="true">üåô</span>':'<span aria-hidden="true">‚òÄÔ∏è</span>')}function Kt(){const e=Gt();return e||(typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}function Zt({onChange:e}={}){const t=document.querySelector(".theme-toggle"),s=(t==null?void 0:t.dataset.themeBound)==="true",a=Ee(Kt());ke(t,a);const r=u=>{typeof e=="function"&&e(u)},i=u=>{if(typeof localStorage<"u"&&localStorage.getItem(Le[0]))return;const h=Ee(u.matches?"dark":"light");ke(t,h),r(h)},d=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-color-scheme: dark)"):null;return d&&(typeof d.addEventListener=="function"?d.addEventListener("change",i):typeof d.addListener=="function"&&d.addListener(i)),t&&!s&&(t.dataset.themeBound="true",t.addEventListener("click",()=>{const u=document.body.classList.contains("theme-dark")?"dark":"light",h=Ee(u==="dark"?"light":"dark");ke(t,h),r(h)})),r(a),a}function Je(e){if(!e||!e.getBoundingClientRect)return;const{height:t}=e.getBoundingClientRect();Number.isFinite(t)&&t>0&&(document.documentElement.style.setProperty("--nav-height",`${t}px`),document.documentElement.style.setProperty("--header-h",`${t}px`))}function Qt(e){if(!e)return;const t=()=>Je(e);if(typeof ResizeObserver<"u"){const s=new ResizeObserver(t);return s.observe(e),s}return window.addEventListener("resize",t),null}function Te(e){var t;return typeof e=="string"&&e.trim()?e.trim():typeof document<"u"?Pe((t=window.location)==null?void 0:t.pathname):""}function en(e={}){const t=e.target??document.getElementById("site-header")??document.querySelector("[data-site-header]");if(!t)return null;const s=e.pageId||e.currentLab||t.dataset.currentLab,a=Te(e.rootPrefix||t.dataset.navRoot),r=e.showEditToggle??t.dataset.showEditToggle==="true",i=e.useLocalAnchors??s==="home";t.id="top",t.dataset.siteHeader="true",t.dataset.currentLab=s||"",t.dataset.navRoot=a||"";const d=Ge({target:t,currentLab:s,rootPrefix:a,useLocalAnchors:i,showEditToggle:r}),u=(d==null?void 0:d.closest("[data-site-header]"))||t;return Je(u),Qt(u),u}function tn(e={}){const t=e.target??document.getElementById("site-footer")??document.querySelector("[data-site-footer]");if(!t)return null;const s=e.pageId||e.preset||t.dataset.footerId,a=Te(e.rootPrefix||t.dataset.footerRoot);t.dataset.siteFooter="true",t.dataset.footerId=s||"home",t.dataset.footerRoot=a||"";const r=Vt({target:t,preset:s||"home",rootPrefix:a});return r&&Yt(),r}function nn(e="home",t={}){var r,i;const s=e||((i=(r=document.body)==null?void 0:r.dataset)==null?void 0:i.currentLab)||"home",a=Te(t.rootPrefix);en({pageId:s,rootPrefix:a,showEditToggle:t.showEditToggle,useLocalAnchors:t.useLocalAnchors}),Zt(t.themeOptions||{}),s!=="circuit-lab"&&tn({pageId:s,rootPrefix:a})}let We=!1,Ne=!1;function sn(){if(Ne)return;const t=Ge()??document.querySelector(".nav"),s=(t==null?void 0:t.querySelector(".nav-toggle"))??document.querySelector(".nav-toggle"),a=(t==null?void 0:t.querySelector(".nav-links"))??document.querySelector(".nav-links");if(!t||!s||!a)return;if(t.dataset.navEnhanced==="true"){Ne=!0;return}const r=document.body,i=Array.from(t.querySelectorAll(".nav-item--dropdown")),d=[],u=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(hover: none)"):null,h=({except:c}={})=>{let m=!1;return d.forEach(x=>{x!==c&&x.isOpen()&&(x.close(),m=!0)}),m};if(i.forEach(c=>{const m=c.querySelector(".nav-dropdown-toggle"),x=c.querySelector(".nav-dropdown-menu");if(!(m instanceof HTMLElement)||!(x instanceof HTMLElement))return;const y={wrapper:c,toggle:m,menu:x,isOpen:()=>m.getAttribute("aria-expanded")==="true",open:()=>{m.setAttribute("aria-expanded","true"),c.setAttribute("data-open","true"),x.hidden=!1},close:()=>{m.setAttribute("aria-expanded","false"),c.setAttribute("data-open","false"),x.hidden=!0}};y.close(),d.push(y);const b=()=>{h({except:y}),y.open()},w=()=>{},E=()=>{};c.addEventListener("pointerenter",w),c.addEventListener("pointerleave",E),m.addEventListener("pointerenter",w),m.addEventListener("pointerleave",E),x.addEventListener("pointerenter",w),x.addEventListener("pointerleave",E),c.addEventListener("focusin",f=>{const j=f.target;j instanceof HTMLElement&&!j.matches(":focus-visible")||b()}),c.addEventListener("focusout",f=>{const j=f.relatedTarget;(!(j instanceof Node)||!c.contains(j))&&y.close()}),m.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),y.isOpen()?y.close():b()}),m.addEventListener("keydown",f=>{if(f.key==="ArrowDown"){f.preventDefault(),y.isOpen()||b();const j=x.querySelector("a");j instanceof HTMLElement&&j.focus()}else f.key==="Escape"&&y.close()}),x.addEventListener("click",f=>{f.target instanceof HTMLAnchorElement&&h()}),x.addEventListener("keydown",f=>{f.key==="Escape"&&(f.stopPropagation(),y.close(),m.focus())})}),u){const c=()=>{h()};typeof u.addEventListener=="function"?u.addEventListener("change",c):typeof u.addListener=="function"&&u.addListener(c)}window.addEventListener("resize",()=>{h()}),d.length>0&&!We&&(document.addEventListener("pointerdown",c=>{const m=c.target;m instanceof Node&&d.some(({wrapper:x})=>x.contains(m))||h()}),document.addEventListener("keydown",c=>{c.key==="Escape"&&h()}),We=!0),s&&(s.addEventListener("click",()=>{const c=s.getAttribute("aria-expanded")==="true";h(),s.setAttribute("aria-expanded",String(!c)),a==null||a.setAttribute("data-visible",String(!c)),r.classList.toggle("nav-open",!c)}),window.addEventListener("keydown",c=>{c.key==="Escape"&&s.getAttribute("aria-expanded")==="true"&&(s.setAttribute("aria-expanded","false"),a==null||a.setAttribute("data-visible","false"),r.classList.remove("nav-open"),h(),s.focus())}),window.addEventListener("resize",()=>{window.innerWidth>=720&&(s.setAttribute("aria-expanded","false"),a==null||a.setAttribute("data-visible","false"),r.classList.remove("nav-open"),h())})),a==null||a.addEventListener("click",c=>{c.target instanceof HTMLAnchorElement&&(s==null||s.setAttribute("aria-expanded","false"),a.setAttribute("data-visible","false"),r.classList.remove("nav-open"),h())}),t.dataset.navEnhanced="true",Ne=!0}const Xe=()=>sn();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Xe,{once:!0}):Xe();const an=e=>{const t=[],s=e.length;for(let a=0;a<s;a++){let r=0,i=0;for(let c=0;c<s;c++){const m=Math.PI*2*a*c/s,x=Math.cos(m),y=Math.sin(m),b=e[c].re,w=e[c].im;r+=b*x+w*y,i+=w*x-b*y}r=r/s,i=i/s;const d=a,u=Math.sqrt(r*r+i*i),h=Math.atan2(i,r);t.push({re:r,im:i,freq:d,amp:u,phase:h})}return t.sort((a,r)=>r.amp-a.amp)},rn=(e,t)=>{if(t<=0||e.length<2)return[...e];const s=[];for(let a=0;a<e.length;a++){let r=0,i=0,d=0;for(let u=-t;u<=t;u++){const h=a+u;h>=0&&h<e.length&&(r+=e[h].x,i+=e[h].y,d++)}s.push({x:r/d,y:i/d})}return s},on=()=>{const e=[];for(let a=0;a<50;a++)e.push({x:-200+a*2*200/50,y:-200});for(let a=0;a<50;a++)e.push({x:200,y:-200+a*2*200/50});for(let a=0;a<50;a++)e.push({x:200-a*2*200/50,y:200});for(let a=0;a<50;a++)e.push({x:-200,y:200-a*2*200/50});return e},ln=()=>{const e=[];for(let a=0;a<200;a++){const r=Math.PI*2*a/200;e.push({x:200*Math.cos(r),y:200*Math.sin(r)})}return e},cn=()=>{const e=[];for(let s=0;s<300;s++){const a=Math.PI*2*s/300,r=16*Math.pow(Math.sin(a),3),i=-(13*Math.cos(a)-5*Math.cos(2*a)-2*Math.cos(3*a)-Math.cos(4*a));e.push({x:r*15,y:i*15})}return e},dn=()=>{const e=[];for(let a=0;a<300;a++){const r=Math.PI*2*a/300,i=150*Math.cos(r),d=150*Math.sin(r)*Math.cos(r);e.push({x:i,y:d})}return e},un=()=>{const e=[];for(let s=0;s<100;s++){const a=Math.PI*2*s/100;e.push({x:40*Math.cos(a)-50,y:30*Math.sin(a)+100})}for(let s=0;s<20;s++)e.push({x:-10,y:100-200*s/20});for(let s=0;s<30;s++){const a=s/30;e.push({x:-10+50*Math.sin(a*Math.PI),y:-100+50*a})}for(let s=0;s<20;s++)e.push({x:-10,y:-50+150*s/20});return e},hn={threshold:30,sampleRate:3,maxPoints:1500,smoothingWindow:4},fn=e=>{if(e.length===0)return[];const t=[],s=new Set;let a=0;for(t.push(e[0]),s.add(0);t.length<e.length;){let r=1/0,i=-1;const d=e[a];for(let u=0;u<e.length;u++)if(!s.has(u)){const h=e[u],c=(d.x-h.x)**2+(d.y-h.y)**2;c<r&&(r=c,i=u)}if(i!==-1)s.add(i),t.push(e[i]),a=i;else break}return t},mn=(e,t,s,a={})=>{const{threshold:r,sampleRate:i,maxPoints:d,smoothingWindow:u}={...hn,...a},h=[],c=b=>(e[b]+e[b+1]+e[b+2])/3;for(let b=0;b<s;b+=i)for(let w=0;w<t;w+=i){const E=(b*t+w)*4,f=(b*t+(w-1))*4,j=((b-1)*t+w)*4;if(w>0&&b>0){const v=c(E),P=c(f),L=c(j);Math.abs(v-P)+Math.abs(v-L)>r&&h.push({x:w-t/2,y:b-s/2})}}if(h.length===0)return[];let m=h;if(h.length>d){const b=Math.ceil(h.length/d);m=h.filter((w,E)=>E%b===0)}const x=fn(m),y=[];for(let b=0;b<x.length;b++){let w=0,E=0,f=0;for(let j=-u;j<=u;j++){const v=(b+j+x.length)%x.length;w+=x[v].x,E+=x[v].y,f++}y.push({x:w/f,y:E/f})}return y},pn=async(e,t=800,s={})=>new Promise((a,r)=>{const i=new Image,d=URL.createObjectURL(e);i.onload=()=>{const u=document.createElement("canvas"),h=u.getContext("2d");if(!h){r(new Error("Could not get canvas context"));return}let c=i.width,m=i.height;if(c>t){const b=t/c;c=t,m=m*b}u.width=c,u.height=m,h.drawImage(i,0,0,c,m);const x=h.getImageData(0,0,c,m),y=mn(x.data,c,m,s);URL.revokeObjectURL(d),a(y)},i.onerror=u=>r(u),i.src=d}),ye=1500,gn=e=>e.map(t=>({re:t.x,im:t.y})),xn=e=>e&&e>0?e:ye,bn=(e,t=ye)=>{const s=xn(t);if(e.length<=s)return[...e];const a=Math.ceil(e.length/s);return e.filter((r,i)=>i%a===0)},yn=(e,t,s=ye)=>{const a=bn(e,s);return rn(a,t)},vn=(e,t={})=>{const{smoothing:s=0,limit:a=ye}=t,r=yn(e,s,a),i=an(gn(r));return{prepared:r,spectrum:i}},wn=(e,t,s,a=600)=>{if(!e.length||!t.length)return{energyPct:0,rmsError:0,topTerms:[],breakdown:[]};const r=e.map(v=>v.amp*v.amp),i=r.reduce((v,P)=>v+P,0)||1,d=Math.max(Math.min(s||e.length,e.length),1),u=r.slice(0,d).reduce((v,P)=>v+P,0);let h=0;const c=r.map(v=>(h+=v,{energyPct:v/i*100,cumulativePct:h/i*100}));let m=0;const x=e.slice(0,6).map((v,P)=>{const L=r[P];return m+=L,{freq:v.freq,amp:v.amp,phase:v.phase,energyPct:L/i*100,cumulativePct:m/i*100}}),y=t.length,b=Math.max(1,Math.floor(y/a)),w=e.slice(0,d);let E=0,f=0;for(let v=0;v<y;v+=b){let P=0,L=0;for(let O=0;O<w.length;O++){const I=w[O],H=2*Math.PI*I.freq*v/y,J=Math.cos(H),K=Math.sin(H);P+=I.re*J-I.im*K,L+=I.re*K+I.im*J}const _=P-t[v].x,A=L-t[v].y;E+=_*_+A*A,f++}const j=Math.sqrt(E/Math.max(f,1));return{energyPct:Number((u/i*100).toFixed(2)),rmsError:Number(j.toFixed(2)),topTerms:x,breakdown:c}},jn=e=>Math.min(1,Math.max(0,e)),Mn=(e,t)=>!isFinite(e)||t<=0?0:jn(e/t),xe=(e,t,s=!1)=>{const a=Mn(e,t),r=210+110*a,i=s?62:48+6*a,d=s?.95:.6;return`hsla(${r.toFixed(1)}, 82%, ${i.toFixed(1)}%, ${d})`},En=e=>`linear-gradient(90deg, ${xe(0,e)} 0%, ${xe(e*.5,e)} 50%, ${xe(e,e,!0)} 100%)`,kn=(e,t,s)=>xe(e.amp,t,s),Nn=({mode:e,setMode:t,isPlaying:s,setIsPlaying:a,clear:r,numEpicycles:i,maxEpicycles:d,setNumEpicycles:u,onUpload:h,showMath:c,setShowMath:m,onPreset:x,speed:y,setSpeed:b,onReset:w,brushColor:E,setBrushColor:f,brushSize:j,setBrushSize:v,smoothing:P,setSmoothing:L,isDrawing:_,onSave:A,onLoad:O,savedDrawings:I,isFullscreen:H,onToggleFullscreen:J,safeMode:K,onToggleSafeMode:D,stepMode:ue,onToggleStepMode:C,stepIndex:Z,stepMax:F,onStepPrev:W,onStepNext:ae,onStepPlayOnce:ve})=>{const Q=p.useRef(null),z=N=>`
    p-2.5 rounded-lg transition-all duration-200 flex items-center justify-center
    ${N?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50 shadow-[0_0_15px_rgba(6,182,212,0.3)]":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 hover:text-slate-200 border border-transparent"}
  `;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"fourier-toolbar fourier-toolbar--top",children:[n.jsxs("div",{className:"flex gap-1 mr-4 pl-2",children:[n.jsx(xt,{className:"w-5 h-5 text-fuchsia-500"}),n.jsxs("span",{className:"font-bold text-slate-100 hidden sm:block",children:["Fourier",n.jsx("span",{className:"text-fuchsia-500",children:"Viz"})]})]}),n.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),n.jsx("button",{onClick:()=>t("DRAW"),className:z(e==="DRAW"),title:"Freehand Draw",children:n.jsx(bt,{size:20})}),n.jsxs("div",{className:"relative group",children:[n.jsx("button",{className:z(e==="PRESET"),title:"Presets",children:n.jsx(yt,{size:20})}),n.jsxs("div",{className:"absolute top-full left-0 mt-2 w-32 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden hidden group-hover:block",children:[n.jsx("button",{onClick:()=>x("circle"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Circle"}),n.jsx("button",{onClick:()=>x("square"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Square"}),n.jsx("button",{onClick:()=>x("heart"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Heart"}),n.jsx("button",{onClick:()=>x("infinity"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Infinity"}),n.jsx("button",{onClick:()=>x("note"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Note"})]})]}),n.jsxs("div",{className:"relative group",children:[n.jsx("button",{className:z(!1),title:"Load Saved Drawing",children:n.jsx(vt,{size:20})}),n.jsx("div",{className:"absolute top-full left-0 mt-2 w-48 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden hidden group-hover:block max-h-60 overflow-y-auto custom-scrollbar",children:I.length===0?n.jsx("div",{className:"px-4 py-2 text-sm text-slate-500 italic",children:"No saved drawings"}):I.map(N=>n.jsx("button",{onClick:()=>O(N),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400 truncate border-b border-slate-800 last:border-0",children:N},N))})]}),n.jsx("button",{onClick:A,className:z(!1),title:"Save Current Drawing",children:n.jsx(wt,{size:20})}),n.jsx("button",{onClick:()=>{var N;return(N=Q.current)==null?void 0:N.click()},className:z(e==="UPLOAD"),title:"Upload Image",children:n.jsx(jt,{size:20})}),n.jsx("input",{type:"file",ref:Q,onChange:h,accept:"image/*",className:"hidden"}),n.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),n.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-lg transition-all duration-300 ${_?"bg-fuchsia-900/20 ring-1 ring-fuchsia-500/50":""}`,children:[n.jsxs("div",{className:"relative flex items-center group",title:"Brush Color",children:[n.jsx(Mt,{size:18,className:`${_?"text-fuchsia-400":"text-slate-400"} mr-2 transition-colors`}),n.jsx("input",{type:"color",value:E,onChange:N=>f(N.target.value),className:"w-6 h-6 rounded border-none cursor-pointer bg-transparent"})]}),n.jsxs("div",{className:"flex items-center gap-2",title:"Brush Size",children:[n.jsx(De,{size:10,className:"text-slate-400"}),n.jsx("input",{type:"range",min:"1",max:"10",step:"0.5",value:j,onChange:N=>v(parseFloat(N.target.value)),className:"w-16 h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-slate-400"}),n.jsx(De,{size:16,className:`text-slate-400 transition-all ${_?"scale-110 text-fuchsia-300":""}`})]})]}),n.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),n.jsx("button",{onClick:r,className:"p-2.5 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors",title:"Clear Canvas",children:n.jsx(Et,{size:20})}),n.jsx("button",{onClick:()=>m(!c),className:z(c),title:"Toggle Math Panel",children:n.jsx(kt,{size:20})}),n.jsx("button",{onClick:D,className:z(K),title:"Toggle safe mode (cap epicycles / lighten rendering)",children:n.jsx(Nt,{size:20})}),n.jsx("button",{onClick:C,className:z(ue),title:"Toggle step-through playback",children:n.jsx(St,{size:20})}),n.jsx("button",{onClick:J,className:z(H),title:H?"Exit Fullscreen":"Fullscreen Play",children:H?n.jsx(Pt,{size:20}):n.jsx(Lt,{size:20})})]}),n.jsx("div",{className:"fourier-toolbar fourier-toolbar--bottom",children:n.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("button",{onClick:w,className:"p-3 rounded-full bg-slate-800 text-slate-300 hover:bg-slate-700 hover:text-white transition-all",title:"Reset Animation",children:n.jsx(Tt,{size:18})}),n.jsx("button",{onClick:()=>a(!s),className:"w-14 h-14 flex items-center justify-center rounded-full bg-cyan-500 text-slate-950 hover:bg-cyan-400 transition-all shadow-[0_0_20px_rgba(6,182,212,0.4)]",children:s?n.jsx(Ct,{fill:"currentColor",size:24}):n.jsx(Rt,{fill:"currentColor",className:"ml-1",size:24})}),ue&&n.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/70 rounded-full px-3 py-2 border border-slate-700",children:[n.jsx("button",{onClick:W,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Previous term",children:n.jsx(_t,{size:16})}),n.jsx("button",{onClick:ve,className:"px-3 py-2 rounded-full bg-amber-400 text-slate-900 font-semibold hover:bg-amber-300 transition",title:"Play this term once",children:"Step"}),n.jsx("button",{onClick:ae,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Next term",children:n.jsx(It,{size:16})}),n.jsxs("span",{className:"text-xs text-slate-300 font-semibold ml-1",children:["Term ",Z+1," / ",Math.max(F,1)]})]})]}),n.jsxs("div",{className:"flex-1 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 w-full",children:[n.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[n.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[n.jsx("span",{children:"Precision"}),n.jsxs("span",{className:"text-cyan-400",children:[i," / ",d,K?" (capped)":""]})]}),n.jsx("input",{type:"range",min:"1",max:d||1,value:i,onChange:N=>u(parseInt(N.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),n.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[n.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(At,{size:12}),n.jsx("span",{children:"Speed"})]}),n.jsxs("span",{className:"text-amber-400",children:[y.toFixed(2),"x"]})]}),n.jsx("input",{type:"range",min:"0.05",max:"3",step:"0.05",value:y,onChange:N=>b(parseFloat(N.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-amber-500"})]}),n.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[n.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx($t,{size:12}),n.jsx("span",{children:"Smoothness"})]}),n.jsxs("span",{className:"text-emerald-400",children:[P,"px"]})]}),n.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:P,onChange:N=>L(parseInt(N.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]})]})]})})]})},Sn=({terms:e,time:t,epicycles:s,metrics:a,focusIndex:r,stepMode:i=!1})=>{var E;const d=p.useRef(null),[u,h]=p.useState("dft"),[c,m]=p.useState(0),x=p.useMemo(()=>{const f=e[0],j=e.length||1,v=(t/(2*Math.PI)).toFixed(2);return{n:j,largestRadius:f?f.amp.toFixed(1):"0.0",maxFreq:f?f.freq:0,phaseTurns:v,dominantPhase:f?f.phase.toFixed(2):"0.00"}},[e,t]),y=p.useMemo(()=>{const f=e[Math.min(c,Math.max(e.length-1,0))];return f||{freq:0,amp:0,phase:0}},[c,e]),b=a.breakdown?a.breakdown[Math.min(c,Math.max(a.breakdown.length-1,0))]??{energyPct:0,cumulativePct:0}:{energyPct:0,cumulativePct:0},w=p.useMemo(()=>{const f={throwOnError:!1},j=x.n||1,v=y.freq,P=y.amp.toFixed(3),L=y.phase.toFixed(3),_=b.energyPct.toFixed(2),A=b.cumulativePct.toFixed(2);return{paramsHtml:me.renderToString(`k = ${v},\\quad |X_k| = ${P},\\quad \\phi_k = ${L}\\,\\text{rad}`,f),vectorHtml:me.renderToString(`\\text{Vector}_k(t) = |X_k|\\,e^{i\\left(2\\pi k t/${j} + \\phi_k\\right)}`,f),energyHtml:me.renderToString(`\\Delta\\text{energy} = ${_}\\%\\quad \\text{cum.} = ${A}\\%`,f)}},[b,y.amp,y.freq,y.phase,x.n]);return p.useEffect(()=>{var O,I;if(!d.current)return;const{n:f,phaseTurns:j,dominantPhase:v}=x,P=Math.max(s,1),L=((O=e[0])==null?void 0:O.freq)??0,_=((I=e[0])==null?void 0:I.amp)??0,A={dft:`
      \\begin{aligned}
        X_k &= \\frac{1}{N} \\sum_{n=0}^{N-1} x_n e^{-i 2\\pi kn / N} \\\\
        &\\textcolor{#f472b6}{N = ${f}},\\; \\textcolor{#22c55e}{k \\in [0, N-1]}
      \\end{aligned}
      `,reconstruction:`
      \\begin{aligned}
        x(t) &\\approx \\sum_{k=0}^{${P-1}} \\left|X_k\\right| e^{i\\left(2\\pi kt/${f} + \\phi_k\\right)} \\\\
        &\\textcolor{#22c55e}{\\left|X_{${L}}\\right| = ${_.toFixed(2)}},\\;
          \\textcolor{#f472b6}{\\phi_{${L}} = ${v}}\\;\\text{rad}
      \\end{aligned}
      `,phasor:`
      \\begin{aligned}
        \\text{Epicycle}_k(t) &= r_k e^{i(\\omega_k t + \\phi_k)} \\\\
        r_k &= \\left|X_k\\right|,\\;
        \\omega_k = 2\\pi k / N,\\;
        t = ${j}\\,\\tau
      \\end{aligned}
      `};me.render(A[u],d.current,{throwOnError:!1,displayMode:!0})},[u,s,x,e]),p.useEffect(()=>{h("dft"),m(0)},[e.length]),p.useEffect(()=>{if(typeof r=="number"&&e.length>0){const f=Math.min(Math.max(r,0),e.length-1);m(f)}},[r,e.length]),n.jsxs("div",{className:"fourier-math-panel",children:[n.jsx("h3",{className:"text-xl font-bold mb-4 text-cyan-400",children:"Fourier Engine"}),n.jsxs("div",{className:"fourier-math-toggle",role:"group","aria-label":"Toggle formulas",children:[n.jsx("button",{type:"button",className:u==="dft"?"is-active":"",onClick:()=>h("dft"),children:"DFT basis"}),n.jsx("button",{type:"button",className:u==="reconstruction"?"is-active":"",onClick:()=>h("reconstruction"),children:"Reconstruction"}),n.jsx("button",{type:"button",className:u==="phasor"?"is-active":"",onClick:()=>h("phasor"),children:"Phasor anatomy"})]}),n.jsx("div",{className:"mb-4",ref:d,"aria-live":"polite"}),n.jsxs("div",{className:"space-y-4 text-sm font-mono",children:[n.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[n.jsx("span",{className:"text-slate-400",children:"Total Vectors (N)"}),n.jsx("span",{className:"text-cyan-300",children:e.length})]}),n.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[n.jsx("span",{className:"text-slate-400",children:"Active Epicycles"}),n.jsx("span",{className:"text-fuchsia-400",children:s})]}),n.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[n.jsx("span",{className:"text-slate-400",children:"Current Phase (t)"}),n.jsxs("span",{className:"text-amber-400",children:[(t/(2*Math.PI)).toFixed(2),"œÑ"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-slate-400",children:"Largest Radius"}),n.jsxs("span",{className:"text-emerald-400",children:[e.length>0?e[0].amp.toFixed(1):"0.0"," px"]})]})]}),n.jsxs("div",{className:"mt-4",children:[n.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Amplitude color map"}),n.jsx("div",{className:"fourier-legend",style:{backgroundImage:En(((E=e[0])==null?void 0:E.amp)||1)},"aria-label":"Amplitude legend from low to high magnitude"}),n.jsxs("div",{className:"flex justify-between text-[11px] text-slate-500 mt-1",children:[n.jsx("span",{children:"low |X_k|"}),n.jsx("span",{children:"high |X_k|"})]})]}),n.jsxs("div",{className:"mt-4 space-y-2 text-sm font-mono",children:[n.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[n.jsx("span",{className:"text-slate-400",children:"Energy captured (M terms)"}),n.jsxs("span",{className:"text-cyan-300",children:[a.energyPct.toFixed(2),"%"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-slate-400",children:"RMS error vs. original path"}),n.jsxs("span",{className:"text-amber-300",children:[a.rmsError.toFixed(2)," px"]})]})]}),a.topTerms.length>0&&n.jsxs("div",{className:"mt-4",children:[n.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Top terms (by amplitude)"}),n.jsxs("div",{className:"grid grid-cols-5 text-[11px] text-slate-300 gap-2 border border-slate-800 rounded-lg p-2",children:[n.jsx("span",{className:"font-semibold text-slate-200",children:"k"}),n.jsx("span",{className:"font-semibold text-slate-200",children:"|X_k|"}),n.jsx("span",{className:"font-semibold text-slate-200",children:"phase"}),n.jsx("span",{className:"font-semibold text-slate-200",children:"energy"}),n.jsx("span",{className:"font-semibold text-slate-200",children:"cum."}),a.topTerms.map((f,j)=>n.jsxs(Se.Fragment,{children:[n.jsx("span",{children:f.freq}),n.jsx("span",{children:f.amp.toFixed(2)}),n.jsxs("span",{children:[f.phase.toFixed(2)," rad"]}),n.jsxs("span",{children:[f.energyPct.toFixed(1),"%"]}),n.jsxs("span",{children:[f.cumulativePct.toFixed(1),"%"]})]},j))]})]}),n.jsxs("div",{className:"mt-5 border border-slate-800 rounded-lg p-3 space-y-2 bg-slate-900/40",children:[n.jsxs("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-slate-400",children:[n.jsx("span",{children:"Term inspector"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>m(f=>Math.max(0,f-1)),"aria-label":"Previous term",children:n.jsx(Ft,{size:18,"aria-hidden":"true"})}),n.jsxs("span",{className:"text-slate-200",children:[c+1," / ",e.length||1]}),n.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>m(f=>Math.min(e.length-1,f+1)),"aria-label":"Next term",children:n.jsx(zt,{size:18,"aria-hidden":"true"})})]})]}),n.jsxs("div",{className:"text-xs text-slate-200 leading-relaxed space-y-2",children:[n.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:w.paramsHtml}}),n.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:w.vectorHtml}}),n.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:w.energyHtml}}),n.jsx("p",{children:i?"Step mode: play once to view this term, then advance.":"Track this circle while playing to see how its phase and magnitude shape the trace."})]})]}),n.jsxs("div",{className:"mt-5 text-xs text-slate-500 italic space-y-2",children:[n.jsx("p",{children:"* Sorted by amplitude so the largest circles draw first."}),n.jsx("p",{children:"Tip: switch formulas to see how truncating to M epicycles shapes the path."})]})]})},Pn=1600,pe=700,Ln=1.75,Tn=.45,Cn=3e6,Ue="fourier_viz__last_session",Rn=()=>{var Ae,$e,Fe,ze,qe;const[e,t]=p.useState("DRAW"),[s,a]=p.useState([]),[r,i]=p.useState([]),[d,u]=p.useState(0),[h,c]=p.useState(!1),[m,x]=p.useState(0),[y,b]=p.useState(!0),[w,E]=p.useState(!1),[f,j]=p.useState("#0f172a"),[v,P]=p.useState("rgba(148, 163, 184, 0.22)"),[L,_]=p.useState(Tn),[A,O]=p.useState(0),[I,H]=p.useState([]),[J,K]=p.useState(!1),[D,ue]=p.useState(!1),[C,Z]=p.useState(!1),[F,W]=p.useState(0),[ae,ve]=p.useState("#ec4899"),[Q,z]=p.useState(2),[N,ie]=p.useState(!1),re=p.useRef(null),ee=p.useRef(null),we=p.useRef(),Y=p.useRef([]),q=p.useRef(!1),X=p.useRef(null),Ce=p.useRef(1),$=p.useRef(null),te=p.useRef(null),U=p.useCallback(()=>{if($.current){const o=$.current.getContext("2d");o&&(o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,$.current.width,$.current.height))}te.current=null},[]),he=p.useCallback(()=>{const o=ee.current,l=re.current;if(!o||!l)return;const{width:g,height:M}=o.getBoundingClientRect(),k=Math.max(1,Math.floor(g)),R=Math.max(1,Math.floor(M));if(k<=1||R<=1)return;const S=window.devicePixelRatio||1;Ce.current=S,o.width=Math.round(k*S),o.height=Math.round(R*S),$.current||($.current=document.createElement("canvas")),$.current.width=o.width,$.current.height=o.height,U()},[U]),je=p.useCallback(()=>{u(0),U()},[U]),Ze=()=>{je()},ne=p.useCallback(o=>{if(o.length===0)return;const l=D?pe:Pn,{prepared:g,spectrum:M}=vn(o,{smoothing:A,limit:l});a(g),i(M),x(Math.min(M.length,l));try{localStorage.setItem(Ue,JSON.stringify(g))}catch{}je(),c(!0),W(0)},[je,D,A]);p.useEffect(()=>{const o=Object.keys(localStorage).filter(g=>g.startsWith("fourier_viz_")).map(g=>g.replace("fourier_viz_","")).sort();H(o);const l=localStorage.getItem(Ue);if(l)try{const g=JSON.parse(l);g.length&&(t("PRESET"),a(g),ne(g))}catch{}},[]),p.useEffect(()=>{const o=()=>{const g=getComputedStyle(document.documentElement),M=g.getPropertyValue("--color-code-bg").trim(),k=g.getPropertyValue("--fourier-grid").trim();j(M||"#0f172a"),P(k||"rgba(148, 163, 184, 0.22)")};o();const l=typeof MutationObserver<"u"?new MutationObserver(o):null;return l&&(l.observe(document.documentElement,{attributes:!0,attributeFilter:["class","data-theme"]}),l.observe(document.body,{attributes:!0,attributeFilter:["class","data-theme"]})),()=>l==null?void 0:l.disconnect()},[]),p.useEffect(()=>{const o=D?Math.min(r.length,pe):r.length;o!==0&&x(l=>Math.min(Math.max(l||1,1),o))},[r.length,D]),p.useEffect(()=>{!C&&F!==0&&W(0)},[C,F]),p.useEffect(()=>{const o=()=>{K(document.fullscreenElement===re.current),he()};return document.addEventListener("fullscreenchange",o),()=>document.removeEventListener("fullscreenchange",o)},[he]);const Qe=p.useCallback(()=>{const o=re.current;o&&(document.fullscreenElement?document.exitFullscreen().catch(()=>{}):o.requestFullscreen().catch(()=>{}))},[]),oe=Se.useMemo(()=>wn(r,s,m),[r,m,s]),et=o=>{if(e!=="DRAW"||q.current||o.pointerType==="mouse"&&o.button!==0)return;q.current=!0,X.current=o.pointerId,ie(!0),a([]),U(),i([]),c(!1),W(0),Z(!1);const l=ee.current.getBoundingClientRect(),g=o.clientX-l.left-l.width/2,M=o.clientY-l.top-l.height/2,k={x:g,y:M};a([k]),Y.current=[k];try{o.currentTarget.setPointerCapture(o.pointerId)}catch{}},tt=o=>{if(!q.current||e!=="DRAW"||X.current!==o.pointerId)return;if(o.pointerType==="mouse"&&(o.buttons&1)===0){q.current=!1,X.current=null,ie(!1);return}const l=ee.current.getBoundingClientRect(),g=o.clientX-l.left-l.width/2,M=o.clientY-l.top-l.height/2,k={x:g,y:M},R=Y.current[Y.current.length-1];Math.hypot(k.x-R.x,k.y-R.y)>Ln&&Y.current.push(k)},nt=o=>{if(!q.current||typeof(o==null?void 0:o.pointerId)=="number"&&X.current!==o.pointerId)return;q.current=!1,X.current=null,ie(!1);const l=Y.current;l.length>1?ne(l):(a([]),i([]),c(!1))},st=()=>{q.current&&(q.current=!1,X.current=null,ie(!1))};p.useEffect(()=>{const o=l=>{if(!q.current)return;const g=l.pointerId;if(typeof g=="number"&&X.current!==null&&g!==X.current)return;q.current=!1,X.current=null,ie(!1);const M=Y.current;M.length>1?ne(M):(a([]),i([]),c(!1))};return window.addEventListener("pointerup",o),window.addEventListener("pointercancel",o),window.addEventListener("blur",o),()=>{window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",o),window.removeEventListener("blur",o)}},[ne]);const at=()=>{a([]),U(),i([]),c(!1),t("DRAW"),W(0),Z(!1),Y.current=[]},rt=o=>{let l=[];switch(o){case"circle":l=ln();break;case"square":l=on();break;case"heart":l=cn();break;case"infinity":l=dn();break;case"note":l=un();break}t("PRESET"),a(l),ne(l)},ot=()=>{if(s.length<2){alert("Draw something first!");return}const o=prompt("Enter a name for this drawing:");if(o)try{localStorage.setItem(`fourier_viz_${o}`,JSON.stringify(s)),H(l=>{const g=[...l];return g.includes(o)||g.push(o),g.sort()})}catch{alert("Failed to save. Storage might be full.")}},it=o=>{const l=localStorage.getItem(`fourier_viz_${o}`);if(l)try{const g=JSON.parse(l);a(g),t("PRESET"),ne(g)}catch(g){console.error("Error loading drawing",g)}},lt=async o=>{if(o.target.files&&o.target.files[0]){const l=o.target.files[0];if(l.size>Cn){alert("File too large for browser processing. Please pick an image under 3MB.");return}E(!0);try{const g=await pn(l);g.length>0?(a(g),t("UPLOAD"),ne(g)):alert("No clear shape found. Try an image with higher contrast.")}catch(g){console.error(g),alert("Error processing image.")}finally{E(!1)}}},Re=o=>{if(!r.length)return;Z(!0);const l=Math.min(Math.max(o,0),Math.max(V-1,0));W(l);const g=l+1;m!==g&&x(g),u(0),U(),te.current=null},ct=()=>Re(F-1),dt=()=>Re(F+1),ut=()=>{C||Z(!0),c(!0)},ht=(o,l,g,M,k)=>{let R=l/2,S=g/2;const B=r.slice(0,Math.max(m,1));for(let G=0;G<B.length;G++){const se=R,T=S,{freq:Oe,amp:le,phase:fe}=B[G],Me=Oe*d+fe,ce=G===M,de=kn(B[G],k,ce),pt=C&&ce?1+.25*Math.sin(d*6):1;R+=le*Math.cos(Me),S+=le*Math.sin(Me),o.strokeStyle=de,o.lineWidth=ce?1.6*pt:1,o.beginPath(),o.arc(se,T,le,0,2*Math.PI),o.stroke(),o.strokeStyle=de,o.beginPath(),o.moveTo(se,T),o.lineTo(R,S),o.stroke(),G===B.length-1&&(o.fillStyle=de,o.beginPath(),o.arc(R,S,3,0,2*Math.PI),o.fill())}return{x:R,y:S}},_e=p.useCallback(()=>{var R;const o=ee.current;if(!o)return;const l=o.getContext("2d");if(!l)return;const g=Ce.current||1,M=o.width/g,k=o.height/g;if(l.setTransform(1,0,0,1,0,0),l.scale(g,g),l.lineCap="round",l.lineJoin="round",l.fillStyle=f,l.fillRect(0,0,M,k),l.strokeStyle=v,l.lineWidth=.5,l.beginPath(),l.moveTo(M/2,0),l.lineTo(M/2,k),l.moveTo(0,k/2),l.lineTo(M,k/2),l.stroke(),s.length>0&&e!=="DRAW"&&(l.strokeStyle="rgba(255, 255, 255, 0.1)",l.lineWidth=1,l.lineCap="round",l.lineJoin="round",l.beginPath(),s.forEach((S,B)=>{B===0?l.moveTo(S.x+M/2,S.y+k/2):l.lineTo(S.x+M/2,S.y+k/2)}),l.stroke()),e==="DRAW"&&q.current&&(l.strokeStyle=ae,l.lineWidth=Q,l.lineCap="round",l.lineJoin="round",l.beginPath(),Y.current.forEach((S,B)=>{B===0?l.moveTo(S.x+M/2,S.y+k/2):l.lineTo(S.x+M/2,S.y+k/2)}),l.stroke()),r.length>0){$.current&&l.drawImage($.current,0,0,M,k);const S=Math.min(Math.max(m,1),r.length),B=Math.max(S-1,0),G=((R=r[0])==null?void 0:R.amp)||1,se=ht(l,M,k,B,G);if($.current){const T=$.current.getContext("2d");T&&(T.setTransform(1,0,0,1,0,0),T.scale(g,g),T.strokeStyle=ae,T.lineWidth=Q,T.lineCap="round",T.lineJoin="round",te.current&&(T.beginPath(),T.moveTo(te.current.x,te.current.y),T.lineTo(se.x,se.y),T.stroke()))}if(te.current={x:se.x,y:se.y},h){const T=Math.max(s.length||r.length,1),le=2*Math.PI/T*L,fe=d+le;if(fe>=2*Math.PI){if(u(0),U(),te.current=null,C){c(!1);const ce=D?Math.min(r.length,pe):r.length;W(de=>Math.min(de+1,Math.max(ce-1,0)))}}else u(fe)}}},[r,h,d,e,s,m,L,ae,Q,f,v,C,D]);p.useEffect(()=>(we.current=requestAnimationFrame(_e),()=>{we.current&&cancelAnimationFrame(we.current)}),[_e]),p.useEffect(()=>{const o=()=>he();o();const l=typeof ResizeObserver<"u"?new ResizeObserver(o):null;return l&&(re.current&&l.observe(re.current),ee.current&&l.observe(ee.current)),window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o),l==null||l.disconnect()}},[he]),p.useEffect(()=>{U()},[m,r]),p.useEffect(()=>{const o=document.getElementById("fourier-root");return o==null||o.classList.add("is-mounted"),()=>{o==null||o.classList.remove("is-mounted")}},[]);const V=D?Math.min(r.length,pe):r.length,Ie=Math.max(Math.min(m-1,(((Ae=oe.breakdown)==null?void 0:Ae.length)||1)-1),0),ft=((Fe=($e=oe.breakdown)==null?void 0:$e[Ie])==null?void 0:Fe.energyPct)??0,mt=((qe=(ze=oe.breakdown)==null?void 0:ze[Ie])==null?void 0:qe.cumulativePct)??oe.energyPct;return p.useEffect(()=>{if(!C)return;const o=Math.min(Math.max(F+1,1),Math.max(V,1));m!==o&&x(o)},[C,F,V,m]),p.useEffect(()=>{const o=Math.max(Math.min(m-1,V-1),0);F>o&&W(o)},[m,V,F]),n.jsxs("div",{className:`fourier-stage select-none ${J?"is-fullscreen":""}`,ref:re,"data-mode":e,"data-drawing":N?"true":"false","data-has-spectrum":r.length>0?"true":"false","data-points":s.length,children:[n.jsx("canvas",{ref:ee,onPointerDown:et,onPointerMove:tt,onPointerUp:nt,onPointerCancel:st,className:`fourier-canvas cursor-${e==="DRAW"?"crosshair":"default"}`}),n.jsx(Nn,{mode:e,setMode:t,isPlaying:h,setIsPlaying:c,clear:at,numEpicycles:m,maxEpicycles:V,setNumEpicycles:x,onUpload:lt,showMath:y,setShowMath:b,onPreset:rt,speed:L,setSpeed:_,onReset:Ze,brushColor:ae,setBrushColor:ve,brushSize:Q,setBrushSize:z,smoothing:A,setSmoothing:O,isDrawing:N,onSave:ot,onLoad:it,savedDrawings:I,isFullscreen:J,onToggleFullscreen:Qe,safeMode:D,onToggleSafeMode:()=>ue(o=>!o),stepMode:C,onToggleStepMode:()=>Z(o=>!o),stepIndex:F,stepMax:V,onStepPrev:ct,onStepNext:dt,onStepPlayOnce:ut}),y&&r.length>0&&n.jsx(Sn,{terms:r,time:d,epicycles:m,metrics:oe,focusIndex:C?Math.max(m-1,0):void 0,stepMode:C}),C&&r.length>0&&n.jsxs("div",{className:"absolute top-4 left-4 z-[60] bg-slate-900/80 text-slate-100 border border-slate-700 rounded-lg px-4 py-3 shadow-lg space-y-1",children:[n.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Step mode"}),n.jsxs("div",{className:"text-sm font-semibold",children:["Term ",Math.min(m,V)," / ",Math.max(V,1)]}),n.jsxs("div",{className:"text-xs text-slate-200",children:["Œîenergy ",ft.toFixed(2),"% ¬∑ Cumulative ",mt.toFixed(2),"% ¬∑ RMS ",oe.rmsError.toFixed(2)," px"]})]}),w&&n.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100]",children:n.jsx("div",{className:"text-cyan-400 font-mono text-xl animate-pulse",children:"Processing Image..."})}),e==="DRAW"&&s.length===0&&n.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none text-center",children:[n.jsx("h1",{className:"text-4xl font-bold text-slate-200 mb-2 drop-shadow",children:"Draw Something"}),n.jsx("p",{className:"text-slate-300",children:"Trace a continuous line to begin"})]})]})};nn("fourier-epicycles");const Ke=document.getElementById("fourier-root");if(!Ke)throw new Error("Could not find root element to mount to");const _n=gt.createRoot(Ke);_n.render(n.jsx(Se.StrictMode,{children:n.jsx(Rn,{})}));
