import{r as w,j as o,R as Ye,a as Xt}from"./react-vendor-CkISVyWX.js";import{A as Yt,P as Vt,S as Gt,F as Kt,a as Jt,I as Zt,b as Qt,C as ft,T as en,c as tn,d as nn,e as mt,M as sn,f as rn,R as an,g as on,h as ln,i as cn,j as dn,G as un,W as hn,k as fn,l as mn}from"./icons-vendor-D7oP6Icu.js";import{k as Pe}from"./math-vendor-Ca7EfnBD.js";import"./vendor-Bb8JjhAW.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const gn=[{id:"about",label:"About"},{id:"learning",label:"Learning"},{id:"posts",label:"Posts"},{id:"projects",label:"Projects"},{id:"experience",label:"Experience"},{id:"education",label:"Education"},{id:"contact",label:"Contact"}],jt=[{id:"circuit-lab",label:"Circuit Lab",href:"pages/circuit-lab/"},{id:"transformer-lab",label:"Transformer Lab",href:"pages/transformer-lab/"},{id:"ml-playground",label:"ML Playground",href:"pages/ml-playground/"},{id:"fourier-epicycles",label:"Fourier Epicycles",href:"pages/fourier-epicycles/"},{id:"endless-depths",label:"Endless Depths",href:"pages/endless-depths/"}],pn="Ka Ming Lui";function kt(e){return e?e==="/"?"/":e.endsWith("/")?e:`${e}/`:""}function Ve(e=""){var a,i;const t=((a=document.documentElement)==null?void 0:a.dataset.navRoot)??((i=document.body)==null?void 0:i.dataset.navRoot)??null;if(typeof t=="string"&&t.trim())return kt(t.trim());const s=(typeof e=="string"?e:"").split(/[?#]/)[0].replace(/\\/g,"/").split("/").filter(Boolean);return s.length&&s[s.length-1].includes(".")&&s.pop(),s.length===0?"":"../".repeat(s.length)}function xn(e=""){var a,i;const t=((a=document.body)==null?void 0:a.dataset.currentLab)??((i=document.documentElement)==null?void 0:i.dataset.currentLab)??null;if(t)return t;const r=(typeof e=="string"?e:"").toLowerCase().replace(/\\/g,"/"),s=jt.find(l=>r.includes(`/${l.id.toLowerCase()}/`));return(s==null?void 0:s.id)??null}function yn({rootPrefix:e,useLocalAnchors:t}){return gn.map(({id:n,label:r})=>`<li><a href="${t?`#${n}`:`${e}index.html#${n}`}">${r}</a></li>`).join("")}function bn({rootPrefix:e,currentLabId:t}){return jt.map(({id:n,label:r,href:s})=>`<li><a href="${s.startsWith("http")?s:`${e}${s}`}"${n===t?' aria-current="page"':""}>${r}</a></li>`).join("")}function Et(e={}){var p,b,x;const t=e.target??document.querySelector("[data-site-header]")??document.querySelector(".site-header");if(!t)return null;const n=t.querySelector(".nav");if(!(t.hasAttribute("data-site-header")||e.forceRender===!0)&&n||t.dataset.navRendered==="true"&&n)return n;const s=typeof e.rootPrefix=="string"&&e.rootPrefix.trim()||typeof((p=t==null?void 0:t.dataset)==null?void 0:p.navRoot)=="string"&&t.dataset.navRoot.trim(),a=kt(s??Ve((b=window.location)==null?void 0:b.pathname)),i=e.useLocalAnchors??(a===""||t.dataset.useLocalAnchors==="true"),l=e.currentLab??t.dataset.currentLab??xn((x=window.location)==null?void 0:x.pathname),u=e.showEditToggle===!0||t.dataset.showEditToggle==="true",f=i?"#hero":`${a}index.html#hero`,c=yn({rootPrefix:a,useLocalAnchors:i}),g=bn({rootPrefix:a,currentLabId:l}),m=`
    <div class="container">
      <nav class="nav" aria-label="Primary">
        <a class="logo" href="${f}">${pn}</a>
        <button class="nav-toggle" type="button" aria-expanded="false" aria-controls="primary-navigation">
          <span class="nav-toggle__bar"></span>
          <span class="nav-toggle__bar"></span>
          <span class="nav-toggle__bar"></span>
          <span class="sr-only">Toggle navigation</span>
        </button>
        <ul class="nav-links" id="primary-navigation" data-visible="false">
          <li class="nav-item nav-item--dropdown">
            <button class="nav-dropdown-toggle nav-pill" type="button" aria-expanded="false" aria-controls="section-menu">
              Sections
              <svg class="nav-dropdown__icon" aria-hidden="true" focusable="false" viewBox="0 0 12 12">
                <path d="M2.47 4.47a.75.75 0 0 1 1.06 0L6 6.94l2.47-2.47a.75.75 0 0 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 0 1 0-1.06Z" />
              </svg>
            </button>
            <ul class="nav-dropdown-menu" id="section-menu" hidden>
              ${c}
            </ul>
          </li>
          <li class="nav-item nav-item--dropdown">
            <button class="nav-dropdown-toggle nav-pill" type="button" aria-expanded="false" aria-controls="labs-menu">
              Labs
              <svg class="nav-dropdown__icon" aria-hidden="true" focusable="false" viewBox="0 0 12 12">
                <path d="M2.47 4.47a.75.75 0 0 1 1.06 0L6 6.94l2.47-2.47a.75.75 0 0 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 0 1 0-1.06Z" />
              </svg>
            </button>
            <ul class="nav-dropdown-menu" id="labs-menu" hidden>
              ${g}
            </ul>
          </li>
        </ul>
        <div class="nav-actions">
          ${u?'<button class="edit-toggle" type="button" aria-pressed="false" hidden>Edit mode</button>':""}
          <button class="theme-toggle" type="button" aria-label="Toggle color theme">
            <span aria-hidden="true">üåô</span>
          </button>
        </div>
      </nav>
    </div>
  `;return t.innerHTML=m.trim(),t.id=t.id||"top",t.classList.add("site-header"),t.dataset.navRendered="true",t.querySelector(".nav")}const Ce='&copy; <span id="year"></span> Ka Ming Lui. Built with accessibility and performance in mind.',gt={home:{id:"home",layoutClass:"footer__layout",useContentBindings:!0,backToTopLabel:"Back to top"},"ml-playground":{layoutClass:"footer__layout",heading:"Want to explore more ML demos?",body:"Try the transformer lab or reach out to share your favorite visualization ideas.",actions:[{label:"Visit Transformer Lab",href:"pages/transformer-lab/",variant:"primary"},{label:"Email Ka-Ming",href:"mailto:contact@kaminglui.com",variant:"ghost"}],meta:["Curious how this playground works? Inspect the source on GitHub to tweak the algorithm.",Ce]},"transformer-lab":{layoutClass:"footer__layout",heading:"Ready for more machine learning stories?",body:"Head back to the main site to explore projects, journal entries, and the learning roadmap behind this transformer lab.",actions:[{label:"View projects",href:"index.html#projects",variant:"primary"},{label:"Get in touch",href:"index.html#contact",variant:"ghost"}],meta:["Enjoyed the walkthrough? Share it with fellow ML explorers.",Ce]},"endless-depths":{layoutClass:"footer__layout",heading:"Back to the main site?",body:"Check out projects, posts, and the ML roadmap that inspired this mini-game.",actions:[{label:"View projects",href:"index.html#projects",variant:"primary"},{label:"Get in touch",href:"index.html#contact",variant:"ghost"}],meta:["Progress saves to your browser so you can pick up where you left off.",'&copy; <span id="year"></span> Ka Ming Lui. Built for performance and accessibility.']}};function Te(e){return e?e==="/"?"/":e.endsWith("/")?e:`${e}/`:""}function vn(e,t){var r,s,a;if(typeof t=="string"&&t.trim())return Te(t.trim());const n=((r=e==null?void 0:e.dataset)==null?void 0:r.footerRoot)||((s=e==null?void 0:e.dataset)==null?void 0:s.navRoot);return typeof n=="string"&&n.trim()?Te(n.trim()):Te(Ve((a=window.location)==null?void 0:a.pathname))}function Mn(e,t){var r,s;const n=t||((r=e==null?void 0:e.dataset)==null?void 0:r.footerId)||((s=e==null?void 0:e.dataset)==null?void 0:s.footerPreset)||"home";return gt[n]||gt.home}function wn(e=[],t=""){if(!Array.isArray(e)||e.length===0)return"";const n=Te(t);return e.map(({label:r,href:s,variant:a})=>{if(!r||!s)return"";const l=/^(https?:)?\/\//i.test(s)||s.startsWith("mailto:")||s.startsWith("#")?s:`${n}${s}`,u=["button"];return a==="primary"&&u.push("button--primary"),a==="ghost"&&u.push("button--ghost"),`<a class="${u.join(" ")}" href="${l}">${r}</a>`}).filter(Boolean).join("")}function pt(e=[]){return!Array.isArray(e)||e.length===0?"":e.map(t=>`<p>${t}</p>`).join("")}function jn(e={}){const t=e.target??document.querySelector("[data-site-footer]")??document.querySelector(".site-footer");if(!t)return null;if(t.dataset.footerRendered==="true"||!t.hasAttribute("data-site-footer")&&e.forceRender!==!0)return t;const n=Mn(t,e.preset),r=vn(t,e.rootPrefix),s=n.layoutClass||"footer__layout";let a="",i="",l="",u="";n.useContentBindings?(a='<h2 data-content="contact.title"></h2>',i='<p data-content="contact.body"></p>',l='<div class="footer__actions" data-contact-actions></div>',u='<p data-content="contact.meta"></p>'+pt([Ce])):(a=n.heading?`<h2>${n.heading}</h2>`:"",i=n.body?`<p>${n.body}</p>`:"",l=`<div class="footer__actions">${wn(n.actions,r)}</div>`,u=pt(n.meta||[Ce]));const f=n.backToTopLabel||"Back to top";return t.innerHTML=`
    <div class="container ${s}">
      <div>
        ${a}
        ${i}
        ${l}
      </div>
      <div class="footer__meta">
        ${u}
      </div>
    </div>
    <a class="back-to-top" href="#top">${f}</a>
  `.trim(),t.classList.add("site-footer"),t.dataset.footerRendered="true",t}function kn(){const e=document.getElementById("year")||document.querySelector("[data-year]");e&&(e.textContent=String(new Date().getFullYear()))}const Ge=["theme","circuitforge-theme"];function En(){if(typeof localStorage>"u")return null;for(const e of Ge){const t=localStorage.getItem(e);if(t==="dark"||t==="light")return t}return null}function Nn(e){typeof localStorage>"u"||Ge.forEach(t=>{try{localStorage.setItem(t,e)}catch(n){console.warn("Unable to store theme preference",n)}})}function Be(e){const t=e==="light"?"light":"dark";return typeof document>"u"||(document.body.classList.toggle("theme-dark",t==="dark"),document.body.classList.toggle("theme-light",t==="light"),document.documentElement.classList.toggle("dark",t==="dark"),Nn(t)),t}function He(e,t){e&&(e.setAttribute("aria-pressed",t==="dark"?"true":"false"),e.innerHTML=t==="dark"?'<span aria-hidden="true">üåô</span>':'<span aria-hidden="true">‚òÄÔ∏è</span>')}function Sn(){const e=En();return e||(typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}function Pn({onChange:e}={}){const t=document.querySelector(".theme-toggle"),n=(t==null?void 0:t.dataset.themeBound)==="true",r=Be(Sn());He(t,r);const s=l=>{typeof e=="function"&&e(l)},a=l=>{if(typeof localStorage<"u"&&localStorage.getItem(Ge[0]))return;const u=Be(l.matches?"dark":"light");He(t,u),s(u)},i=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-color-scheme: dark)"):null;return i&&(typeof i.addEventListener=="function"?i.addEventListener("change",a):typeof i.addListener=="function"&&i.addListener(a)),t&&!n&&(t.dataset.themeBound="true",t.addEventListener("click",()=>{const l=document.body.classList.contains("theme-dark")?"dark":"light",u=Be(l==="dark"?"light":"dark");He(t,u),s(u)})),s(r),r}function Nt(e){if(!e||!e.getBoundingClientRect)return;const{height:t}=e.getBoundingClientRect();Number.isFinite(t)&&t>0&&(document.documentElement.style.setProperty("--nav-height",`${t}px`),document.documentElement.style.setProperty("--header-h",`${t}px`))}function Ln(e){if(!e)return;const t=()=>Nt(e);if(typeof ResizeObserver<"u"){const n=new ResizeObserver(t);return n.observe(e),n}return window.addEventListener("resize",t),null}function Ke(e){var t;return typeof e=="string"&&e.trim()?e.trim():typeof document<"u"?Ve((t=window.location)==null?void 0:t.pathname):""}function Tn(e={}){const t=e.target??document.getElementById("site-header")??document.querySelector("[data-site-header]");if(!t)return null;const n=e.pageId||e.currentLab||t.dataset.currentLab,r=Ke(e.rootPrefix||t.dataset.navRoot),s=e.showEditToggle??t.dataset.showEditToggle==="true",a=e.useLocalAnchors??n==="home";t.id="top",t.dataset.siteHeader="true",t.dataset.currentLab=n||"",t.dataset.navRoot=r||"";const i=Et({target:t,currentLab:n,rootPrefix:r,useLocalAnchors:a,showEditToggle:s}),l=(i==null?void 0:i.closest("[data-site-header]"))||t;return Nt(l),Ln(l),l}function Rn(e={}){const t=e.target??document.getElementById("site-footer")??document.querySelector("[data-site-footer]");if(!t)return null;const n=e.pageId||e.preset||t.dataset.footerId,r=Ke(e.rootPrefix||t.dataset.footerRoot);t.dataset.siteFooter="true",t.dataset.footerId=n||"home",t.dataset.footerRoot=r||"";const s=jn({target:t,preset:n||"home",rootPrefix:r});return s&&kn(),s}function Cn(e="home",t={}){var s,a;const n=e||((a=(s=document.body)==null?void 0:s.dataset)==null?void 0:a.currentLab)||"home",r=Ke(t.rootPrefix);Tn({pageId:n,rootPrefix:r,showEditToggle:t.showEditToggle,useLocalAnchors:t.useLocalAnchors}),Pn(t.themeOptions||{}),n!=="circuit-lab"&&Rn({pageId:n,rootPrefix:r})}Cn("fourier-epicycles");let xt=!1,We=!1;function In(){if(We)return;const t=Et()??document.querySelector(".nav"),n=(t==null?void 0:t.querySelector(".nav-toggle"))??document.querySelector(".nav-toggle"),r=(t==null?void 0:t.querySelector(".nav-links"))??document.querySelector(".nav-links");if(!t||!n||!r)return;if(t.dataset.navEnhanced==="true"){We=!0;return}const s=document.body,a=Array.from(t.querySelectorAll(".nav-item--dropdown")),i=[],l=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(hover: none)"):null,u=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(hover: hover)"):null,f=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(pointer: fine)"):null,c=()=>{const h=(l==null?void 0:l.matches)??!1,m=(u==null?void 0:u.matches)??!1,p=(f==null?void 0:f.matches)??!1;return h||!m||!p},g=({except:h}={})=>{let m=!1;return i.forEach(p=>{p!==h&&p.isOpen()&&(p.close(),m=!0)}),m};if(a.forEach(h=>{const m=h.querySelector(".nav-dropdown-toggle"),p=h.querySelector(".nav-dropdown-menu");if(!(m instanceof HTMLElement)||!(p instanceof HTMLElement))return;let b=null;const x=()=>{b!==null&&(window.clearTimeout(b),b=null)},j=()=>{c()||(x(),b=window.setTimeout(()=>{!h.matches(":hover")&&!p.matches(":hover")&&!m.matches(":hover")&&M.close()},220))},M={wrapper:h,toggle:m,menu:p,isOpen:()=>m.getAttribute("aria-expanded")==="true",open:()=>{m.setAttribute("aria-expanded","true"),h.setAttribute("data-open","true"),p.hidden=!1,x()},close:()=>{m.setAttribute("aria-expanded","false"),h.setAttribute("data-open","false"),p.hidden=!0,x()}};M.close(),i.push(M);const k=()=>{g({except:M}),M.open()},P=()=>{c()||(x(),k())},C=()=>{c()||j()};h.addEventListener("pointerenter",P),h.addEventListener("pointerleave",C),m.addEventListener("pointerenter",P),m.addEventListener("pointerleave",C),p.addEventListener("pointerenter",P),p.addEventListener("pointerleave",C),h.addEventListener("focusin",E=>{const L=E.target;c()&&L instanceof HTMLElement&&!L.matches(":focus-visible")||k()}),h.addEventListener("focusout",E=>{const L=E.relatedTarget;(!(L instanceof Node)||!h.contains(L))&&M.close()}),m.addEventListener("click",E=>{c()&&(E.preventDefault(),E.stopPropagation(),M.isOpen()?M.close():k())}),m.addEventListener("keydown",E=>{if(E.key==="ArrowDown"){E.preventDefault(),M.isOpen()||k();const L=p.querySelector("a");L instanceof HTMLElement&&L.focus()}else E.key==="Escape"&&M.close()}),p.addEventListener("click",E=>{E.target instanceof HTMLAnchorElement&&g()}),p.addEventListener("keydown",E=>{E.key==="Escape"&&(E.stopPropagation(),M.close(),m.focus())})}),l){const h=()=>{g()};typeof l.addEventListener=="function"?l.addEventListener("change",h):typeof l.addListener=="function"&&l.addListener(h)}window.addEventListener("resize",()=>{g()}),i.length>0&&!xt&&(document.addEventListener("pointerdown",h=>{const m=h.target;m instanceof Node&&i.some(({wrapper:p})=>p.contains(m))||g()}),document.addEventListener("keydown",h=>{h.key==="Escape"&&g()}),xt=!0),n&&(n.addEventListener("click",()=>{const h=n.getAttribute("aria-expanded")==="true";g(),n.setAttribute("aria-expanded",String(!h)),r==null||r.setAttribute("data-visible",String(!h)),s.classList.toggle("nav-open",!h)}),window.addEventListener("keydown",h=>{h.key==="Escape"&&n.getAttribute("aria-expanded")==="true"&&(n.setAttribute("aria-expanded","false"),r==null||r.setAttribute("data-visible","false"),s.classList.remove("nav-open"),g(),n.focus())}),window.addEventListener("resize",()=>{window.innerWidth>=720&&(n.setAttribute("aria-expanded","false"),r==null||r.setAttribute("data-visible","false"),s.classList.remove("nav-open"),g())})),r==null||r.addEventListener("click",h=>{h.target instanceof HTMLAnchorElement&&(n==null||n.setAttribute("aria-expanded","false"),r.setAttribute("data-visible","false"),s.classList.remove("nav-open"),g())}),t.dataset.navEnhanced="true",We=!0}const yt=()=>In();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",yt,{once:!0}):yt();const An=e=>{const t=[],n=e.length;for(let r=0;r<n;r++){let s=0,a=0;for(let f=0;f<n;f++){const c=Math.PI*2*r*f/n,g=Math.cos(c),h=Math.sin(c),m=e[f].re,p=e[f].im;s+=m*g+p*h,a+=p*g-m*h}s=s/n,a=a/n;const i=r>n/2?r-n:r,l=Math.sqrt(s*s+a*a),u=Math.atan2(a,s);t.push({re:s,im:a,freq:i,amp:l,phase:u})}return t.sort((r,s)=>s.amp-r.amp)},_n=(e,t)=>{if(t<=0||e.length<2)return[...e];const n=[];for(let r=0;r<e.length;r++){let s=0,a=0,i=0;for(let l=-t;l<=t;l++){const u=r+l;u>=0&&u<e.length&&(s+=e[u].x,a+=e[u].y,i++)}n.push({x:s/i,y:a/i})}return n},Fn=()=>{const e=[];for(let r=0;r<50;r++)e.push({x:-200+r*2*200/50,y:-200});for(let r=0;r<50;r++)e.push({x:200,y:-200+r*2*200/50});for(let r=0;r<50;r++)e.push({x:200-r*2*200/50,y:200});for(let r=0;r<50;r++)e.push({x:-200,y:200-r*2*200/50});return e},$n=()=>{const e=[];for(let r=0;r<200;r++){const s=Math.PI*2*r/200;e.push({x:200*Math.cos(s),y:200*Math.sin(s)})}return e},zn=()=>{const e=[];for(let n=0;n<300;n++){const r=Math.PI*2*n/300,s=16*Math.pow(Math.sin(r),3),a=-(13*Math.cos(r)-5*Math.cos(2*r)-2*Math.cos(3*r)-Math.cos(4*r));e.push({x:s*15,y:a*15})}return e},qn=()=>{const e=[];for(let r=0;r<300;r++){const s=Math.PI*2*r/300,a=150*Math.cos(s),i=150*Math.sin(s)*Math.cos(s);e.push({x:a,y:i})}return e},Dn=()=>{const e=[];for(let n=0;n<100;n++){const r=Math.PI*2*n/100;e.push({x:40*Math.cos(r)-50,y:30*Math.sin(r)+100})}for(let n=0;n<20;n++)e.push({x:-10,y:100-200*n/20});for(let n=0;n<30;n++){const r=n/30;e.push({x:-10+50*Math.sin(r*Math.PI),y:-100+50*r})}for(let n=0;n<20;n++)e.push({x:-10,y:-50+150*n/20});return e},On={threshold:30,sampleRate:2,maxPoints:1500,smoothingWindow:4,blurRadius:1,morphRadius:2,detail:.9},Un=e=>{if(e.length===0)return[];const t=[],n=new Set;let r=0;for(t.push(e[0]),n.add(0);t.length<e.length;){let s=1/0,a=-1;const i=e[r];for(let l=0;l<e.length;l++)if(!n.has(l)){const u=e[l],f=(i.x-u.x)**2+(i.y-u.y)**2;f<s&&(s=f,a=l)}if(a!==-1)n.add(a),t.push(e[a]),r=a;else break}return t},te=(e,t,n)=>Math.max(t,Math.min(n,e)),Bn=e=>Math.max(0,Math.min(1,e)),ue=(e,t,n)=>e+(t-e)*n,Hn=(e,t,n,r)=>{const s=Math.max(1,Math.floor(r||1)),a=Math.max(1,Math.floor(t/s)),i=Math.max(1,Math.floor(n/s)),l=new Uint8Array(a*i);for(let u=0;u<i;u++){const f=te(u*s,0,n-1);for(let c=0;c<a;c++){const g=te(c*s,0,t-1),h=(f*t+g)*4,m=e[h]??0,p=e[h+1]??0,b=e[h+2]??0;l[u*a+c]=Math.round(.2126*m+.7152*p+.0722*b)}}return{gray:l,w:a,h:i,step:s}},Wn=(e,t,n,r)=>{const s=Math.max(1,Math.floor(r||1)),a=new Uint8Array(e.length);for(let i=0;i<n;i++)for(let l=0;l<t;l++){let u=0;for(let f=-s;f<=s&&!u;f++){const c=i+f;if(!(c<0||c>=n))for(let g=-s;g<=s;g++){const h=l+g;if(!(h<0||h>=t)&&e[c*t+h]){u=1;break}}}a[i*t+l]=u}return a},Xn=(e,t,n,r)=>{const s=Math.max(1,Math.floor(r||1)),a=new Uint8Array(e.length);for(let i=0;i<n;i++)for(let l=0;l<t;l++){let u=1;for(let f=-s;f<=s&&u;f++){const c=i+f;if(c<0||c>=n){u=0;break}for(let g=-s;g<=s;g++){const h=l+g;if(h<0||h>=t||!e[c*t+h]){u=0;break}}}a[i*t+l]=u}return a},Yn=(e,t,n,r)=>{const s=Math.max(1,Math.floor(r||1));return Xn(Wn(e,t,n,s),t,n,s)},Vn=(e,t)=>{const n=Math.max(0,Math.floor(t||0));if(n<=0||e.length<3)return e;const r=[],s=e.length;for(let a=0;a<s;a++){let i=0,l=0,u=0;for(let f=-n;f<=n;f++){const c=(a+f+s)%s;i+=e[c].x,l+=e[c].y,u++}r.push({x:i/u,y:l/u})}return r},pe=e=>{if(e.length<2)return e;const t=e[0],n=e[e.length-1];return t.x===n.x&&t.y===n.y?e:[...e,{...t}]},Gn=(e,t,n)=>{if(t<3||n<3)return new Uint8Array(e.length);const r=new Uint16Array(e.length),s=new Uint32Array(1025);for(let c=1;c<n-1;c++)for(let g=1;g<t-1;g++){const h=c*t+g,m=e[h-t-1],p=e[h-t],b=e[h-t+1],x=e[h-1],j=e[h+1],M=e[h+t-1],k=e[h+t],P=e[h+t+1],C=-m+b-2*x+2*j-M+P,E=-m-2*p-b+M+2*k+P,L=Math.min(1024,Math.abs(C)+Math.abs(E));r[h]=L,s[L]++}const a=(t-2)*(n-2);let i=Math.floor(a*.08);i=te(i,50,a);let l=0,u=1024;for(let c=1024;c>=0;c--)if(l+=s[c],l>=i){u=c;break}const f=new Uint8Array(e.length);for(let c=0;c<r.length;c++)f[c]=r[c]>=u&&r[c]>0?1:0;return f},Kn=e=>{let t=0;for(let n=0;n<e.length;n++)t+=e[n]?1:0;return t},Jn=e=>{const t=Math.max(.01,e),n=Math.max(1,Math.ceil(3*t)),r=n*2+1,s=new Float32Array(r),a=2*t*t;let i=0;for(let l=-n;l<=n;l++){const u=Math.exp(-(l*l)/a);s[l+n]=u,i+=u}if(i>0)for(let l=0;l<s.length;l++)s[l]/=i;return s},bt=(e,t,n,r)=>{const s=t*n,a=Math.max(0,r);if(s===0)return new Float32Array(0);if(a<=.01){const c=new Float32Array(s);for(let g=0;g<s;g++)c[g]=e[g];return c}const i=Jn(a),l=(i.length-1)/2,u=new Float32Array(s),f=new Float32Array(s);for(let c=0;c<n;c++){const g=c*t;for(let h=0;h<t;h++){let m=0;for(let p=-l;p<=l;p++){const b=te(h+p,0,t-1);m+=i[p+l]*(e[g+b]??0)}u[g+h]=m}}for(let c=0;c<n;c++){const g=c*t;for(let h=0;h<t;h++){let m=0;for(let p=-l;p<=l;p++){const b=te(c+p,0,n-1);m+=i[p+l]*(u[b*t+h]??0)}f[g+h]=m}}return f},Zn=(e,t,n,r,s)=>{const a=t*n;if(t<3||n<3||a===0)return new Uint8Array(a);const i=Math.min(t,n),l=Math.max(.35,s||1),u=ue(2.4,.7,r)*l,f=Math.max(.35,i/4),c=Math.min(Math.max(.35,u),f),g=Math.min(Math.max(c*1.6,c+.15),f*1.6),h=bt(e,t,n,c),m=bt(e,t,n,g),p=new Float32Array(a);for(let N=0;N<a;N++)p[N]=h[N]-m[N];const b=new Uint16Array(a),x=new Uint32Array(1025);let j=0;const M=4,k=[-t-1,-t,-t+1,-1,1,t-1,t,t+1];for(let N=1;N<n-1;N++){const $=N*t;for(let z=1;z<t-1;z++){const H=$+z,q=p[H],Y=q>=0;let _=0;for(let W=0;W<k.length;W++){const ne=H+k[W],J=p[ne];if(J>=0===Y)continue;const I=Math.abs(q-J);I>_&&(_=I)}if(_>0){const W=te(Math.round(_*M),0,1024);b[H]=W,x[W]++,j++}}}if(j===0)return new Uint8Array(a);const P=ue(.02,.08,r),C=te(Math.floor(j*P),1,j);let E=0,L=1024;for(let N=1024;N>=1;N--)if(E+=x[N],E>=C){L=N;break}const A=ue(.6,.22,r),K=Math.max(1,Math.floor(L*A)),F=new Uint8Array(a),B=[];for(let N=0;N<a;N++)b[N]>=L&&(F[N]=1,B.push(N));const R=[1,1,0,-1,-1,-1,0,1],T=[0,1,1,1,0,-1,-1,-1];for(;B.length;){const N=B.pop(),$=N%t,z=(N-$)/t;for(let H=0;H<8;H++){const q=$+R[H],Y=z+T[H];if(q<0||q>=t||Y<0||Y>=n)continue;const _=Y*t+q;F[_]||b[_]>=K&&(F[_]=1,B.push(_))}}return F},Qn=(e,t,n)=>{const r=[1,1,0,-1,-1,-1,0,1],s=[0,1,1,1,0,-1,-1,-1],a=[4,5,6,7,0,1,2,3],i=new Uint8Array(e.length),l=[];for(let m=0;m<e.length;m++){if(!e[m])continue;const p=m%t,b=(m-p)/t;let x=0;for(let j=0;j<8;j++){const M=p+r[j],k=b+s[j];M<0||M>=t||k<0||k>=n||e[k*t+M]&&x++}i[m]=x,x>0&&l.push(m)}const u=new Uint8Array(e.length),f=[],c=(m,p)=>{const b=m%t,x=(m-b)/t,j=b+r[p],M=x+s[p];if(j<0||j>=t||M<0||M>=n)return-1;const k=M*t+j;return e[k]?k:-1},g=(m,p,b)=>{u[m]|=1<<p,u[b]|=1<<a[p]},h=(m,p,b)=>{const x=c(m,p);if(x<0)return[];const j=[m];let M=p,k=x;g(m,p,k),j.push(k);const P=t*n*2;for(let C=0;C<P;C++){const E=i[k];if(b&&E!==2)break;const L=a[M];let A=-1;for(let F=0;F<8;F++){if(F===L)continue;if(c(k,F)>=0){A=F;break}}if(A<0||u[k]&1<<A)break;const K=c(k,A);if(K<0||(g(k,A,K),k=K,M=A,j.push(k),!b&&k===m))break}return j};for(const m of l){const p=i[m];if(!(p===0||p===2))for(let b=0;b<8;b++){if(c(m,b)<0||u[m]&1<<b)continue;const j=h(m,b,!0);j.length>1&&f.push(j)}}for(const m of l)for(let p=0;p<8;p++){if(c(m,p)<0||u[m]&1<<p)continue;const x=h(m,p,!1);x.length>1&&(x[0]===x[x.length-1]?f.push(x):f.push([...x,x[0]]))}return f},es=(e,t,n,r,s)=>{const a=e%t,i=(e-a)/t;return{x:a*n-r/2,y:i*n-s/2}},Xe=e=>{if(e.length===0)return[];const t=[e[0]];for(let n=1;n<e.length;n++){const r=t[t.length-1],s=e[n];(r.x!==s.x||r.y!==s.y)&&t.push(s)}return t},vt=(e,t)=>{if(e.length<3||t<=0)return e;const n=t*t,r=new Uint8Array(e.length);r[0]=1,r[e.length-1]=1;const s=(l,u,f)=>{const c=f.x-u.x,g=f.y-u.y,h=l.x-u.x,m=l.y-u.y,p=c*h+g*m;if(p<=0)return h*h+m*m;const b=c*c+g*g;if(b<=p){const C=l.x-f.x,E=l.y-f.y;return C*C+E*E}const x=p/b,j=u.x+x*c,M=u.y+x*g,k=l.x-j,P=l.y-M;return k*k+P*P},a=[[0,e.length-1]];for(;a.length;){const[l,u]=a.pop();let f=0,c=-1;const g=e[l],h=e[u];for(let m=l+1;m<u;m++){const p=s(e[m],g,h);p>f&&(f=p,c=m)}c!==-1&&f>n&&(r[c]=1,a.push([l,c],[c,u]))}const i=[];for(let l=0;l<e.length;l++)r[l]&&i.push(e[l]);return i},ts=(e,t)=>{if(e.length===0)return[];const n=[...e].sort((i,l)=>l.length-i.length);let r=[...n.shift()];const s=(i,l)=>{const u=i.x-l.x,f=i.y-l.y;return u*u+f*f},a=te(Math.round(ue(2,10,t)),2,12);for(;n.length;){const i=r[r.length-1];let l=0,u=!1,f=1/0;for(let b=0;b<n.length;b++){const x=n[b],j=s(i,x[0]),M=s(i,x[x.length-1]);j<f&&(f=j,l=b,u=!1),M<f&&(f=M,l=b,u=!0)}const c=n.splice(l,1)[0];u&&c.reverse();const g=c[0],h=g.x-i.x,m=g.y-i.y;if(Math.hypot(h,m)>1e-6)for(let b=1;b<=a;b++){const x=b/(a+1);r.push({x:i.x+h*x,y:i.y+m*x})}r[r.length-1].x===g.x&&r[r.length-1].y===g.y?r.push(...c.slice(1)):r.push(...c)}return r},ns=(e,t)=>{const n=Math.max(8,Math.floor(t)),r=pe(Xe(e));if(r.length<4)return r;const s=r.slice(0,-1),a=s.length,i=new Float64Array(a);let l=0;for(let M=0;M<a;M++){const k=s[M],P=s[(M+1)%a],C=Math.hypot(P.x-k.x,P.y-k.y);i[M]=C,l+=C}if(!Number.isFinite(l)||l<=0)return pe(s);const u=l/n,f=[{...s[0]}];let c=0,g=s[0],h=s[1%a],m=i[0],p=0,b=u;const x=n*(a+4);let j=0;for(;f.length<n&&j++<x;){if(m===0){c=(c+1)%a,g=s[c],h=s[(c+1)%a],m=i[c];continue}if(p+m>=b-1e-9){const M=(b-p)/m;f.push({x:g.x+(h.x-g.x)*M,y:g.y+(h.y-g.y)*M}),b+=u}else p+=m,c=(c+1)%a,g=s[c],h=s[(c+1)%a],m=i[c]}return f.length>n&&(f.length=n),pe(f)},ss=(e,t,n,r={})=>{const s={...On,...r},a=Bn(s.detail),i=typeof r.sampleRate=="number"?Math.max(1,Math.floor(s.sampleRate)):a>=.88?1:a>=.55?2:3,l=Math.max(200,Math.floor(s.maxPoints)),u=Math.max(0,Math.floor(s.smoothingWindow)),f=Math.max(0,Math.floor(s.blurRadius)),c=Math.max(0,Math.floor(s.morphRadius)),g=Math.max(1,Math.floor(s.threshold)),{gray:h,w:m,h:p,step:b}=Hn(e,t,n,i),x=h;let j=Zn(x,m,p,a,f);Kn(j)<Math.max(10,Math.floor(m*p*.001))&&(j=Gn(x,m,p)),c>0&&(j=Yn(j,m,p,c));const M=Qn(j,m,p),k=te(Math.round(ue(40,10,a)),6,80),P=ue(6,1.2,a)*b,C=M.filter(R=>R.length>=k).map(R=>R.map(T=>es(T,m,b,t,n))).map(R=>{const T=Xe(R);if(T.length>2&&T[0].x===T[T.length-1].x&&T[0].y===T[T.length-1].y){const $=T.slice(0,-1);return pe(vt($,P))}return vt(T,P)}).filter(R=>R.length>=2);if(C.length>0){const R=ts(C,a),T=pe(Xe(R)),N=u>0?Vn(T,u):T,$=te(Math.round(ue(400,l,a)),120,l);return ns(N,$)}const E=[],L=R=>(e[R]+e[R+1]+e[R+2])/3;for(let R=0;R<n;R+=i)for(let T=0;T<t;T+=i){if(T<=0||R<=0)continue;const N=(R*t+T)*4,$=(R*t+(T-1))*4,z=((R-1)*t+T)*4,H=L(N),q=L($),Y=L(z);Math.abs(H-q)+Math.abs(H-Y)>g&&E.push({x:T-t/2,y:R-n/2})}if(E.length===0)return[];const A=E.length>l?Math.ceil(E.length/l):1,K=A===1?E:E.filter((R,T)=>T%A===0),F=Un(K),B=[];for(let R=0;R<F.length;R++){let T=0,N=0,$=0;for(let z=-u;z<=u;z++){const H=(R+z+F.length)%F.length;T+=F[H].x,N+=F[H].y,$++}B.push({x:T/$,y:N/$})}return pe(B)},Mt=async(e,t=900,n={})=>new Promise((r,s)=>{const a=new Image,i=URL.createObjectURL(e);a.onload=()=>{const l=document.createElement("canvas"),u=l.getContext("2d");if(!u){s(new Error("Could not get canvas context"));return}let f=a.width,c=a.height;const g=Math.max(f,c),h=t&&t>0?t:900;if(g>h){const b=h/g;f=Math.round(f*b),c=Math.round(c*b)}l.width=f,l.height=c,u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.drawImage(a,0,0,f,c);const m=u.getImageData(0,0,f,c),p=ss(m.data,f,c,n);URL.revokeObjectURL(i),r(p)},a.onerror=l=>s(l),a.src=i}),Je=1500,rs=120,as=200,os=e=>e.map(t=>({re:t.x,im:t.y})),ls=e=>e&&e>0?e:Je,Ze=(e,t)=>Math.hypot(e.x-t.x,e.y-t.y),Qe=(e,t,n)=>Math.max(t,Math.min(n,Math.round(e))),is=e=>{let t=1/0,n=1/0,r=-1/0,s=-1/0;for(const a of e)a.x<t&&(t=a.x),a.y<n&&(n=a.y),a.x>r&&(r=a.x),a.y>s&&(s=a.y);return!Number.isFinite(t)||!Number.isFinite(n)||!Number.isFinite(r)||!Number.isFinite(s)?0:Math.hypot(r-t,s-n)},cs=e=>{if(e.length<3)return!1;const t=e[0],n=e[e.length-1],r=is(e),s=Math.max(10,r*.04);return Ze(t,n)<=s},ds=(e,t=.25)=>{if(e.length<2)return[...e];const n=[e[0]];for(let r=1;r<e.length;r++){const s=n[n.length-1],a=e[r];Ze(s,a)>=t&&n.push(a)}return n},us=(e,t,n)=>{const r=e.length;if(r===0)return[];if(r===1)return[{...e[0]}];const s=Qe(t,2,1e4),a=n?r:r-1,i=new Array(a);let l=0;for(let g=0;g<a;g++){const h=e[g],m=e[(g+1)%r],p=Ze(h,m);i[g]=p,l+=p}if(l<=0)return Array.from({length:s},()=>({...e[0]}));const u=l/(n?s:s-1),f=[],c=g=>{let h=0,m=0;for(;h<a-1&&m+i[h]<g;)m+=i[h],h++;const p=e[h],b=e[(h+1)%r],x=i[h]||1,j=Math.max(0,Math.min(1,(g-m)/x));return{x:p.x+(b.x-p.x)*j,y:p.y+(b.y-p.y)*j}};if(n){for(let g=0;g<s;g++)f.push(c(u*g));return f}f.push({...e[0]});for(let g=1;g<s-1;g++)f.push(c(u*g));return f.push({...e[r-1]}),f},hs=(e,t)=>{if(t<=0||e.length<2)return[...e];const n=e.length,r=Qe(t,1,Math.floor(n/2)),s=[];for(let a=0;a<n;a++){let i=0,l=0,u=0;for(let f=-r;f<=r;f++){const c=(a+f+n)%n;i+=e[c].x,l+=e[c].y,u++}s.push({x:i/u,y:l/u})}return s},fs=(e,t,n=Je)=>{const r=ls(n),s=ds(e);if(s.length===0)return[];const a=cs(s),i=a?as:rs,l=Math.min(r,Math.max(s.length,i)),u=us(s,l,a),f=t>0?Qe(t,0,999):0;return a?hs(u,f):_n(u,f)},ms=(e,t={})=>{const{smoothing:n=0,limit:r=Je}=t,s=fs(e,n,r),a=An(os(s));return{prepared:s,spectrum:a}},gs=(e,t,n,r=600)=>{if(!e.length||!t.length)return{energyPct:0,rmsError:0,topTerms:[],breakdown:[]};const s=e.map(M=>M.amp*M.amp),a=s.reduce((M,k)=>M+k,0)||1,i=Math.max(Math.min(n||e.length,e.length),1),l=s.slice(0,i).reduce((M,k)=>M+k,0);let u=0;const f=s.map(M=>(u+=M,{energyPct:M/a*100,cumulativePct:u/a*100}));let c=0;const g=e.slice(0,6).map((M,k)=>{const P=s[k];return c+=P,{freq:M.freq,amp:M.amp,phase:M.phase,energyPct:P/a*100,cumulativePct:c/a*100}}),h=t.length,m=Math.max(1,Math.floor(h/r)),p=e.slice(0,i);let b=0,x=0;for(let M=0;M<h;M+=m){let k=0,P=0;for(let L=0;L<p.length;L++){const A=p[L],K=2*Math.PI*A.freq*M/h,F=Math.cos(K),B=Math.sin(K);k+=A.re*F-A.im*B,P+=A.re*B+A.im*F}const C=k-t[M].x,E=P-t[M].y;b+=C*C+E*E,x++}const j=Math.sqrt(b/Math.max(x,1));return{energyPct:Number((l/a*100).toFixed(2)),rmsError:Number(j.toFixed(2)),topTerms:g,breakdown:f}},ps=e=>Math.min(1,Math.max(0,e)),xs=(e,t)=>!isFinite(e)||t<=0?0:ps(e/t),Re=(e,t,n=!1)=>{const r=xs(e,t),s=210+110*r,a=n?62:48+6*r,i=n?.95:.6;return`hsla(${s.toFixed(1)}, 82%, ${a.toFixed(1)}%, ${i})`},ys=e=>`linear-gradient(90deg, ${Re(0,e)} 0%, ${Re(e*.5,e)} 50%, ${Re(e,e,!0)} 100%)`,bs=(e,t,n)=>Re(e.amp,t,n),vs=({mode:e,setMode:t,isPlaying:n,setIsPlaying:r,clear:s,numEpicycles:a,maxEpicycles:i,setNumEpicycles:l,onUpload:u,showMath:f,setShowMath:c,onPreset:g,speed:h,setSpeed:m,onReset:p,brushColor:b,setBrushColor:x,brushSize:j,setBrushSize:M,smoothing:k,setSmoothing:P,outlineDetail:C,setOutlineDetail:E,isDrawing:L,onSave:A,onLoad:K,savedDrawings:F,isFullscreen:B,onToggleFullscreen:R,safeMode:T,onToggleSafeMode:N,stepMode:$,onToggleStepMode:z,stepIndex:H,stepMax:q,onStepPrev:Y,onStepNext:_,onStepPlayOnce:W})=>{const ne=w.useRef(null),J=I=>`
    p-2.5 rounded-lg transition-all duration-200 flex items-center justify-center
    ${I?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50 shadow-[0_0_15px_rgba(6,182,212,0.3)]":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 hover:text-slate-200 border border-transparent"}
  `;return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"fourier-toolbar fourier-toolbar--top",children:[o.jsxs("div",{className:"flex gap-1 mr-4 pl-2",children:[o.jsx(Yt,{className:"w-5 h-5 text-fuchsia-500"}),o.jsxs("span",{className:"font-bold text-slate-100 hidden sm:block",children:["Fourier",o.jsx("span",{className:"text-fuchsia-500",children:"Viz"})]})]}),o.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),o.jsx("button",{onClick:()=>t("DRAW"),className:J(e==="DRAW"),title:"Freehand Draw",children:o.jsx(Vt,{size:20})}),o.jsxs("div",{className:"relative group",children:[o.jsx("button",{className:J(e==="PRESET"),title:"Presets",children:o.jsx(Gt,{size:20})}),o.jsxs("div",{className:"absolute top-full left-0 w-32 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden hidden group-hover:block group-focus-within:block z-50",children:[o.jsx("button",{onClick:()=>g("circle"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Circle"}),o.jsx("button",{onClick:()=>g("square"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Square"}),o.jsx("button",{onClick:()=>g("heart"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Heart"}),o.jsx("button",{onClick:()=>g("infinity"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Infinity"}),o.jsx("button",{onClick:()=>g("note"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Note"})]})]}),o.jsxs("div",{className:"relative group",children:[o.jsx("button",{className:J(!1),title:"Load Saved Drawing",children:o.jsx(Kt,{size:20})}),o.jsx("div",{className:"absolute top-full left-0 w-48 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden hidden group-hover:block group-focus-within:block max-h-60 overflow-y-auto custom-scrollbar z-50",children:F.length===0?o.jsx("div",{className:"px-4 py-2 text-sm text-slate-500 italic",children:"No saved drawings"}):F.map(I=>o.jsx("button",{onClick:()=>K(I),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400 truncate border-b border-slate-800 last:border-0",children:I},I))})]}),o.jsx("button",{onClick:A,className:J(!1),title:"Save Current Drawing",children:o.jsx(Jt,{size:20})}),o.jsx("button",{onClick:()=>{var I;return(I=ne.current)==null?void 0:I.click()},className:J(e==="UPLOAD"),title:"Upload Image",children:o.jsx(Zt,{size:20})}),o.jsx("input",{type:"file",ref:ne,onChange:u,accept:"image/*",className:"hidden"}),o.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),o.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-lg transition-all duration-300 ${L?"bg-fuchsia-900/20 ring-1 ring-fuchsia-500/50":""}`,children:[o.jsxs("div",{className:"relative flex items-center group",title:"Brush Color",children:[o.jsx(Qt,{size:18,className:`${L?"text-fuchsia-400":"text-slate-400"} mr-2 transition-colors`}),o.jsx("input",{type:"color",value:b,onChange:I=>x(I.target.value),className:"w-6 h-6 rounded border-none cursor-pointer bg-transparent"})]}),o.jsxs("div",{className:"flex items-center gap-2",title:"Brush Size",children:[o.jsx(ft,{size:10,className:"text-slate-400"}),o.jsx("input",{type:"range",min:"1",max:"10",step:"0.5",value:j,onChange:I=>M(parseFloat(I.target.value)),className:"w-16 h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-slate-400"}),o.jsx(ft,{size:16,className:`text-slate-400 transition-all ${L?"scale-110 text-fuchsia-300":""}`})]})]}),o.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),o.jsx("button",{onClick:s,className:"p-2.5 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors",title:"Clear Canvas",children:o.jsx(en,{size:20})}),o.jsx("button",{onClick:()=>c(!f),className:J(f),title:"Toggle Math Panel",children:o.jsx(tn,{size:20})}),o.jsx("button",{onClick:N,className:J(T),title:"Toggle safe mode (cap epicycles / lighten rendering)",children:o.jsx(nn,{size:20})}),o.jsx("button",{onClick:z,className:J($),title:"Toggle step-through playback",children:o.jsx(mt,{size:20})}),o.jsx("button",{onClick:R,className:J(B),title:B?"Exit Fullscreen":"Fullscreen Play",children:B?o.jsx(sn,{size:20}):o.jsx(rn,{size:20})})]}),o.jsx("div",{className:"fourier-toolbar fourier-toolbar--bottom",children:o.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("button",{onClick:p,className:"p-3 rounded-full bg-slate-800 text-slate-300 hover:bg-slate-700 hover:text-white transition-all",title:"Reset Animation",children:o.jsx(an,{size:18})}),o.jsx("button",{onClick:()=>r(!n),className:"w-14 h-14 flex items-center justify-center rounded-full bg-cyan-500 text-slate-950 hover:bg-cyan-400 transition-all shadow-[0_0_20px_rgba(6,182,212,0.4)]",children:n?o.jsx(on,{fill:"currentColor",size:24}):o.jsx(ln,{fill:"currentColor",className:"ml-1",size:24})}),$&&o.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/70 rounded-full px-3 py-2 border border-slate-700",children:[o.jsx("button",{onClick:Y,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Previous term",children:o.jsx(cn,{size:16})}),o.jsx("button",{onClick:W,className:"px-3 py-2 rounded-full bg-amber-400 text-slate-900 font-semibold hover:bg-amber-300 transition",title:"Play this term once",children:"Step"}),o.jsx("button",{onClick:_,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Next term",children:o.jsx(dn,{size:16})}),o.jsxs("span",{className:"text-xs text-slate-300 font-semibold ml-1",children:["Term ",H+1," / ",Math.max(q,1)]})]})]}),o.jsxs("div",{className:"flex-1 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 w-full",children:[o.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[o.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[o.jsx("span",{children:"Precision"}),o.jsxs("span",{className:"text-cyan-400",children:[a," / ",i,T?" (capped)":""]})]}),o.jsx("input",{type:"range",min:"1",max:i||1,value:a,onChange:I=>l(parseInt(I.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),o.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[o.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(un,{size:12}),o.jsx("span",{children:"Speed"})]}),o.jsxs("span",{className:"text-amber-400",children:[h.toFixed(2),"x"]})]}),o.jsx("input",{type:"range",min:"0.05",max:"3",step:"0.05",value:h,onChange:I=>m(parseFloat(I.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-amber-500"})]}),o.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[o.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(hn,{size:12}),o.jsx("span",{children:"Smoothness"})]}),o.jsxs("span",{className:"text-emerald-400",children:[k,"px"]})]}),o.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:k,onChange:I=>P(parseInt(I.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]}),o.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[o.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(mt,{size:12}),o.jsx("span",{children:"Outline detail"})]}),o.jsxs("span",{className:"text-violet-300",children:[C,"%"]})]}),o.jsx("input",{type:"range",min:"10",max:"100",step:"1",value:C,onChange:I=>E(parseInt(I.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-violet-400"})]})]})]})})]})},Ms=({terms:e,time:t,epicycles:n,metrics:r,focusIndex:s,stepMode:a=!1})=>{var b;const i=w.useRef(null),[l,u]=w.useState("dft"),[f,c]=w.useState(()=>Math.max(Math.min(n-1,e.length-1),0)),g=w.useMemo(()=>{const x=e[0],j=e.length||1,M=(t/(2*Math.PI)).toFixed(2);return{n:j,largestRadius:x?x.amp.toFixed(1):"0.0",maxFreq:x?x.freq:0,phaseTurns:M,dominantPhase:x?x.phase.toFixed(2):"0.00"}},[e,t]),h=w.useMemo(()=>{const x=e[Math.min(f,Math.max(e.length-1,0))];return x||{freq:0,amp:0,phase:0}},[f,e]),m=r.breakdown?r.breakdown[Math.min(f,Math.max(r.breakdown.length-1,0))]??{energyPct:0,cumulativePct:0}:{energyPct:0,cumulativePct:0},p=w.useMemo(()=>{const x={throwOnError:!1},j=g.n||1,M=h.freq,k=h.amp.toFixed(3),P=h.phase.toFixed(3),C=m.energyPct.toFixed(2),E=m.cumulativePct.toFixed(2);return{paramsHtml:Pe.renderToString(`k = ${M},\\quad |X_k| = ${k},\\quad \\phi_k = ${P}\\,\\text{rad}`,x),vectorHtml:Pe.renderToString(`\\text{Vector}_k(t) = |X_k|\\,e^{i\\left(2\\pi k t/${j} + \\phi_k\\right)}`,x),energyHtml:Pe.renderToString(`\\Delta\\text{energy} = ${C}\\%\\quad \\text{cum.} = ${E}\\%`,x)}},[m,h.amp,h.freq,h.phase,g.n]);return w.useEffect(()=>{var L,A;if(!i.current)return;const{n:x,phaseTurns:j,dominantPhase:M}=g,k=Math.max(n,1),P=((L=e[0])==null?void 0:L.freq)??0,C=((A=e[0])==null?void 0:A.amp)??0,E={dft:`
      \\begin{aligned}
        X_k &= \\frac{1}{N} \\sum_{n=0}^{N-1} x_n e^{-i 2\\pi kn / N} \\\\
        &\\textcolor{#f472b6}{N = ${x}},\\; \\textcolor{#22c55e}{k \\in [0, N-1]}
      \\end{aligned}
      `,reconstruction:`
      \\begin{aligned}
        x(t) &\\approx \\sum_{j=1}^{${k}} \\left|X_{k_j}\\right| e^{i\\left(k_j t + \\phi_{k_j}\\right)} \\\\
        t &= 2\\pi n/N,\\; k_j \\in \\left[-\\frac{N}{2}, \\frac{N}{2}\\right] \\\\
        &\\textcolor{#22c55e}{\\left|X_{${P}}\\right| = ${C.toFixed(2)}},\\;
          \\textcolor{#f472b6}{\\phi_{${P}} = ${M}}\\;\\text{rad}
      \\end{aligned}
      `,phasor:`
      \\begin{aligned}
        \\text{Epicycle}_k(t) &= r_k e^{i(\\omega_k t + \\phi_k)} \\\\
        r_k &= \\left|X_k\\right|,\\;
        \\omega_k = k,\\;
        t = ${j}\\,\\tau
      \\end{aligned}
      `};Pe.render(E[l],i.current,{throwOnError:!1,displayMode:!0})},[l,n,g,e]),w.useEffect(()=>{u("dft"),c(Math.max(Math.min(n-1,e.length-1),0))},[e.length]),w.useEffect(()=>{if(typeof s=="number"&&e.length>0){const x=Math.min(Math.max(s,0),e.length-1);c(x)}},[s,e.length]),o.jsxs("div",{className:"fourier-math-panel custom-scrollbar",children:[o.jsx("h3",{className:"text-xl font-bold mb-4 text-cyan-400",children:"Fourier Engine"}),o.jsxs("div",{className:"fourier-math-toggle",role:"group","aria-label":"Toggle formulas",children:[o.jsx("button",{type:"button",className:l==="dft"?"is-active":"",onClick:()=>u("dft"),children:"DFT basis"}),o.jsx("button",{type:"button",className:l==="reconstruction"?"is-active":"",onClick:()=>u("reconstruction"),children:"Reconstruction"}),o.jsx("button",{type:"button",className:l==="phasor"?"is-active":"",onClick:()=>u("phasor"),children:"Phasor anatomy"})]}),o.jsx("div",{className:"mb-4",ref:i,"aria-live":"polite"}),o.jsxs("div",{className:"space-y-4 text-sm font-mono",children:[o.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[o.jsx("span",{className:"text-slate-400",children:"Total Vectors (N)"}),o.jsx("span",{className:"text-cyan-300",children:e.length})]}),o.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[o.jsx("span",{className:"text-slate-400",children:"Active Epicycles"}),o.jsx("span",{className:"text-fuchsia-400",children:n})]}),o.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[o.jsx("span",{className:"text-slate-400",children:"Current Phase (t)"}),o.jsxs("span",{className:"text-amber-400",children:[(t/(2*Math.PI)).toFixed(2),"œÑ"]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-400",children:"Largest Radius"}),o.jsxs("span",{className:"text-emerald-400",children:[e.length>0?e[0].amp.toFixed(1):"0.0"," px"]})]})]}),o.jsxs("div",{className:"mt-4",children:[o.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Amplitude color map"}),o.jsx("div",{className:"fourier-legend",style:{backgroundImage:ys(((b=e[0])==null?void 0:b.amp)||1)},"aria-label":"Amplitude legend from low to high magnitude"}),o.jsxs("div",{className:"flex justify-between text-[11px] text-slate-500 mt-1",children:[o.jsx("span",{children:"low |X_k|"}),o.jsx("span",{children:"high |X_k|"})]})]}),o.jsxs("div",{className:"mt-4 space-y-2 text-sm font-mono",children:[o.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[o.jsx("span",{className:"text-slate-400",children:"Energy captured (M terms)"}),o.jsxs("span",{className:"text-cyan-300",children:[r.energyPct.toFixed(2),"%"]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-slate-400",children:"RMS error vs. original path"}),o.jsxs("span",{className:"text-amber-300",children:[r.rmsError.toFixed(2)," px"]})]})]}),r.topTerms.length>0&&o.jsxs("div",{className:"mt-4",children:[o.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Top terms (by amplitude)"}),o.jsxs("div",{className:"grid grid-cols-5 text-[11px] text-slate-300 gap-2 border border-slate-800 rounded-lg p-2",children:[o.jsx("span",{className:"font-semibold text-slate-200",children:"k"}),o.jsx("span",{className:"font-semibold text-slate-200",children:"|X_k|"}),o.jsx("span",{className:"font-semibold text-slate-200",children:"phase"}),o.jsx("span",{className:"font-semibold text-slate-200",children:"energy"}),o.jsx("span",{className:"font-semibold text-slate-200",children:"cum."}),r.topTerms.map((x,j)=>o.jsxs(Ye.Fragment,{children:[o.jsx("span",{children:x.freq}),o.jsx("span",{children:x.amp.toFixed(2)}),o.jsxs("span",{children:[x.phase.toFixed(2)," rad"]}),o.jsxs("span",{children:[x.energyPct.toFixed(1),"%"]}),o.jsxs("span",{children:[x.cumulativePct.toFixed(1),"%"]})]},j))]})]}),o.jsxs("div",{className:"mt-5 border border-slate-800 rounded-lg p-3 space-y-2 bg-slate-900/40",children:[o.jsxs("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-slate-400",children:[o.jsx("span",{children:"Term inspector"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>c(x=>Math.max(0,x-1)),"aria-label":"Previous term",children:o.jsx(fn,{size:18,"aria-hidden":"true"})}),o.jsxs("span",{className:"text-slate-200",children:[f+1," / ",e.length||1]}),o.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>c(x=>Math.min(e.length-1,x+1)),"aria-label":"Next term",children:o.jsx(mn,{size:18,"aria-hidden":"true"})})]})]}),o.jsxs("div",{className:"text-xs text-slate-200 leading-relaxed space-y-2",children:[o.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:p.paramsHtml}}),o.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:p.vectorHtml}}),o.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:p.energyHtml}}),o.jsx("p",{children:a?"Step mode: play once to view this term, then advance.":"Track this circle while playing to see how its phase and magnitude shape the trace."})]})]}),o.jsxs("div",{className:"mt-5 text-xs text-slate-500 italic space-y-2",children:[o.jsx("p",{children:"* Sorted by amplitude so the largest circles draw first."}),o.jsx("p",{children:"Tip: switch formulas to see how truncating to M epicycles shapes the path."})]})]})},ws=1600,Le=700,js=1.75,ks=.45,Es=1e7,wt="fourier_viz__last_session",Ns=()=>{var it,ct,dt,ut,ht;const[e,t]=w.useState("DRAW"),[n,r]=w.useState([]),[s,a]=w.useState([]),[i,l]=w.useState(0),[u,f]=w.useState(!1),[c,g]=w.useState(0),[h,m]=w.useState(!1),[p,b]=w.useState(!1),[x,j]=w.useState("#0f172a"),[M,k]=w.useState("rgba(148, 163, 184, 0.22)"),[P,C]=w.useState(ks),[E,L]=w.useState(0),[A,K]=w.useState(90),[F,B]=w.useState([]),[R,T]=w.useState(!1),[N,$]=w.useState(!1),[z,H]=w.useState(!1),[q,Y]=w.useState(!1),[_,W]=w.useState(0),[ne,J]=w.useState("#ec4899"),[I,Pt]=w.useState(2),[et,xe]=w.useState(!1),he=w.useRef(null),ce=w.useRef(null),we=w.useRef(),oe=w.useRef([]),Z=w.useRef(!1),se=w.useRef(null),tt=w.useRef(1),nt=w.useRef(null),ye=w.useRef(0),de=w.useRef(null),be=w.useRef(null),Ie=w.useRef(!1),Ae=w.useRef(!0),Q=w.useRef(null),ve=w.useRef(null),_e=w.useRef({mode:e,points:n,fourierX:s,time:i,isPlaying:u,numEpicycles:c,showMath:h,canvasBg:x,gridColor:M,speed:P,brushColor:ne,brushSize:I,stepMode:q,safeMode:z,stepIndex:_}),ee=w.useCallback(()=>{if(Q.current){const d=Q.current.getContext("2d");d&&(d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,Q.current.width,Q.current.height))}ve.current=null},[]),fe=w.useCallback(()=>{const d=ce.current,v=he.current;if(!d||!v)return;const{width:y,height:S}=d.getBoundingClientRect(),D=Math.max(1,Math.floor(y)),U=Math.max(1,Math.floor(S));if(D<=1||U<=1)return;const X=window.devicePixelRatio||1;tt.current=X,d.width=Math.round(D*X),d.height=Math.round(U*X),Q.current||(Q.current=document.createElement("canvas")),Q.current.width=d.width,Q.current.height=d.height,ee()},[ee]),Fe=w.useCallback(d=>{ye.current=d,de.current=null,be.current=null,l(d)},[]),$e=w.useCallback(()=>{Fe(0),ee()},[ee,Fe]),Lt=()=>{$e()},re=w.useCallback(d=>{if(d.length===0)return;const v=z?Le:ws,{prepared:y,spectrum:S}=ms(d,{smoothing:E,limit:v});r(y),a(S),g(Math.min(S.length,v));try{localStorage.setItem(wt,JSON.stringify(y))}catch{}$e(),f(!0),W(0)},[$e,z,E]);w.useEffect(()=>{const d=Object.keys(localStorage).filter(y=>y.startsWith("fourier_viz_")).map(y=>y.replace("fourier_viz_","")).sort();B(d);const v=localStorage.getItem(wt);if(v)try{const y=JSON.parse(v);y.length&&(t("PRESET"),r(y),re(y))}catch{}},[]),w.useEffect(()=>{const d=()=>{const y=getComputedStyle(document.documentElement),S=y.getPropertyValue("--color-code-bg").trim(),D=y.getPropertyValue("--fourier-grid").trim();j(S||"#0f172a"),k(D||"rgba(148, 163, 184, 0.22)")};d();const v=typeof MutationObserver<"u"?new MutationObserver(d):null;return v&&(v.observe(document.documentElement,{attributes:!0,attributeFilter:["class","data-theme"]}),v.observe(document.body,{attributes:!0,attributeFilter:["class","data-theme"]})),()=>v==null?void 0:v.disconnect()},[]),w.useEffect(()=>{const d=z?Math.min(s.length,Le):s.length;d!==0&&g(v=>Math.min(Math.max(v||1,1),d))},[s.length,z]),w.useEffect(()=>{!q&&_!==0&&W(0)},[q,_]),w.useEffect(()=>{const d=()=>{T(document.fullscreenElement===he.current),document.fullscreenElement&&$(!1),fe()};return document.addEventListener("fullscreenchange",d),()=>document.removeEventListener("fullscreenchange",d)},[fe]),w.useEffect(()=>{document.body.classList.toggle("fourier-pseudo-fullscreen",N);const d=window.requestAnimationFrame(()=>{fe()});return()=>{window.cancelAnimationFrame(d),document.body.classList.remove("fourier-pseudo-fullscreen")}},[N,fe]),w.useEffect(()=>{if(!N)return;const d=v=>{v.key==="Escape"&&$(!1)};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[N]);const Tt=w.useCallback(()=>{const d=he.current;if(!d)return;const v=document.fullscreenElement===d;if(v||N){v?document.exitFullscreen().catch(()=>{}):$(!1);return}if(typeof d.requestFullscreen=="function"){d.requestFullscreen().catch(()=>{$(!0)});return}$(!0)},[N]),me=Ye.useMemo(()=>gs(s,n,c),[s,c,n]),Rt=d=>{if(e!=="DRAW"||Z.current||d.pointerType==="mouse"&&d.button!==0)return;Z.current=!0,se.current=d.pointerId,xe(!0),r([]),ee(),a([]),f(!1),W(0),Y(!1);const v=ce.current.getBoundingClientRect(),y=d.clientX-v.left-v.width/2,S=d.clientY-v.top-v.height/2,D={x:y,y:S};r([D]),oe.current=[D];try{d.currentTarget.setPointerCapture(d.pointerId)}catch{}},Ct=d=>{if(!Z.current||e!=="DRAW"||se.current!==d.pointerId)return;if(d.pointerType==="mouse"&&(d.buttons&1)===0){Z.current=!1,se.current=null,xe(!1);return}const v=ce.current.getBoundingClientRect(),y=d.clientX-v.left-v.width/2,S=d.clientY-v.top-v.height/2,D={x:y,y:S},U=oe.current[oe.current.length-1];Math.hypot(D.x-U.x,D.y-U.y)>js&&oe.current.push(D)},It=d=>{if(!Z.current||typeof(d==null?void 0:d.pointerId)=="number"&&se.current!==d.pointerId)return;Z.current=!1,se.current=null,xe(!1);const v=oe.current;v.length>1?re(v):(r([]),a([]),f(!1))},At=()=>{Z.current&&(Z.current=!1,se.current=null,xe(!1))};w.useEffect(()=>{const d=v=>{if(!Z.current)return;const y=v.pointerId;if(typeof y=="number"&&se.current!==null&&y!==se.current)return;Z.current=!1,se.current=null,xe(!1);const S=oe.current;S.length>1?re(S):(r([]),a([]),f(!1))};return window.addEventListener("pointerup",d),window.addEventListener("pointercancel",d),window.addEventListener("blur",d),()=>{window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",d),window.removeEventListener("blur",d)}},[re]);const _t=()=>{r([]),ee(),a([]),f(!1),t("DRAW"),W(0),Y(!1),oe.current=[]},Ft=d=>{let v=[];switch(d){case"circle":v=$n();break;case"square":v=Fn();break;case"heart":v=zn();break;case"infinity":v=qn();break;case"note":v=Dn();break}t("PRESET"),r(v),re(v)},$t=()=>{if(n.length<2){alert("Draw something first!");return}const d=prompt("Enter a name for this drawing:");if(d)try{localStorage.setItem(`fourier_viz_${d}`,JSON.stringify(n)),B(v=>{const y=[...v];return y.includes(d)||y.push(d),y.sort()})}catch{alert("Failed to save. Storage might be full.")}},zt=d=>{const v=localStorage.getItem(`fourier_viz_${d}`);if(v)try{const y=JSON.parse(v);r(y),t("PRESET"),re(y)}catch(y){console.error("Error loading drawing",y)}},qt=async d=>{if(d.target.files&&d.target.files[0]){const v=d.target.files[0];if(v.type&&!v.type.startsWith("image/")){alert("Please upload an image file.");return}if(v.size>Es){alert("File too large for in-browser processing. Please pick an image under 10MB.");return}b(!0),nt.current=v;try{const y=await Mt(v,900,{detail:A/100});y.length>0?(r(y),t("UPLOAD"),re(y)):alert("No clear shape found. Try an image with higher contrast.")}catch(y){console.error(y),alert("Error processing image.")}finally{b(!1),d.target.value=""}}};w.useEffect(()=>{if(e!=="UPLOAD")return;const d=nt.current;if(!d)return;const v=window.setTimeout(async()=>{b(!0);try{const y=await Mt(d,900,{detail:A/100});y.length>0&&(r(y),re(y))}catch(y){console.error(y)}finally{b(!1)}},250);return()=>window.clearTimeout(v)},[e,A,re]);const st=d=>{if(!s.length)return;Y(!0);const v=Math.min(Math.max(d,0),Math.max(ae-1,0));W(v);const y=v+1;c!==y&&g(y),Fe(0),ee()},Dt=()=>st(_-1),Ot=()=>st(_+1),Ut=()=>{q||Y(!0),f(!0)},rt=w.useCallback((d,v,y,S,D,U,X)=>{var Me;let le=v/2,O=y/2;const V=S.slice(0,Math.max(D,1)),G=Math.max(V.length-1,0),qe=((Me=S[0])==null?void 0:Me.amp)||1;for(let ie=0;ie<V.length;ie++){const je=le,ke=O,{freq:Ee,amp:Ne,phase:De}=V[ie],Se=Ee*U+De,Oe=ie===G,Ue=bs(V[ie],qe,Oe),Wt=X&&Oe?1+.25*Math.sin(U*6):1;le+=Ne*Math.cos(Se),O+=Ne*Math.sin(Se),d.strokeStyle=Ue,d.lineWidth=Oe?1.6*Wt:1,d.beginPath(),d.arc(je,ke,Ne,0,2*Math.PI),d.stroke(),d.strokeStyle=Ue,d.beginPath(),d.moveTo(je,ke),d.lineTo(le,O),d.stroke(),ie===V.length-1&&(d.fillStyle=Ue,d.beginPath(),d.arc(le,O,3,0,2*Math.PI),d.fill())}return{x:le,y:O}},[]),at=w.useCallback(d=>{const v=ce.current;if(!v)return;const y=v.getContext("2d");if(!y)return;const S=_e.current,D=tt.current||1,U=v.width/D,X=v.height/D;y.setTransform(1,0,0,1,0,0),y.scale(D,D),y.lineCap="round",y.lineJoin="round",y.fillStyle=S.canvasBg,y.fillRect(0,0,U,X),y.strokeStyle=S.gridColor,y.lineWidth=.5,y.beginPath(),y.moveTo(U/2,0),y.lineTo(U/2,X),y.moveTo(0,X/2),y.lineTo(U,X/2),y.stroke(),S.points.length>0&&S.mode!=="DRAW"&&(y.strokeStyle="rgba(255, 255, 255, 0.1)",y.lineWidth=1,y.beginPath(),S.points.forEach((O,V)=>{V===0?y.moveTo(O.x+U/2,O.y+X/2):y.lineTo(O.x+U/2,O.y+X/2)}),y.stroke()),S.mode==="DRAW"&&Z.current&&(y.strokeStyle=S.brushColor,y.lineWidth=S.brushSize,y.beginPath(),oe.current.forEach((O,V)=>{V===0?y.moveTo(O.x+U/2,O.y+X/2):y.lineTo(O.x+U/2,O.y+X/2)}),y.stroke());const le=ye.current;if(S.fourierX.length>0){Q.current&&y.drawImage(Q.current,0,0,U,X);const O=Math.min(Math.max(S.numEpicycles,1),S.fourierX.length),V=rt(y,U,X,S.fourierX,O,le,S.stepMode);if(Q.current){const G=Q.current.getContext("2d");G&&(G.setTransform(1,0,0,1,0,0),G.scale(D,D),G.strokeStyle=S.brushColor,G.lineWidth=S.brushSize,G.lineCap="round",G.lineJoin="round",ve.current&&(G.beginPath(),G.moveTo(ve.current.x,ve.current.y),G.lineTo(V.x,V.y),G.stroke()))}if(ve.current={x:V.x,y:V.y},S.isPlaying){const G=Math.max(S.points.length||S.fourierX.length,1),qe=2*Math.PI/G,Me=de.current,ie=Me==null?0:Math.min(Math.max(d-Me,0),80);de.current=d;const je=ie/(1e3/60),ke=qe*S.speed*je,Ee=le+ke;if(Ee>=2*Math.PI){if(ye.current=0,ee(),S.stepMode){f(!1);const De=S.safeMode?Math.min(S.fourierX.length,Le):S.fourierX.length;W(Se=>Math.min(Se+1,Math.max(De-1,0)))}}else ye.current=Ee}else de.current=d}else de.current=d;if(S.showMath){const O=be.current;(O==null||d-O>=50)&&(l(ye.current),be.current=d)}else be.current=null},[ee,rt]),ze=w.useCallback(d=>{const y=_e.current.isPlaying||Z.current;(Ae.current||y)&&(at(d),Ae.current=!1),y?we.current=requestAnimationFrame(ze):(Ie.current=!1,de.current=null,be.current=null)},[at]),ge=w.useCallback(()=>{Ae.current=!0,!Ie.current&&(Ie.current=!0,de.current=null,we.current=requestAnimationFrame(ze))},[ze]);w.useEffect(()=>{_e.current={mode:e,points:n,fourierX:s,time:i,isPlaying:u,numEpicycles:c,showMath:h,canvasBg:x,gridColor:M,speed:P,brushColor:ne,brushSize:I,stepMode:q,safeMode:z,stepIndex:_},ge()},[e,n,s,i,u,c,h,x,M,P,ne,I,q,z,_,ge]),w.useEffect(()=>(ge(),()=>{we.current&&cancelAnimationFrame(we.current)}),[ge]),w.useEffect(()=>{const d=()=>{fe(),ge()};d();const v=typeof ResizeObserver<"u"?new ResizeObserver(d):null;return v&&(he.current&&v.observe(he.current),ce.current&&v.observe(ce.current)),window.addEventListener("resize",d),()=>{window.removeEventListener("resize",d),v==null||v.disconnect()}},[fe,ge]),w.useEffect(()=>{ee()},[c,s]),w.useEffect(()=>{const d=document.getElementById("fourier-root");return d==null||d.classList.add("is-mounted"),()=>{d==null||d.classList.remove("is-mounted")}},[]);const ae=z?Math.min(s.length,Le):s.length,ot=Math.max(Math.min(c-1,(((it=me.breakdown)==null?void 0:it.length)||1)-1),0),Bt=((dt=(ct=me.breakdown)==null?void 0:ct[ot])==null?void 0:dt.energyPct)??0,Ht=((ht=(ut=me.breakdown)==null?void 0:ut[ot])==null?void 0:ht.cumulativePct)??me.energyPct,lt=R||N;return w.useEffect(()=>{if(!q)return;const d=Math.min(Math.max(_+1,1),Math.max(ae,1));c!==d&&g(d)},[q,_,ae,c]),w.useEffect(()=>{const d=Math.max(Math.min(c-1,ae-1),0);_>d&&W(d)},[c,ae,_]),o.jsxs("div",{className:`fourier-stage select-none ${lt?"is-fullscreen":""} ${N?"is-pseudo-fullscreen":""}`,ref:he,"data-mode":e,"data-drawing":et?"true":"false","data-has-spectrum":s.length>0?"true":"false","data-points":n.length,children:[o.jsx("canvas",{ref:ce,onPointerDown:Rt,onPointerMove:Ct,onPointerUp:It,onPointerCancel:At,className:`fourier-canvas cursor-${e==="DRAW"?"crosshair":"default"}`}),o.jsx(vs,{mode:e,setMode:t,isPlaying:u,setIsPlaying:f,clear:_t,numEpicycles:c,maxEpicycles:ae,setNumEpicycles:g,onUpload:qt,showMath:h,setShowMath:m,onPreset:Ft,speed:P,setSpeed:C,onReset:Lt,brushColor:ne,setBrushColor:J,brushSize:I,setBrushSize:Pt,smoothing:E,setSmoothing:L,outlineDetail:A,setOutlineDetail:K,isDrawing:et,onSave:$t,onLoad:zt,savedDrawings:F,isFullscreen:lt,onToggleFullscreen:Tt,safeMode:z,onToggleSafeMode:()=>H(d=>!d),stepMode:q,onToggleStepMode:()=>Y(d=>!d),stepIndex:_,stepMax:ae,onStepPrev:Dt,onStepNext:Ot,onStepPlayOnce:Ut}),h&&s.length>0&&o.jsx(Ms,{terms:s,time:i,epicycles:c,metrics:me,focusIndex:q?Math.max(c-1,0):void 0,stepMode:q}),q&&s.length>0&&o.jsxs("div",{className:"absolute top-4 left-4 z-[60] bg-slate-900/80 text-slate-100 border border-slate-700 rounded-lg px-4 py-3 shadow-lg space-y-1",children:[o.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Step mode"}),o.jsxs("div",{className:"text-sm font-semibold",children:["Term ",Math.min(c,ae)," / ",Math.max(ae,1)]}),o.jsxs("div",{className:"text-xs text-slate-200",children:["Œîenergy ",Bt.toFixed(2),"% ¬∑ Cumulative ",Ht.toFixed(2),"% ¬∑ RMS ",me.rmsError.toFixed(2)," px"]})]}),p&&o.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100]",children:o.jsx("div",{className:"text-cyan-400 font-mono text-xl animate-pulse",children:"Processing Image..."})}),e==="DRAW"&&n.length===0&&o.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none text-center",children:[o.jsx("h1",{className:"text-4xl font-bold text-slate-200 mb-2 drop-shadow",children:"Draw Something"}),o.jsx("p",{className:"text-slate-300",children:"Trace a continuous line to begin"})]})]})},St=document.getElementById("fourier-root");if(!St)throw new Error("Could not find root element to mount to");const Ss=Xt.createRoot(St);Ss.render(o.jsx(Ye.StrictMode,{children:o.jsx(Ns,{})}));
