import{r as p,j as t,R as Ne,a as st}from"./react-vendor-CkISVyWX.js";import{A as nt,P as rt,S as at,F as ot,a as lt,I as ct,b as it,C as Fe,T as ut,c as dt,d as ht,e as ft,M as xt,f as mt,R as pt,g as gt,h as bt,i as yt,j as vt,G as jt,W as Mt,k as Nt,l as kt}from"./icons-vendor-D7oP6Icu.js";import{k as pe}from"./math-vendor-Ca7EfnBD.js";import"./vendor-Bb8JjhAW.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function a(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=a(s);fetch(s.href,o)}})();const wt=e=>{const n=[],a=e.length;for(let r=0;r<a;r++){let s=0,o=0;for(let f=0;f<a;f++){const c=Math.PI*2*r*f/a,m=Math.cos(c),x=Math.sin(c),M=e[f].re,y=e[f].im;s+=M*m+y*x,o+=y*m-M*x}s=s/a,o=o/a;const d=r>a/2?r-a:r,h=Math.sqrt(s*s+o*o),i=Math.atan2(o,s);n.push({re:s,im:o,freq:d,amp:h,phase:i})}return n.sort((r,s)=>s.amp-r.amp)},St=(e,n)=>{if(n<=0||e.length<2)return[...e];const a=[];for(let r=0;r<e.length;r++){let s=0,o=0,d=0;for(let h=-n;h<=n;h++){const i=r+h;i>=0&&i<e.length&&(s+=e[i].x,o+=e[i].y,d++)}a.push({x:s/d,y:o/d})}return a},Pt=()=>{const e=[];for(let r=0;r<50;r++)e.push({x:-200+r*2*200/50,y:-200});for(let r=0;r<50;r++)e.push({x:200,y:-200+r*2*200/50});for(let r=0;r<50;r++)e.push({x:200-r*2*200/50,y:200});for(let r=0;r<50;r++)e.push({x:-200,y:200-r*2*200/50});return e},Ct=()=>{const e=[];for(let r=0;r<200;r++){const s=Math.PI*2*r/200;e.push({x:200*Math.cos(s),y:200*Math.sin(s)})}return e},Et=()=>{const e=[];for(let a=0;a<300;a++){const r=Math.PI*2*a/300,s=16*Math.pow(Math.sin(r),3),o=-(13*Math.cos(r)-5*Math.cos(2*r)-2*Math.cos(3*r)-Math.cos(4*r));e.push({x:s*15,y:o*15})}return e},Rt=()=>{const e=[];for(let r=0;r<300;r++){const s=Math.PI*2*r/300,o=150*Math.cos(s),d=150*Math.sin(s)*Math.cos(s);e.push({x:o,y:d})}return e},Tt=()=>{const e=[];for(let a=0;a<100;a++){const r=Math.PI*2*a/100;e.push({x:40*Math.cos(r)-50,y:30*Math.sin(r)+100})}for(let a=0;a<20;a++)e.push({x:-10,y:100-200*a/20});for(let a=0;a<30;a++){const r=a/30;e.push({x:-10+50*Math.sin(r*Math.PI),y:-100+50*r})}for(let a=0;a<20;a++)e.push({x:-10,y:-50+150*a/20});return e},It={threshold:30,sampleRate:2,maxPoints:1500,smoothingWindow:4,blurRadius:1,morphRadius:2},_t=e=>{if(e.length===0)return[];const n=[],a=new Set;let r=0;for(n.push(e[0]),a.add(0);n.length<e.length;){let s=1/0,o=-1;const d=e[r];for(let h=0;h<e.length;h++)if(!a.has(h)){const i=e[h],f=(d.x-i.x)**2+(d.y-i.y)**2;f<s&&(s=f,o=h)}if(o!==-1)a.add(o),n.push(e[o]),r=o;else break}return n},he=(e,n,a)=>Math.max(n,Math.min(a,e)),Ft=(e,n,a,r)=>{const s=Math.max(1,Math.floor(r||1)),o=Math.max(1,Math.floor(n/s)),d=Math.max(1,Math.floor(a/s)),h=new Uint8Array(o*d);for(let i=0;i<d;i++){const f=he(i*s,0,a-1);for(let c=0;c<o;c++){const m=he(c*s,0,n-1),x=(f*n+m)*4,M=e[x]??0,y=e[x+1]??0,j=e[x+2]??0;h[i*o+c]=Math.round(.2126*M+.7152*y+.0722*j)}}return{gray:h,w:o,h:d,step:s}},zt=(e,n,a,r)=>{const s=Math.max(0,Math.floor(r||0));if(s===0||n*a===0)return e;const o=new Uint8Array(n*a),d=(2*s+1)*(2*s+1);for(let h=0;h<a;h++)for(let i=0;i<n;i++){let f=0;for(let c=-s;c<=s;c++){const m=he(h+c,0,a-1);for(let x=-s;x<=s;x++){const M=he(i+x,0,n-1);f+=e[m*n+M]??0}}o[h*n+i]=Math.round(f/d)}return o},Lt=e=>{const n=new Uint32Array(256);for(let i=0;i<e.length;i++)n[e[i]]++;const a=e.length||1;let r=0;for(let i=0;i<256;i++)r+=i*n[i];let s=0,o=0,d=-1,h=128;for(let i=0;i<256;i++){const f=n[i];if(o+=f,o===0)continue;const c=a-o;if(c===0)break;s+=i*f;const m=s/o,x=(r-s)/c,M=o*c*(m-x)*(m-x);M>d&&(d=M,h=i)}return h},At=(e,n,a)=>{if(n===0||a===0)return 0;let r=0,s=0;for(let o=0;o<n;o++)r+=e[o]??0,r+=e[(a-1)*n+o]??0,s+=2;for(let o=1;o<a-1;o++)r+=e[o*n]??0,r+=e[o*n+(n-1)]??0,s+=2;return s>0?r/s:0},Dt=(e,n,a,r)=>{const s=Math.max(1,Math.floor(r||1)),o=new Uint8Array(e.length);for(let d=0;d<a;d++)for(let h=0;h<n;h++){let i=0;for(let f=-s;f<=s&&!i;f++){const c=d+f;if(!(c<0||c>=a))for(let m=-s;m<=s;m++){const x=h+m;if(!(x<0||x>=n)&&e[c*n+x]){i=1;break}}}o[d*n+h]=i}return o},Ot=(e,n,a,r)=>{const s=Math.max(1,Math.floor(r||1)),o=new Uint8Array(e.length);for(let d=0;d<a;d++)for(let h=0;h<n;h++){let i=1;for(let f=-s;f<=s&&i;f++){const c=d+f;if(c<0||c>=a){i=0;break}for(let m=-s;m<=s;m++){const x=h+m;if(x<0||x>=n||!e[c*n+x]){i=0;break}}}o[d*n+h]=i}return o},Ut=(e,n,a,r)=>{const s=Math.max(1,Math.floor(r||1));return Ot(Dt(e,n,a,s),n,a,s)},$t=(e,n,a)=>{const r=new Uint8Array(e.length);let s=[];const o=[],d=i=>{i<0||i>=e.length||!e[i]||r[i]||(r[i]=1,o.push(i))};for(let i=0;i<e.length;i++){if(!e[i]||r[i])continue;const f=[];for(o.length=0,r[i]=1,o.push(i);o.length;){const c=o.pop();f.push(c);const m=c%n,x=(c-m)/n;m>0&&d(c-1),m<n-1&&d(c+1),x>0&&d(c-n),x<a-1&&d(c+n)}f.length>s.length&&(s=f)}const h=new Uint8Array(e.length);return s.forEach(i=>{h[i]=1}),h},qt=(e,n,a,r,s)=>{const o=s*n+r;if(!e[o])return!1;const d=r>0?e[o-1]:0,h=r<n-1?e[o+1]:0,i=s>0?e[o-n]:0,f=s<a-1?e[o+n]:0;return!(d&&h&&i&&f)},Bt=(e,n,a)=>{if(n<2||a<2)return[];let r=-1,s=-1;for(let y=0;y<a&&r===-1;y++)for(let j=0;j<n;j++)if(qt(e,n,a,j,y)){r=j,s=y;break}if(r===-1||s===-1)return[];const o=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1]],d=(y,j)=>o.findIndex(b=>b[0]===y&&b[1]===j),h=(y,j)=>y<0||y>=n||j<0||j>=a?!1:e[j*n+y]===1,i={x:r,y:s},f={x:r-1,y:s};let c={...i},m={...f};const x=[{...c}],M=n*a*4;for(let y=0;y<M;y++){const j=Math.sign(m.x-c.x),b=Math.sign(m.y-c.y),F=d(j,b),v=F===-1?0:(F+1)%8;let P=!1,k={x:c.x,y:c.y},C={x:m.x,y:m.y};for(let R=0;R<8;R++){const z=(v+R)%8,A=c.x+o[z][0],D=c.y+o[z][1];if(h(A,D)){k={x:A,y:D};const q=(z+7)%8;C={x:c.x+o[q][0],y:c.y+o[q][1]},P=!0;break}}if(!P||(c=k,m=C,x.push({...c}),c.x===i.x&&c.y===i.y&&m.x===f.x&&m.y===f.y))break}return x},Wt=(e,n)=>{const a=Math.max(0,Math.floor(n||0));if(a<=0||e.length<3)return e;const r=[],s=e.length;for(let o=0;o<s;o++){let d=0,h=0,i=0;for(let f=-a;f<=a;f++){const c=(o+f+s)%s;d+=e[c].x,h+=e[c].y,i++}r.push({x:d/i,y:h/i})}return r},Xt=(e,n,a,r,s)=>{if(!e.length)return[];const o=e.length>s?Math.ceil(e.length/s):1,d=[];for(let h=0;h<e.length;h+=o){const i=e[h],f=i.x*r-n/2,c=i.y*r-a/2;d.push({x:f,y:c})}return d},Ht=e=>{if(e.length<2)return e;const n=e[0],a=e[e.length-1];return n.x===a.x&&n.y===a.y?e:[...e,{...n}]},ze=(e,n,a)=>{const r=new Uint8Array(e.length);for(let s=0;s<e.length;s++){const o=e[s];r[s]=a?o<=n?1:0:o>=n?1:0}return r},Yt=(e,n,a,r)=>{const s=At(e,n,a),o=Math.max(1,Math.floor(r)),d=new Uint8Array(e.length);for(let h=0;h<e.length;h++)d[h]=Math.abs(e[h]-s)>=o?1:0;return d},Gt=(e,n,a)=>{if(n<3||a<3)return new Uint8Array(e.length);const r=new Uint16Array(e.length),s=new Uint32Array(1025);for(let c=1;c<a-1;c++)for(let m=1;m<n-1;m++){const x=c*n+m,M=e[x-n-1],y=e[x-n],j=e[x-n+1],b=e[x-1],F=e[x+1],v=e[x+n-1],P=e[x+n],k=e[x+n+1],C=-M+j-2*b+2*F-v+k,R=-M-2*y-j+v+2*P+k,z=Math.min(1024,Math.abs(C)+Math.abs(R));r[x]=z,s[z]++}const o=(n-2)*(a-2);let d=Math.floor(o*.08);d=he(d,50,o);let h=0,i=1024;for(let c=1024;c>=0;c--)if(h+=s[c],h>=d){i=c;break}const f=new Uint8Array(e.length);for(let c=0;c<r.length;c++)f[c]=r[c]>=i&&r[c]>0?1:0;return f},Jt=e=>{let n=0;for(let a=0;a<e.length;a++)n+=e[a]?1:0;return n},Vt=(e,n,a,r={})=>{const{threshold:s,sampleRate:o,maxPoints:d,smoothingWindow:h,blurRadius:i,morphRadius:f}={...It,...r},{gray:c,w:m,h:x,step:M}=Ft(e,n,a,o),y=zt(c,m,x,i),j=[],b=Lt(y),F=ze(y,b,!0),v=ze(y,b,!1);j.push(F,v),j.push(Yt(y,m,x,s)),j.push(Gt(y,m,x));const P=m*x||1;let k=[];for(const N of j){const S=Ut(N,m,x,f),B=$t(S,m,x),O=Jt(B)/P;if(O<.002||O>.9)continue;const L=Bt(B,m,x);L.length>k.length&&(k=L)}if(k.length>=8){const N=Xt(k,n,a,M,d);return Ht(Wt(N,h))}const C=[],R=N=>(e[N]+e[N+1]+e[N+2])/3;for(let N=0;N<a;N+=o)for(let S=0;S<n;S+=o){if(S<=0||N<=0)continue;const B=(N*n+S)*4,T=(N*n+(S-1))*4,O=((N-1)*n+S)*4,L=R(B),X=R(T),Q=R(O);Math.abs(L-X)+Math.abs(L-Q)>s&&C.push({x:S-n/2,y:N-a/2})}if(C.length===0)return[];const z=C.length>d?Math.ceil(C.length/d):1,A=z===1?C:C.filter((N,S)=>S%z===0),D=_t(A),q=[];for(let N=0;N<D.length;N++){let S=0,B=0,T=0;for(let O=-h;O<=h;O++){const L=(N+O+D.length)%D.length;S+=D[L].x,B+=D[L].y,T++}q.push({x:S/T,y:B/T})}return q},Kt=async(e,n=900,a={})=>new Promise((r,s)=>{const o=new Image,d=URL.createObjectURL(e);o.onload=()=>{const h=document.createElement("canvas"),i=h.getContext("2d");if(!i){s(new Error("Could not get canvas context"));return}let f=o.width,c=o.height;const m=Math.max(f,c),x=n&&n>0?n:900;if(m>x){const j=x/m;f=Math.round(f*j),c=Math.round(c*j)}h.width=f,h.height=c,i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(o,0,0,f,c);const M=i.getImageData(0,0,f,c),y=Vt(M.data,f,c,a);URL.revokeObjectURL(d),r(y)},o.onerror=h=>s(h),o.src=d}),ye=1500,Qt=e=>e.map(n=>({re:n.x,im:n.y})),Zt=e=>e&&e>0?e:ye,es=(e,n=ye)=>{const a=Zt(n);if(e.length<=a)return[...e];const r=Math.ceil(e.length/a);return e.filter((s,o)=>o%r===0)},ts=(e,n,a=ye)=>{const r=es(e,a);return St(r,n)},ss=(e,n={})=>{const{smoothing:a=0,limit:r=ye}=n,s=ts(e,a,r),o=wt(Qt(s));return{prepared:s,spectrum:o}},ns=(e,n,a,r=600)=>{if(!e.length||!n.length)return{energyPct:0,rmsError:0,topTerms:[],breakdown:[]};const s=e.map(v=>v.amp*v.amp),o=s.reduce((v,P)=>v+P,0)||1,d=Math.max(Math.min(a||e.length,e.length),1),h=s.slice(0,d).reduce((v,P)=>v+P,0);let i=0;const f=s.map(v=>(i+=v,{energyPct:v/o*100,cumulativePct:i/o*100}));let c=0;const m=e.slice(0,6).map((v,P)=>{const k=s[P];return c+=k,{freq:v.freq,amp:v.amp,phase:v.phase,energyPct:k/o*100,cumulativePct:c/o*100}}),x=n.length,M=Math.max(1,Math.floor(x/r)),y=e.slice(0,d);let j=0,b=0;for(let v=0;v<x;v+=M){let P=0,k=0;for(let z=0;z<y.length;z++){const A=y[z],D=2*Math.PI*A.freq*v/x,q=Math.cos(D),N=Math.sin(D);P+=A.re*q-A.im*N,k+=A.re*N+A.im*q}const C=P-n[v].x,R=k-n[v].y;j+=C*C+R*R,b++}const F=Math.sqrt(j/Math.max(b,1));return{energyPct:Number((h/o*100).toFixed(2)),rmsError:Number(F.toFixed(2)),topTerms:m,breakdown:f}},rs=e=>Math.min(1,Math.max(0,e)),as=(e,n)=>!isFinite(e)||n<=0?0:rs(e/n),be=(e,n,a=!1)=>{const r=as(e,n),s=210+110*r,o=a?62:48+6*r,d=a?.95:.6;return`hsla(${s.toFixed(1)}, 82%, ${o.toFixed(1)}%, ${d})`},os=e=>`linear-gradient(90deg, ${be(0,e)} 0%, ${be(e*.5,e)} 50%, ${be(e,e,!0)} 100%)`,ls=(e,n,a)=>be(e.amp,n,a),cs=({mode:e,setMode:n,isPlaying:a,setIsPlaying:r,clear:s,numEpicycles:o,maxEpicycles:d,setNumEpicycles:h,onUpload:i,showMath:f,setShowMath:c,onPreset:m,speed:x,setSpeed:M,onReset:y,brushColor:j,setBrushColor:b,brushSize:F,setBrushSize:v,smoothing:P,setSmoothing:k,isDrawing:C,onSave:R,onLoad:z,savedDrawings:A,isFullscreen:D,onToggleFullscreen:q,safeMode:N,onToggleSafeMode:S,stepMode:B,onToggleStepMode:T,stepIndex:O,stepMax:L,onStepPrev:X,onStepNext:Q,onStepPlayOnce:fe})=>{const te=p.useRef(null),H=I=>`
    p-2.5 rounded-lg transition-all duration-200 flex items-center justify-center
    ${I?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50 shadow-[0_0_15px_rgba(6,182,212,0.3)]":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 hover:text-slate-200 border border-transparent"}
  `;return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"fourier-toolbar fourier-toolbar--top",children:[t.jsxs("div",{className:"flex gap-1 mr-4 pl-2",children:[t.jsx(nt,{className:"w-5 h-5 text-fuchsia-500"}),t.jsxs("span",{className:"font-bold text-slate-100 hidden sm:block",children:["Fourier",t.jsx("span",{className:"text-fuchsia-500",children:"Viz"})]})]}),t.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),t.jsx("button",{onClick:()=>n("DRAW"),className:H(e==="DRAW"),title:"Freehand Draw",children:t.jsx(rt,{size:20})}),t.jsxs("div",{className:"relative group",children:[t.jsx("button",{className:H(e==="PRESET"),title:"Presets",children:t.jsx(at,{size:20})}),t.jsxs("div",{className:"absolute top-full left-0 w-32 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden hidden group-hover:block group-focus-within:block z-50",children:[t.jsx("button",{onClick:()=>m("circle"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Circle"}),t.jsx("button",{onClick:()=>m("square"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Square"}),t.jsx("button",{onClick:()=>m("heart"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Heart"}),t.jsx("button",{onClick:()=>m("infinity"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Infinity"}),t.jsx("button",{onClick:()=>m("note"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Note"})]})]}),t.jsxs("div",{className:"relative group",children:[t.jsx("button",{className:H(!1),title:"Load Saved Drawing",children:t.jsx(ot,{size:20})}),t.jsx("div",{className:"absolute top-full left-0 w-48 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden hidden group-hover:block group-focus-within:block max-h-60 overflow-y-auto custom-scrollbar z-50",children:A.length===0?t.jsx("div",{className:"px-4 py-2 text-sm text-slate-500 italic",children:"No saved drawings"}):A.map(I=>t.jsx("button",{onClick:()=>z(I),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400 truncate border-b border-slate-800 last:border-0",children:I},I))})]}),t.jsx("button",{onClick:R,className:H(!1),title:"Save Current Drawing",children:t.jsx(lt,{size:20})}),t.jsx("button",{onClick:()=>{var I;return(I=te.current)==null?void 0:I.click()},className:H(e==="UPLOAD"),title:"Upload Image",children:t.jsx(ct,{size:20})}),t.jsx("input",{type:"file",ref:te,onChange:i,accept:"image/*",className:"hidden"}),t.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),t.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-lg transition-all duration-300 ${C?"bg-fuchsia-900/20 ring-1 ring-fuchsia-500/50":""}`,children:[t.jsxs("div",{className:"relative flex items-center group",title:"Brush Color",children:[t.jsx(it,{size:18,className:`${C?"text-fuchsia-400":"text-slate-400"} mr-2 transition-colors`}),t.jsx("input",{type:"color",value:j,onChange:I=>b(I.target.value),className:"w-6 h-6 rounded border-none cursor-pointer bg-transparent"})]}),t.jsxs("div",{className:"flex items-center gap-2",title:"Brush Size",children:[t.jsx(Fe,{size:10,className:"text-slate-400"}),t.jsx("input",{type:"range",min:"1",max:"10",step:"0.5",value:F,onChange:I=>v(parseFloat(I.target.value)),className:"w-16 h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-slate-400"}),t.jsx(Fe,{size:16,className:`text-slate-400 transition-all ${C?"scale-110 text-fuchsia-300":""}`})]})]}),t.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),t.jsx("button",{onClick:s,className:"p-2.5 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors",title:"Clear Canvas",children:t.jsx(ut,{size:20})}),t.jsx("button",{onClick:()=>c(!f),className:H(f),title:"Toggle Math Panel",children:t.jsx(dt,{size:20})}),t.jsx("button",{onClick:S,className:H(N),title:"Toggle safe mode (cap epicycles / lighten rendering)",children:t.jsx(ht,{size:20})}),t.jsx("button",{onClick:T,className:H(B),title:"Toggle step-through playback",children:t.jsx(ft,{size:20})}),t.jsx("button",{onClick:q,className:H(D),title:D?"Exit Fullscreen":"Fullscreen Play",children:D?t.jsx(xt,{size:20}):t.jsx(mt,{size:20})})]}),t.jsx("div",{className:"fourier-toolbar fourier-toolbar--bottom",children:t.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:y,className:"p-3 rounded-full bg-slate-800 text-slate-300 hover:bg-slate-700 hover:text-white transition-all",title:"Reset Animation",children:t.jsx(pt,{size:18})}),t.jsx("button",{onClick:()=>r(!a),className:"w-14 h-14 flex items-center justify-center rounded-full bg-cyan-500 text-slate-950 hover:bg-cyan-400 transition-all shadow-[0_0_20px_rgba(6,182,212,0.4)]",children:a?t.jsx(gt,{fill:"currentColor",size:24}):t.jsx(bt,{fill:"currentColor",className:"ml-1",size:24})}),B&&t.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/70 rounded-full px-3 py-2 border border-slate-700",children:[t.jsx("button",{onClick:X,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Previous term",children:t.jsx(yt,{size:16})}),t.jsx("button",{onClick:fe,className:"px-3 py-2 rounded-full bg-amber-400 text-slate-900 font-semibold hover:bg-amber-300 transition",title:"Play this term once",children:"Step"}),t.jsx("button",{onClick:Q,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Next term",children:t.jsx(vt,{size:16})}),t.jsxs("span",{className:"text-xs text-slate-300 font-semibold ml-1",children:["Term ",O+1," / ",Math.max(L,1)]})]})]}),t.jsxs("div",{className:"flex-1 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 w-full",children:[t.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[t.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[t.jsx("span",{children:"Precision"}),t.jsxs("span",{className:"text-cyan-400",children:[o," / ",d,N?" (capped)":""]})]}),t.jsx("input",{type:"range",min:"1",max:d||1,value:o,onChange:I=>h(parseInt(I.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),t.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[t.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(jt,{size:12}),t.jsx("span",{children:"Speed"})]}),t.jsxs("span",{className:"text-amber-400",children:[x.toFixed(2),"x"]})]}),t.jsx("input",{type:"range",min:"0.05",max:"3",step:"0.05",value:x,onChange:I=>M(parseFloat(I.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-amber-500"})]}),t.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[t.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Mt,{size:12}),t.jsx("span",{children:"Smoothness"})]}),t.jsxs("span",{className:"text-emerald-400",children:[P,"px"]})]}),t.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:P,onChange:I=>k(parseInt(I.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]})]})]})})]})},is=({terms:e,time:n,epicycles:a,metrics:r,focusIndex:s,stepMode:o=!1})=>{var j;const d=p.useRef(null),[h,i]=p.useState("dft"),[f,c]=p.useState(0),m=p.useMemo(()=>{const b=e[0],F=e.length||1,v=(n/(2*Math.PI)).toFixed(2);return{n:F,largestRadius:b?b.amp.toFixed(1):"0.0",maxFreq:b?b.freq:0,phaseTurns:v,dominantPhase:b?b.phase.toFixed(2):"0.00"}},[e,n]),x=p.useMemo(()=>{const b=e[Math.min(f,Math.max(e.length-1,0))];return b||{freq:0,amp:0,phase:0}},[f,e]),M=r.breakdown?r.breakdown[Math.min(f,Math.max(r.breakdown.length-1,0))]??{energyPct:0,cumulativePct:0}:{energyPct:0,cumulativePct:0},y=p.useMemo(()=>{const b={throwOnError:!1},F=m.n||1,v=x.freq,P=x.amp.toFixed(3),k=x.phase.toFixed(3),C=M.energyPct.toFixed(2),R=M.cumulativePct.toFixed(2);return{paramsHtml:pe.renderToString(`k = ${v},\\quad |X_k| = ${P},\\quad \\phi_k = ${k}\\,\\text{rad}`,b),vectorHtml:pe.renderToString(`\\text{Vector}_k(t) = |X_k|\\,e^{i\\left(2\\pi k t/${F} + \\phi_k\\right)}`,b),energyHtml:pe.renderToString(`\\Delta\\text{energy} = ${C}\\%\\quad \\text{cum.} = ${R}\\%`,b)}},[M,x.amp,x.freq,x.phase,m.n]);return p.useEffect(()=>{var z,A;if(!d.current)return;const{n:b,phaseTurns:F,dominantPhase:v}=m,P=Math.max(a,1),k=((z=e[0])==null?void 0:z.freq)??0,C=((A=e[0])==null?void 0:A.amp)??0,R={dft:`
      \\begin{aligned}
        X_k &= \\frac{1}{N} \\sum_{n=0}^{N-1} x_n e^{-i 2\\pi kn / N} \\\\
        &\\textcolor{#f472b6}{N = ${b}},\\; \\textcolor{#22c55e}{k \\in [0, N-1]}
      \\end{aligned}
      `,reconstruction:`
      \\begin{aligned}
        x(t) &\\approx \\sum_{j=1}^{${P}} \\left|X_{k_j}\\right| e^{i\\left(k_j t + \\phi_{k_j}\\right)} \\\\
        t &= 2\\pi n/N,\\; k_j \\in \\left[-\\frac{N}{2}, \\frac{N}{2}\\right] \\\\
        &\\textcolor{#22c55e}{\\left|X_{${k}}\\right| = ${C.toFixed(2)}},\\;
          \\textcolor{#f472b6}{\\phi_{${k}} = ${v}}\\;\\text{rad}
      \\end{aligned}
      `,phasor:`
      \\begin{aligned}
        \\text{Epicycle}_k(t) &= r_k e^{i(\\omega_k t + \\phi_k)} \\\\
        r_k &= \\left|X_k\\right|,\\;
        \\omega_k = k,\\;
        t = ${F}\\,\\tau
      \\end{aligned}
      `};pe.render(R[h],d.current,{throwOnError:!1,displayMode:!0})},[h,a,m,e]),p.useEffect(()=>{i("dft"),c(0)},[e.length]),p.useEffect(()=>{if(typeof s=="number"&&e.length>0){const b=Math.min(Math.max(s,0),e.length-1);c(b)}},[s,e.length]),t.jsxs("div",{className:"fourier-math-panel custom-scrollbar",children:[t.jsx("h3",{className:"text-xl font-bold mb-4 text-cyan-400",children:"Fourier Engine"}),t.jsxs("div",{className:"fourier-math-toggle",role:"group","aria-label":"Toggle formulas",children:[t.jsx("button",{type:"button",className:h==="dft"?"is-active":"",onClick:()=>i("dft"),children:"DFT basis"}),t.jsx("button",{type:"button",className:h==="reconstruction"?"is-active":"",onClick:()=>i("reconstruction"),children:"Reconstruction"}),t.jsx("button",{type:"button",className:h==="phasor"?"is-active":"",onClick:()=>i("phasor"),children:"Phasor anatomy"})]}),t.jsx("div",{className:"mb-4",ref:d,"aria-live":"polite"}),t.jsxs("div",{className:"space-y-4 text-sm font-mono",children:[t.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[t.jsx("span",{className:"text-slate-400",children:"Total Vectors (N)"}),t.jsx("span",{className:"text-cyan-300",children:e.length})]}),t.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[t.jsx("span",{className:"text-slate-400",children:"Active Epicycles"}),t.jsx("span",{className:"text-fuchsia-400",children:a})]}),t.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[t.jsx("span",{className:"text-slate-400",children:"Current Phase (t)"}),t.jsxs("span",{className:"text-amber-400",children:[(n/(2*Math.PI)).toFixed(2),"τ"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-slate-400",children:"Largest Radius"}),t.jsxs("span",{className:"text-emerald-400",children:[e.length>0?e[0].amp.toFixed(1):"0.0"," px"]})]})]}),t.jsxs("div",{className:"mt-4",children:[t.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Amplitude color map"}),t.jsx("div",{className:"fourier-legend",style:{backgroundImage:os(((j=e[0])==null?void 0:j.amp)||1)},"aria-label":"Amplitude legend from low to high magnitude"}),t.jsxs("div",{className:"flex justify-between text-[11px] text-slate-500 mt-1",children:[t.jsx("span",{children:"low |X_k|"}),t.jsx("span",{children:"high |X_k|"})]})]}),t.jsxs("div",{className:"mt-4 space-y-2 text-sm font-mono",children:[t.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[t.jsx("span",{className:"text-slate-400",children:"Energy captured (M terms)"}),t.jsxs("span",{className:"text-cyan-300",children:[r.energyPct.toFixed(2),"%"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-slate-400",children:"RMS error vs. original path"}),t.jsxs("span",{className:"text-amber-300",children:[r.rmsError.toFixed(2)," px"]})]})]}),r.topTerms.length>0&&t.jsxs("div",{className:"mt-4",children:[t.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Top terms (by amplitude)"}),t.jsxs("div",{className:"grid grid-cols-5 text-[11px] text-slate-300 gap-2 border border-slate-800 rounded-lg p-2",children:[t.jsx("span",{className:"font-semibold text-slate-200",children:"k"}),t.jsx("span",{className:"font-semibold text-slate-200",children:"|X_k|"}),t.jsx("span",{className:"font-semibold text-slate-200",children:"phase"}),t.jsx("span",{className:"font-semibold text-slate-200",children:"energy"}),t.jsx("span",{className:"font-semibold text-slate-200",children:"cum."}),r.topTerms.map((b,F)=>t.jsxs(Ne.Fragment,{children:[t.jsx("span",{children:b.freq}),t.jsx("span",{children:b.amp.toFixed(2)}),t.jsxs("span",{children:[b.phase.toFixed(2)," rad"]}),t.jsxs("span",{children:[b.energyPct.toFixed(1),"%"]}),t.jsxs("span",{children:[b.cumulativePct.toFixed(1),"%"]})]},F))]})]}),t.jsxs("div",{className:"mt-5 border border-slate-800 rounded-lg p-3 space-y-2 bg-slate-900/40",children:[t.jsxs("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-slate-400",children:[t.jsx("span",{children:"Term inspector"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>c(b=>Math.max(0,b-1)),"aria-label":"Previous term",children:t.jsx(Nt,{size:18,"aria-hidden":"true"})}),t.jsxs("span",{className:"text-slate-200",children:[f+1," / ",e.length||1]}),t.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>c(b=>Math.min(e.length-1,b+1)),"aria-label":"Next term",children:t.jsx(kt,{size:18,"aria-hidden":"true"})})]})]}),t.jsxs("div",{className:"text-xs text-slate-200 leading-relaxed space-y-2",children:[t.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:y.paramsHtml}}),t.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:y.vectorHtml}}),t.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:y.energyHtml}}),t.jsx("p",{children:o?"Step mode: play once to view this term, then advance.":"Track this circle while playing to see how its phase and magnitude shape the trace."})]})]}),t.jsxs("div",{className:"mt-5 text-xs text-slate-500 italic space-y-2",children:[t.jsx("p",{children:"* Sorted by amplitude so the largest circles draw first."}),t.jsx("p",{children:"Tip: switch formulas to see how truncating to M epicycles shapes the path."})]})]})},us=1600,ge=700,ds=1.75,hs=.45,fs=1e7,Le="fourier_viz__last_session",xs=()=>{var Ce,Ee,Re,Te,Ie;const[e,n]=p.useState("DRAW"),[a,r]=p.useState([]),[s,o]=p.useState([]),[d,h]=p.useState(0),[i,f]=p.useState(!1),[c,m]=p.useState(0),[x,M]=p.useState(!1),[y,j]=p.useState(!1),[b,F]=p.useState("#0f172a"),[v,P]=p.useState("rgba(148, 163, 184, 0.22)"),[k,C]=p.useState(hs),[R,z]=p.useState(0),[A,D]=p.useState([]),[q,N]=p.useState(!1),[S,B]=p.useState(!1),[T,O]=p.useState(!1),[L,X]=p.useState(0),[Q,fe]=p.useState("#ec4899"),[te,H]=p.useState(2),[I,ce]=p.useState(!1),oe=p.useRef(null),se=p.useRef(null),ve=p.useRef(),Z=p.useRef([]),Y=p.useRef(!1),J=p.useRef(null),ke=p.useRef(1),W=p.useRef(null),ne=p.useRef(null),V=p.useCallback(()=>{if(W.current){const l=W.current.getContext("2d");l&&(l.setTransform(1,0,0,1,0,0),l.clearRect(0,0,W.current.width,W.current.height))}ne.current=null},[]),xe=p.useCallback(()=>{const l=se.current,u=oe.current;if(!l||!u)return;const{width:g,height:w}=l.getBoundingClientRect(),E=Math.max(1,Math.floor(g)),$=Math.max(1,Math.floor(w));if(E<=1||$<=1)return;const _=window.devicePixelRatio||1;ke.current=_,l.width=Math.round(E*_),l.height=Math.round($*_),W.current||(W.current=document.createElement("canvas")),W.current.width=l.width,W.current.height=l.height,V()},[V]),je=p.useCallback(()=>{h(0),V()},[V]),De=()=>{je()},re=p.useCallback(l=>{if(l.length===0)return;const u=S?ge:us,{prepared:g,spectrum:w}=ss(l,{smoothing:R,limit:u});r(g),o(w),m(Math.min(w.length,u));try{localStorage.setItem(Le,JSON.stringify(g))}catch{}je(),f(!0),X(0)},[je,S,R]);p.useEffect(()=>{const l=Object.keys(localStorage).filter(g=>g.startsWith("fourier_viz_")).map(g=>g.replace("fourier_viz_","")).sort();D(l);const u=localStorage.getItem(Le);if(u)try{const g=JSON.parse(u);g.length&&(n("PRESET"),r(g),re(g))}catch{}},[]),p.useEffect(()=>{const l=()=>{const g=getComputedStyle(document.documentElement),w=g.getPropertyValue("--color-code-bg").trim(),E=g.getPropertyValue("--fourier-grid").trim();F(w||"#0f172a"),P(E||"rgba(148, 163, 184, 0.22)")};l();const u=typeof MutationObserver<"u"?new MutationObserver(l):null;return u&&(u.observe(document.documentElement,{attributes:!0,attributeFilter:["class","data-theme"]}),u.observe(document.body,{attributes:!0,attributeFilter:["class","data-theme"]})),()=>u==null?void 0:u.disconnect()},[]),p.useEffect(()=>{const l=S?Math.min(s.length,ge):s.length;l!==0&&m(u=>Math.min(Math.max(u||1,1),l))},[s.length,S]),p.useEffect(()=>{!T&&L!==0&&X(0)},[T,L]),p.useEffect(()=>{const l=()=>{N(document.fullscreenElement===oe.current),xe()};return document.addEventListener("fullscreenchange",l),()=>document.removeEventListener("fullscreenchange",l)},[xe]);const Oe=p.useCallback(()=>{const l=oe.current;l&&(document.fullscreenElement?document.exitFullscreen().catch(()=>{}):l.requestFullscreen().catch(()=>{}))},[]),le=Ne.useMemo(()=>ns(s,a,c),[s,c,a]),Ue=l=>{if(e!=="DRAW"||Y.current||l.pointerType==="mouse"&&l.button!==0)return;Y.current=!0,J.current=l.pointerId,ce(!0),r([]),V(),o([]),f(!1),X(0),O(!1);const u=se.current.getBoundingClientRect(),g=l.clientX-u.left-u.width/2,w=l.clientY-u.top-u.height/2,E={x:g,y:w};r([E]),Z.current=[E];try{l.currentTarget.setPointerCapture(l.pointerId)}catch{}},$e=l=>{if(!Y.current||e!=="DRAW"||J.current!==l.pointerId)return;if(l.pointerType==="mouse"&&(l.buttons&1)===0){Y.current=!1,J.current=null,ce(!1);return}const u=se.current.getBoundingClientRect(),g=l.clientX-u.left-u.width/2,w=l.clientY-u.top-u.height/2,E={x:g,y:w},$=Z.current[Z.current.length-1];Math.hypot(E.x-$.x,E.y-$.y)>ds&&Z.current.push(E)},qe=l=>{if(!Y.current||typeof(l==null?void 0:l.pointerId)=="number"&&J.current!==l.pointerId)return;Y.current=!1,J.current=null,ce(!1);const u=Z.current;u.length>1?re(u):(r([]),o([]),f(!1))},Be=()=>{Y.current&&(Y.current=!1,J.current=null,ce(!1))};p.useEffect(()=>{const l=u=>{if(!Y.current)return;const g=u.pointerId;if(typeof g=="number"&&J.current!==null&&g!==J.current)return;Y.current=!1,J.current=null,ce(!1);const w=Z.current;w.length>1?re(w):(r([]),o([]),f(!1))};return window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l),window.addEventListener("blur",l),()=>{window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),window.removeEventListener("blur",l)}},[re]);const We=()=>{r([]),V(),o([]),f(!1),n("DRAW"),X(0),O(!1),Z.current=[]},Xe=l=>{let u=[];switch(l){case"circle":u=Ct();break;case"square":u=Pt();break;case"heart":u=Et();break;case"infinity":u=Rt();break;case"note":u=Tt();break}n("PRESET"),r(u),re(u)},He=()=>{if(a.length<2){alert("Draw something first!");return}const l=prompt("Enter a name for this drawing:");if(l)try{localStorage.setItem(`fourier_viz_${l}`,JSON.stringify(a)),D(u=>{const g=[...u];return g.includes(l)||g.push(l),g.sort()})}catch{alert("Failed to save. Storage might be full.")}},Ye=l=>{const u=localStorage.getItem(`fourier_viz_${l}`);if(u)try{const g=JSON.parse(u);r(g),n("PRESET"),re(g)}catch(g){console.error("Error loading drawing",g)}},Ge=async l=>{if(l.target.files&&l.target.files[0]){const u=l.target.files[0];if(u.type&&!u.type.startsWith("image/")){alert("Please upload an image file.");return}if(u.size>fs){alert("File too large for in-browser processing. Please pick an image under 10MB.");return}j(!0);try{const g=await Kt(u);g.length>0?(r(g),n("UPLOAD"),re(g)):alert("No clear shape found. Try an image with higher contrast.")}catch(g){console.error(g),alert("Error processing image.")}finally{j(!1),l.target.value=""}}},we=l=>{if(!s.length)return;O(!0);const u=Math.min(Math.max(l,0),Math.max(K-1,0));X(u);const g=u+1;c!==g&&m(g),h(0),V(),ne.current=null},Je=()=>we(L-1),Ve=()=>we(L+1),Ke=()=>{T||O(!0),f(!0)},Qe=(l,u,g,w,E)=>{let $=u/2,_=g/2;const G=s.slice(0,Math.max(c,1));for(let ee=0;ee<G.length;ee++){const ae=$,U=_,{freq:_e,amp:ie,phase:me}=G[ee],Me=_e*d+me,ue=ee===w,de=ls(G[ee],E,ue),tt=T&&ue?1+.25*Math.sin(d*6):1;$+=ie*Math.cos(Me),_+=ie*Math.sin(Me),l.strokeStyle=de,l.lineWidth=ue?1.6*tt:1,l.beginPath(),l.arc(ae,U,ie,0,2*Math.PI),l.stroke(),l.strokeStyle=de,l.beginPath(),l.moveTo(ae,U),l.lineTo($,_),l.stroke(),ee===G.length-1&&(l.fillStyle=de,l.beginPath(),l.arc($,_,3,0,2*Math.PI),l.fill())}return{x:$,y:_}},Se=p.useCallback(()=>{var $;const l=se.current;if(!l)return;const u=l.getContext("2d");if(!u)return;const g=ke.current||1,w=l.width/g,E=l.height/g;if(u.setTransform(1,0,0,1,0,0),u.scale(g,g),u.lineCap="round",u.lineJoin="round",u.fillStyle=b,u.fillRect(0,0,w,E),u.strokeStyle=v,u.lineWidth=.5,u.beginPath(),u.moveTo(w/2,0),u.lineTo(w/2,E),u.moveTo(0,E/2),u.lineTo(w,E/2),u.stroke(),a.length>0&&e!=="DRAW"&&(u.strokeStyle="rgba(255, 255, 255, 0.1)",u.lineWidth=1,u.lineCap="round",u.lineJoin="round",u.beginPath(),a.forEach((_,G)=>{G===0?u.moveTo(_.x+w/2,_.y+E/2):u.lineTo(_.x+w/2,_.y+E/2)}),u.stroke()),e==="DRAW"&&Y.current&&(u.strokeStyle=Q,u.lineWidth=te,u.lineCap="round",u.lineJoin="round",u.beginPath(),Z.current.forEach((_,G)=>{G===0?u.moveTo(_.x+w/2,_.y+E/2):u.lineTo(_.x+w/2,_.y+E/2)}),u.stroke()),s.length>0){W.current&&u.drawImage(W.current,0,0,w,E);const _=Math.min(Math.max(c,1),s.length),G=Math.max(_-1,0),ee=(($=s[0])==null?void 0:$.amp)||1,ae=Qe(u,w,E,G,ee);if(W.current){const U=W.current.getContext("2d");U&&(U.setTransform(1,0,0,1,0,0),U.scale(g,g),U.strokeStyle=Q,U.lineWidth=te,U.lineCap="round",U.lineJoin="round",ne.current&&(U.beginPath(),U.moveTo(ne.current.x,ne.current.y),U.lineTo(ae.x,ae.y),U.stroke()))}if(ne.current={x:ae.x,y:ae.y},i){const U=Math.max(a.length||s.length,1),ie=2*Math.PI/U*k,me=d+ie;if(me>=2*Math.PI){if(h(0),V(),ne.current=null,T){f(!1);const ue=S?Math.min(s.length,ge):s.length;X(de=>Math.min(de+1,Math.max(ue-1,0)))}}else h(me)}}},[s,i,d,e,a,c,k,Q,te,b,v,T,S]);p.useEffect(()=>(ve.current=requestAnimationFrame(Se),()=>{ve.current&&cancelAnimationFrame(ve.current)}),[Se]),p.useEffect(()=>{const l=()=>xe();l();const u=typeof ResizeObserver<"u"?new ResizeObserver(l):null;return u&&(oe.current&&u.observe(oe.current),se.current&&u.observe(se.current)),window.addEventListener("resize",l),()=>{window.removeEventListener("resize",l),u==null||u.disconnect()}},[xe]),p.useEffect(()=>{V()},[c,s]),p.useEffect(()=>{const l=document.getElementById("fourier-root");return l==null||l.classList.add("is-mounted"),()=>{l==null||l.classList.remove("is-mounted")}},[]);const K=S?Math.min(s.length,ge):s.length,Pe=Math.max(Math.min(c-1,(((Ce=le.breakdown)==null?void 0:Ce.length)||1)-1),0),Ze=((Re=(Ee=le.breakdown)==null?void 0:Ee[Pe])==null?void 0:Re.energyPct)??0,et=((Ie=(Te=le.breakdown)==null?void 0:Te[Pe])==null?void 0:Ie.cumulativePct)??le.energyPct;return p.useEffect(()=>{if(!T)return;const l=Math.min(Math.max(L+1,1),Math.max(K,1));c!==l&&m(l)},[T,L,K,c]),p.useEffect(()=>{const l=Math.max(Math.min(c-1,K-1),0);L>l&&X(l)},[c,K,L]),t.jsxs("div",{className:`fourier-stage select-none ${q?"is-fullscreen":""}`,ref:oe,"data-mode":e,"data-drawing":I?"true":"false","data-has-spectrum":s.length>0?"true":"false","data-points":a.length,children:[t.jsx("canvas",{ref:se,onPointerDown:Ue,onPointerMove:$e,onPointerUp:qe,onPointerCancel:Be,className:`fourier-canvas cursor-${e==="DRAW"?"crosshair":"default"}`}),t.jsx(cs,{mode:e,setMode:n,isPlaying:i,setIsPlaying:f,clear:We,numEpicycles:c,maxEpicycles:K,setNumEpicycles:m,onUpload:Ge,showMath:x,setShowMath:M,onPreset:Xe,speed:k,setSpeed:C,onReset:De,brushColor:Q,setBrushColor:fe,brushSize:te,setBrushSize:H,smoothing:R,setSmoothing:z,isDrawing:I,onSave:He,onLoad:Ye,savedDrawings:A,isFullscreen:q,onToggleFullscreen:Oe,safeMode:S,onToggleSafeMode:()=>B(l=>!l),stepMode:T,onToggleStepMode:()=>O(l=>!l),stepIndex:L,stepMax:K,onStepPrev:Je,onStepNext:Ve,onStepPlayOnce:Ke}),x&&s.length>0&&t.jsx(is,{terms:s,time:d,epicycles:c,metrics:le,focusIndex:T?Math.max(c-1,0):void 0,stepMode:T}),T&&s.length>0&&t.jsxs("div",{className:"absolute top-4 left-4 z-[60] bg-slate-900/80 text-slate-100 border border-slate-700 rounded-lg px-4 py-3 shadow-lg space-y-1",children:[t.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Step mode"}),t.jsxs("div",{className:"text-sm font-semibold",children:["Term ",Math.min(c,K)," / ",Math.max(K,1)]}),t.jsxs("div",{className:"text-xs text-slate-200",children:["Δenergy ",Ze.toFixed(2),"% · Cumulative ",et.toFixed(2),"% · RMS ",le.rmsError.toFixed(2)," px"]})]}),y&&t.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100]",children:t.jsx("div",{className:"text-cyan-400 font-mono text-xl animate-pulse",children:"Processing Image..."})}),e==="DRAW"&&a.length===0&&t.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none text-center",children:[t.jsx("h1",{className:"text-4xl font-bold text-slate-200 mb-2 drop-shadow",children:"Draw Something"}),t.jsx("p",{className:"text-slate-300",children:"Trace a continuous line to begin"})]})]})},Ae=document.getElementById("fourier-root");if(!Ae)throw new Error("Could not find root element to mount to");const ms=st.createRoot(Ae);ms.render(t.jsx(Ne.StrictMode,{children:t.jsx(xs,{})}));
