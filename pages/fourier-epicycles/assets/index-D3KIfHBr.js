const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./siteShell-DZ2PanQp.js","./site-header-DlLg5oTJ.js","./nav-Dn-mYCJA.js"])))=>i.map(i=>d[i]);
import{r as v,j as n,R as $e,a as Et}from"./react-vendor-CkISVyWX.js";import{A as Rt,P as Ct,S as It,F as Tt,a as _t,I as Ft,b as Lt,C as nt,T as zt,c as At,d as Dt,e as rt,M as Ut,f as Ot,R as qt,g as $t,h as Xt,i as Wt,j as Bt,G as Ht,W as Yt,k as Gt,l as Vt}from"./icons-vendor-D7oP6Icu.js";import{k as Pe}from"./math-vendor-Ca7EfnBD.js";import"./vendor-Bb8JjhAW.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function r(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(t){if(t.ep)return;t.ep=!0;const a=r(t);fetch(t.href,a)}})();const Jt="modulepreload",Kt=function(e,s){return new URL(e,s).href},ot={},at=function(s,r,o){let t=Promise.resolve();if(r&&r.length>0){let d=function(c){return Promise.all(c.map(f=>Promise.resolve(f).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const i=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),h=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));t=d(r.map(c=>{if(c=Kt(c,o),c in ot)return;ot[c]=!0;const f=c.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(!!o)for(let j=i.length-1;j>=0;j--){const g=i[j];if(g.href===c&&(!f||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${m}`))return;const y=document.createElement("link");if(y.rel=f?"stylesheet":Jt,f||(y.as="script"),y.crossOrigin="",y.href=c,h&&y.setAttribute("nonce",h),document.head.appendChild(y),f)return new Promise((j,g)=>{y.addEventListener("load",j),y.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(d){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=d,window.dispatchEvent(i),!i.defaultPrevented)throw d}return t.then(d=>{for(const i of d||[])i.status==="rejected"&&a(i.reason);return s().catch(a)})};(async()=>{try{const{initSiteShell:e}=await at(async()=>{const{initSiteShell:s}=await import("./siteShell-DZ2PanQp.js");return{initSiteShell:s}},__vite__mapDeps([0,1]),import.meta.url);e("fourier-epicycles"),await at(()=>import("./nav-Dn-mYCJA.js"),__vite__mapDeps([2,1]),import.meta.url)}catch(e){console.error("Site shell failed to load:",e)}})();const Qt=e=>{const s=[],r=e.length;for(let o=0;o<r;o++){let t=0,a=0;for(let h=0;h<r;h++){const c=Math.PI*2*o*h/r,f=Math.cos(c),m=Math.sin(c),p=e[h].re,y=e[h].im;t+=p*f+y*m,a+=y*f-p*m}t=t/r,a=a/r;const d=o>r/2?o-r:o,i=Math.sqrt(t*t+a*a),u=Math.atan2(a,t);s.push({re:t,im:a,freq:d,amp:i,phase:u})}return s.sort((o,t)=>t.amp-o.amp)},Zt=(e,s)=>{if(s<=0||e.length<2)return[...e];const r=[];for(let o=0;o<e.length;o++){let t=0,a=0,d=0;for(let i=-s;i<=s;i++){const u=o+i;u>=0&&u<e.length&&(t+=e[u].x,a+=e[u].y,d++)}r.push({x:t/d,y:a/d})}return r},es=()=>{const e=[];for(let o=0;o<50;o++)e.push({x:-200+o*2*200/50,y:-200});for(let o=0;o<50;o++)e.push({x:200,y:-200+o*2*200/50});for(let o=0;o<50;o++)e.push({x:200-o*2*200/50,y:200});for(let o=0;o<50;o++)e.push({x:-200,y:200-o*2*200/50});return e},ts=()=>{const e=[];for(let o=0;o<200;o++){const t=Math.PI*2*o/200;e.push({x:200*Math.cos(t),y:200*Math.sin(t)})}return e},ss=()=>{const e=[];for(let r=0;r<300;r++){const o=Math.PI*2*r/300,t=16*Math.pow(Math.sin(o),3),a=-(13*Math.cos(o)-5*Math.cos(2*o)-2*Math.cos(3*o)-Math.cos(4*o));e.push({x:t*15,y:a*15})}return e},ns=()=>{const e=[];for(let o=0;o<300;o++){const t=Math.PI*2*o/300,a=150*Math.cos(t),d=150*Math.sin(t)*Math.cos(t);e.push({x:a,y:d})}return e},rs=()=>{const e=[];for(let r=0;r<100;r++){const o=Math.PI*2*r/100;e.push({x:40*Math.cos(o)-50,y:30*Math.sin(o)+100})}for(let r=0;r<20;r++)e.push({x:-10,y:100-200*r/20});for(let r=0;r<30;r++){const o=r/30;e.push({x:-10+50*Math.sin(o*Math.PI),y:-100+50*o})}for(let r=0;r<20;r++)e.push({x:-10,y:-50+150*r/20});return e},os={threshold:30,sampleRate:2,maxPoints:1500,smoothingWindow:4,blurRadius:1,morphRadius:2,detail:.9},as=e=>{if(e.length===0)return[];const s=[],r=new Set;let o=0;for(s.push(e[0]),r.add(0);s.length<e.length;){let t=1/0,a=-1;const d=e[o];for(let i=0;i<e.length;i++)if(!r.has(i)){const u=e[i],h=(d.x-u.x)**2+(d.y-u.y)**2;h<t&&(t=h,a=i)}if(a!==-1)r.add(a),s.push(e[a]),o=a;else break}return s},ae=(e,s,r)=>Math.max(s,Math.min(r,e)),ls=e=>Math.max(0,Math.min(1,e)),fe=(e,s,r)=>e+(s-e)*r,cs=(e,s,r,o)=>{const t=Math.max(1,Math.floor(o||1)),a=Math.max(1,Math.floor(s/t)),d=Math.max(1,Math.floor(r/t)),i=new Uint8Array(a*d);for(let u=0;u<d;u++){const h=ae(u*t,0,r-1);for(let c=0;c<a;c++){const f=ae(c*t,0,s-1),m=(h*s+f)*4,p=e[m]??0,y=e[m+1]??0,j=e[m+2]??0;i[u*a+c]=Math.round(.2126*p+.7152*y+.0722*j)}}return{gray:i,w:a,h:d,step:t}},is=(e,s,r,o)=>{const t=Math.max(0,Math.floor(o||0));if(t===0||s*r===0)return e;const a=new Uint8Array(s*r),d=(2*t+1)*(2*t+1);for(let i=0;i<r;i++)for(let u=0;u<s;u++){let h=0;for(let c=-t;c<=t;c++){const f=ae(i+c,0,r-1);for(let m=-t;m<=t;m++){const p=ae(u+m,0,s-1);h+=e[f*s+p]??0}}a[i*s+u]=Math.round(h/d)}return a},us=(e,s,r,o)=>{const t=Math.max(1,Math.floor(o||1)),a=new Uint8Array(e.length);for(let d=0;d<r;d++)for(let i=0;i<s;i++){let u=0;for(let h=-t;h<=t&&!u;h++){const c=d+h;if(!(c<0||c>=r))for(let f=-t;f<=t;f++){const m=i+f;if(!(m<0||m>=s)&&e[c*s+m]){u=1;break}}}a[d*s+i]=u}return a},ds=(e,s,r,o)=>{const t=Math.max(1,Math.floor(o||1)),a=new Uint8Array(e.length);for(let d=0;d<r;d++)for(let i=0;i<s;i++){let u=1;for(let h=-t;h<=t&&u;h++){const c=d+h;if(c<0||c>=r){u=0;break}for(let f=-t;f<=t;f++){const m=i+f;if(m<0||m>=s||!e[c*s+m]){u=0;break}}}a[d*s+i]=u}return a},hs=(e,s,r,o)=>{const t=Math.max(1,Math.floor(o||1));return ds(us(e,s,r,t),s,r,t)},fs=(e,s)=>{const r=Math.max(0,Math.floor(s||0));if(r<=0||e.length<3)return e;const o=[],t=e.length;for(let a=0;a<t;a++){let d=0,i=0,u=0;for(let h=-r;h<=r;h++){const c=(a+h+t)%t;d+=e[c].x,i+=e[c].y,u++}o.push({x:d/u,y:i/u})}return o},xe=e=>{if(e.length<2)return e;const s=e[0],r=e[e.length-1];return s.x===r.x&&s.y===r.y?e:[...e,{...s}]},xs=(e,s,r,o)=>{if(s<3||r<3)return new Uint8Array(e.length);const t=new Uint16Array(s*r),a=new Uint8Array(s*r);for(let M=1;M<r-1;M++){const P=M*s;for(let I=1;I<s-1;I++){const w=P+I,T=e[w-s-1],E=e[w-s],F=e[w-s+1],_=e[w-1],B=e[w+1],R=e[w+s-1],C=e[w+s],A=e[w+s+1],$=-T+F-2*_+2*B-R+A,L=-T-2*E-F+R+2*C+A,X=Math.abs($),D=Math.abs(L),G=Math.min(1024,X+D);t[w]=G;let V=0;X>=D?D*2<=X?V=0:V=$*L>=0?1:3:X*2<=D?V=2:V=$*L>=0?1:3,a[w]=V}}const d=new Uint16Array(s*r),i=new Uint32Array(1025);let u=0;for(let M=1;M<r-1;M++){const P=M*s;for(let I=1;I<s-1;I++){const w=P+I,T=t[w];if(T===0)continue;const E=a[w];let F=0,_=0;E===0?(F=t[w-1],_=t[w+1]):E===2?(F=t[w-s],_=t[w+s]):E===1?(F=t[w-s+1],_=t[w+s-1]):(F=t[w-s-1],_=t[w+s+1]),T>=F&&T>=_&&(d[w]=T,i[T]++,u++)}}if(u===0)return new Uint8Array(e.length);const h=fe(.02,.1,o),c=ae(Math.floor(u*h),1,u);let f=0,m=1024;for(let M=1024;M>=1;M--)if(f+=i[M],f>=c){m=M;break}const p=fe(.55,.25,o),y=Math.max(1,Math.floor(m*p)),j=new Uint8Array(s*r),g=[];for(let M=0;M<d.length;M++)d[M]>=m&&(j[M]=1,g.push(M));const k=[1,1,0,-1,-1,-1,0,1],N=[0,1,1,1,0,-1,-1,-1];for(;g.length;){const M=g.pop(),P=M%s,I=(M-P)/s;for(let w=0;w<8;w++){const T=P+k[w],E=I+N[w];if(T<0||T>=s||E<0||E>=r)continue;const F=E*s+T;j[F]||d[F]>=y&&(j[F]=1,g.push(F))}}return j},ms=(e,s,r)=>{const o=[1,1,0,-1,-1,-1,0,1],t=[0,1,1,1,0,-1,-1,-1],a=[4,5,6,7,0,1,2,3],d=new Uint8Array(e.length),i=[];for(let p=0;p<e.length;p++){if(!e[p])continue;const y=p%s,j=(p-y)/s;let g=0;for(let k=0;k<8;k++){const N=y+o[k],M=j+t[k];N<0||N>=s||M<0||M>=r||e[M*s+N]&&g++}d[p]=g,g>0&&i.push(p)}const u=new Uint8Array(e.length),h=[],c=(p,y)=>{const j=p%s,g=(p-j)/s,k=j+o[y],N=g+t[y];if(k<0||k>=s||N<0||N>=r)return-1;const M=N*s+k;return e[M]?M:-1},f=(p,y,j)=>{u[p]|=1<<y,u[j]|=1<<a[y]},m=(p,y,j)=>{const g=c(p,y);if(g<0)return[];const k=[p];let N=y,M=g;f(p,y,M),k.push(M);const P=s*r*2;for(let I=0;I<P;I++){const w=d[M];if(j&&w!==2)break;const T=a[N];let E=-1;for(let _=0;_<8;_++){if(_===T)continue;if(c(M,_)>=0){E=_;break}}if(E<0||u[M]&1<<E)break;const F=c(M,E);if(F<0||(f(M,E,F),M=F,N=E,k.push(M),!j&&M===p))break}return k};for(const p of i){const y=d[p];if(!(y===0||y===2))for(let j=0;j<8;j++){if(c(p,j)<0||u[p]&1<<j)continue;const k=m(p,j,!0);k.length>1&&h.push(k)}}for(const p of i)for(let y=0;y<8;y++){if(c(p,y)<0||u[p]&1<<y)continue;const g=m(p,y,!1);g.length>1&&(g[0]===g[g.length-1]?h.push(g):h.push([...g,g[0]]))}return h},gs=(e,s,r,o,t)=>{const a=e%s,d=(e-a)/s;return{x:a*r-o/2,y:d*r-t/2}},qe=e=>{if(e.length===0)return[];const s=[e[0]];for(let r=1;r<e.length;r++){const o=s[s.length-1],t=e[r];(o.x!==t.x||o.y!==t.y)&&s.push(t)}return s},lt=(e,s)=>{if(e.length<3||s<=0)return e;const r=s*s,o=new Uint8Array(e.length);o[0]=1,o[e.length-1]=1;const t=(i,u,h)=>{const c=h.x-u.x,f=h.y-u.y,m=i.x-u.x,p=i.y-u.y,y=c*m+f*p;if(y<=0)return m*m+p*p;const j=c*c+f*f;if(j<=y){const I=i.x-h.x,w=i.y-h.y;return I*I+w*w}const g=y/j,k=u.x+g*c,N=u.y+g*f,M=i.x-k,P=i.y-N;return M*M+P*P},a=[[0,e.length-1]];for(;a.length;){const[i,u]=a.pop();let h=0,c=-1;const f=e[i],m=e[u];for(let p=i+1;p<u;p++){const y=t(e[p],f,m);y>h&&(h=y,c=p)}c!==-1&&h>r&&(o[c]=1,a.push([i,c],[c,u]))}const d=[];for(let i=0;i<e.length;i++)o[i]&&d.push(e[i]);return d},ps=(e,s)=>{if(e.length===0)return[];const r=[...e].sort((d,i)=>i.length-d.length);let o=[...r.shift()];const t=(d,i)=>{const u=d.x-i.x,h=d.y-i.y;return u*u+h*h},a=ae(Math.round(fe(2,10,s)),2,12);for(;r.length;){const d=o[o.length-1];let i=0,u=!1,h=1/0;for(let j=0;j<r.length;j++){const g=r[j],k=t(d,g[0]),N=t(d,g[g.length-1]);k<h&&(h=k,i=j,u=!1),N<h&&(h=N,i=j,u=!0)}const c=r.splice(i,1)[0];u&&c.reverse();const f=c[0],m=f.x-d.x,p=f.y-d.y;if(Math.hypot(m,p)>1e-6)for(let j=1;j<=a;j++){const g=j/(a+1);o.push({x:d.x+m*g,y:d.y+p*g})}o[o.length-1].x===f.x&&o[o.length-1].y===f.y?o.push(...c.slice(1)):o.push(...c)}return o},ys=(e,s)=>{const r=Math.max(8,Math.floor(s)),o=xe(qe(e));if(o.length<4)return o;const t=o.slice(0,-1),a=t.length,d=new Float64Array(a);let i=0;for(let N=0;N<a;N++){const M=t[N],P=t[(N+1)%a],I=Math.hypot(P.x-M.x,P.y-M.y);d[N]=I,i+=I}if(!Number.isFinite(i)||i<=0)return xe(t);const u=i/r,h=[{...t[0]}];let c=0,f=t[0],m=t[1%a],p=d[0],y=0,j=u;const g=r*(a+4);let k=0;for(;h.length<r&&k++<g;){if(p===0){c=(c+1)%a,f=t[c],m=t[(c+1)%a],p=d[c];continue}if(y+p>=j-1e-9){const N=(j-y)/p;h.push({x:f.x+(m.x-f.x)*N,y:f.y+(m.y-f.y)*N}),j+=u}else y+=p,c=(c+1)%a,f=t[c],m=t[(c+1)%a],p=d[c]}return h.length>r&&(h.length=r),xe(h)},bs=(e,s,r,o={})=>{const t={...os,...o},a=ls(t.detail),d=typeof o.sampleRate=="number"?Math.max(1,Math.floor(t.sampleRate)):a>=.88?1:a>=.55?2:3,i=Math.max(200,Math.floor(t.maxPoints)),u=Math.max(0,Math.floor(t.smoothingWindow)),h=Math.max(0,Math.floor(t.blurRadius)),c=Math.max(0,Math.floor(t.morphRadius)),f=Math.max(1,Math.floor(t.threshold)),{gray:m,w:p,h:y,step:j}=cs(e,s,r,d),g=is(m,p,y,h);let k=xs(g,p,y,a);c>0&&(k=hs(k,p,y,c));const N=ms(k,p,y),M=ae(Math.round(fe(40,10,a)),6,80),P=fe(6,1.2,a)*j,I=N.filter(R=>R.length>=M).map(R=>R.map(C=>gs(C,p,j,s,r))).map(R=>{const C=qe(R);if(C.length>2&&C[0].x===C[C.length-1].x&&C[0].y===C[C.length-1].y){const $=C.slice(0,-1);return xe(lt($,P))}return lt(C,P)}).filter(R=>R.length>=2);if(I.length>0){const R=ps(I,a),C=xe(qe(R)),A=u>0?fs(C,u):C,$=ae(Math.round(fe(400,i,a)),120,i);return ys(A,$)}const w=[],T=R=>(e[R]+e[R+1]+e[R+2])/3;for(let R=0;R<r;R+=d)for(let C=0;C<s;C+=d){if(C<=0||R<=0)continue;const A=(R*s+C)*4,$=(R*s+(C-1))*4,L=((R-1)*s+C)*4,X=T(A),D=T($),G=T(L);Math.abs(X-D)+Math.abs(X-G)>f&&w.push({x:C-s/2,y:R-r/2})}if(w.length===0)return[];const E=w.length>i?Math.ceil(w.length/i):1,F=E===1?w:w.filter((R,C)=>C%E===0),_=as(F),B=[];for(let R=0;R<_.length;R++){let C=0,A=0,$=0;for(let L=-u;L<=u;L++){const X=(R+L+_.length)%_.length;C+=_[X].x,A+=_[X].y,$++}B.push({x:C/$,y:A/$})}return xe(B)},ct=async(e,s=900,r={})=>new Promise((o,t)=>{const a=new Image,d=URL.createObjectURL(e);a.onload=()=>{const i=document.createElement("canvas"),u=i.getContext("2d");if(!u){t(new Error("Could not get canvas context"));return}let h=a.width,c=a.height;const f=Math.max(h,c),m=s&&s>0?s:900;if(f>m){const j=m/f;h=Math.round(h*j),c=Math.round(c*j)}i.width=h,i.height=c,u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.drawImage(a,0,0,h,c);const p=u.getImageData(0,0,h,c),y=bs(p.data,h,c,r);URL.revokeObjectURL(d),o(y)},a.onerror=i=>t(i),a.src=d}),Xe=1500,vs=120,js=200,Ms=e=>e.map(s=>({re:s.x,im:s.y})),Ns=e=>e&&e>0?e:Xe,We=(e,s)=>Math.hypot(e.x-s.x,e.y-s.y),Be=(e,s,r)=>Math.max(s,Math.min(r,Math.round(e))),ws=e=>{let s=1/0,r=1/0,o=-1/0,t=-1/0;for(const a of e)a.x<s&&(s=a.x),a.y<r&&(r=a.y),a.x>o&&(o=a.x),a.y>t&&(t=a.y);return!Number.isFinite(s)||!Number.isFinite(r)||!Number.isFinite(o)||!Number.isFinite(t)?0:Math.hypot(o-s,t-r)},ks=e=>{if(e.length<3)return!1;const s=e[0],r=e[e.length-1],o=ws(e),t=Math.max(10,o*.04);return We(s,r)<=t},Ss=(e,s=.25)=>{if(e.length<2)return[...e];const r=[e[0]];for(let o=1;o<e.length;o++){const t=r[r.length-1],a=e[o];We(t,a)>=s&&r.push(a)}return r},Ps=(e,s,r)=>{const o=e.length;if(o===0)return[];if(o===1)return[{...e[0]}];const t=Be(s,2,1e4),a=r?o:o-1,d=new Array(a);let i=0;for(let f=0;f<a;f++){const m=e[f],p=e[(f+1)%o],y=We(m,p);d[f]=y,i+=y}if(i<=0)return Array.from({length:t},()=>({...e[0]}));const u=i/(r?t:t-1),h=[],c=f=>{let m=0,p=0;for(;m<a-1&&p+d[m]<f;)p+=d[m],m++;const y=e[m],j=e[(m+1)%o],g=d[m]||1,k=Math.max(0,Math.min(1,(f-p)/g));return{x:y.x+(j.x-y.x)*k,y:y.y+(j.y-y.y)*k}};if(r){for(let f=0;f<t;f++)h.push(c(u*f));return h}h.push({...e[0]});for(let f=1;f<t-1;f++)h.push(c(u*f));return h.push({...e[o-1]}),h},Es=(e,s)=>{if(s<=0||e.length<2)return[...e];const r=e.length,o=Be(s,1,Math.floor(r/2)),t=[];for(let a=0;a<r;a++){let d=0,i=0,u=0;for(let h=-o;h<=o;h++){const c=(a+h+r)%r;d+=e[c].x,i+=e[c].y,u++}t.push({x:d/u,y:i/u})}return t},Rs=(e,s,r=Xe)=>{const o=Ns(r),t=Ss(e);if(t.length===0)return[];const a=ks(t),d=a?js:vs,i=Math.min(o,Math.max(t.length,d)),u=Ps(t,i,a),h=s>0?Be(s,0,999):0;return a?Es(u,h):Zt(u,h)},Cs=(e,s={})=>{const{smoothing:r=0,limit:o=Xe}=s,t=Rs(e,r,o),a=Qt(Ms(t));return{prepared:t,spectrum:a}},Is=(e,s,r,o=600)=>{if(!e.length||!s.length)return{energyPct:0,rmsError:0,topTerms:[],breakdown:[]};const t=e.map(N=>N.amp*N.amp),a=t.reduce((N,M)=>N+M,0)||1,d=Math.max(Math.min(r||e.length,e.length),1),i=t.slice(0,d).reduce((N,M)=>N+M,0);let u=0;const h=t.map(N=>(u+=N,{energyPct:N/a*100,cumulativePct:u/a*100}));let c=0;const f=e.slice(0,6).map((N,M)=>{const P=t[M];return c+=P,{freq:N.freq,amp:N.amp,phase:N.phase,energyPct:P/a*100,cumulativePct:c/a*100}}),m=s.length,p=Math.max(1,Math.floor(m/o)),y=e.slice(0,d);let j=0,g=0;for(let N=0;N<m;N+=p){let M=0,P=0;for(let T=0;T<y.length;T++){const E=y[T],F=2*Math.PI*E.freq*N/m,_=Math.cos(F),B=Math.sin(F);M+=E.re*_-E.im*B,P+=E.re*B+E.im*_}const I=M-s[N].x,w=P-s[N].y;j+=I*I+w*w,g++}const k=Math.sqrt(j/Math.max(g,1));return{energyPct:Number((i/a*100).toFixed(2)),rmsError:Number(k.toFixed(2)),topTerms:f,breakdown:h}},Ts=e=>Math.min(1,Math.max(0,e)),_s=(e,s)=>!isFinite(e)||s<=0?0:Ts(e/s),Re=(e,s,r=!1)=>{const o=_s(e,s),t=210+110*o,a=r?62:48+6*o,d=r?.95:.6;return`hsla(${t.toFixed(1)}, 82%, ${a.toFixed(1)}%, ${d})`},Fs=e=>`linear-gradient(90deg, ${Re(0,e)} 0%, ${Re(e*.5,e)} 50%, ${Re(e,e,!0)} 100%)`,Ls=(e,s,r)=>Re(e.amp,s,r),zs=({mode:e,setMode:s,isPlaying:r,setIsPlaying:o,clear:t,numEpicycles:a,maxEpicycles:d,setNumEpicycles:i,onUpload:u,showMath:h,setShowMath:c,onPreset:f,speed:m,setSpeed:p,onReset:y,brushColor:j,setBrushColor:g,brushSize:k,setBrushSize:N,smoothing:M,setSmoothing:P,outlineDetail:I,setOutlineDetail:w,isDrawing:T,onSave:E,onLoad:F,savedDrawings:_,isFullscreen:B,onToggleFullscreen:R,safeMode:C,onToggleSafeMode:A,stepMode:$,onToggleStepMode:L,stepIndex:X,stepMax:D,onStepPrev:G,onStepNext:V,onStepPlayOnce:Ce})=>{const le=v.useRef(null),Q=z=>`
    p-2.5 rounded-lg transition-all duration-200 flex items-center justify-center
    ${z?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50 shadow-[0_0_15px_rgba(6,182,212,0.3)]":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 hover:text-slate-200 border border-transparent"}
  `;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"fourier-toolbar fourier-toolbar--top",children:[n.jsxs("div",{className:"flex gap-1 mr-4 pl-2",children:[n.jsx(Rt,{className:"w-5 h-5 text-fuchsia-500"}),n.jsxs("span",{className:"font-bold text-slate-100 hidden sm:block",children:["Fourier",n.jsx("span",{className:"text-fuchsia-500",children:"Viz"})]})]}),n.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),n.jsx("button",{onClick:()=>s("DRAW"),className:Q(e==="DRAW"),title:"Freehand Draw",children:n.jsx(Ct,{size:20})}),n.jsxs("div",{className:"relative group",children:[n.jsx("button",{className:Q(e==="PRESET"),title:"Presets",children:n.jsx(It,{size:20})}),n.jsxs("div",{className:"absolute top-full left-0 w-32 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden hidden group-hover:block group-focus-within:block z-50",children:[n.jsx("button",{onClick:()=>f("circle"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Circle"}),n.jsx("button",{onClick:()=>f("square"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Square"}),n.jsx("button",{onClick:()=>f("heart"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Heart"}),n.jsx("button",{onClick:()=>f("infinity"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Infinity"}),n.jsx("button",{onClick:()=>f("note"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Note"})]})]}),n.jsxs("div",{className:"relative group",children:[n.jsx("button",{className:Q(!1),title:"Load Saved Drawing",children:n.jsx(Tt,{size:20})}),n.jsx("div",{className:"absolute top-full left-0 w-48 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden hidden group-hover:block group-focus-within:block max-h-60 overflow-y-auto custom-scrollbar z-50",children:_.length===0?n.jsx("div",{className:"px-4 py-2 text-sm text-slate-500 italic",children:"No saved drawings"}):_.map(z=>n.jsx("button",{onClick:()=>F(z),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400 truncate border-b border-slate-800 last:border-0",children:z},z))})]}),n.jsx("button",{onClick:E,className:Q(!1),title:"Save Current Drawing",children:n.jsx(_t,{size:20})}),n.jsx("button",{onClick:()=>{var z;return(z=le.current)==null?void 0:z.click()},className:Q(e==="UPLOAD"),title:"Upload Image",children:n.jsx(Ft,{size:20})}),n.jsx("input",{type:"file",ref:le,onChange:u,accept:"image/*",className:"hidden"}),n.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),n.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-lg transition-all duration-300 ${T?"bg-fuchsia-900/20 ring-1 ring-fuchsia-500/50":""}`,children:[n.jsxs("div",{className:"relative flex items-center group",title:"Brush Color",children:[n.jsx(Lt,{size:18,className:`${T?"text-fuchsia-400":"text-slate-400"} mr-2 transition-colors`}),n.jsx("input",{type:"color",value:j,onChange:z=>g(z.target.value),className:"w-6 h-6 rounded border-none cursor-pointer bg-transparent"})]}),n.jsxs("div",{className:"flex items-center gap-2",title:"Brush Size",children:[n.jsx(nt,{size:10,className:"text-slate-400"}),n.jsx("input",{type:"range",min:"1",max:"10",step:"0.5",value:k,onChange:z=>N(parseFloat(z.target.value)),className:"w-16 h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-slate-400"}),n.jsx(nt,{size:16,className:`text-slate-400 transition-all ${T?"scale-110 text-fuchsia-300":""}`})]})]}),n.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),n.jsx("button",{onClick:t,className:"p-2.5 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors",title:"Clear Canvas",children:n.jsx(zt,{size:20})}),n.jsx("button",{onClick:()=>c(!h),className:Q(h),title:"Toggle Math Panel",children:n.jsx(At,{size:20})}),n.jsx("button",{onClick:A,className:Q(C),title:"Toggle safe mode (cap epicycles / lighten rendering)",children:n.jsx(Dt,{size:20})}),n.jsx("button",{onClick:L,className:Q($),title:"Toggle step-through playback",children:n.jsx(rt,{size:20})}),n.jsx("button",{onClick:R,className:Q(B),title:B?"Exit Fullscreen":"Fullscreen Play",children:B?n.jsx(Ut,{size:20}):n.jsx(Ot,{size:20})})]}),n.jsx("div",{className:"fourier-toolbar fourier-toolbar--bottom",children:n.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("button",{onClick:y,className:"p-3 rounded-full bg-slate-800 text-slate-300 hover:bg-slate-700 hover:text-white transition-all",title:"Reset Animation",children:n.jsx(qt,{size:18})}),n.jsx("button",{onClick:()=>o(!r),className:"w-14 h-14 flex items-center justify-center rounded-full bg-cyan-500 text-slate-950 hover:bg-cyan-400 transition-all shadow-[0_0_20px_rgba(6,182,212,0.4)]",children:r?n.jsx($t,{fill:"currentColor",size:24}):n.jsx(Xt,{fill:"currentColor",className:"ml-1",size:24})}),$&&n.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/70 rounded-full px-3 py-2 border border-slate-700",children:[n.jsx("button",{onClick:G,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Previous term",children:n.jsx(Wt,{size:16})}),n.jsx("button",{onClick:Ce,className:"px-3 py-2 rounded-full bg-amber-400 text-slate-900 font-semibold hover:bg-amber-300 transition",title:"Play this term once",children:"Step"}),n.jsx("button",{onClick:V,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Next term",children:n.jsx(Bt,{size:16})}),n.jsxs("span",{className:"text-xs text-slate-300 font-semibold ml-1",children:["Term ",X+1," / ",Math.max(D,1)]})]})]}),n.jsxs("div",{className:"flex-1 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 w-full",children:[n.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[n.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[n.jsx("span",{children:"Precision"}),n.jsxs("span",{className:"text-cyan-400",children:[a," / ",d,C?" (capped)":""]})]}),n.jsx("input",{type:"range",min:"1",max:d||1,value:a,onChange:z=>i(parseInt(z.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),n.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[n.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(Ht,{size:12}),n.jsx("span",{children:"Speed"})]}),n.jsxs("span",{className:"text-amber-400",children:[m.toFixed(2),"x"]})]}),n.jsx("input",{type:"range",min:"0.05",max:"3",step:"0.05",value:m,onChange:z=>p(parseFloat(z.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-amber-500"})]}),n.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[n.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(Yt,{size:12}),n.jsx("span",{children:"Smoothness"})]}),n.jsxs("span",{className:"text-emerald-400",children:[M,"px"]})]}),n.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:M,onChange:z=>P(parseInt(z.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]}),n.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[n.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(rt,{size:12}),n.jsx("span",{children:"Outline detail"})]}),n.jsxs("span",{className:"text-violet-300",children:[I,"%"]})]}),n.jsx("input",{type:"range",min:"10",max:"100",step:"1",value:I,onChange:z=>w(parseInt(z.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-violet-400"})]})]})]})})]})},As=({terms:e,time:s,epicycles:r,metrics:o,focusIndex:t,stepMode:a=!1})=>{var j;const d=v.useRef(null),[i,u]=v.useState("dft"),[h,c]=v.useState(0),f=v.useMemo(()=>{const g=e[0],k=e.length||1,N=(s/(2*Math.PI)).toFixed(2);return{n:k,largestRadius:g?g.amp.toFixed(1):"0.0",maxFreq:g?g.freq:0,phaseTurns:N,dominantPhase:g?g.phase.toFixed(2):"0.00"}},[e,s]),m=v.useMemo(()=>{const g=e[Math.min(h,Math.max(e.length-1,0))];return g||{freq:0,amp:0,phase:0}},[h,e]),p=o.breakdown?o.breakdown[Math.min(h,Math.max(o.breakdown.length-1,0))]??{energyPct:0,cumulativePct:0}:{energyPct:0,cumulativePct:0},y=v.useMemo(()=>{const g={throwOnError:!1},k=f.n||1,N=m.freq,M=m.amp.toFixed(3),P=m.phase.toFixed(3),I=p.energyPct.toFixed(2),w=p.cumulativePct.toFixed(2);return{paramsHtml:Pe.renderToString(`k = ${N},\\quad |X_k| = ${M},\\quad \\phi_k = ${P}\\,\\text{rad}`,g),vectorHtml:Pe.renderToString(`\\text{Vector}_k(t) = |X_k|\\,e^{i\\left(2\\pi k t/${k} + \\phi_k\\right)}`,g),energyHtml:Pe.renderToString(`\\Delta\\text{energy} = ${I}\\%\\quad \\text{cum.} = ${w}\\%`,g)}},[p,m.amp,m.freq,m.phase,f.n]);return v.useEffect(()=>{var T,E;if(!d.current)return;const{n:g,phaseTurns:k,dominantPhase:N}=f,M=Math.max(r,1),P=((T=e[0])==null?void 0:T.freq)??0,I=((E=e[0])==null?void 0:E.amp)??0,w={dft:`
      \\begin{aligned}
        X_k &= \\frac{1}{N} \\sum_{n=0}^{N-1} x_n e^{-i 2\\pi kn / N} \\\\
        &\\textcolor{#f472b6}{N = ${g}},\\; \\textcolor{#22c55e}{k \\in [0, N-1]}
      \\end{aligned}
      `,reconstruction:`
      \\begin{aligned}
        x(t) &\\approx \\sum_{j=1}^{${M}} \\left|X_{k_j}\\right| e^{i\\left(k_j t + \\phi_{k_j}\\right)} \\\\
        t &= 2\\pi n/N,\\; k_j \\in \\left[-\\frac{N}{2}, \\frac{N}{2}\\right] \\\\
        &\\textcolor{#22c55e}{\\left|X_{${P}}\\right| = ${I.toFixed(2)}},\\;
          \\textcolor{#f472b6}{\\phi_{${P}} = ${N}}\\;\\text{rad}
      \\end{aligned}
      `,phasor:`
      \\begin{aligned}
        \\text{Epicycle}_k(t) &= r_k e^{i(\\omega_k t + \\phi_k)} \\\\
        r_k &= \\left|X_k\\right|,\\;
        \\omega_k = k,\\;
        t = ${k}\\,\\tau
      \\end{aligned}
      `};Pe.render(w[i],d.current,{throwOnError:!1,displayMode:!0})},[i,r,f,e]),v.useEffect(()=>{u("dft"),c(0)},[e.length]),v.useEffect(()=>{if(typeof t=="number"&&e.length>0){const g=Math.min(Math.max(t,0),e.length-1);c(g)}},[t,e.length]),n.jsxs("div",{className:"fourier-math-panel custom-scrollbar",children:[n.jsx("h3",{className:"text-xl font-bold mb-4 text-cyan-400",children:"Fourier Engine"}),n.jsxs("div",{className:"fourier-math-toggle",role:"group","aria-label":"Toggle formulas",children:[n.jsx("button",{type:"button",className:i==="dft"?"is-active":"",onClick:()=>u("dft"),children:"DFT basis"}),n.jsx("button",{type:"button",className:i==="reconstruction"?"is-active":"",onClick:()=>u("reconstruction"),children:"Reconstruction"}),n.jsx("button",{type:"button",className:i==="phasor"?"is-active":"",onClick:()=>u("phasor"),children:"Phasor anatomy"})]}),n.jsx("div",{className:"mb-4",ref:d,"aria-live":"polite"}),n.jsxs("div",{className:"space-y-4 text-sm font-mono",children:[n.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[n.jsx("span",{className:"text-slate-400",children:"Total Vectors (N)"}),n.jsx("span",{className:"text-cyan-300",children:e.length})]}),n.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[n.jsx("span",{className:"text-slate-400",children:"Active Epicycles"}),n.jsx("span",{className:"text-fuchsia-400",children:r})]}),n.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[n.jsx("span",{className:"text-slate-400",children:"Current Phase (t)"}),n.jsxs("span",{className:"text-amber-400",children:[(s/(2*Math.PI)).toFixed(2),"τ"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-slate-400",children:"Largest Radius"}),n.jsxs("span",{className:"text-emerald-400",children:[e.length>0?e[0].amp.toFixed(1):"0.0"," px"]})]})]}),n.jsxs("div",{className:"mt-4",children:[n.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Amplitude color map"}),n.jsx("div",{className:"fourier-legend",style:{backgroundImage:Fs(((j=e[0])==null?void 0:j.amp)||1)},"aria-label":"Amplitude legend from low to high magnitude"}),n.jsxs("div",{className:"flex justify-between text-[11px] text-slate-500 mt-1",children:[n.jsx("span",{children:"low |X_k|"}),n.jsx("span",{children:"high |X_k|"})]})]}),n.jsxs("div",{className:"mt-4 space-y-2 text-sm font-mono",children:[n.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[n.jsx("span",{className:"text-slate-400",children:"Energy captured (M terms)"}),n.jsxs("span",{className:"text-cyan-300",children:[o.energyPct.toFixed(2),"%"]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-slate-400",children:"RMS error vs. original path"}),n.jsxs("span",{className:"text-amber-300",children:[o.rmsError.toFixed(2)," px"]})]})]}),o.topTerms.length>0&&n.jsxs("div",{className:"mt-4",children:[n.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Top terms (by amplitude)"}),n.jsxs("div",{className:"grid grid-cols-5 text-[11px] text-slate-300 gap-2 border border-slate-800 rounded-lg p-2",children:[n.jsx("span",{className:"font-semibold text-slate-200",children:"k"}),n.jsx("span",{className:"font-semibold text-slate-200",children:"|X_k|"}),n.jsx("span",{className:"font-semibold text-slate-200",children:"phase"}),n.jsx("span",{className:"font-semibold text-slate-200",children:"energy"}),n.jsx("span",{className:"font-semibold text-slate-200",children:"cum."}),o.topTerms.map((g,k)=>n.jsxs($e.Fragment,{children:[n.jsx("span",{children:g.freq}),n.jsx("span",{children:g.amp.toFixed(2)}),n.jsxs("span",{children:[g.phase.toFixed(2)," rad"]}),n.jsxs("span",{children:[g.energyPct.toFixed(1),"%"]}),n.jsxs("span",{children:[g.cumulativePct.toFixed(1),"%"]})]},k))]})]}),n.jsxs("div",{className:"mt-5 border border-slate-800 rounded-lg p-3 space-y-2 bg-slate-900/40",children:[n.jsxs("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-slate-400",children:[n.jsx("span",{children:"Term inspector"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>c(g=>Math.max(0,g-1)),"aria-label":"Previous term",children:n.jsx(Gt,{size:18,"aria-hidden":"true"})}),n.jsxs("span",{className:"text-slate-200",children:[h+1," / ",e.length||1]}),n.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>c(g=>Math.min(e.length-1,g+1)),"aria-label":"Next term",children:n.jsx(Vt,{size:18,"aria-hidden":"true"})})]})]}),n.jsxs("div",{className:"text-xs text-slate-200 leading-relaxed space-y-2",children:[n.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:y.paramsHtml}}),n.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:y.vectorHtml}}),n.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:y.energyHtml}}),n.jsx("p",{children:a?"Step mode: play once to view this term, then advance.":"Track this circle while playing to see how its phase and magnitude shape the trace."})]})]}),n.jsxs("div",{className:"mt-5 text-xs text-slate-500 italic space-y-2",children:[n.jsx("p",{children:"* Sorted by amplitude so the largest circles draw first."}),n.jsx("p",{children:"Tip: switch formulas to see how truncating to M epicycles shapes the path."})]})]})},Ds=1600,Ee=700,Us=1.75,Os=.45,qs=1e7,it="fourier_viz__last_session",$s=()=>{var Qe,Ze,et,tt,st;const[e,s]=v.useState("DRAW"),[r,o]=v.useState([]),[t,a]=v.useState([]),[d,i]=v.useState(0),[u,h]=v.useState(!1),[c,f]=v.useState(0),[m,p]=v.useState(!1),[y,j]=v.useState(!1),[g,k]=v.useState("#0f172a"),[N,M]=v.useState("rgba(148, 163, 184, 0.22)"),[P,I]=v.useState(Os),[w,T]=v.useState(0),[E,F]=v.useState(90),[_,B]=v.useState([]),[R,C]=v.useState(!1),[A,$]=v.useState(!1),[L,X]=v.useState(!1),[D,G]=v.useState(0),[V,Ce]=v.useState("#ec4899"),[le,Q]=v.useState(2),[z,me]=v.useState(!1),ue=v.useRef(null),ce=v.useRef(null),ve=v.useRef(),ne=v.useRef([]),J=v.useRef(!1),ee=v.useRef(null),He=v.useRef(1),Ye=v.useRef(null),ge=v.useRef(0),ie=v.useRef(null),pe=v.useRef(null),Ie=v.useRef(!1),Te=v.useRef(!0),K=v.useRef(null),ye=v.useRef(null),_e=v.useRef({mode:e,points:r,fourierX:t,time:d,isPlaying:u,numEpicycles:c,showMath:m,canvasBg:g,gridColor:N,speed:P,brushColor:V,brushSize:le,stepMode:L,safeMode:A,stepIndex:D}),Z=v.useCallback(()=>{if(K.current){const l=K.current.getContext("2d");l&&(l.setTransform(1,0,0,1,0,0),l.clearRect(0,0,K.current.width,K.current.height))}ye.current=null},[]),je=v.useCallback(()=>{const l=ce.current,b=ue.current;if(!l||!b)return;const{width:x,height:S}=l.getBoundingClientRect(),U=Math.max(1,Math.floor(x)),q=Math.max(1,Math.floor(S));if(U<=1||q<=1)return;const W=window.devicePixelRatio||1;He.current=W,l.width=Math.round(U*W),l.height=Math.round(q*W),K.current||(K.current=document.createElement("canvas")),K.current.width=l.width,K.current.height=l.height,Z()},[Z]),Fe=v.useCallback(l=>{ge.current=l,ie.current=null,pe.current=null,i(l)},[]),Le=v.useCallback(()=>{Fe(0),Z()},[Z,Fe]),dt=()=>{Le()},te=v.useCallback(l=>{if(l.length===0)return;const b=A?Ee:Ds,{prepared:x,spectrum:S}=Cs(l,{smoothing:w,limit:b});o(x),a(S),f(Math.min(S.length,b));try{localStorage.setItem(it,JSON.stringify(x))}catch{}Le(),h(!0),G(0)},[Le,A,w]);v.useEffect(()=>{const l=Object.keys(localStorage).filter(x=>x.startsWith("fourier_viz_")).map(x=>x.replace("fourier_viz_","")).sort();B(l);const b=localStorage.getItem(it);if(b)try{const x=JSON.parse(b);x.length&&(s("PRESET"),o(x),te(x))}catch{}},[]),v.useEffect(()=>{const l=()=>{const x=getComputedStyle(document.documentElement),S=x.getPropertyValue("--color-code-bg").trim(),U=x.getPropertyValue("--fourier-grid").trim();k(S||"#0f172a"),M(U||"rgba(148, 163, 184, 0.22)")};l();const b=typeof MutationObserver<"u"?new MutationObserver(l):null;return b&&(b.observe(document.documentElement,{attributes:!0,attributeFilter:["class","data-theme"]}),b.observe(document.body,{attributes:!0,attributeFilter:["class","data-theme"]})),()=>b==null?void 0:b.disconnect()},[]),v.useEffect(()=>{const l=A?Math.min(t.length,Ee):t.length;l!==0&&f(b=>Math.min(Math.max(b||1,1),l))},[t.length,A]),v.useEffect(()=>{!L&&D!==0&&G(0)},[L,D]),v.useEffect(()=>{const l=()=>{C(document.fullscreenElement===ue.current),je()};return document.addEventListener("fullscreenchange",l),()=>document.removeEventListener("fullscreenchange",l)},[je]);const ht=v.useCallback(()=>{const l=ue.current;l&&(document.fullscreenElement?document.exitFullscreen().catch(()=>{}):l.requestFullscreen().catch(()=>{}))},[]),de=$e.useMemo(()=>Is(t,r,c),[t,c,r]),ft=l=>{if(e!=="DRAW"||J.current||l.pointerType==="mouse"&&l.button!==0)return;J.current=!0,ee.current=l.pointerId,me(!0),o([]),Z(),a([]),h(!1),G(0),X(!1);const b=ce.current.getBoundingClientRect(),x=l.clientX-b.left-b.width/2,S=l.clientY-b.top-b.height/2,U={x,y:S};o([U]),ne.current=[U];try{l.currentTarget.setPointerCapture(l.pointerId)}catch{}},xt=l=>{if(!J.current||e!=="DRAW"||ee.current!==l.pointerId)return;if(l.pointerType==="mouse"&&(l.buttons&1)===0){J.current=!1,ee.current=null,me(!1);return}const b=ce.current.getBoundingClientRect(),x=l.clientX-b.left-b.width/2,S=l.clientY-b.top-b.height/2,U={x,y:S},q=ne.current[ne.current.length-1];Math.hypot(U.x-q.x,U.y-q.y)>Us&&ne.current.push(U)},mt=l=>{if(!J.current||typeof(l==null?void 0:l.pointerId)=="number"&&ee.current!==l.pointerId)return;J.current=!1,ee.current=null,me(!1);const b=ne.current;b.length>1?te(b):(o([]),a([]),h(!1))},gt=()=>{J.current&&(J.current=!1,ee.current=null,me(!1))};v.useEffect(()=>{const l=b=>{if(!J.current)return;const x=b.pointerId;if(typeof x=="number"&&ee.current!==null&&x!==ee.current)return;J.current=!1,ee.current=null,me(!1);const S=ne.current;S.length>1?te(S):(o([]),a([]),h(!1))};return window.addEventListener("pointerup",l),window.addEventListener("pointercancel",l),window.addEventListener("blur",l),()=>{window.removeEventListener("pointerup",l),window.removeEventListener("pointercancel",l),window.removeEventListener("blur",l)}},[te]);const pt=()=>{o([]),Z(),a([]),h(!1),s("DRAW"),G(0),X(!1),ne.current=[]},yt=l=>{let b=[];switch(l){case"circle":b=ts();break;case"square":b=es();break;case"heart":b=ss();break;case"infinity":b=ns();break;case"note":b=rs();break}s("PRESET"),o(b),te(b)},bt=()=>{if(r.length<2){alert("Draw something first!");return}const l=prompt("Enter a name for this drawing:");if(l)try{localStorage.setItem(`fourier_viz_${l}`,JSON.stringify(r)),B(b=>{const x=[...b];return x.includes(l)||x.push(l),x.sort()})}catch{alert("Failed to save. Storage might be full.")}},vt=l=>{const b=localStorage.getItem(`fourier_viz_${l}`);if(b)try{const x=JSON.parse(b);o(x),s("PRESET"),te(x)}catch(x){console.error("Error loading drawing",x)}},jt=async l=>{if(l.target.files&&l.target.files[0]){const b=l.target.files[0];if(b.type&&!b.type.startsWith("image/")){alert("Please upload an image file.");return}if(b.size>qs){alert("File too large for in-browser processing. Please pick an image under 10MB.");return}j(!0),Ye.current=b;try{const x=await ct(b,900,{detail:E/100});x.length>0?(o(x),s("UPLOAD"),te(x)):alert("No clear shape found. Try an image with higher contrast.")}catch(x){console.error(x),alert("Error processing image.")}finally{j(!1),l.target.value=""}}};v.useEffect(()=>{if(e!=="UPLOAD")return;const l=Ye.current;if(!l)return;const b=window.setTimeout(async()=>{j(!0);try{const x=await ct(l,900,{detail:E/100});x.length>0&&(o(x),te(x))}catch(x){console.error(x)}finally{j(!1)}},250);return()=>window.clearTimeout(b)},[e,E,te]);const Ge=l=>{if(!t.length)return;X(!0);const b=Math.min(Math.max(l,0),Math.max(se-1,0));G(b);const x=b+1;c!==x&&f(x),Fe(0),Z()},Mt=()=>Ge(D-1),Nt=()=>Ge(D+1),wt=()=>{L||X(!0),h(!0)},Ve=v.useCallback((l,b,x,S,U,q,W)=>{var be;let re=b/2,O=x/2;const H=S.slice(0,Math.max(U,1)),Y=Math.max(H.length-1,0),Ae=((be=S[0])==null?void 0:be.amp)||1;for(let oe=0;oe<H.length;oe++){const Me=re,Ne=O,{freq:we,amp:ke,phase:De}=H[oe],Se=we*q+De,Ue=oe===Y,Oe=Ls(H[oe],Ae,Ue),Pt=W&&Ue?1+.25*Math.sin(q*6):1;re+=ke*Math.cos(Se),O+=ke*Math.sin(Se),l.strokeStyle=Oe,l.lineWidth=Ue?1.6*Pt:1,l.beginPath(),l.arc(Me,Ne,ke,0,2*Math.PI),l.stroke(),l.strokeStyle=Oe,l.beginPath(),l.moveTo(Me,Ne),l.lineTo(re,O),l.stroke(),oe===H.length-1&&(l.fillStyle=Oe,l.beginPath(),l.arc(re,O,3,0,2*Math.PI),l.fill())}return{x:re,y:O}},[]),Je=v.useCallback(l=>{const b=ce.current;if(!b)return;const x=b.getContext("2d");if(!x)return;const S=_e.current,U=He.current||1,q=b.width/U,W=b.height/U;x.setTransform(1,0,0,1,0,0),x.scale(U,U),x.lineCap="round",x.lineJoin="round",x.fillStyle=S.canvasBg,x.fillRect(0,0,q,W),x.strokeStyle=S.gridColor,x.lineWidth=.5,x.beginPath(),x.moveTo(q/2,0),x.lineTo(q/2,W),x.moveTo(0,W/2),x.lineTo(q,W/2),x.stroke(),S.points.length>0&&S.mode!=="DRAW"&&(x.strokeStyle="rgba(255, 255, 255, 0.1)",x.lineWidth=1,x.beginPath(),S.points.forEach((O,H)=>{H===0?x.moveTo(O.x+q/2,O.y+W/2):x.lineTo(O.x+q/2,O.y+W/2)}),x.stroke()),S.mode==="DRAW"&&J.current&&(x.strokeStyle=S.brushColor,x.lineWidth=S.brushSize,x.beginPath(),ne.current.forEach((O,H)=>{H===0?x.moveTo(O.x+q/2,O.y+W/2):x.lineTo(O.x+q/2,O.y+W/2)}),x.stroke());const re=ge.current;if(S.fourierX.length>0){K.current&&x.drawImage(K.current,0,0,q,W);const O=Math.min(Math.max(S.numEpicycles,1),S.fourierX.length),H=Ve(x,q,W,S.fourierX,O,re,S.stepMode);if(K.current){const Y=K.current.getContext("2d");Y&&(Y.setTransform(1,0,0,1,0,0),Y.scale(U,U),Y.strokeStyle=S.brushColor,Y.lineWidth=S.brushSize,Y.lineCap="round",Y.lineJoin="round",ye.current&&(Y.beginPath(),Y.moveTo(ye.current.x,ye.current.y),Y.lineTo(H.x,H.y),Y.stroke()))}if(ye.current={x:H.x,y:H.y},S.isPlaying){const Y=Math.max(S.points.length||S.fourierX.length,1),Ae=2*Math.PI/Y,be=ie.current,oe=be==null?0:Math.min(Math.max(l-be,0),80);ie.current=l;const Me=oe/(1e3/60),Ne=Ae*S.speed*Me,we=re+Ne;if(we>=2*Math.PI){if(ge.current=0,Z(),S.stepMode){h(!1);const De=S.safeMode?Math.min(S.fourierX.length,Ee):S.fourierX.length;G(Se=>Math.min(Se+1,Math.max(De-1,0)))}}else ge.current=we}else ie.current=l}else ie.current=l;if(S.showMath){const O=pe.current;(O==null||l-O>=50)&&(i(ge.current),pe.current=l)}else pe.current=null},[Z,Ve]),ze=v.useCallback(l=>{const x=_e.current.isPlaying||J.current;(Te.current||x)&&(Je(l),Te.current=!1),x?ve.current=requestAnimationFrame(ze):(Ie.current=!1,ie.current=null,pe.current=null)},[Je]),he=v.useCallback(()=>{Te.current=!0,!Ie.current&&(Ie.current=!0,ie.current=null,ve.current=requestAnimationFrame(ze))},[ze]);v.useEffect(()=>{_e.current={mode:e,points:r,fourierX:t,time:d,isPlaying:u,numEpicycles:c,showMath:m,canvasBg:g,gridColor:N,speed:P,brushColor:V,brushSize:le,stepMode:L,safeMode:A,stepIndex:D},he()},[e,r,t,d,u,c,m,g,N,P,V,le,L,A,D,he]),v.useEffect(()=>(he(),()=>{ve.current&&cancelAnimationFrame(ve.current)}),[he]),v.useEffect(()=>{const l=()=>{je(),he()};l();const b=typeof ResizeObserver<"u"?new ResizeObserver(l):null;return b&&(ue.current&&b.observe(ue.current),ce.current&&b.observe(ce.current)),window.addEventListener("resize",l),()=>{window.removeEventListener("resize",l),b==null||b.disconnect()}},[je,he]),v.useEffect(()=>{Z()},[c,t]),v.useEffect(()=>{const l=document.getElementById("fourier-root");return l==null||l.classList.add("is-mounted"),()=>{l==null||l.classList.remove("is-mounted")}},[]);const se=A?Math.min(t.length,Ee):t.length,Ke=Math.max(Math.min(c-1,(((Qe=de.breakdown)==null?void 0:Qe.length)||1)-1),0),kt=((et=(Ze=de.breakdown)==null?void 0:Ze[Ke])==null?void 0:et.energyPct)??0,St=((st=(tt=de.breakdown)==null?void 0:tt[Ke])==null?void 0:st.cumulativePct)??de.energyPct;return v.useEffect(()=>{if(!L)return;const l=Math.min(Math.max(D+1,1),Math.max(se,1));c!==l&&f(l)},[L,D,se,c]),v.useEffect(()=>{const l=Math.max(Math.min(c-1,se-1),0);D>l&&G(l)},[c,se,D]),n.jsxs("div",{className:`fourier-stage select-none ${R?"is-fullscreen":""}`,ref:ue,"data-mode":e,"data-drawing":z?"true":"false","data-has-spectrum":t.length>0?"true":"false","data-points":r.length,children:[n.jsx("canvas",{ref:ce,onPointerDown:ft,onPointerMove:xt,onPointerUp:mt,onPointerCancel:gt,className:`fourier-canvas cursor-${e==="DRAW"?"crosshair":"default"}`}),n.jsx(zs,{mode:e,setMode:s,isPlaying:u,setIsPlaying:h,clear:pt,numEpicycles:c,maxEpicycles:se,setNumEpicycles:f,onUpload:jt,showMath:m,setShowMath:p,onPreset:yt,speed:P,setSpeed:I,onReset:dt,brushColor:V,setBrushColor:Ce,brushSize:le,setBrushSize:Q,smoothing:w,setSmoothing:T,outlineDetail:E,setOutlineDetail:F,isDrawing:z,onSave:bt,onLoad:vt,savedDrawings:_,isFullscreen:R,onToggleFullscreen:ht,safeMode:A,onToggleSafeMode:()=>$(l=>!l),stepMode:L,onToggleStepMode:()=>X(l=>!l),stepIndex:D,stepMax:se,onStepPrev:Mt,onStepNext:Nt,onStepPlayOnce:wt}),m&&t.length>0&&n.jsx(As,{terms:t,time:d,epicycles:c,metrics:de,focusIndex:L?Math.max(c-1,0):void 0,stepMode:L}),L&&t.length>0&&n.jsxs("div",{className:"absolute top-4 left-4 z-[60] bg-slate-900/80 text-slate-100 border border-slate-700 rounded-lg px-4 py-3 shadow-lg space-y-1",children:[n.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Step mode"}),n.jsxs("div",{className:"text-sm font-semibold",children:["Term ",Math.min(c,se)," / ",Math.max(se,1)]}),n.jsxs("div",{className:"text-xs text-slate-200",children:["Δenergy ",kt.toFixed(2),"% · Cumulative ",St.toFixed(2),"% · RMS ",de.rmsError.toFixed(2)," px"]})]}),y&&n.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100]",children:n.jsx("div",{className:"text-cyan-400 font-mono text-xl animate-pulse",children:"Processing Image..."})}),e==="DRAW"&&r.length===0&&n.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none text-center",children:[n.jsx("h1",{className:"text-4xl font-bold text-slate-200 mb-2 drop-shadow",children:"Draw Something"}),n.jsx("p",{className:"text-slate-300",children:"Trace a continuous line to begin"})]})]})},ut=document.getElementById("fourier-root");if(!ut)throw new Error("Could not find root element to mount to");const Xs=Et.createRoot(ut);Xs.render(n.jsx($e.StrictMode,{children:n.jsx($s,{})}));
