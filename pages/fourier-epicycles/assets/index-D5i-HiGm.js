import{r as i,j as e,R as Ne,a as et}from"./react-vendor-CkISVyWX.js";import{A as tt,P as st,S as nt,F as rt,a as at,I as lt,b as ot,C as _e,T as ct,c as it,d as dt,e as ut,M as ht,f as mt,R as xt,g as ft,h as pt,i as gt,j as bt,G as vt,W as yt,k as jt,l as Nt}from"./icons-vendor-D7oP6Icu.js";import{k as xe}from"./math-vendor-Ca7EfnBD.js";import"./vendor-Bb8JjhAW.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const x of o.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&r(x)}).observe(document,{childList:!0,subtree:!0});function l(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=l(a);fetch(a.href,o)}})();const wt=t=>{const c=[],l=t.length;for(let r=0;r<l;r++){let a=0,o=0;for(let h=0;h<l;h++){const m=Math.PI*2*r*h/l,v=Math.cos(m),N=Math.sin(m),b=t[h].re,j=t[h].im;a+=b*v+j*N,o+=j*v-b*N}a=a/l,o=o/l;const x=r>l/2?r-l:r,p=Math.sqrt(a*a+o*o),g=Math.atan2(o,a);c.push({re:a,im:o,freq:x,amp:p,phase:g})}return c.sort((r,a)=>a.amp-r.amp)},Mt=(t,c)=>{if(c<=0||t.length<2)return[...t];const l=[];for(let r=0;r<t.length;r++){let a=0,o=0,x=0;for(let p=-c;p<=c;p++){const g=r+p;g>=0&&g<t.length&&(a+=t[g].x,o+=t[g].y,x++)}l.push({x:a/x,y:o/x})}return l},kt=()=>{const t=[];for(let r=0;r<50;r++)t.push({x:-200+r*2*200/50,y:-200});for(let r=0;r<50;r++)t.push({x:200,y:-200+r*2*200/50});for(let r=0;r<50;r++)t.push({x:200-r*2*200/50,y:200});for(let r=0;r<50;r++)t.push({x:-200,y:200-r*2*200/50});return t},Pt=()=>{const t=[];for(let r=0;r<200;r++){const a=Math.PI*2*r/200;t.push({x:200*Math.cos(a),y:200*Math.sin(a)})}return t},St=()=>{const t=[];for(let l=0;l<300;l++){const r=Math.PI*2*l/300,a=16*Math.pow(Math.sin(r),3),o=-(13*Math.cos(r)-5*Math.cos(2*r)-2*Math.cos(3*r)-Math.cos(4*r));t.push({x:a*15,y:o*15})}return t},Ct=()=>{const t=[];for(let r=0;r<300;r++){const a=Math.PI*2*r/300,o=150*Math.cos(a),x=150*Math.sin(a)*Math.cos(a);t.push({x:o,y:x})}return t},Et=()=>{const t=[];for(let l=0;l<100;l++){const r=Math.PI*2*l/100;t.push({x:40*Math.cos(r)-50,y:30*Math.sin(r)+100})}for(let l=0;l<20;l++)t.push({x:-10,y:100-200*l/20});for(let l=0;l<30;l++){const r=l/30;t.push({x:-10+50*Math.sin(r*Math.PI),y:-100+50*r})}for(let l=0;l<20;l++)t.push({x:-10,y:-50+150*l/20});return t},Rt={threshold:30,sampleRate:3,maxPoints:1500,smoothingWindow:4},Tt=t=>{if(t.length===0)return[];const c=[],l=new Set;let r=0;for(c.push(t[0]),l.add(0);c.length<t.length;){let a=1/0,o=-1;const x=t[r];for(let p=0;p<t.length;p++)if(!l.has(p)){const g=t[p],h=(x.x-g.x)**2+(x.y-g.y)**2;h<a&&(a=h,o=p)}if(o!==-1)l.add(o),c.push(t[o]),r=o;else break}return c},It=(t,c,l,r={})=>{const{threshold:a,sampleRate:o,maxPoints:x,smoothingWindow:p}={...Rt,...r},g=[],h=b=>(t[b]+t[b+1]+t[b+2])/3;for(let b=0;b<l;b+=o)for(let j=0;j<c;j+=o){const E=(b*c+j)*4,u=(b*c+(j-1))*4,P=((b-1)*c+j)*4;if(j>0&&b>0){const f=h(E),S=h(u),C=h(P);Math.abs(f-S)+Math.abs(f-C)>a&&g.push({x:j-c/2,y:b-l/2})}}if(g.length===0)return[];let m=g;if(g.length>x){const b=Math.ceil(g.length/x);m=g.filter((j,E)=>E%b===0)}const v=Tt(m),N=[];for(let b=0;b<v.length;b++){let j=0,E=0,u=0;for(let P=-p;P<=p;P++){const f=(b+P+v.length)%v.length;j+=v[f].x,E+=v[f].y,u++}N.push({x:j/u,y:E/u})}return N},_t=async(t,c=800,l={})=>new Promise((r,a)=>{const o=new Image,x=URL.createObjectURL(t);o.onload=()=>{const p=document.createElement("canvas"),g=p.getContext("2d");if(!g){a(new Error("Could not get canvas context"));return}let h=o.width,m=o.height;if(h>c){const b=c/h;h=c,m=m*b}p.width=h,p.height=m,g.drawImage(o,0,0,h,m);const v=g.getImageData(0,0,h,m),N=It(v.data,h,m,l);URL.revokeObjectURL(x),r(N)},o.onerror=p=>a(p),o.src=x}),ge=1500,Ft=t=>t.map(c=>({re:c.x,im:c.y})),zt=t=>t&&t>0?t:ge,Lt=(t,c=ge)=>{const l=zt(c);if(t.length<=l)return[...t];const r=Math.ceil(t.length/l);return t.filter((a,o)=>o%r===0)},Dt=(t,c,l=ge)=>{const r=Lt(t,l);return Mt(r,c)},At=(t,c={})=>{const{smoothing:l=0,limit:r=ge}=c,a=Dt(t,l,r),o=wt(Ft(a));return{prepared:a,spectrum:o}},Ot=(t,c,l,r=600)=>{if(!t.length||!c.length)return{energyPct:0,rmsError:0,topTerms:[],breakdown:[]};const a=t.map(f=>f.amp*f.amp),o=a.reduce((f,S)=>f+S,0)||1,x=Math.max(Math.min(l||t.length,t.length),1),p=a.slice(0,x).reduce((f,S)=>f+S,0);let g=0;const h=a.map(f=>(g+=f,{energyPct:f/o*100,cumulativePct:g/o*100}));let m=0;const v=t.slice(0,6).map((f,S)=>{const C=a[S];return m+=C,{freq:f.freq,amp:f.amp,phase:f.phase,energyPct:C/o*100,cumulativePct:m/o*100}}),N=c.length,b=Math.max(1,Math.floor(N/r)),j=t.slice(0,x);let E=0,u=0;for(let f=0;f<N;f+=b){let S=0,C=0;for(let $=0;$<j.length;$++){const F=j[$],X=2*Math.PI*F.freq*f/N,G=Math.cos(X),K=Math.sin(X);S+=F.re*G-F.im*K,C+=F.re*K+F.im*G}const _=S-c[f].x,z=C-c[f].y;E+=_*_+z*z,u++}const P=Math.sqrt(E/Math.max(u,1));return{energyPct:Number((p/o*100).toFixed(2)),rmsError:Number(P.toFixed(2)),topTerms:v,breakdown:h}},$t=t=>Math.min(1,Math.max(0,t)),qt=(t,c)=>!isFinite(t)||c<=0?0:$t(t/c),pe=(t,c,l=!1)=>{const r=qt(t,c),a=210+110*r,o=l?62:48+6*r,x=l?.95:.6;return`hsla(${a.toFixed(1)}, 82%, ${o.toFixed(1)}%, ${x})`},Wt=t=>`linear-gradient(90deg, ${pe(0,t)} 0%, ${pe(t*.5,t)} 50%, ${pe(t,t,!0)} 100%)`,Xt=(t,c,l)=>pe(t.amp,c,l),Ut=({mode:t,setMode:c,isPlaying:l,setIsPlaying:r,clear:a,numEpicycles:o,maxEpicycles:x,setNumEpicycles:p,onUpload:g,showMath:h,setShowMath:m,onPreset:v,speed:N,setSpeed:b,onReset:j,brushColor:E,setBrushColor:u,brushSize:P,setBrushSize:f,smoothing:S,setSmoothing:C,isDrawing:_,onSave:z,onLoad:$,savedDrawings:F,isFullscreen:X,onToggleFullscreen:G,safeMode:K,onToggleSafeMode:q,stepMode:ue,onToggleStepMode:T,stepIndex:Q,stepMax:D,onStepPrev:U,onStepNext:re,onStepPlayOnce:be})=>{const Z=i.useRef(null),A=M=>`
    p-2.5 rounded-lg transition-all duration-200 flex items-center justify-center
    ${M?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50 shadow-[0_0_15px_rgba(6,182,212,0.3)]":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 hover:text-slate-200 border border-transparent"}
  `;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fourier-toolbar fourier-toolbar--top",children:[e.jsxs("div",{className:"flex gap-1 mr-4 pl-2",children:[e.jsx(tt,{className:"w-5 h-5 text-fuchsia-500"}),e.jsxs("span",{className:"font-bold text-slate-100 hidden sm:block",children:["Fourier",e.jsx("span",{className:"text-fuchsia-500",children:"Viz"})]})]}),e.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),e.jsx("button",{onClick:()=>c("DRAW"),className:A(t==="DRAW"),title:"Freehand Draw",children:e.jsx(st,{size:20})}),e.jsxs("div",{className:"relative group",children:[e.jsx("button",{className:A(t==="PRESET"),title:"Presets",children:e.jsx(nt,{size:20})}),e.jsxs("div",{className:"absolute top-full left-0 w-32 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden hidden group-hover:block group-focus-within:block z-50",children:[e.jsx("button",{onClick:()=>v("circle"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Circle"}),e.jsx("button",{onClick:()=>v("square"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Square"}),e.jsx("button",{onClick:()=>v("heart"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Heart"}),e.jsx("button",{onClick:()=>v("infinity"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Infinity"}),e.jsx("button",{onClick:()=>v("note"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Note"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("button",{className:A(!1),title:"Load Saved Drawing",children:e.jsx(rt,{size:20})}),e.jsx("div",{className:"absolute top-full left-0 w-48 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden hidden group-hover:block group-focus-within:block max-h-60 overflow-y-auto custom-scrollbar z-50",children:F.length===0?e.jsx("div",{className:"px-4 py-2 text-sm text-slate-500 italic",children:"No saved drawings"}):F.map(M=>e.jsx("button",{onClick:()=>$(M),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400 truncate border-b border-slate-800 last:border-0",children:M},M))})]}),e.jsx("button",{onClick:z,className:A(!1),title:"Save Current Drawing",children:e.jsx(at,{size:20})}),e.jsx("button",{onClick:()=>{var M;return(M=Z.current)==null?void 0:M.click()},className:A(t==="UPLOAD"),title:"Upload Image",children:e.jsx(lt,{size:20})}),e.jsx("input",{type:"file",ref:Z,onChange:g,accept:"image/*",className:"hidden"}),e.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),e.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-lg transition-all duration-300 ${_?"bg-fuchsia-900/20 ring-1 ring-fuchsia-500/50":""}`,children:[e.jsxs("div",{className:"relative flex items-center group",title:"Brush Color",children:[e.jsx(ot,{size:18,className:`${_?"text-fuchsia-400":"text-slate-400"} mr-2 transition-colors`}),e.jsx("input",{type:"color",value:E,onChange:M=>u(M.target.value),className:"w-6 h-6 rounded border-none cursor-pointer bg-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2",title:"Brush Size",children:[e.jsx(_e,{size:10,className:"text-slate-400"}),e.jsx("input",{type:"range",min:"1",max:"10",step:"0.5",value:P,onChange:M=>f(parseFloat(M.target.value)),className:"w-16 h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-slate-400"}),e.jsx(_e,{size:16,className:`text-slate-400 transition-all ${_?"scale-110 text-fuchsia-300":""}`})]})]}),e.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),e.jsx("button",{onClick:a,className:"p-2.5 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors",title:"Clear Canvas",children:e.jsx(ct,{size:20})}),e.jsx("button",{onClick:()=>m(!h),className:A(h),title:"Toggle Math Panel",children:e.jsx(it,{size:20})}),e.jsx("button",{onClick:q,className:A(K),title:"Toggle safe mode (cap epicycles / lighten rendering)",children:e.jsx(dt,{size:20})}),e.jsx("button",{onClick:T,className:A(ue),title:"Toggle step-through playback",children:e.jsx(ut,{size:20})}),e.jsx("button",{onClick:G,className:A(X),title:X?"Exit Fullscreen":"Fullscreen Play",children:X?e.jsx(ht,{size:20}):e.jsx(mt,{size:20})})]}),e.jsx("div",{className:"fourier-toolbar fourier-toolbar--bottom",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:j,className:"p-3 rounded-full bg-slate-800 text-slate-300 hover:bg-slate-700 hover:text-white transition-all",title:"Reset Animation",children:e.jsx(xt,{size:18})}),e.jsx("button",{onClick:()=>r(!l),className:"w-14 h-14 flex items-center justify-center rounded-full bg-cyan-500 text-slate-950 hover:bg-cyan-400 transition-all shadow-[0_0_20px_rgba(6,182,212,0.4)]",children:l?e.jsx(ft,{fill:"currentColor",size:24}):e.jsx(pt,{fill:"currentColor",className:"ml-1",size:24})}),ue&&e.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/70 rounded-full px-3 py-2 border border-slate-700",children:[e.jsx("button",{onClick:U,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Previous term",children:e.jsx(gt,{size:16})}),e.jsx("button",{onClick:be,className:"px-3 py-2 rounded-full bg-amber-400 text-slate-900 font-semibold hover:bg-amber-300 transition",title:"Play this term once",children:"Step"}),e.jsx("button",{onClick:re,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Next term",children:e.jsx(bt,{size:16})}),e.jsxs("span",{className:"text-xs text-slate-300 font-semibold ml-1",children:["Term ",Q+1," / ",Math.max(D,1)]})]})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 w-full",children:[e.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[e.jsx("span",{children:"Precision"}),e.jsxs("span",{className:"text-cyan-400",children:[o," / ",x,K?" (capped)":""]})]}),e.jsx("input",{type:"range",min:"1",max:x||1,value:o,onChange:M=>p(parseInt(M.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),e.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(vt,{size:12}),e.jsx("span",{children:"Speed"})]}),e.jsxs("span",{className:"text-amber-400",children:[N.toFixed(2),"x"]})]}),e.jsx("input",{type:"range",min:"0.05",max:"3",step:"0.05",value:N,onChange:M=>b(parseFloat(M.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-amber-500"})]}),e.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(yt,{size:12}),e.jsx("span",{children:"Smoothness"})]}),e.jsxs("span",{className:"text-emerald-400",children:[S,"px"]})]}),e.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:S,onChange:M=>C(parseInt(M.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]})]})]})})]})},Bt=({terms:t,time:c,epicycles:l,metrics:r,focusIndex:a,stepMode:o=!1})=>{var E;const x=i.useRef(null),[p,g]=i.useState("dft"),[h,m]=i.useState(0),v=i.useMemo(()=>{const u=t[0],P=t.length||1,f=(c/(2*Math.PI)).toFixed(2);return{n:P,largestRadius:u?u.amp.toFixed(1):"0.0",maxFreq:u?u.freq:0,phaseTurns:f,dominantPhase:u?u.phase.toFixed(2):"0.00"}},[t,c]),N=i.useMemo(()=>{const u=t[Math.min(h,Math.max(t.length-1,0))];return u||{freq:0,amp:0,phase:0}},[h,t]),b=r.breakdown?r.breakdown[Math.min(h,Math.max(r.breakdown.length-1,0))]??{energyPct:0,cumulativePct:0}:{energyPct:0,cumulativePct:0},j=i.useMemo(()=>{const u={throwOnError:!1},P=v.n||1,f=N.freq,S=N.amp.toFixed(3),C=N.phase.toFixed(3),_=b.energyPct.toFixed(2),z=b.cumulativePct.toFixed(2);return{paramsHtml:xe.renderToString(`k = ${f},\\quad |X_k| = ${S},\\quad \\phi_k = ${C}\\,\\text{rad}`,u),vectorHtml:xe.renderToString(`\\text{Vector}_k(t) = |X_k|\\,e^{i\\left(2\\pi k t/${P} + \\phi_k\\right)}`,u),energyHtml:xe.renderToString(`\\Delta\\text{energy} = ${_}\\%\\quad \\text{cum.} = ${z}\\%`,u)}},[b,N.amp,N.freq,N.phase,v.n]);return i.useEffect(()=>{var $,F;if(!x.current)return;const{n:u,phaseTurns:P,dominantPhase:f}=v,S=Math.max(l,1),C=(($=t[0])==null?void 0:$.freq)??0,_=((F=t[0])==null?void 0:F.amp)??0,z={dft:`
      \\begin{aligned}
        X_k &= \\frac{1}{N} \\sum_{n=0}^{N-1} x_n e^{-i 2\\pi kn / N} \\\\
        &\\textcolor{#f472b6}{N = ${u}},\\; \\textcolor{#22c55e}{k \\in [0, N-1]}
      \\end{aligned}
      `,reconstruction:`
      \\begin{aligned}
        x(t) &\\approx \\sum_{j=1}^{${S}} \\left|X_{k_j}\\right| e^{i\\left(k_j t + \\phi_{k_j}\\right)} \\\\
        t &= 2\\pi n/N,\\; k_j \\in \\left[-\\frac{N}{2}, \\frac{N}{2}\\right] \\\\
        &\\textcolor{#22c55e}{\\left|X_{${C}}\\right| = ${_.toFixed(2)}},\\;
          \\textcolor{#f472b6}{\\phi_{${C}} = ${f}}\\;\\text{rad}
      \\end{aligned}
      `,phasor:`
      \\begin{aligned}
        \\text{Epicycle}_k(t) &= r_k e^{i(\\omega_k t + \\phi_k)} \\\\
        r_k &= \\left|X_k\\right|,\\;
        \\omega_k = k,\\;
        t = ${P}\\,\\tau
      \\end{aligned}
      `};xe.render(z[p],x.current,{throwOnError:!1,displayMode:!0})},[p,l,v,t]),i.useEffect(()=>{g("dft"),m(0)},[t.length]),i.useEffect(()=>{if(typeof a=="number"&&t.length>0){const u=Math.min(Math.max(a,0),t.length-1);m(u)}},[a,t.length]),e.jsxs("div",{className:"fourier-math-panel",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-cyan-400",children:"Fourier Engine"}),e.jsxs("div",{className:"fourier-math-toggle",role:"group","aria-label":"Toggle formulas",children:[e.jsx("button",{type:"button",className:p==="dft"?"is-active":"",onClick:()=>g("dft"),children:"DFT basis"}),e.jsx("button",{type:"button",className:p==="reconstruction"?"is-active":"",onClick:()=>g("reconstruction"),children:"Reconstruction"}),e.jsx("button",{type:"button",className:p==="phasor"?"is-active":"",onClick:()=>g("phasor"),children:"Phasor anatomy"})]}),e.jsx("div",{className:"mb-4",ref:x,"aria-live":"polite"}),e.jsxs("div",{className:"space-y-4 text-sm font-mono",children:[e.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[e.jsx("span",{className:"text-slate-400",children:"Total Vectors (N)"}),e.jsx("span",{className:"text-cyan-300",children:t.length})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[e.jsx("span",{className:"text-slate-400",children:"Active Epicycles"}),e.jsx("span",{className:"text-fuchsia-400",children:l})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[e.jsx("span",{className:"text-slate-400",children:"Current Phase (t)"}),e.jsxs("span",{className:"text-amber-400",children:[(c/(2*Math.PI)).toFixed(2),"τ"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Largest Radius"}),e.jsxs("span",{className:"text-emerald-400",children:[t.length>0?t[0].amp.toFixed(1):"0.0"," px"]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Amplitude color map"}),e.jsx("div",{className:"fourier-legend",style:{backgroundImage:Wt(((E=t[0])==null?void 0:E.amp)||1)},"aria-label":"Amplitude legend from low to high magnitude"}),e.jsxs("div",{className:"flex justify-between text-[11px] text-slate-500 mt-1",children:[e.jsx("span",{children:"low |X_k|"}),e.jsx("span",{children:"high |X_k|"})]})]}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm font-mono",children:[e.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[e.jsx("span",{className:"text-slate-400",children:"Energy captured (M terms)"}),e.jsxs("span",{className:"text-cyan-300",children:[r.energyPct.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"RMS error vs. original path"}),e.jsxs("span",{className:"text-amber-300",children:[r.rmsError.toFixed(2)," px"]})]})]}),r.topTerms.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Top terms (by amplitude)"}),e.jsxs("div",{className:"grid grid-cols-5 text-[11px] text-slate-300 gap-2 border border-slate-800 rounded-lg p-2",children:[e.jsx("span",{className:"font-semibold text-slate-200",children:"k"}),e.jsx("span",{className:"font-semibold text-slate-200",children:"|X_k|"}),e.jsx("span",{className:"font-semibold text-slate-200",children:"phase"}),e.jsx("span",{className:"font-semibold text-slate-200",children:"energy"}),e.jsx("span",{className:"font-semibold text-slate-200",children:"cum."}),r.topTerms.map((u,P)=>e.jsxs(Ne.Fragment,{children:[e.jsx("span",{children:u.freq}),e.jsx("span",{children:u.amp.toFixed(2)}),e.jsxs("span",{children:[u.phase.toFixed(2)," rad"]}),e.jsxs("span",{children:[u.energyPct.toFixed(1),"%"]}),e.jsxs("span",{children:[u.cumulativePct.toFixed(1),"%"]})]},P))]})]}),e.jsxs("div",{className:"mt-5 border border-slate-800 rounded-lg p-3 space-y-2 bg-slate-900/40",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-slate-400",children:[e.jsx("span",{children:"Term inspector"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>m(u=>Math.max(0,u-1)),"aria-label":"Previous term",children:e.jsx(jt,{size:18,"aria-hidden":"true"})}),e.jsxs("span",{className:"text-slate-200",children:[h+1," / ",t.length||1]}),e.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>m(u=>Math.min(t.length-1,u+1)),"aria-label":"Next term",children:e.jsx(Nt,{size:18,"aria-hidden":"true"})})]})]}),e.jsxs("div",{className:"text-xs text-slate-200 leading-relaxed space-y-2",children:[e.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:j.paramsHtml}}),e.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:j.vectorHtml}}),e.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:j.energyHtml}}),e.jsx("p",{children:o?"Step mode: play once to view this term, then advance.":"Track this circle while playing to see how its phase and magnitude shape the trace."})]})]}),e.jsxs("div",{className:"mt-5 text-xs text-slate-500 italic space-y-2",children:[e.jsx("p",{children:"* Sorted by amplitude so the largest circles draw first."}),e.jsx("p",{children:"Tip: switch formulas to see how truncating to M epicycles shapes the path."})]})]})},Ht=1600,fe=700,Jt=1.75,Vt=.45,Yt=3e6,Fe="fourier_viz__last_session",Gt=()=>{var Se,Ce,Ee,Re,Te;const[t,c]=i.useState("DRAW"),[l,r]=i.useState([]),[a,o]=i.useState([]),[x,p]=i.useState(0),[g,h]=i.useState(!1),[m,v]=i.useState(0),[N,b]=i.useState(!0),[j,E]=i.useState(!1),[u,P]=i.useState("#0f172a"),[f,S]=i.useState("rgba(148, 163, 184, 0.22)"),[C,_]=i.useState(Vt),[z,$]=i.useState(0),[F,X]=i.useState([]),[G,K]=i.useState(!1),[q,ue]=i.useState(!1),[T,Q]=i.useState(!1),[D,U]=i.useState(0),[re,be]=i.useState("#ec4899"),[Z,A]=i.useState(2),[M,oe]=i.useState(!1),ae=i.useRef(null),ee=i.useRef(null),ve=i.useRef(),V=i.useRef([]),O=i.useRef(!1),B=i.useRef(null),we=i.useRef(1),L=i.useRef(null),te=i.useRef(null),H=i.useCallback(()=>{if(L.current){const s=L.current.getContext("2d");s&&(s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,L.current.width,L.current.height))}te.current=null},[]),he=i.useCallback(()=>{const s=ee.current,n=ae.current;if(!s||!n)return;const{width:d,height:y}=s.getBoundingClientRect(),w=Math.max(1,Math.floor(d)),I=Math.max(1,Math.floor(y));if(w<=1||I<=1)return;const k=window.devicePixelRatio||1;we.current=k,s.width=Math.round(w*k),s.height=Math.round(I*k),L.current||(L.current=document.createElement("canvas")),L.current.width=s.width,L.current.height=s.height,H()},[H]),ye=i.useCallback(()=>{p(0),H()},[H]),Le=()=>{ye()},se=i.useCallback(s=>{if(s.length===0)return;const n=q?fe:Ht,{prepared:d,spectrum:y}=At(s,{smoothing:z,limit:n});r(d),o(y),v(Math.min(y.length,n));try{localStorage.setItem(Fe,JSON.stringify(d))}catch{}ye(),h(!0),U(0)},[ye,q,z]);i.useEffect(()=>{const s=Object.keys(localStorage).filter(d=>d.startsWith("fourier_viz_")).map(d=>d.replace("fourier_viz_","")).sort();X(s);const n=localStorage.getItem(Fe);if(n)try{const d=JSON.parse(n);d.length&&(c("PRESET"),r(d),se(d))}catch{}},[]),i.useEffect(()=>{const s=()=>{const d=getComputedStyle(document.documentElement),y=d.getPropertyValue("--color-code-bg").trim(),w=d.getPropertyValue("--fourier-grid").trim();P(y||"#0f172a"),S(w||"rgba(148, 163, 184, 0.22)")};s();const n=typeof MutationObserver<"u"?new MutationObserver(s):null;return n&&(n.observe(document.documentElement,{attributes:!0,attributeFilter:["class","data-theme"]}),n.observe(document.body,{attributes:!0,attributeFilter:["class","data-theme"]})),()=>n==null?void 0:n.disconnect()},[]),i.useEffect(()=>{const s=q?Math.min(a.length,fe):a.length;s!==0&&v(n=>Math.min(Math.max(n||1,1),s))},[a.length,q]),i.useEffect(()=>{!T&&D!==0&&U(0)},[T,D]),i.useEffect(()=>{const s=()=>{K(document.fullscreenElement===ae.current),he()};return document.addEventListener("fullscreenchange",s),()=>document.removeEventListener("fullscreenchange",s)},[he]);const De=i.useCallback(()=>{const s=ae.current;s&&(document.fullscreenElement?document.exitFullscreen().catch(()=>{}):s.requestFullscreen().catch(()=>{}))},[]),le=Ne.useMemo(()=>Ot(a,l,m),[a,m,l]),Ae=s=>{if(t!=="DRAW"||O.current||s.pointerType==="mouse"&&s.button!==0)return;O.current=!0,B.current=s.pointerId,oe(!0),r([]),H(),o([]),h(!1),U(0),Q(!1);const n=ee.current.getBoundingClientRect(),d=s.clientX-n.left-n.width/2,y=s.clientY-n.top-n.height/2,w={x:d,y};r([w]),V.current=[w];try{s.currentTarget.setPointerCapture(s.pointerId)}catch{}},Oe=s=>{if(!O.current||t!=="DRAW"||B.current!==s.pointerId)return;if(s.pointerType==="mouse"&&(s.buttons&1)===0){O.current=!1,B.current=null,oe(!1);return}const n=ee.current.getBoundingClientRect(),d=s.clientX-n.left-n.width/2,y=s.clientY-n.top-n.height/2,w={x:d,y},I=V.current[V.current.length-1];Math.hypot(w.x-I.x,w.y-I.y)>Jt&&V.current.push(w)},$e=s=>{if(!O.current||typeof(s==null?void 0:s.pointerId)=="number"&&B.current!==s.pointerId)return;O.current=!1,B.current=null,oe(!1);const n=V.current;n.length>1?se(n):(r([]),o([]),h(!1))},qe=()=>{O.current&&(O.current=!1,B.current=null,oe(!1))};i.useEffect(()=>{const s=n=>{if(!O.current)return;const d=n.pointerId;if(typeof d=="number"&&B.current!==null&&d!==B.current)return;O.current=!1,B.current=null,oe(!1);const y=V.current;y.length>1?se(y):(r([]),o([]),h(!1))};return window.addEventListener("pointerup",s),window.addEventListener("pointercancel",s),window.addEventListener("blur",s),()=>{window.removeEventListener("pointerup",s),window.removeEventListener("pointercancel",s),window.removeEventListener("blur",s)}},[se]);const We=()=>{r([]),H(),o([]),h(!1),c("DRAW"),U(0),Q(!1),V.current=[]},Xe=s=>{let n=[];switch(s){case"circle":n=Pt();break;case"square":n=kt();break;case"heart":n=St();break;case"infinity":n=Ct();break;case"note":n=Et();break}c("PRESET"),r(n),se(n)},Ue=()=>{if(l.length<2){alert("Draw something first!");return}const s=prompt("Enter a name for this drawing:");if(s)try{localStorage.setItem(`fourier_viz_${s}`,JSON.stringify(l)),X(n=>{const d=[...n];return d.includes(s)||d.push(s),d.sort()})}catch{alert("Failed to save. Storage might be full.")}},Be=s=>{const n=localStorage.getItem(`fourier_viz_${s}`);if(n)try{const d=JSON.parse(n);r(d),c("PRESET"),se(d)}catch(d){console.error("Error loading drawing",d)}},He=async s=>{if(s.target.files&&s.target.files[0]){const n=s.target.files[0];if(n.size>Yt){alert("File too large for browser processing. Please pick an image under 3MB.");return}E(!0);try{const d=await _t(n);d.length>0?(r(d),c("UPLOAD"),se(d)):alert("No clear shape found. Try an image with higher contrast.")}catch(d){console.error(d),alert("Error processing image.")}finally{E(!1)}}},Me=s=>{if(!a.length)return;Q(!0);const n=Math.min(Math.max(s,0),Math.max(J-1,0));U(n);const d=n+1;m!==d&&v(d),p(0),H(),te.current=null},Je=()=>Me(D-1),Ve=()=>Me(D+1),Ye=()=>{T||Q(!0),h(!0)},Ge=(s,n,d,y,w)=>{let I=n/2,k=d/2;const W=a.slice(0,Math.max(m,1));for(let Y=0;Y<W.length;Y++){const ne=I,R=k,{freq:Ie,amp:ce,phase:me}=W[Y],je=Ie*x+me,ie=Y===y,de=Xt(W[Y],w,ie),Ze=T&&ie?1+.25*Math.sin(x*6):1;I+=ce*Math.cos(je),k+=ce*Math.sin(je),s.strokeStyle=de,s.lineWidth=ie?1.6*Ze:1,s.beginPath(),s.arc(ne,R,ce,0,2*Math.PI),s.stroke(),s.strokeStyle=de,s.beginPath(),s.moveTo(ne,R),s.lineTo(I,k),s.stroke(),Y===W.length-1&&(s.fillStyle=de,s.beginPath(),s.arc(I,k,3,0,2*Math.PI),s.fill())}return{x:I,y:k}},ke=i.useCallback(()=>{var I;const s=ee.current;if(!s)return;const n=s.getContext("2d");if(!n)return;const d=we.current||1,y=s.width/d,w=s.height/d;if(n.setTransform(1,0,0,1,0,0),n.scale(d,d),n.lineCap="round",n.lineJoin="round",n.fillStyle=u,n.fillRect(0,0,y,w),n.strokeStyle=f,n.lineWidth=.5,n.beginPath(),n.moveTo(y/2,0),n.lineTo(y/2,w),n.moveTo(0,w/2),n.lineTo(y,w/2),n.stroke(),l.length>0&&t!=="DRAW"&&(n.strokeStyle="rgba(255, 255, 255, 0.1)",n.lineWidth=1,n.lineCap="round",n.lineJoin="round",n.beginPath(),l.forEach((k,W)=>{W===0?n.moveTo(k.x+y/2,k.y+w/2):n.lineTo(k.x+y/2,k.y+w/2)}),n.stroke()),t==="DRAW"&&O.current&&(n.strokeStyle=re,n.lineWidth=Z,n.lineCap="round",n.lineJoin="round",n.beginPath(),V.current.forEach((k,W)=>{W===0?n.moveTo(k.x+y/2,k.y+w/2):n.lineTo(k.x+y/2,k.y+w/2)}),n.stroke()),a.length>0){L.current&&n.drawImage(L.current,0,0,y,w);const k=Math.min(Math.max(m,1),a.length),W=Math.max(k-1,0),Y=((I=a[0])==null?void 0:I.amp)||1,ne=Ge(n,y,w,W,Y);if(L.current){const R=L.current.getContext("2d");R&&(R.setTransform(1,0,0,1,0,0),R.scale(d,d),R.strokeStyle=re,R.lineWidth=Z,R.lineCap="round",R.lineJoin="round",te.current&&(R.beginPath(),R.moveTo(te.current.x,te.current.y),R.lineTo(ne.x,ne.y),R.stroke()))}if(te.current={x:ne.x,y:ne.y},g){const R=Math.max(l.length||a.length,1),ce=2*Math.PI/R*C,me=x+ce;if(me>=2*Math.PI){if(p(0),H(),te.current=null,T){h(!1);const ie=q?Math.min(a.length,fe):a.length;U(de=>Math.min(de+1,Math.max(ie-1,0)))}}else p(me)}}},[a,g,x,t,l,m,C,re,Z,u,f,T,q]);i.useEffect(()=>(ve.current=requestAnimationFrame(ke),()=>{ve.current&&cancelAnimationFrame(ve.current)}),[ke]),i.useEffect(()=>{const s=()=>he();s();const n=typeof ResizeObserver<"u"?new ResizeObserver(s):null;return n&&(ae.current&&n.observe(ae.current),ee.current&&n.observe(ee.current)),window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s),n==null||n.disconnect()}},[he]),i.useEffect(()=>{H()},[m,a]),i.useEffect(()=>{const s=document.getElementById("fourier-root");return s==null||s.classList.add("is-mounted"),()=>{s==null||s.classList.remove("is-mounted")}},[]);const J=q?Math.min(a.length,fe):a.length,Pe=Math.max(Math.min(m-1,(((Se=le.breakdown)==null?void 0:Se.length)||1)-1),0),Ke=((Ee=(Ce=le.breakdown)==null?void 0:Ce[Pe])==null?void 0:Ee.energyPct)??0,Qe=((Te=(Re=le.breakdown)==null?void 0:Re[Pe])==null?void 0:Te.cumulativePct)??le.energyPct;return i.useEffect(()=>{if(!T)return;const s=Math.min(Math.max(D+1,1),Math.max(J,1));m!==s&&v(s)},[T,D,J,m]),i.useEffect(()=>{const s=Math.max(Math.min(m-1,J-1),0);D>s&&U(s)},[m,J,D]),e.jsxs("div",{className:`fourier-stage select-none ${G?"is-fullscreen":""}`,ref:ae,"data-mode":t,"data-drawing":M?"true":"false","data-has-spectrum":a.length>0?"true":"false","data-points":l.length,children:[e.jsx("canvas",{ref:ee,onPointerDown:Ae,onPointerMove:Oe,onPointerUp:$e,onPointerCancel:qe,className:`fourier-canvas cursor-${t==="DRAW"?"crosshair":"default"}`}),e.jsx(Ut,{mode:t,setMode:c,isPlaying:g,setIsPlaying:h,clear:We,numEpicycles:m,maxEpicycles:J,setNumEpicycles:v,onUpload:He,showMath:N,setShowMath:b,onPreset:Xe,speed:C,setSpeed:_,onReset:Le,brushColor:re,setBrushColor:be,brushSize:Z,setBrushSize:A,smoothing:z,setSmoothing:$,isDrawing:M,onSave:Ue,onLoad:Be,savedDrawings:F,isFullscreen:G,onToggleFullscreen:De,safeMode:q,onToggleSafeMode:()=>ue(s=>!s),stepMode:T,onToggleStepMode:()=>Q(s=>!s),stepIndex:D,stepMax:J,onStepPrev:Je,onStepNext:Ve,onStepPlayOnce:Ye}),N&&a.length>0&&e.jsx(Bt,{terms:a,time:x,epicycles:m,metrics:le,focusIndex:T?Math.max(m-1,0):void 0,stepMode:T}),T&&a.length>0&&e.jsxs("div",{className:"absolute top-4 left-4 z-[60] bg-slate-900/80 text-slate-100 border border-slate-700 rounded-lg px-4 py-3 shadow-lg space-y-1",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Step mode"}),e.jsxs("div",{className:"text-sm font-semibold",children:["Term ",Math.min(m,J)," / ",Math.max(J,1)]}),e.jsxs("div",{className:"text-xs text-slate-200",children:["Δenergy ",Ke.toFixed(2),"% · Cumulative ",Qe.toFixed(2),"% · RMS ",le.rmsError.toFixed(2)," px"]})]}),j&&e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100]",children:e.jsx("div",{className:"text-cyan-400 font-mono text-xl animate-pulse",children:"Processing Image..."})}),t==="DRAW"&&l.length===0&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-slate-200 mb-2 drop-shadow",children:"Draw Something"}),e.jsx("p",{className:"text-slate-300",children:"Trace a continuous line to begin"})]})]})},ze=document.getElementById("fourier-root");if(!ze)throw new Error("Could not find root element to mount to");const Kt=et.createRoot(ze);Kt.render(e.jsx(Ne.StrictMode,{children:e.jsx(Gt,{})}));
