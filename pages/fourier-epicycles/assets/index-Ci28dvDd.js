import{r as y,j as a,R as Je,a as Xt}from"./react-vendor-CkISVyWX.js";import{A as Yt,P as Vt,S as Gt,F as Kt,a as Jt,I as Zt,b as Qt,C as mt,T as en,c as tn,d as nn,e as pt,M as sn,f as rn,R as on,g as an,h as ln,i as cn,j as un,G as dn,W as fn,k as hn,l as mn}from"./icons-vendor-D7oP6Icu.js";import{k as Ie}from"./math-vendor-Ca7EfnBD.js";import"./vendor-Bb8JjhAW.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const pn=[{id:"about",label:"About"},{id:"learning",label:"Learning"},{id:"posts",label:"Posts"},{id:"projects",label:"Projects"},{id:"experience",label:"Experience"},{id:"education",label:"Education"},{id:"contact",label:"Contact"}],kt=[{id:"circuit-lab",label:"Circuit Lab",href:"pages/circuit-lab/"},{id:"transformer-lab",label:"Transformer Lab",href:"pages/transformer-lab/"},{id:"ml-playground",label:"ML Playground",href:"pages/ml-playground/"},{id:"fourier-epicycles",label:"Fourier Epicycles",href:"pages/fourier-epicycles/"},{id:"endless-depths",label:"Endless Depths",href:"pages/endless-depths/"}],gn="Ka Ming Lui";function Et(e){return e?e==="/"?"/":e.endsWith("/")?e:`${e}/`:""}function Ze(e=""){var o,l;const t=((o=document.documentElement)==null?void 0:o.dataset.navRoot)??((l=document.body)==null?void 0:l.dataset.navRoot)??null;if(typeof t=="string"&&t.trim())return Et(t.trim());const s=(typeof e=="string"?e:"").split(/[?#]/)[0].replace(/\\/g,"/").split("/").filter(Boolean);return s.length&&s[s.length-1].includes(".")&&s.pop(),s.length===0?"":"../".repeat(s.length)}function xn(e=""){var o,l;const t=((o=document.body)==null?void 0:o.dataset.currentLab)??((l=document.documentElement)==null?void 0:l.dataset.currentLab)??null;if(t)return t;const r=(typeof e=="string"?e:"").toLowerCase().replace(/\\/g,"/"),s=kt.find(i=>r.includes(`/${i.id.toLowerCase()}/`));return(s==null?void 0:s.id)??null}function yn({rootPrefix:e,useLocalAnchors:t}){return pn.map(({id:n,label:r})=>`<li><a href="${t?`#${n}`:`${e}index.html#${n}`}">${r}</a></li>`).join("")}function bn({rootPrefix:e,currentLabId:t}){return kt.map(({id:n,label:r,href:s})=>`<li><a href="${s.startsWith("http")?s:`${e}${s}`}"${n===t?' aria-current="page"':""}>${r}</a></li>`).join("")}function Nt(e={}){var p,v,j;const t=e.target??document.querySelector("[data-site-header]")??document.querySelector(".site-header");if(!t)return null;const n=t.querySelector(".nav");if(!(t.hasAttribute("data-site-header")||e.forceRender===!0)&&n||t.dataset.navRendered==="true"&&n)return n;const s=typeof e.rootPrefix=="string"&&e.rootPrefix.trim()||typeof((p=t==null?void 0:t.dataset)==null?void 0:p.navRoot)=="string"&&t.dataset.navRoot.trim(),o=Et(s??Ze((v=window.location)==null?void 0:v.pathname)),l=e.useLocalAnchors??(o===""||t.dataset.useLocalAnchors==="true"),i=e.currentLab??t.dataset.currentLab??xn((j=window.location)==null?void 0:j.pathname),d=e.showEditToggle===!0||t.dataset.showEditToggle==="true",h=l?"#hero":`${o}index.html#hero`,c=yn({rootPrefix:o,useLocalAnchors:l}),g=bn({rootPrefix:o,currentLabId:i}),m=`
    <div class="container">
      <nav class="nav" aria-label="Primary">
        <a class="logo" href="${h}">${gn}</a>
        <button class="nav-toggle" type="button" aria-expanded="false" aria-controls="primary-navigation">
          <span class="nav-toggle__bar"></span>
          <span class="nav-toggle__bar"></span>
          <span class="nav-toggle__bar"></span>
          <span class="sr-only">Toggle navigation</span>
        </button>
        <ul class="nav-links" id="primary-navigation" data-visible="false">
          <li class="nav-item nav-item--dropdown">
            <button class="nav-dropdown-toggle nav-pill" type="button" aria-expanded="false" aria-controls="section-menu">
              Sections
              <svg class="nav-dropdown__icon" aria-hidden="true" focusable="false" viewBox="0 0 12 12">
                <path d="M2.47 4.47a.75.75 0 0 1 1.06 0L6 6.94l2.47-2.47a.75.75 0 0 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 0 1 0-1.06Z" />
              </svg>
            </button>
            <ul class="nav-dropdown-menu" id="section-menu" hidden>
              ${c}
            </ul>
          </li>
          <li class="nav-item nav-item--dropdown">
            <button class="nav-dropdown-toggle nav-pill" type="button" aria-expanded="false" aria-controls="labs-menu">
              Labs
              <svg class="nav-dropdown__icon" aria-hidden="true" focusable="false" viewBox="0 0 12 12">
                <path d="M2.47 4.47a.75.75 0 0 1 1.06 0L6 6.94l2.47-2.47a.75.75 0 0 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 0 1 0-1.06Z" />
              </svg>
            </button>
            <ul class="nav-dropdown-menu" id="labs-menu" hidden>
              ${g}
            </ul>
          </li>
        </ul>
        <div class="nav-actions">
          ${d?'<button class="edit-toggle" type="button" aria-pressed="false" hidden>Edit mode</button>':""}
          <button class="theme-toggle" type="button" aria-label="Toggle color theme">
            <span aria-hidden="true">üåô</span>
          </button>
        </div>
      </nav>
    </div>
  `;return t.innerHTML=m.trim(),t.id=t.id||"top",t.classList.add("site-header"),t.dataset.navRendered="true",t.querySelector(".nav")}const $e='&copy; <span id="year"></span> Ka Ming Lui. Built with accessibility and performance in mind.',gt={home:{id:"home",layoutClass:"footer__layout",useContentBindings:!0,backToTopLabel:"Back to top"},"ml-playground":{layoutClass:"footer__layout",heading:"Want to explore more ML demos?",body:"Try the transformer lab or reach out to share your favorite visualization ideas.",actions:[{label:"Visit Transformer Lab",href:"pages/transformer-lab/",variant:"primary"},{label:"Email Ka-Ming",href:"mailto:contact@kaminglui.com",variant:"ghost"}],meta:["Curious how this playground works? Inspect the source on GitHub to tweak the algorithm.",$e]},"transformer-lab":{layoutClass:"footer__layout",heading:"Ready for more machine learning stories?",body:"Head back to the main site to explore projects, journal entries, and the learning roadmap behind this transformer lab.",actions:[{label:"View projects",href:"index.html#projects",variant:"primary"},{label:"Get in touch",href:"index.html#contact",variant:"ghost"}],meta:["Enjoyed the walkthrough? Share it with fellow ML explorers.",$e]},"endless-depths":{layoutClass:"footer__layout",heading:"Back to the main site?",body:"Check out projects, posts, and the ML roadmap that inspired this mini-game.",actions:[{label:"View projects",href:"index.html#projects",variant:"primary"},{label:"Get in touch",href:"index.html#contact",variant:"ghost"}],meta:["Progress saves to your browser so you can pick up where you left off.",'&copy; <span id="year"></span> Ka Ming Lui. Built for performance and accessibility.']}};function _e(e){return e?e==="/"?"/":e.endsWith("/")?e:`${e}/`:""}function vn(e,t){var r,s,o;if(typeof t=="string"&&t.trim())return _e(t.trim());const n=((r=e==null?void 0:e.dataset)==null?void 0:r.footerRoot)||((s=e==null?void 0:e.dataset)==null?void 0:s.navRoot);return typeof n=="string"&&n.trim()?_e(n.trim()):_e(Ze((o=window.location)==null?void 0:o.pathname))}function Mn(e,t){var r,s;const n=t||((r=e==null?void 0:e.dataset)==null?void 0:r.footerId)||((s=e==null?void 0:e.dataset)==null?void 0:s.footerPreset)||"home";return gt[n]||gt.home}function wn(e=[],t=""){if(!Array.isArray(e)||e.length===0)return"";const n=_e(t);return e.map(({label:r,href:s,variant:o})=>{if(!r||!s)return"";const i=/^(https?:)?\/\//i.test(s)||s.startsWith("mailto:")||s.startsWith("#")?s:`${n}${s}`,d=["button"];return o==="primary"&&d.push("button--primary"),o==="ghost"&&d.push("button--ghost"),`<a class="${d.join(" ")}" href="${i}">${r}</a>`}).filter(Boolean).join("")}function xt(e=[]){return!Array.isArray(e)||e.length===0?"":e.map(t=>`<p>${t}</p>`).join("")}function jn(e={}){const t=e.target??document.querySelector("[data-site-footer]")??document.querySelector(".site-footer");if(!t)return null;if(t.dataset.footerRendered==="true"||!t.hasAttribute("data-site-footer")&&e.forceRender!==!0)return t;const n=Mn(t,e.preset),r=vn(t,e.rootPrefix),s=n.layoutClass||"footer__layout";let o="",l="",i="",d="";n.useContentBindings?(o='<h2 data-content="contact.title"></h2>',l='<p data-content="contact.body"></p>',i='<div class="footer__actions" data-contact-actions></div>',d='<p data-content="contact.meta"></p>'+xt([$e])):(o=n.heading?`<h2>${n.heading}</h2>`:"",l=n.body?`<p>${n.body}</p>`:"",i=`<div class="footer__actions">${wn(n.actions,r)}</div>`,d=xt(n.meta||[$e]));const h=n.backToTopLabel||"Back to top";return t.innerHTML=`
    <div class="container ${s}">
      <div>
        ${o}
        ${l}
        ${i}
      </div>
      <div class="footer__meta">
        ${d}
      </div>
    </div>
    <a class="back-to-top" href="#top">${h}</a>
  `.trim(),t.classList.add("site-footer"),t.dataset.footerRendered="true",t}function kn(){const e=document.getElementById("year")||document.querySelector("[data-year]");e&&(e.textContent=String(new Date().getFullYear()))}const Qe=["theme","circuitforge-theme"];function En(){if(typeof localStorage>"u")return null;for(const e of Qe){const t=localStorage.getItem(e);if(t==="dark"||t==="light")return t}return null}function Nn(e){typeof localStorage>"u"||Qe.forEach(t=>{try{localStorage.setItem(t,e)}catch(n){console.warn("Unable to store theme preference",n)}})}function Ye(e){const t=e==="light"?"light":"dark";return typeof document>"u"||(document.body.classList.toggle("theme-dark",t==="dark"),document.body.classList.toggle("theme-light",t==="light"),document.documentElement.classList.toggle("dark",t==="dark"),Nn(t)),t}function Ve(e,t){e&&(e.setAttribute("aria-pressed",t==="dark"?"true":"false"),e.innerHTML=t==="dark"?'<span aria-hidden="true">üåô</span>':'<span aria-hidden="true">‚òÄÔ∏è</span>')}function Sn(){const e=En();return e||(typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}function Ln({onChange:e}={}){const t=document.querySelector(".theme-toggle"),n=(t==null?void 0:t.dataset.themeBound)==="true",r=Ye(Sn());Ve(t,r);const s=i=>{typeof e=="function"&&e(i)},o=i=>{if(typeof localStorage<"u"&&localStorage.getItem(Qe[0]))return;const d=Ye(i.matches?"dark":"light");Ve(t,d),s(d)},l=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-color-scheme: dark)"):null;return l&&(typeof l.addEventListener=="function"?l.addEventListener("change",o):typeof l.addListener=="function"&&l.addListener(o)),t&&!n&&(t.dataset.themeBound="true",t.addEventListener("click",()=>{const i=document.body.classList.contains("theme-dark")?"dark":"light",d=Ye(i==="dark"?"light":"dark");Ve(t,d),s(d)})),s(r),r}function St(e){if(!e||!e.getBoundingClientRect)return;const{height:t}=e.getBoundingClientRect();Number.isFinite(t)&&t>0&&(document.documentElement.style.setProperty("--nav-height",`${t}px`),document.documentElement.style.setProperty("--header-h",`${t}px`))}function Pn(e){if(!e)return;const t=()=>St(e);if(typeof ResizeObserver<"u"){const n=new ResizeObserver(t);return n.observe(e),n}return window.addEventListener("resize",t),null}function et(e){var t;return typeof e=="string"&&e.trim()?e.trim():typeof document<"u"?Ze((t=window.location)==null?void 0:t.pathname):""}function Tn(e={}){const t=e.target??document.getElementById("site-header")??document.querySelector("[data-site-header]");if(!t)return null;const n=e.pageId||e.currentLab||t.dataset.currentLab,r=et(e.rootPrefix||t.dataset.navRoot),s=e.showEditToggle??t.dataset.showEditToggle==="true",o=e.useLocalAnchors??n==="home";t.id="top",t.dataset.siteHeader="true",t.dataset.currentLab=n||"",t.dataset.navRoot=r||"";const l=Nt({target:t,currentLab:n,rootPrefix:r,useLocalAnchors:o,showEditToggle:s}),i=(l==null?void 0:l.closest("[data-site-header]"))||t;return St(i),Pn(i),i}function Rn(e={}){const t=e.target??document.getElementById("site-footer")??document.querySelector("[data-site-footer]");if(!t)return null;const n=e.pageId||e.preset||t.dataset.footerId,r=et(e.rootPrefix||t.dataset.footerRoot);t.dataset.siteFooter="true",t.dataset.footerId=n||"home",t.dataset.footerRoot=r||"";const s=jn({target:t,preset:n||"home",rootPrefix:r});return s&&kn(),s}function Cn(e="home",t={}){var s,o;const n=e||((o=(s=document.body)==null?void 0:s.dataset)==null?void 0:o.currentLab)||"home",r=et(t.rootPrefix);Tn({pageId:n,rootPrefix:r,showEditToggle:t.showEditToggle,useLocalAnchors:t.useLocalAnchors}),Ln(t.themeOptions||{}),n!=="circuit-lab"&&Rn({pageId:n,rootPrefix:r})}Cn("fourier-epicycles");let yt=!1,Ge=!1;function In(){if(Ge)return;const t=Nt()??document.querySelector(".nav"),n=(t==null?void 0:t.querySelector(".nav-toggle"))??document.querySelector(".nav-toggle"),r=(t==null?void 0:t.querySelector(".nav-links"))??document.querySelector(".nav-links");if(!t||!n||!r)return;if(t.dataset.navEnhanced==="true"){Ge=!0;return}const s=document.body,o=Array.from(t.querySelectorAll(".nav-item--dropdown")),l=[],i=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(hover: none)"):null,d=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(hover: hover)"):null,h=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(pointer: fine)"):null,c=()=>{const f=(i==null?void 0:i.matches)??!1,m=(d==null?void 0:d.matches)??!1,p=(h==null?void 0:h.matches)??!1;return f||!m||!p},g=({except:f}={})=>{let m=!1;return l.forEach(p=>{p!==f&&p.isOpen()&&(p.close(),m=!0)}),m};if(o.forEach(f=>{const m=f.querySelector(".nav-dropdown-toggle"),p=f.querySelector(".nav-dropdown-menu");if(!(m instanceof HTMLElement)||!(p instanceof HTMLElement))return;let v=null;const j=()=>{v!==null&&(window.clearTimeout(v),v=null)},k=()=>{c()||(j(),v=window.setTimeout(()=>{!f.matches(":hover")&&!p.matches(":hover")&&!m.matches(":hover")&&x.close()},220))},x={wrapper:f,toggle:m,menu:p,isOpen:()=>m.getAttribute("aria-expanded")==="true",open:()=>{m.setAttribute("aria-expanded","true"),f.setAttribute("data-open","true"),p.hidden=!1,j()},close:()=>{m.setAttribute("aria-expanded","false"),f.setAttribute("data-open","false"),p.hidden=!0,j()}};x.close(),l.push(x);const w=()=>{g({except:x}),x.open()},P=()=>{c()||(j(),w())},I=()=>{c()||k()};f.addEventListener("pointerenter",P),f.addEventListener("pointerleave",I),m.addEventListener("pointerenter",P),m.addEventListener("pointerleave",I),p.addEventListener("pointerenter",P),p.addEventListener("pointerleave",I),f.addEventListener("focusin",N=>{const T=N.target;c()&&T instanceof HTMLElement&&!T.matches(":focus-visible")||w()}),f.addEventListener("focusout",N=>{const T=N.relatedTarget;(!(T instanceof Node)||!f.contains(T))&&x.close()}),m.addEventListener("click",N=>{c()&&(N.preventDefault(),N.stopPropagation(),x.isOpen()?x.close():w())}),m.addEventListener("keydown",N=>{if(N.key==="ArrowDown"){N.preventDefault(),x.isOpen()||w();const T=p.querySelector("a");T instanceof HTMLElement&&T.focus()}else N.key==="Escape"&&x.close()}),p.addEventListener("click",N=>{N.target instanceof HTMLAnchorElement&&g()}),p.addEventListener("keydown",N=>{N.key==="Escape"&&(N.stopPropagation(),x.close(),m.focus())})}),i){const f=()=>{g()};typeof i.addEventListener=="function"?i.addEventListener("change",f):typeof i.addListener=="function"&&i.addListener(f)}window.addEventListener("resize",()=>{g()}),l.length>0&&!yt&&(document.addEventListener("pointerdown",f=>{const m=f.target;m instanceof Node&&l.some(({wrapper:p})=>p.contains(m))||g()}),document.addEventListener("keydown",f=>{f.key==="Escape"&&g()}),yt=!0),n&&(n.addEventListener("click",()=>{const f=n.getAttribute("aria-expanded")==="true";g(),n.setAttribute("aria-expanded",String(!f)),r==null||r.setAttribute("data-visible",String(!f)),s.classList.toggle("nav-open",!f)}),window.addEventListener("keydown",f=>{f.key==="Escape"&&n.getAttribute("aria-expanded")==="true"&&(n.setAttribute("aria-expanded","false"),r==null||r.setAttribute("data-visible","false"),s.classList.remove("nav-open"),g(),n.focus())}),window.addEventListener("resize",()=>{window.innerWidth>=720&&(n.setAttribute("aria-expanded","false"),r==null||r.setAttribute("data-visible","false"),s.classList.remove("nav-open"),g())})),r==null||r.addEventListener("click",f=>{f.target instanceof HTMLAnchorElement&&(n==null||n.setAttribute("aria-expanded","false"),r.setAttribute("data-visible","false"),s.classList.remove("nav-open"),g())}),t.dataset.navEnhanced="true",Ge=!0}const bt=()=>In();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",bt,{once:!0}):bt();const An=e=>{const t=[],n=e.length;for(let r=0;r<n;r++){let s=0,o=0;for(let h=0;h<n;h++){const c=Math.PI*2*r*h/n,g=Math.cos(c),f=Math.sin(c),m=e[h].re,p=e[h].im;s+=m*g+p*f,o+=p*g-m*f}s=s/n,o=o/n;const l=r>n/2?r-n:r,i=Math.sqrt(s*s+o*o),d=Math.atan2(o,s);t.push({re:s,im:o,freq:l,amp:i,phase:d})}return t.sort((r,s)=>s.amp-r.amp)},_n=(e,t)=>{if(t<=0||e.length<2)return[...e];const n=[];for(let r=0;r<e.length;r++){let s=0,o=0,l=0;for(let i=-t;i<=t;i++){const d=r+i;d>=0&&d<e.length&&(s+=e[d].x,o+=e[d].y,l++)}n.push({x:s/l,y:o/l})}return n},Fn=()=>{const e=[];for(let r=0;r<50;r++)e.push({x:-200+r*2*200/50,y:-200});for(let r=0;r<50;r++)e.push({x:200,y:-200+r*2*200/50});for(let r=0;r<50;r++)e.push({x:200-r*2*200/50,y:200});for(let r=0;r<50;r++)e.push({x:-200,y:200-r*2*200/50});return e},$n=()=>{const e=[];for(let r=0;r<200;r++){const s=Math.PI*2*r/200;e.push({x:200*Math.cos(s),y:200*Math.sin(s)})}return e},zn=()=>{const e=[];for(let n=0;n<300;n++){const r=Math.PI*2*n/300,s=16*Math.pow(Math.sin(r),3),o=-(13*Math.cos(r)-5*Math.cos(2*r)-2*Math.cos(3*r)-Math.cos(4*r));e.push({x:s*15,y:o*15})}return e},Dn=()=>{const e=[];for(let r=0;r<300;r++){const s=Math.PI*2*r/300,o=150*Math.cos(s),l=150*Math.sin(s)*Math.cos(s);e.push({x:o,y:l})}return e},On=()=>{const e=[];for(let n=0;n<100;n++){const r=Math.PI*2*n/100;e.push({x:40*Math.cos(r)-50,y:30*Math.sin(r)+100})}for(let n=0;n<20;n++)e.push({x:-10,y:100-200*n/20});for(let n=0;n<30;n++){const r=n/30;e.push({x:-10+50*Math.sin(r*Math.PI),y:-100+50*r})}for(let n=0;n<20;n++)e.push({x:-10,y:-50+150*n/20});return e},qn={threshold:30,sampleRate:2,maxPoints:1500,smoothingWindow:4,blurRadius:1,morphRadius:2,detail:.9},Un=e=>{if(e.length===0)return[];const t=[],n=new Set;let r=0;for(t.push(e[0]),n.add(0);t.length<e.length;){let s=1/0,o=-1;const l=e[r];for(let i=0;i<e.length;i++)if(!n.has(i)){const d=e[i],h=(l.x-d.x)**2+(l.y-d.y)**2;h<s&&(s=h,o=i)}if(o!==-1)n.add(o),t.push(e[o]),r=o;else break}return t},ce=(e,t,n)=>Math.max(t,Math.min(n,e)),Bn=e=>Math.max(0,Math.min(1,e)),ve=(e,t,n)=>e+(t-e)*n,Hn=(e,t,n,r)=>{const s=Math.max(1,Math.floor(r||1)),o=Math.max(1,Math.floor(t/s)),l=Math.max(1,Math.floor(n/s)),i=new Uint8Array(o*l);for(let d=0;d<l;d++){const h=ce(d*s,0,n-1);for(let c=0;c<o;c++){const g=ce(c*s,0,t-1),f=(h*t+g)*4,m=e[f]??0,p=e[f+1]??0,v=e[f+2]??0;i[d*o+c]=Math.round(.2126*m+.7152*p+.0722*v)}}return{gray:i,w:o,h:l,step:s}},Wn=(e,t,n,r)=>{const s=Math.max(1,Math.floor(r||1)),o=new Uint8Array(e.length);for(let l=0;l<n;l++)for(let i=0;i<t;i++){let d=0;for(let h=-s;h<=s&&!d;h++){const c=l+h;if(!(c<0||c>=n))for(let g=-s;g<=s;g++){const f=i+g;if(!(f<0||f>=t)&&e[c*t+f]){d=1;break}}}o[l*t+i]=d}return o},Xn=(e,t,n,r)=>{const s=Math.max(1,Math.floor(r||1)),o=new Uint8Array(e.length);for(let l=0;l<n;l++)for(let i=0;i<t;i++){let d=1;for(let h=-s;h<=s&&d;h++){const c=l+h;if(c<0||c>=n){d=0;break}for(let g=-s;g<=s;g++){const f=i+g;if(f<0||f>=t||!e[c*t+f]){d=0;break}}}o[l*t+i]=d}return o},Yn=(e,t,n,r)=>{const s=Math.max(1,Math.floor(r||1));return Xn(Wn(e,t,n,s),t,n,s)},Vn=(e,t)=>{const n=Math.max(0,Math.floor(t||0));if(n<=0||e.length<3)return e;const r=[],s=e.length;for(let o=0;o<s;o++){let l=0,i=0,d=0;for(let h=-n;h<=n;h++){const c=(o+h+s)%s;l+=e[c].x,i+=e[c].y,d++}r.push({x:l/d,y:i/d})}return r},ke=e=>{if(e.length<2)return e;const t=e[0],n=e[e.length-1];return t.x===n.x&&t.y===n.y?e:[...e,{...t}]},Gn=(e,t,n)=>{if(t<3||n<3)return new Uint8Array(e.length);const r=new Uint16Array(e.length),s=new Uint32Array(1025);for(let c=1;c<n-1;c++)for(let g=1;g<t-1;g++){const f=c*t+g,m=e[f-t-1],p=e[f-t],v=e[f-t+1],j=e[f-1],k=e[f+1],x=e[f+t-1],w=e[f+t],P=e[f+t+1],I=-m+v-2*j+2*k-x+P,N=-m-2*p-v+x+2*w+P,T=Math.min(1024,Math.abs(I)+Math.abs(N));r[f]=T,s[T]++}const o=(t-2)*(n-2);let l=Math.floor(o*.08);l=ce(l,50,o);let i=0,d=1024;for(let c=1024;c>=0;c--)if(i+=s[c],i>=l){d=c;break}const h=new Uint8Array(e.length);for(let c=0;c<r.length;c++)h[c]=r[c]>=d&&r[c]>0?1:0;return h},Kn=e=>{let t=0;for(let n=0;n<e.length;n++)t+=e[n]?1:0;return t},Jn=e=>{const t=Math.max(.01,e),n=Math.max(1,Math.ceil(3*t)),r=n*2+1,s=new Float32Array(r),o=2*t*t;let l=0;for(let i=-n;i<=n;i++){const d=Math.exp(-(i*i)/o);s[i+n]=d,l+=d}if(l>0)for(let i=0;i<s.length;i++)s[i]/=l;return s},vt=(e,t,n,r)=>{const s=t*n,o=Math.max(0,r);if(s===0)return new Float32Array(0);if(o<=.01){const c=new Float32Array(s);for(let g=0;g<s;g++)c[g]=e[g];return c}const l=Jn(o),i=(l.length-1)/2,d=new Float32Array(s),h=new Float32Array(s);for(let c=0;c<n;c++){const g=c*t;for(let f=0;f<t;f++){let m=0;for(let p=-i;p<=i;p++){const v=ce(f+p,0,t-1);m+=l[p+i]*(e[g+v]??0)}d[g+f]=m}}for(let c=0;c<n;c++){const g=c*t;for(let f=0;f<t;f++){let m=0;for(let p=-i;p<=i;p++){const v=ce(c+p,0,n-1);m+=l[p+i]*(d[v*t+f]??0)}h[g+f]=m}}return h},Zn=(e,t,n,r,s)=>{const o=t*n;if(t<3||n<3||o===0)return new Uint8Array(o);const l=Math.min(t,n),i=Math.max(.35,s||1),d=ve(2.4,.7,r)*i,h=Math.max(.35,l/4),c=Math.min(Math.max(.35,d),h),g=Math.min(Math.max(c*1.6,c+.15),h*1.6),f=vt(e,t,n,c),m=vt(e,t,n,g),p=new Float32Array(o);for(let S=0;S<o;S++)p[S]=f[S]-m[S];const v=new Uint16Array(o),j=new Uint32Array(1025);let k=0;const x=4,w=[-t-1,-t,-t+1,-1,1,t-1,t,t+1];for(let S=1;S<n-1;S++){const $=S*t;for(let z=1;z<t-1;z++){const Y=$+z,D=p[Y],Z=D>=0;let F=0;for(let G=0;G<w.length;G++){const ue=Y+w[G],ye=p[ue];if(ye>=0===Z)continue;const oe=Math.abs(D-ye);oe>F&&(F=oe)}if(F>0){const G=ce(Math.round(F*x),0,1024);v[Y]=G,j[G]++,k++}}}if(k===0)return new Uint8Array(o);const P=ve(.02,.08,r),I=ce(Math.floor(k*P),1,k);let N=0,T=1024;for(let S=1024;S>=1;S--)if(N+=j[S],N>=I){T=S;break}const A=ve(.6,.22,r),V=Math.max(1,Math.floor(T*A)),_=new Uint8Array(o),X=[];for(let S=0;S<o;S++)v[S]>=T&&(_[S]=1,X.push(S));const C=[1,1,0,-1,-1,-1,0,1],R=[0,1,1,1,0,-1,-1,-1];for(;X.length;){const S=X.pop(),$=S%t,z=(S-$)/t;for(let Y=0;Y<8;Y++){const D=$+C[Y],Z=z+R[Y];if(D<0||D>=t||Z<0||Z>=n)continue;const F=Z*t+D;_[F]||v[F]>=V&&(_[F]=1,X.push(F))}}return _},Qn=(e,t,n)=>{const r=[1,1,0,-1,-1,-1,0,1],s=[0,1,1,1,0,-1,-1,-1],o=[4,5,6,7,0,1,2,3],l=new Uint8Array(e.length),i=[];for(let m=0;m<e.length;m++){if(!e[m])continue;const p=m%t,v=(m-p)/t;let j=0;for(let k=0;k<8;k++){const x=p+r[k],w=v+s[k];x<0||x>=t||w<0||w>=n||e[w*t+x]&&j++}l[m]=j,j>0&&i.push(m)}const d=new Uint8Array(e.length),h=[],c=(m,p)=>{const v=m%t,j=(m-v)/t,k=v+r[p],x=j+s[p];if(k<0||k>=t||x<0||x>=n)return-1;const w=x*t+k;return e[w]?w:-1},g=(m,p,v)=>{d[m]|=1<<p,d[v]|=1<<o[p]},f=(m,p,v)=>{const j=c(m,p);if(j<0)return[];const k=[m];let x=p,w=j;g(m,p,w),k.push(w);const P=t*n*2;for(let I=0;I<P;I++){const N=l[w];if(v&&N!==2)break;const T=o[x];let A=-1;for(let _=0;_<8;_++){if(_===T)continue;if(c(w,_)>=0){A=_;break}}if(A<0||d[w]&1<<A)break;const V=c(w,A);if(V<0||(g(w,A,V),w=V,x=A,k.push(w),!v&&w===m))break}return k};for(const m of i){const p=l[m];if(!(p===0||p===2))for(let v=0;v<8;v++){if(c(m,v)<0||d[m]&1<<v)continue;const k=f(m,v,!0);k.length>1&&h.push(k)}}for(const m of i)for(let p=0;p<8;p++){if(c(m,p)<0||d[m]&1<<p)continue;const j=f(m,p,!1);j.length>1&&(j[0]===j[j.length-1]?h.push(j):h.push([...j,j[0]]))}return h},es=(e,t,n,r,s)=>{const o=e%t,l=(e-o)/t;return{x:o*n-r/2,y:l*n-s/2}},Ke=e=>{if(e.length===0)return[];const t=[e[0]];for(let n=1;n<e.length;n++){const r=t[t.length-1],s=e[n];(r.x!==s.x||r.y!==s.y)&&t.push(s)}return t},Mt=(e,t)=>{if(e.length<3||t<=0)return e;const n=t*t,r=new Uint8Array(e.length);r[0]=1,r[e.length-1]=1;const s=(i,d,h)=>{const c=h.x-d.x,g=h.y-d.y,f=i.x-d.x,m=i.y-d.y,p=c*f+g*m;if(p<=0)return f*f+m*m;const v=c*c+g*g;if(v<=p){const I=i.x-h.x,N=i.y-h.y;return I*I+N*N}const j=p/v,k=d.x+j*c,x=d.y+j*g,w=i.x-k,P=i.y-x;return w*w+P*P},o=[[0,e.length-1]];for(;o.length;){const[i,d]=o.pop();let h=0,c=-1;const g=e[i],f=e[d];for(let m=i+1;m<d;m++){const p=s(e[m],g,f);p>h&&(h=p,c=m)}c!==-1&&h>n&&(r[c]=1,o.push([i,c],[c,d]))}const l=[];for(let i=0;i<e.length;i++)r[i]&&l.push(e[i]);return l},ts=(e,t)=>{if(e.length===0)return[];const n=[...e].sort((l,i)=>i.length-l.length);let r=[...n.shift()];const s=(l,i)=>{const d=l.x-i.x,h=l.y-i.y;return d*d+h*h},o=ce(Math.round(ve(2,10,t)),2,12);for(;n.length;){const l=r[r.length-1];let i=0,d=!1,h=1/0;for(let v=0;v<n.length;v++){const j=n[v],k=s(l,j[0]),x=s(l,j[j.length-1]);k<h&&(h=k,i=v,d=!1),x<h&&(h=x,i=v,d=!0)}const c=n.splice(i,1)[0];d&&c.reverse();const g=c[0],f=g.x-l.x,m=g.y-l.y;if(Math.hypot(f,m)>1e-6)for(let v=1;v<=o;v++){const j=v/(o+1);r.push({x:l.x+f*j,y:l.y+m*j})}r[r.length-1].x===g.x&&r[r.length-1].y===g.y?r.push(...c.slice(1)):r.push(...c)}return r},ns=(e,t)=>{const n=Math.max(8,Math.floor(t)),r=ke(Ke(e));if(r.length<4)return r;const s=r.slice(0,-1),o=s.length,l=new Float64Array(o);let i=0;for(let x=0;x<o;x++){const w=s[x],P=s[(x+1)%o],I=Math.hypot(P.x-w.x,P.y-w.y);l[x]=I,i+=I}if(!Number.isFinite(i)||i<=0)return ke(s);const d=i/n,h=[{...s[0]}];let c=0,g=s[0],f=s[1%o],m=l[0],p=0,v=d;const j=n*(o+4);let k=0;for(;h.length<n&&k++<j;){if(m===0){c=(c+1)%o,g=s[c],f=s[(c+1)%o],m=l[c];continue}if(p+m>=v-1e-9){const x=(v-p)/m;h.push({x:g.x+(f.x-g.x)*x,y:g.y+(f.y-g.y)*x}),v+=d}else p+=m,c=(c+1)%o,g=s[c],f=s[(c+1)%o],m=l[c]}return h.length>n&&(h.length=n),ke(h)},ss=(e,t,n,r={})=>{const s={...qn,...r},o=Bn(s.detail),l=typeof r.sampleRate=="number"?Math.max(1,Math.floor(s.sampleRate)):o>=.88?1:o>=.55?2:3,i=Math.max(200,Math.floor(s.maxPoints)),d=Math.max(0,Math.floor(s.smoothingWindow)),h=Math.max(0,Math.floor(s.blurRadius)),c=Math.max(0,Math.floor(s.morphRadius)),g=Math.max(1,Math.floor(s.threshold)),{gray:f,w:m,h:p,step:v}=Hn(e,t,n,l),j=f;let k=Zn(j,m,p,o,h);Kn(k)<Math.max(10,Math.floor(m*p*.001))&&(k=Gn(j,m,p)),c>0&&(k=Yn(k,m,p,c));const x=Qn(k,m,p),w=ce(Math.round(ve(40,10,o)),6,80),P=ve(6,1.2,o)*v,I=x.filter(C=>C.length>=w).map(C=>C.map(R=>es(R,m,v,t,n))).map(C=>{const R=Ke(C);if(R.length>2&&R[0].x===R[R.length-1].x&&R[0].y===R[R.length-1].y){const $=R.slice(0,-1);return ke(Mt($,P))}return Mt(R,P)}).filter(C=>C.length>=2);if(I.length>0){const C=ts(I,o),R=ke(Ke(C)),S=d>0?Vn(R,d):R,$=ce(Math.round(ve(400,i,o)),120,i);return ns(S,$)}const N=[],T=C=>(e[C]+e[C+1]+e[C+2])/3;for(let C=0;C<n;C+=l)for(let R=0;R<t;R+=l){if(R<=0||C<=0)continue;const S=(C*t+R)*4,$=(C*t+(R-1))*4,z=((C-1)*t+R)*4,Y=T(S),D=T($),Z=T(z);Math.abs(Y-D)+Math.abs(Y-Z)>g&&N.push({x:R-t/2,y:C-n/2})}if(N.length===0)return[];const A=N.length>i?Math.ceil(N.length/i):1,V=A===1?N:N.filter((C,R)=>R%A===0),_=Un(V),X=[];for(let C=0;C<_.length;C++){let R=0,S=0,$=0;for(let z=-d;z<=d;z++){const Y=(C+z+_.length)%_.length;R+=_[Y].x,S+=_[Y].y,$++}X.push({x:R/$,y:S/$})}return ke(X)},wt=async(e,t=900,n={})=>new Promise((r,s)=>{const o=new Image,l=URL.createObjectURL(e);o.onload=()=>{const i=document.createElement("canvas"),d=i.getContext("2d");if(!d){s(new Error("Could not get canvas context"));return}let h=o.width,c=o.height;const g=Math.max(h,c),f=t&&t>0?t:900;if(g>f){const v=f/g;h=Math.round(h*v),c=Math.round(c*v)}i.width=h,i.height=c,d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.drawImage(o,0,0,h,c);const m=d.getImageData(0,0,h,c),p=ss(m.data,h,c,n);URL.revokeObjectURL(l),r(p)},o.onerror=i=>s(i),o.src=l}),tt=1500,rs=300,os=600,as=e=>e.map(t=>({re:t.x,im:t.y})),is=e=>e&&e>0?e:tt,nt=(e,t)=>Math.hypot(e.x-t.x,e.y-t.y),st=(e,t,n)=>Math.max(t,Math.min(n,Math.round(e))),ls=e=>{let t=1/0,n=1/0,r=-1/0,s=-1/0;for(const o of e)o.x<t&&(t=o.x),o.y<n&&(n=o.y),o.x>r&&(r=o.x),o.y>s&&(s=o.y);return!Number.isFinite(t)||!Number.isFinite(n)||!Number.isFinite(r)||!Number.isFinite(s)?0:Math.hypot(r-t,s-n)},cs=e=>{if(e.length<3)return!1;const t=e[0],n=e[e.length-1],r=ls(e),s=Math.max(10,r*.04);return nt(t,n)<=s},us=(e,t=.25)=>{if(e.length<2)return[...e];const n=[e[0]];for(let r=1;r<e.length;r++){const s=n[n.length-1],o=e[r];nt(s,o)>=t&&n.push(o)}return n},ds=(e,t,n)=>{const r=e.length;if(r===0)return[];if(r===1)return[{...e[0]}];const s=st(t,2,1e4),o=n?r:r-1,l=new Array(o);let i=0;for(let g=0;g<o;g++){const f=e[g],m=e[(g+1)%r],p=nt(f,m);l[g]=p,i+=p}if(i<=0)return Array.from({length:s},()=>({...e[0]}));const d=i/(n?s:s-1),h=[],c=g=>{let f=0,m=0;for(;f<o-1&&m+l[f]<g;)m+=l[f],f++;const p=e[f],v=e[(f+1)%r],j=l[f]||1,k=Math.max(0,Math.min(1,(g-m)/j));return{x:p.x+(v.x-p.x)*k,y:p.y+(v.y-p.y)*k}};if(n){for(let g=0;g<s;g++)h.push(c(d*g));return h}h.push({...e[0]});for(let g=1;g<s-1;g++)h.push(c(d*g));return h.push({...e[r-1]}),h},fs=(e,t)=>{if(t<=0||e.length<2)return[...e];const n=e.length,r=st(t,1,Math.floor(n/2)),s=[];for(let o=0;o<n;o++){let l=0,i=0,d=0;for(let h=-r;h<=r;h++){const c=(o+h+n)%n;l+=e[c].x,i+=e[c].y,d++}s.push({x:l/d,y:i/d})}return s},hs=(e,t,n=tt)=>{const r=is(n),s=us(e);if(s.length===0)return[];const o=cs(s),l=o?os:rs,i=Math.min(r,Math.max(s.length,l)),d=ds(s,i,o),h=t>0?st(t,0,999):0;return o?fs(d,h):_n(d,h)},ms=(e,t={})=>{const{smoothing:n=0,limit:r=tt}=t,s=hs(e,n,r),o=An(as(s));return{prepared:s,spectrum:o}},ps=(e,t,n,r=600)=>{if(!e.length||!t.length)return{energyPct:0,rmsError:0,topTerms:[],breakdown:[]};const s=e.map(x=>x.amp*x.amp),o=s.reduce((x,w)=>x+w,0)||1,l=Math.max(Math.min(n||e.length,e.length),1),i=s.slice(0,l).reduce((x,w)=>x+w,0);let d=0;const h=s.map(x=>(d+=x,{energyPct:x/o*100,cumulativePct:d/o*100}));let c=0;const g=e.slice(0,6).map((x,w)=>{const P=s[w];return c+=P,{freq:x.freq,amp:x.amp,phase:x.phase,energyPct:P/o*100,cumulativePct:c/o*100}}),f=t.length,m=Math.max(1,Math.floor(f/r)),p=e.slice(0,l);let v=0,j=0;for(let x=0;x<f;x+=m){let w=0,P=0;for(let T=0;T<p.length;T++){const A=p[T],V=2*Math.PI*A.freq*x/f,_=Math.cos(V),X=Math.sin(V);w+=A.re*_-A.im*X,P+=A.re*X+A.im*_}const I=w-t[x].x,N=P-t[x].y;v+=I*I+N*N,j++}const k=Math.sqrt(v/Math.max(j,1));return{energyPct:Number((i/o*100).toFixed(2)),rmsError:Number(k.toFixed(2)),topTerms:g,breakdown:h}},gs=e=>Math.min(1,Math.max(0,e)),xs=(e,t)=>!isFinite(e)||t<=0?0:gs(e/t),Fe=(e,t,n=!1)=>{const r=xs(e,t),s=210+110*r,o=n?62:48+6*r,l=n?.95:.6;return`hsla(${s.toFixed(1)}, 82%, ${o.toFixed(1)}%, ${l})`},ys=e=>`linear-gradient(90deg, ${Fe(0,e)} 0%, ${Fe(e*.5,e)} 50%, ${Fe(e,e,!0)} 100%)`,bs=(e,t,n)=>Fe(e.amp,t,n),vs=({mode:e,setMode:t,isPlaying:n,setIsPlaying:r,clear:s,numEpicycles:o,maxEpicycles:l,setNumEpicycles:i,onUpload:d,showMath:h,setShowMath:c,onPreset:g,speed:f,setSpeed:m,onReset:p,brushColor:v,setBrushColor:j,brushSize:k,setBrushSize:x,smoothing:w,setSmoothing:P,outlineDetail:I,setOutlineDetail:N,isDrawing:T,onSave:A,onLoad:V,savedDrawings:_,isFullscreen:X,onToggleFullscreen:C,safeMode:R,onToggleSafeMode:S,stepMode:$,onToggleStepMode:z,stepIndex:Y,stepMax:D,onStepPrev:Z,onStepNext:F,onStepPlayOnce:G})=>{const ue=y.useRef(null),ye=y.useRef(null),oe=y.useRef(null),[me,K]=y.useState(null),[ae,pe]=y.useState(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return!0;const E=window.matchMedia("(hover: none)").matches,O=window.matchMedia("(hover: hover)").matches,B=window.matchMedia("(pointer: fine)").matches;return E||!O||!B});y.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const E=window.matchMedia("(hover: none)"),O=window.matchMedia("(hover: hover)"),B=window.matchMedia("(pointer: fine)"),ne=()=>{const H=E.matches,be=O.matches,Ee=B.matches;pe(H||!be||!Ee)},de=H=>{typeof H.addEventListener=="function"?H.addEventListener("change",ne):typeof H.addListener=="function"&&H.addListener(ne)},se=H=>{typeof H.removeEventListener=="function"?H.removeEventListener("change",ne):typeof H.removeListener=="function"&&H.removeListener(ne)};return de(E),de(O),de(B),ne(),()=>{se(E),se(O),se(B)}},[]),y.useEffect(()=>{if(!me)return;const E=B=>{var de,se;const ne=B.target;ne instanceof Node&&((de=ye.current)!=null&&de.contains(ne)||(se=oe.current)!=null&&se.contains(ne)||K(null))},O=B=>{B.key==="Escape"&&K(null)};return document.addEventListener("pointerdown",E),document.addEventListener("keydown",O),()=>{document.removeEventListener("pointerdown",E),document.removeEventListener("keydown",O)}},[me]);const ie=y.useCallback(E=>{K(O=>O===E?null:E)},[]),te=E=>`
    p-2.5 rounded-lg transition-all duration-200 flex items-center justify-center
    ${E?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50 shadow-[0_0_15px_rgba(6,182,212,0.3)]":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 hover:text-slate-200 border border-transparent"}
  `;return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"fourier-toolbar fourier-toolbar--top",children:[a.jsxs("div",{className:"flex gap-1 mr-4 pl-2",children:[a.jsx(Yt,{className:"w-5 h-5 text-fuchsia-500"}),a.jsxs("span",{className:"font-bold text-slate-100 hidden sm:block",children:["Fourier",a.jsx("span",{className:"text-fuchsia-500",children:"Viz"})]})]}),a.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),a.jsx("button",{onClick:()=>t("DRAW"),className:te(e==="DRAW"),title:"Freehand Draw",children:a.jsx(Vt,{size:20})}),a.jsxs("div",{className:"relative",ref:ye,onPointerEnter:()=>{ae||K("presets")},onPointerLeave:()=>{ae||K(E=>E==="presets"?null:E)},children:[a.jsx("button",{type:"button",className:te(e==="PRESET"),title:"Presets","aria-expanded":me==="presets","aria-controls":"fourier-presets-menu",onClick:()=>ie("presets"),children:a.jsx(Gt,{size:20})}),a.jsxs("div",{id:"fourier-presets-menu",role:"menu",style:{display:me==="presets"?"block":"none"},className:"absolute top-full left-0 w-32 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden z-50",children:[a.jsx("button",{type:"button",role:"menuitem",onClick:()=>{g("circle"),K(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Circle"}),a.jsx("button",{type:"button",role:"menuitem",onClick:()=>{g("square"),K(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Square"}),a.jsx("button",{type:"button",role:"menuitem",onClick:()=>{g("heart"),K(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Heart"}),a.jsx("button",{type:"button",role:"menuitem",onClick:()=>{g("infinity"),K(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Infinity"}),a.jsx("button",{type:"button",role:"menuitem",onClick:()=>{g("note"),K(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Note"})]})]}),a.jsxs("div",{className:"relative",ref:oe,onPointerEnter:()=>{ae||K("load")},onPointerLeave:()=>{ae||K(E=>E==="load"?null:E)},children:[a.jsx("button",{type:"button",className:te(!1),title:"Load Saved Drawing","aria-expanded":me==="load","aria-controls":"fourier-load-menu",onClick:()=>ie("load"),children:a.jsx(Kt,{size:20})}),a.jsx("div",{id:"fourier-load-menu",role:"menu",style:{display:me==="load"?"block":"none"},className:"absolute top-full left-0 w-48 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden max-h-60 overflow-y-auto custom-scrollbar z-50",children:_.length===0?a.jsx("div",{className:"px-4 py-2 text-sm text-slate-500 italic",children:"No saved drawings"}):_.map(E=>a.jsx("button",{type:"button",role:"menuitem",onClick:()=>{V(E),K(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400 truncate border-b border-slate-800 last:border-0",children:E},E))})]}),a.jsx("button",{onClick:A,className:te(!1),title:"Save Current Drawing",children:a.jsx(Jt,{size:20})}),a.jsx("button",{onClick:()=>{var E;return(E=ue.current)==null?void 0:E.click()},className:te(e==="UPLOAD"),title:"Upload Image",children:a.jsx(Zt,{size:20})}),a.jsx("input",{type:"file",ref:ue,onChange:d,accept:"image/*",className:"hidden"}),a.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),a.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-lg transition-all duration-300 ${T?"bg-fuchsia-900/20 ring-1 ring-fuchsia-500/50":""}`,children:[a.jsxs("div",{className:"relative flex items-center group",title:"Brush Color",children:[a.jsx(Qt,{size:18,className:`${T?"text-fuchsia-400":"text-slate-400"} mr-2 transition-colors`}),a.jsx("input",{type:"color",value:v,onChange:E=>j(E.target.value),className:"w-6 h-6 rounded border-none cursor-pointer bg-transparent"})]}),a.jsxs("div",{className:"flex items-center gap-2",title:"Brush Size",children:[a.jsx(mt,{size:10,className:"text-slate-400"}),a.jsx("input",{type:"range",min:"1",max:"10",step:"0.5",value:k,onChange:E=>x(parseFloat(E.target.value)),className:"w-16 h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-slate-400"}),a.jsx(mt,{size:16,className:`text-slate-400 transition-all ${T?"scale-110 text-fuchsia-300":""}`})]})]}),a.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),a.jsx("button",{onClick:s,className:"p-2.5 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors",title:"Clear Canvas",children:a.jsx(en,{size:20})}),a.jsx("button",{onClick:()=>c(!h),className:te(h),title:"Toggle Math Panel",children:a.jsx(tn,{size:20})}),a.jsx("button",{onClick:S,className:te(R),title:"Toggle safe mode (cap epicycles / lighten rendering)",children:a.jsx(nn,{size:20})}),a.jsx("button",{onClick:z,className:te($),title:"Toggle step-through playback",children:a.jsx(pt,{size:20})}),a.jsx("button",{onClick:C,className:te(X),title:X?"Exit Fullscreen":"Fullscreen Play",children:X?a.jsx(sn,{size:20}):a.jsx(rn,{size:20})})]}),a.jsx("div",{className:"fourier-toolbar fourier-toolbar--bottom",children:a.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:p,className:"p-3 rounded-full bg-slate-800 text-slate-300 hover:bg-slate-700 hover:text-white transition-all",title:"Reset Animation",children:a.jsx(on,{size:18})}),a.jsx("button",{onClick:()=>r(!n),className:"w-14 h-14 flex items-center justify-center rounded-full bg-cyan-500 text-slate-950 hover:bg-cyan-400 transition-all shadow-[0_0_20px_rgba(6,182,212,0.4)]",children:n?a.jsx(an,{fill:"currentColor",size:24}):a.jsx(ln,{fill:"currentColor",className:"ml-1",size:24})}),$&&a.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/70 rounded-full px-3 py-2 border border-slate-700",children:[a.jsx("button",{onClick:Z,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Previous term",children:a.jsx(cn,{size:16})}),a.jsx("button",{onClick:G,className:"px-3 py-2 rounded-full bg-amber-400 text-slate-900 font-semibold hover:bg-amber-300 transition",title:"Play this term once",children:"Step"}),a.jsx("button",{onClick:F,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Next term",children:a.jsx(un,{size:16})}),a.jsxs("span",{className:"text-xs text-slate-300 font-semibold ml-1",children:["Term ",Y+1," / ",Math.max(D,1)]})]})]}),a.jsxs("div",{className:"flex-1 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 w-full",children:[a.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[a.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[a.jsx("span",{children:"Precision"}),a.jsxs("span",{className:"text-cyan-400",children:[o," / ",l,R?" (capped)":""]})]}),a.jsx("input",{type:"range",min:"1",max:l||1,value:o,onChange:E=>i(parseInt(E.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),a.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[a.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(dn,{size:12}),a.jsx("span",{children:"Speed"})]}),a.jsxs("span",{className:"text-amber-400",children:[f.toFixed(2),"x"]})]}),a.jsx("input",{type:"range",min:"0.05",max:"3",step:"0.05",value:f,onChange:E=>m(parseFloat(E.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-amber-500"})]}),a.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[a.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(fn,{size:12}),a.jsx("span",{children:"Smoothness"})]}),a.jsxs("span",{className:"text-emerald-400",children:[w,"px"]})]}),a.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:w,onChange:E=>P(parseInt(E.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]}),a.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[a.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(pt,{size:12}),a.jsx("span",{children:"Outline detail"})]}),a.jsxs("span",{className:"text-violet-300",children:[I,"%"]})]}),a.jsx("input",{type:"range",min:"10",max:"100",step:"1",value:I,onChange:E=>N(parseInt(E.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-violet-400"})]})]})]})})]})},Ms=({terms:e,time:t,epicycles:n,metrics:r,focusIndex:s,stepMode:o=!1})=>{var k;const l=y.useRef(null),i=(x,w)=>Math.max(Math.min(x-1,w-1),0),[d,h]=y.useState("dft"),[c,g]=y.useState(()=>i(n,e.length)),f=y.useRef(i(n,e.length)),m=y.useMemo(()=>{const x=e[0],w=e.length||1,P=(t/(2*Math.PI)).toFixed(2);return{n:w,largestRadius:x?x.amp.toFixed(1):"0.0",maxFreq:x?x.freq:0,phaseTurns:P,dominantPhase:x?x.phase.toFixed(2):"0.00"}},[e,t]),p=y.useMemo(()=>{const x=e[Math.min(c,Math.max(e.length-1,0))];return x||{freq:0,amp:0,phase:0}},[c,e]),v=r.breakdown?r.breakdown[Math.min(c,Math.max(r.breakdown.length-1,0))]??{energyPct:0,cumulativePct:0}:{energyPct:0,cumulativePct:0},j=y.useMemo(()=>{const x={throwOnError:!1},w=m.n||1,P=p.freq,I=p.amp.toFixed(3),N=p.phase.toFixed(3),T=v.energyPct.toFixed(2),A=v.cumulativePct.toFixed(2);return{paramsHtml:Ie.renderToString(`k = ${P},\\quad |X_k| = ${I},\\quad \\phi_k = ${N}\\,\\text{rad}`,x),vectorHtml:Ie.renderToString(`\\text{Vector}_k(t) = |X_k|\\,e^{i\\left(2\\pi k t/${w} + \\phi_k\\right)}`,x),energyHtml:Ie.renderToString(`\\Delta\\text{energy} = ${T}\\%\\quad \\text{cum.} = ${A}\\%`,x)}},[v,p.amp,p.freq,p.phase,m.n]);return y.useEffect(()=>{var V,_;if(!l.current)return;const{n:x,phaseTurns:w,dominantPhase:P}=m,I=Math.max(n,1),N=((V=e[0])==null?void 0:V.freq)??0,T=((_=e[0])==null?void 0:_.amp)??0,A={dft:`
      \\begin{aligned}
        X_k &= \\frac{1}{N} \\sum_{n=0}^{N-1} x_n e^{-i 2\\pi kn / N} \\\\
        &\\textcolor{#f472b6}{N = ${x}},\\; \\textcolor{#22c55e}{k \\in [0, N-1]}
      \\end{aligned}
      `,reconstruction:`
      \\begin{aligned}
        x(t) &\\approx \\sum_{j=1}^{${I}} \\left|X_{k_j}\\right| e^{i\\left(k_j t + \\phi_{k_j}\\right)} \\\\
        t &= 2\\pi n/N,\\; k_j \\in \\left[-\\frac{N}{2}, \\frac{N}{2}\\right] \\\\
        &\\textcolor{#22c55e}{\\left|X_{${N}}\\right| = ${T.toFixed(2)}},\\;
          \\textcolor{#f472b6}{\\phi_{${N}} = ${P}}\\;\\text{rad}
      \\end{aligned}
      `,phasor:`
      \\begin{aligned}
        \\text{Epicycle}_k(t) &= r_k \\\\
        &\\cdot e^{i(\\omega_k t + \\phi_k)} \\\\
        r_k &= \\left|X_k\\right| \\\\
        \\omega_k &= k \\\\
        t &= ${w}\\,\\tau
      \\end{aligned}
      `};Ie.render(A[d],l.current,{throwOnError:!1,displayMode:!0})},[d,n,m,e]),y.useEffect(()=>{h("dft");const x=i(n,e.length);f.current=x,g(x)},[e.length]),y.useEffect(()=>{const x=i(n,e.length),w=f.current;f.current=x,typeof s!="number"&&g(P=>P===w?x:P)},[n,s,e.length]),y.useEffect(()=>{if(typeof s=="number"&&e.length>0){const x=Math.min(Math.max(s,0),e.length-1);g(x)}},[s,e.length]),a.jsxs("div",{className:"fourier-math-panel custom-scrollbar",children:[a.jsx("h3",{className:"text-xl font-bold mb-4 text-cyan-400",children:"Fourier Engine"}),a.jsxs("div",{className:"fourier-math-toggle",role:"group","aria-label":"Toggle formulas",children:[a.jsx("button",{type:"button",className:d==="dft"?"is-active":"",onClick:()=>h("dft"),children:"DFT basis"}),a.jsx("button",{type:"button",className:d==="reconstruction"?"is-active":"",onClick:()=>h("reconstruction"),children:"Reconstruction"}),a.jsx("button",{type:"button",className:d==="phasor"?"is-active":"",onClick:()=>h("phasor"),children:"Phasor anatomy"})]}),a.jsx("div",{className:"mb-4",ref:l,"aria-live":"polite"}),a.jsxs("div",{className:"space-y-4 text-sm font-mono",children:[a.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[a.jsx("span",{className:"text-slate-400",children:"Total Vectors (N)"}),a.jsx("span",{className:"text-cyan-300",children:e.length})]}),a.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[a.jsx("span",{className:"text-slate-400",children:"Active Epicycles"}),a.jsx("span",{className:"text-fuchsia-400",children:n})]}),a.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[a.jsx("span",{className:"text-slate-400",children:"Current Phase (t)"}),a.jsxs("span",{className:"text-amber-400",children:[(t/(2*Math.PI)).toFixed(2),"œÑ"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-slate-400",children:"Largest Radius"}),a.jsxs("span",{className:"text-emerald-400",children:[e.length>0?e[0].amp.toFixed(1):"0.0"," px"]})]})]}),a.jsxs("div",{className:"mt-4",children:[a.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Amplitude color map"}),a.jsx("div",{className:"fourier-legend",style:{backgroundImage:ys(((k=e[0])==null?void 0:k.amp)||1)},"aria-label":"Amplitude legend from low to high magnitude"}),a.jsxs("div",{className:"flex justify-between text-[11px] text-slate-500 mt-1",children:[a.jsx("span",{children:"low |X_k|"}),a.jsx("span",{children:"high |X_k|"})]})]}),a.jsxs("div",{className:"mt-4 space-y-2 text-sm font-mono",children:[a.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[a.jsx("span",{className:"text-slate-400",children:"Energy captured (M terms)"}),a.jsxs("span",{className:"text-cyan-300",children:[r.energyPct.toFixed(2),"%"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-slate-400",children:"RMS error vs. original path"}),a.jsxs("span",{className:"text-amber-300",children:[r.rmsError.toFixed(2)," px"]})]})]}),r.topTerms.length>0&&a.jsxs("div",{className:"mt-4",children:[a.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Top terms (by amplitude)"}),a.jsxs("div",{className:"grid grid-cols-5 text-[11px] text-slate-300 gap-2 border border-slate-800 rounded-lg p-2",children:[a.jsx("span",{className:"font-semibold text-slate-200",children:"k"}),a.jsx("span",{className:"font-semibold text-slate-200",children:"|X_k|"}),a.jsx("span",{className:"font-semibold text-slate-200",children:"phase"}),a.jsx("span",{className:"font-semibold text-slate-200",children:"energy"}),a.jsx("span",{className:"font-semibold text-slate-200",children:"cum."}),r.topTerms.map((x,w)=>a.jsxs(Je.Fragment,{children:[a.jsx("span",{children:x.freq}),a.jsx("span",{children:x.amp.toFixed(2)}),a.jsxs("span",{children:[x.phase.toFixed(2)," rad"]}),a.jsxs("span",{children:[x.energyPct.toFixed(1),"%"]}),a.jsxs("span",{children:[x.cumulativePct.toFixed(1),"%"]})]},w))]})]}),a.jsxs("div",{className:"mt-5 border border-slate-800 rounded-lg p-3 space-y-2 bg-slate-900/40",children:[a.jsxs("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-slate-400",children:[a.jsx("span",{children:"Term inspector"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>g(x=>Math.max(0,x-1)),"aria-label":"Previous term",children:a.jsx(hn,{size:18,"aria-hidden":"true"})}),a.jsxs("span",{className:"text-slate-200",children:[c+1," / ",e.length||1]}),a.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>g(x=>Math.min(e.length-1,x+1)),"aria-label":"Next term",children:a.jsx(mn,{size:18,"aria-hidden":"true"})})]})]}),a.jsxs("div",{className:"text-xs text-slate-200 leading-relaxed space-y-2",children:[a.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:j.paramsHtml}}),a.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:j.vectorHtml}}),a.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:j.energyHtml}}),a.jsx("p",{children:o?"Step mode: play once to view this term, then advance.":"Track this circle while playing to see how its phase and magnitude shape the trace."})]})]}),a.jsxs("div",{className:"mt-5 text-xs text-slate-500 italic space-y-2",children:[a.jsx("p",{children:"* Sorted by amplitude so the largest circles draw first."}),a.jsx("p",{children:"Tip: switch formulas to see how truncating to M epicycles shapes the path."})]})]})},ws=2400,Ae=700,js=1.75,ks=.45,Es=1e7,jt="fourier_viz__last_session",Ns=()=>{var ct,ut,dt,ft,ht;const[e,t]=y.useState("DRAW"),[n,r]=y.useState([]),[s,o]=y.useState([]),[l,i]=y.useState(0),[d,h]=y.useState(!1),[c,g]=y.useState(0),[f,m]=y.useState(!1),[p,v]=y.useState(!1),[j,k]=y.useState("#0f172a"),[x,w]=y.useState("rgba(148, 163, 184, 0.22)"),[P,I]=y.useState(ks),[N,T]=y.useState(0),[A,V]=y.useState(90),[_,X]=y.useState([]),[C,R]=y.useState(!1),[S,$]=y.useState(!1),[z,Y]=y.useState(!1),[D,Z]=y.useState(!1),[F,G]=y.useState(0),[ue,ye]=y.useState("#ec4899"),[oe,me]=y.useState(2),[K,ae]=y.useState(!1),pe=y.useRef(null),ie=y.useRef(null),te=y.useRef(),E=y.useRef([]),O=y.useRef(!1),B=y.useRef(null),ne=y.useRef(1),de=y.useRef(null),se=y.useRef(0),H=y.useRef(null),be=y.useRef(null),Ee=y.useRef(!1),ze=y.useRef(!0),re=y.useRef(null),Ne=y.useRef(null),De=y.useRef({mode:e,points:n,fourierX:s,time:l,isPlaying:d,numEpicycles:c,showMath:f,canvasBg:j,gridColor:x,speed:P,brushColor:ue,brushSize:oe,stepMode:D,safeMode:z,stepIndex:F}),le=y.useCallback(()=>{if(re.current){const u=re.current.getContext("2d");u&&(u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,re.current.width,re.current.height))}Ne.current=null},[]),Me=y.useCallback(()=>{const u=ie.current,M=pe.current;if(!u||!M)return;const{width:b,height:L}=u.getBoundingClientRect(),q=Math.max(1,Math.floor(b)),W=Math.max(1,Math.floor(L));if(q<=1||W<=1)return;const J=window.devicePixelRatio||1;ne.current=J,u.width=Math.round(q*J),u.height=Math.round(W*J),re.current||(re.current=document.createElement("canvas")),re.current.width=u.width,re.current.height=u.height,le()},[le]),Oe=y.useCallback(u=>{se.current=u,H.current=null,be.current=null,i(u)},[]),qe=y.useCallback(()=>{Oe(0),le()},[le,Oe]),Pt=()=>{qe()},fe=y.useCallback(u=>{if(u.length===0)return;const M=z?Ae:ws,{prepared:b,spectrum:L}=ms(u,{smoothing:N,limit:M});r(b),o(L);const q=Math.min(L.length,M);g(Math.max(1,q));try{localStorage.setItem(jt,JSON.stringify(b))}catch{}qe(),h(!0),G(0)},[qe,z,N]);y.useEffect(()=>{const u=Object.keys(localStorage).filter(b=>b.startsWith("fourier_viz_")).map(b=>b.replace("fourier_viz_","")).sort();X(u);const M=localStorage.getItem(jt);if(M)try{const b=JSON.parse(M);b.length&&(t("PRESET"),r(b),fe(b))}catch{}},[]),y.useEffect(()=>{const u=()=>{const b=getComputedStyle(document.documentElement),L=b.getPropertyValue("--color-code-bg").trim(),q=b.getPropertyValue("--fourier-grid").trim();k(L||"#0f172a"),w(q||"rgba(148, 163, 184, 0.22)")};u();const M=typeof MutationObserver<"u"?new MutationObserver(u):null;return M&&(M.observe(document.documentElement,{attributes:!0,attributeFilter:["class","data-theme"]}),M.observe(document.body,{attributes:!0,attributeFilter:["class","data-theme"]})),()=>M==null?void 0:M.disconnect()},[]),y.useEffect(()=>{const u=z?Math.min(s.length,Ae):s.length;u!==0&&g(M=>Math.min(Math.max(M||1,1),u))},[s.length,z]),y.useEffect(()=>{!D&&F!==0&&G(0)},[D,F]),y.useEffect(()=>{const u=()=>{R(document.fullscreenElement===pe.current),document.fullscreenElement&&$(!1),Me()};return document.addEventListener("fullscreenchange",u),()=>document.removeEventListener("fullscreenchange",u)},[Me]),y.useEffect(()=>{document.body.classList.toggle("fourier-pseudo-fullscreen",S);const u=window.requestAnimationFrame(()=>{Me()});return()=>{window.cancelAnimationFrame(u),document.body.classList.remove("fourier-pseudo-fullscreen")}},[S,Me]),y.useEffect(()=>{if(!S)return;const u=M=>{M.key==="Escape"&&$(!1)};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[S]);const Tt=y.useCallback(()=>{const u=pe.current;if(!u)return;const M=document.fullscreenElement===u;if(M||S){M?document.exitFullscreen().catch(()=>{}):$(!1);return}if(typeof u.requestFullscreen=="function"){u.requestFullscreen().catch(()=>{$(!0)});return}$(!0)},[S]),we=Je.useMemo(()=>ps(s,n,c),[s,c,n]),Rt=u=>{if(e!=="DRAW"||O.current||u.pointerType==="mouse"&&u.button!==0)return;O.current=!0,B.current=u.pointerId,ae(!0),r([]),le(),o([]),h(!1),G(0),Z(!1);const M=ie.current.getBoundingClientRect(),b=u.clientX-M.left-M.width/2,L=u.clientY-M.top-M.height/2,q={x:b,y:L};r([q]),E.current=[q];try{u.currentTarget.setPointerCapture(u.pointerId)}catch{}},Ct=u=>{if(!O.current||e!=="DRAW"||B.current!==u.pointerId)return;if(u.pointerType==="mouse"&&(u.buttons&1)===0){O.current=!1,B.current=null,ae(!1);return}const M=ie.current.getBoundingClientRect(),b=u.clientX-M.left-M.width/2,L=u.clientY-M.top-M.height/2,q={x:b,y:L},W=E.current[E.current.length-1];Math.hypot(q.x-W.x,q.y-W.y)>js&&E.current.push(q)},It=u=>{if(!O.current||typeof(u==null?void 0:u.pointerId)=="number"&&B.current!==u.pointerId)return;O.current=!1,B.current=null,ae(!1);const M=E.current;M.length>1?fe(M):(r([]),o([]),h(!1))},At=()=>{O.current&&(O.current=!1,B.current=null,ae(!1))};y.useEffect(()=>{const u=M=>{if(!O.current)return;const b=M.pointerId;if(typeof b=="number"&&B.current!==null&&b!==B.current)return;O.current=!1,B.current=null,ae(!1);const L=E.current;L.length>1?fe(L):(r([]),o([]),h(!1))};return window.addEventListener("pointerup",u),window.addEventListener("pointercancel",u),window.addEventListener("blur",u),()=>{window.removeEventListener("pointerup",u),window.removeEventListener("pointercancel",u),window.removeEventListener("blur",u)}},[fe]);const _t=()=>{r([]),le(),o([]),h(!1),t("DRAW"),G(0),Z(!1),E.current=[]},Ft=u=>{let M=[];switch(u){case"circle":M=$n();break;case"square":M=Fn();break;case"heart":M=zn();break;case"infinity":M=Dn();break;case"note":M=On();break}t("PRESET"),r(M),fe(M)},$t=()=>{if(n.length<2){alert("Draw something first!");return}const u=prompt("Enter a name for this drawing:");if(u)try{localStorage.setItem(`fourier_viz_${u}`,JSON.stringify(n)),X(M=>{const b=[...M];return b.includes(u)||b.push(u),b.sort()})}catch{alert("Failed to save. Storage might be full.")}},zt=u=>{const M=localStorage.getItem(`fourier_viz_${u}`);if(M)try{const b=JSON.parse(M);r(b),t("PRESET"),fe(b)}catch(b){console.error("Error loading drawing",b)}},Dt=async u=>{if(u.target.files&&u.target.files[0]){const M=u.target.files[0];if(M.type&&!M.type.startsWith("image/")){alert("Please upload an image file.");return}if(M.size>Es){alert("File too large for in-browser processing. Please pick an image under 10MB.");return}v(!0),de.current=M;try{const b=await wt(M,900,{detail:A/100});b.length>0?(r(b),t("UPLOAD"),fe(b)):alert("No clear shape found. Try an image with higher contrast.")}catch(b){console.error(b),alert("Error processing image.")}finally{v(!1),u.target.value=""}}};y.useEffect(()=>{if(e!=="UPLOAD")return;const u=de.current;if(!u)return;const M=window.setTimeout(async()=>{v(!0);try{const b=await wt(u,900,{detail:A/100});b.length>0&&(r(b),fe(b))}catch(b){console.error(b)}finally{v(!1)}},250);return()=>window.clearTimeout(M)},[e,A,fe]);const rt=u=>{if(!s.length)return;Z(!0);const M=Math.min(Math.max(u,0),Math.max(he-1,0));G(M);const b=M+1;c!==b&&g(b),Oe(0),le()},Ot=()=>rt(F-1),qt=()=>rt(F+1),Ut=()=>{D||Z(!0),h(!0)},ot=y.useCallback((u,M,b,L,q,W,J)=>{var Se;let ge=M/2,U=b/2;const Q=L.slice(0,Math.max(q,1)),ee=Math.max(Q.length-1,0),Be=((Se=L[0])==null?void 0:Se.amp)||1;for(let xe=0;xe<Q.length;xe++){const Le=ge,Pe=U,{freq:Te,amp:Re,phase:He}=Q[xe],Ce=Te*W+He,We=xe===ee,Xe=bs(Q[xe],Be,We),Wt=J&&We?1+.25*Math.sin(W*6):1;ge+=Re*Math.cos(Ce),U+=Re*Math.sin(Ce),u.strokeStyle=Xe,u.lineWidth=We?1.6*Wt:1,u.beginPath(),u.arc(Le,Pe,Re,0,2*Math.PI),u.stroke(),u.strokeStyle=Xe,u.beginPath(),u.moveTo(Le,Pe),u.lineTo(ge,U),u.stroke(),xe===Q.length-1&&(u.fillStyle=Xe,u.beginPath(),u.arc(ge,U,3,0,2*Math.PI),u.fill())}return{x:ge,y:U}},[]),at=y.useCallback(u=>{const M=ie.current;if(!M)return;const b=M.getContext("2d");if(!b)return;const L=De.current,q=ne.current||1,W=M.width/q,J=M.height/q;b.setTransform(1,0,0,1,0,0),b.scale(q,q),b.lineCap="round",b.lineJoin="round",b.fillStyle=L.canvasBg,b.fillRect(0,0,W,J),b.strokeStyle=L.gridColor,b.lineWidth=.5,b.beginPath(),b.moveTo(W/2,0),b.lineTo(W/2,J),b.moveTo(0,J/2),b.lineTo(W,J/2),b.stroke(),L.points.length>0&&L.mode!=="DRAW"&&(b.strokeStyle="rgba(255, 255, 255, 0.1)",b.lineWidth=1,b.beginPath(),L.points.forEach((U,Q)=>{Q===0?b.moveTo(U.x+W/2,U.y+J/2):b.lineTo(U.x+W/2,U.y+J/2)}),b.stroke()),L.mode==="DRAW"&&O.current&&(b.strokeStyle=L.brushColor,b.lineWidth=L.brushSize,b.beginPath(),E.current.forEach((U,Q)=>{Q===0?b.moveTo(U.x+W/2,U.y+J/2):b.lineTo(U.x+W/2,U.y+J/2)}),b.stroke());const ge=se.current;if(L.fourierX.length>0){re.current&&b.drawImage(re.current,0,0,W,J);const U=Math.min(Math.max(L.numEpicycles,1),L.fourierX.length),Q=ot(b,W,J,L.fourierX,U,ge,L.stepMode);if(re.current){const ee=re.current.getContext("2d");ee&&(ee.setTransform(1,0,0,1,0,0),ee.scale(q,q),ee.strokeStyle=L.brushColor,ee.lineWidth=L.brushSize,ee.lineCap="round",ee.lineJoin="round",Ne.current&&(ee.beginPath(),ee.moveTo(Ne.current.x,Ne.current.y),ee.lineTo(Q.x,Q.y),ee.stroke()))}if(Ne.current={x:Q.x,y:Q.y},L.isPlaying){const ee=Math.max(L.points.length||L.fourierX.length,1),Be=2*Math.PI/ee,Se=H.current,xe=Se==null?0:Math.min(Math.max(u-Se,0),80);H.current=u;const Le=xe/(1e3/60),Pe=Be*L.speed*Le,Te=ge+Pe;if(Te>=2*Math.PI){if(se.current=0,le(),L.stepMode){h(!1);const He=L.safeMode?Math.min(L.fourierX.length,Ae):L.fourierX.length;G(Ce=>Math.min(Ce+1,Math.max(He-1,0)))}}else se.current=Te}else H.current=u}else H.current=u;if(L.showMath){const U=be.current;(U==null||u-U>=50)&&(i(se.current),be.current=u)}else be.current=null},[le,ot]),Ue=y.useCallback(u=>{const b=De.current.isPlaying||O.current;(ze.current||b)&&(at(u),ze.current=!1),b?te.current=requestAnimationFrame(Ue):(Ee.current=!1,H.current=null,be.current=null)},[at]),je=y.useCallback(()=>{ze.current=!0,!Ee.current&&(Ee.current=!0,H.current=null,te.current=requestAnimationFrame(Ue))},[Ue]);y.useEffect(()=>{De.current={mode:e,points:n,fourierX:s,time:l,isPlaying:d,numEpicycles:c,showMath:f,canvasBg:j,gridColor:x,speed:P,brushColor:ue,brushSize:oe,stepMode:D,safeMode:z,stepIndex:F},je()},[e,n,s,l,d,c,f,j,x,P,ue,oe,D,z,F,je]),y.useEffect(()=>(je(),()=>{te.current&&cancelAnimationFrame(te.current)}),[je]),y.useEffect(()=>{const u=()=>{Me(),je()};u();const M=typeof ResizeObserver<"u"?new ResizeObserver(u):null;return M&&(pe.current&&M.observe(pe.current),ie.current&&M.observe(ie.current)),window.addEventListener("resize",u),()=>{window.removeEventListener("resize",u),M==null||M.disconnect()}},[Me,je]),y.useEffect(()=>{le()},[c,s]),y.useEffect(()=>{const u=document.getElementById("fourier-root");return u==null||u.classList.add("is-mounted"),()=>{u==null||u.classList.remove("is-mounted")}},[]);const he=z?Math.min(s.length,Ae):s.length,it=Math.max(Math.min(c-1,(((ct=we.breakdown)==null?void 0:ct.length)||1)-1),0),Bt=((dt=(ut=we.breakdown)==null?void 0:ut[it])==null?void 0:dt.energyPct)??0,Ht=((ht=(ft=we.breakdown)==null?void 0:ft[it])==null?void 0:ht.cumulativePct)??we.energyPct,lt=C||S;return y.useEffect(()=>{if(!D)return;const u=Math.min(Math.max(F+1,1),Math.max(he,1));c!==u&&g(u)},[D,F,he,c]),y.useEffect(()=>{const u=Math.max(Math.min(c-1,he-1),0);F>u&&G(u)},[c,he,F]),a.jsxs("div",{className:`fourier-stage select-none ${lt?"is-fullscreen":""} ${S?"is-pseudo-fullscreen":""}`,ref:pe,"data-mode":e,"data-drawing":K?"true":"false","data-has-spectrum":s.length>0?"true":"false","data-points":n.length,"data-epicycles":c,"data-terms":s.length,children:[a.jsx("canvas",{ref:ie,onPointerDown:Rt,onPointerMove:Ct,onPointerUp:It,onPointerCancel:At,className:`fourier-canvas cursor-${e==="DRAW"?"crosshair":"default"}`}),a.jsx(vs,{mode:e,setMode:t,isPlaying:d,setIsPlaying:h,clear:_t,numEpicycles:c,maxEpicycles:he,setNumEpicycles:g,onUpload:Dt,showMath:f,setShowMath:m,onPreset:Ft,speed:P,setSpeed:I,onReset:Pt,brushColor:ue,setBrushColor:ye,brushSize:oe,setBrushSize:me,smoothing:N,setSmoothing:T,outlineDetail:A,setOutlineDetail:V,isDrawing:K,onSave:$t,onLoad:zt,savedDrawings:_,isFullscreen:lt,onToggleFullscreen:Tt,safeMode:z,onToggleSafeMode:()=>Y(u=>!u),stepMode:D,onToggleStepMode:()=>Z(u=>!u),stepIndex:F,stepMax:he,onStepPrev:Ot,onStepNext:qt,onStepPlayOnce:Ut}),f&&s.length>0&&a.jsx(Ms,{terms:s,time:l,epicycles:c,metrics:we,focusIndex:D?Math.max(c-1,0):void 0,stepMode:D}),D&&s.length>0&&a.jsxs("div",{className:"absolute top-4 left-4 z-[60] bg-slate-900/80 text-slate-100 border border-slate-700 rounded-lg px-4 py-3 shadow-lg space-y-1",children:[a.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Step mode"}),a.jsxs("div",{className:"text-sm font-semibold",children:["Term ",Math.min(c,he)," / ",Math.max(he,1)]}),a.jsxs("div",{className:"text-xs text-slate-200",children:["Œîenergy ",Bt.toFixed(2),"% ¬∑ Cumulative ",Ht.toFixed(2),"% ¬∑ RMS ",we.rmsError.toFixed(2)," px"]})]}),p&&a.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100]",children:a.jsx("div",{className:"text-cyan-400 font-mono text-xl animate-pulse",children:"Processing Image..."})}),e==="DRAW"&&n.length===0&&a.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none text-center",children:[a.jsx("h1",{className:"text-4xl font-bold text-slate-200 mb-2 drop-shadow",children:"Draw Something"}),a.jsx("p",{className:"text-slate-300",children:"Trace a continuous line to begin"})]})]})},Lt=document.getElementById("fourier-root");if(!Lt)throw new Error("Could not find root element to mount to");const Ss=Xt.createRoot(Lt);Ss.render(a.jsx(Je.StrictMode,{children:a.jsx(Ns,{})}));
