import{r as m,j as s,R as Ee,a as pt}from"./react-vendor-CkISVyWX.js";import{A as gt,P as xt,S as bt,F as yt,a as vt,I as jt,b as wt,C as Be,T as Mt,c as Et,d as Nt,e as kt,M as St,f as Pt,R as Lt,g as Tt,h as Ct,i as Rt,j as _t,G as It,W as At}from"./icons-vendor-7VGIiVdl.js";import{k as Ft}from"./math-vendor-Ca7EfnBD.js";import"./vendor-Bb8JjhAW.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}})();const $t=[{id:"about",label:"About"},{id:"learning",label:"Learning"},{id:"posts",label:"Posts"},{id:"projects",label:"Projects"},{id:"experience",label:"Experience"},{id:"education",label:"Education"},{id:"contact",label:"Contact"}],Ge=[{id:"circuit-lab",label:"Circuit Lab",href:"pages/circuit-lab/"},{id:"transformer-lab",label:"Transformer Lab",href:"pages/transformer-lab/"},{id:"ml-playground",label:"ML Playground",href:"pages/ml-playground/"},{id:"fourier-epicycles",label:"Fourier Epicycles",href:"pages/fourier-epicycles/"},{id:"endless-depths",label:"Endless Depths",href:"pages/endless-depths/"}],zt="Ka Ming Lui";function Ke(e){return e?e==="/"?"/":e.endsWith("/")?e:`${e}/`:""}function Ne(e=""){var o,d;const t=((o=document.documentElement)==null?void 0:o.dataset.navRoot)??((d=document.body)==null?void 0:d.dataset.navRoot)??null;if(typeof t=="string"&&t.trim())return Ke(t.trim());const r=(typeof e=="string"?e:"").split(/[?#]/)[0].replace(/\\/g,"/").split("/").filter(Boolean);return r.length&&r[r.length-1].includes(".")&&r.pop(),r.length===0?"":"../".repeat(r.length)}function Ot(e=""){var o,d;const t=((o=document.body)==null?void 0:o.dataset.currentLab)??((d=document.documentElement)==null?void 0:d.dataset.currentLab)??null;if(t)return t;const n=(typeof e=="string"?e:"").toLowerCase().replace(/\\/g,"/"),r=Ge.find(u=>n.includes(`/${u.id.toLowerCase()}/`));return(r==null?void 0:r.id)??null}function qt({rootPrefix:e,useLocalAnchors:t}){return $t.map(({id:a,label:n})=>`<li><a href="${t?`#${a}`:`${e}index.html#${a}`}">${n}</a></li>`).join("")}function Dt({rootPrefix:e,currentLabId:t}){return Ge.map(({id:a,label:n,href:r})=>`<li><a href="${r.startsWith("http")?r:`${e}${r}`}"${a===t?' aria-current="page"':""}>${n}</a></li>`).join("")}function Je(e={}){var w,x,b;const t=e.target??document.querySelector("[data-site-header]")??document.querySelector(".site-header");if(!t)return null;const a=t.querySelector(".nav");if(!(t.hasAttribute("data-site-header")||e.forceRender===!0)&&a||t.dataset.navRendered==="true"&&a)return a;const r=typeof e.rootPrefix=="string"&&e.rootPrefix.trim()||typeof((w=t==null?void 0:t.dataset)==null?void 0:w.navRoot)=="string"&&t.dataset.navRoot.trim(),o=Ke(r??Ne((x=window.location)==null?void 0:x.pathname)),d=e.useLocalAnchors??(o===""||t.dataset.useLocalAnchors==="true"),u=e.currentLab??t.dataset.currentLab??Ot((b=window.location)==null?void 0:b.pathname),h=e.showEditToggle===!0||t.dataset.showEditToggle==="true",c=d?"#hero":`${o}index.html#hero`,f=qt({rootPrefix:o,useLocalAnchors:d}),g=Dt({rootPrefix:o,currentLabId:u}),y=`
    <div class="container">
      <nav class="nav" aria-label="Primary">
        <a class="logo" href="${c}">${zt}</a>
        <button class="nav-toggle" type="button" aria-expanded="false" aria-controls="primary-navigation">
          <span class="nav-toggle__bar"></span>
          <span class="nav-toggle__bar"></span>
          <span class="nav-toggle__bar"></span>
          <span class="sr-only">Toggle navigation</span>
        </button>
        <ul class="nav-links" id="primary-navigation" data-visible="false">
          <li class="nav-item nav-item--dropdown">
            <button class="nav-dropdown-toggle nav-pill" type="button" aria-expanded="false" aria-controls="section-menu">
              Sections
              <svg class="nav-dropdown__icon" aria-hidden="true" focusable="false" viewBox="0 0 12 12">
                <path d="M2.47 4.47a.75.75 0 0 1 1.06 0L6 6.94l2.47-2.47a.75.75 0 0 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 0 1 0-1.06Z" />
              </svg>
            </button>
            <ul class="nav-dropdown-menu" id="section-menu" hidden>
              ${f}
            </ul>
          </li>
          <li class="nav-item nav-item--dropdown">
            <button class="nav-dropdown-toggle nav-pill" type="button" aria-expanded="false" aria-controls="labs-menu">
              Labs
              <svg class="nav-dropdown__icon" aria-hidden="true" focusable="false" viewBox="0 0 12 12">
                <path d="M2.47 4.47a.75.75 0 0 1 1.06 0L6 6.94l2.47-2.47a.75.75 0 0 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 0 1 0-1.06Z" />
              </svg>
            </button>
            <ul class="nav-dropdown-menu" id="labs-menu" hidden>
              ${g}
            </ul>
          </li>
        </ul>
        <div class="nav-actions">
          ${h?'<button class="edit-toggle" type="button" aria-pressed="false" hidden>Edit mode</button>':""}
          <button class="theme-toggle" type="button" aria-label="Toggle color theme">
            <span aria-hidden="true">üåô</span>
          </button>
        </div>
      </nav>
    </div>
  `;return t.innerHTML=y.trim(),t.id=t.id||"top",t.classList.add("site-header"),t.dataset.navRendered="true",t.querySelector(".nav")}const ue='&copy; <span id="year"></span> Ka Ming Lui. Built with accessibility and performance in mind.',We={home:{id:"home",layoutClass:"footer__layout",useContentBindings:!0,backToTopLabel:"Back to top"},"ml-playground":{layoutClass:"footer__layout",heading:"Want to explore more ML demos?",body:"Try the transformer lab or reach out to share your favorite visualization ideas.",actions:[{label:"Visit Transformer Lab",href:"pages/transformer-lab/",variant:"primary"},{label:"Email Ka-Ming",href:"mailto:contact@kaminglui.com",variant:"ghost"}],meta:["Curious how this playground works? Inspect the source on GitHub to tweak the algorithm.",ue]},"transformer-lab":{layoutClass:"footer__layout",heading:"Ready for more machine learning stories?",body:"Head back to the main site to explore projects, journal entries, and the learning roadmap behind this transformer lab.",actions:[{label:"View projects",href:"index.html#projects",variant:"primary"},{label:"Get in touch",href:"index.html#contact",variant:"ghost"}],meta:["Enjoyed the walkthrough? Share it with fellow ML explorers.",ue]},"endless-depths":{layoutClass:"footer__layout",heading:"Back to the main site?",body:"Check out projects, posts, and the ML roadmap that inspired this mini-game.",actions:[{label:"View projects",href:"index.html#projects",variant:"primary"},{label:"Get in touch",href:"index.html#contact",variant:"ghost"}],meta:["Progress saves to your browser so you can pick up where you left off.",'&copy; <span id="year"></span> Ka Ming Lui. Built for performance and accessibility.']}};function ce(e){return e?e==="/"?"/":e.endsWith("/")?e:`${e}/`:""}function Bt(e,t){var n,r,o;if(typeof t=="string"&&t.trim())return ce(t.trim());const a=((n=e==null?void 0:e.dataset)==null?void 0:n.footerRoot)||((r=e==null?void 0:e.dataset)==null?void 0:r.navRoot);return typeof a=="string"&&a.trim()?ce(a.trim()):ce(Ne((o=window.location)==null?void 0:o.pathname))}function Wt(e,t){var n,r;const a=t||((n=e==null?void 0:e.dataset)==null?void 0:n.footerId)||((r=e==null?void 0:e.dataset)==null?void 0:r.footerPreset)||"home";return We[a]||We.home}function Ht(e=[],t=""){if(!Array.isArray(e)||e.length===0)return"";const a=ce(t);return e.map(({label:n,href:r,variant:o})=>{if(!n||!r)return"";const u=/^(https?:)?\/\//i.test(r)||r.startsWith("mailto:")||r.startsWith("#")?r:`${a}${r}`,h=["button"];return o==="primary"&&h.push("button--primary"),o==="ghost"&&h.push("button--ghost"),`<a class="${h.join(" ")}" href="${u}">${n}</a>`}).filter(Boolean).join("")}function He(e=[]){return!Array.isArray(e)||e.length===0?"":e.map(t=>`<p>${t}</p>`).join("")}function Xt(e={}){const t=e.target??document.querySelector("[data-site-footer]")??document.querySelector(".site-footer");if(!t)return null;if(t.dataset.footerRendered==="true"||!t.hasAttribute("data-site-footer")&&e.forceRender!==!0)return t;const a=Wt(t,e.preset),n=Bt(t,e.rootPrefix),r=a.layoutClass||"footer__layout";let o="",d="",u="",h="";a.useContentBindings?(o='<h2 data-content="contact.title"></h2>',d='<p data-content="contact.body"></p>',u='<div class="footer__actions" data-contact-actions></div>',h='<p data-content="contact.meta"></p>'+He([ue])):(o=a.heading?`<h2>${a.heading}</h2>`:"",d=a.body?`<p>${a.body}</p>`:"",u=`<div class="footer__actions">${Ht(a.actions,n)}</div>`,h=He(a.meta||[ue]));const c=a.backToTopLabel||"Back to top";return t.innerHTML=`
    <div class="container ${r}">
      <div>
        ${o}
        ${d}
        ${u}
      </div>
      <div class="footer__meta">
        ${h}
      </div>
    </div>
    <a class="back-to-top" href="#top">${c}</a>
  `.trim(),t.classList.add("site-footer"),t.dataset.footerRendered="true",t}function Ut(){const e=document.getElementById("year")||document.querySelector("[data-year]");e&&(e.textContent=String(new Date().getFullYear()))}const ke=["theme","circuitforge-theme"];function Vt(){if(typeof localStorage>"u")return null;for(const e of ke){const t=localStorage.getItem(e);if(t==="dark"||t==="light")return t}return null}function Yt(e){typeof localStorage>"u"||ke.forEach(t=>{try{localStorage.setItem(t,e)}catch(a){console.warn("Unable to store theme preference",a)}})}function ye(e){const t=e==="light"?"light":"dark";return typeof document>"u"||(document.body.classList.toggle("theme-dark",t==="dark"),document.body.classList.toggle("theme-light",t==="light"),document.documentElement.classList.toggle("dark",t==="dark"),Yt(t)),t}function ve(e,t){e&&(e.setAttribute("aria-pressed",t==="dark"?"true":"false"),e.innerHTML=t==="dark"?'<span aria-hidden="true">üåô</span>':'<span aria-hidden="true">‚òÄÔ∏è</span>')}function Gt(){const e=Vt();return e||(typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}function Kt({onChange:e}={}){const t=document.querySelector(".theme-toggle"),a=(t==null?void 0:t.dataset.themeBound)==="true",n=ye(Gt());ve(t,n);const r=u=>{typeof e=="function"&&e(u)},o=u=>{if(typeof localStorage<"u"&&localStorage.getItem(ke[0]))return;const h=ye(u.matches?"dark":"light");ve(t,h),r(h)},d=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-color-scheme: dark)"):null;return d&&(typeof d.addEventListener=="function"?d.addEventListener("change",o):typeof d.addListener=="function"&&d.addListener(o)),t&&!a&&(t.dataset.themeBound="true",t.addEventListener("click",()=>{const u=document.body.classList.contains("theme-dark")?"dark":"light",h=ye(u==="dark"?"light":"dark");ve(t,h),r(h)})),r(n),n}function Ze(e){if(!e||!e.getBoundingClientRect)return;const{height:t}=e.getBoundingClientRect();Number.isFinite(t)&&t>0&&(document.documentElement.style.setProperty("--nav-height",`${t}px`),document.documentElement.style.setProperty("--header-h",`${t}px`))}function Jt(e){if(!e)return;const t=()=>Ze(e);if(typeof ResizeObserver<"u"){const a=new ResizeObserver(t);return a.observe(e),a}return window.addEventListener("resize",t),null}function Se(e){var t;return typeof e=="string"&&e.trim()?e.trim():typeof document<"u"?Ne((t=window.location)==null?void 0:t.pathname):""}function Zt(e={}){const t=e.target??document.getElementById("site-header")??document.querySelector("[data-site-header]");if(!t)return null;const a=e.pageId||e.currentLab||t.dataset.currentLab,n=Se(e.rootPrefix||t.dataset.navRoot),r=e.showEditToggle??t.dataset.showEditToggle==="true",o=e.useLocalAnchors??a==="home";t.id="top",t.dataset.siteHeader="true",t.dataset.currentLab=a||"",t.dataset.navRoot=n||"";const d=Je({target:t,currentLab:a,rootPrefix:n,useLocalAnchors:o,showEditToggle:r}),u=(d==null?void 0:d.closest("[data-site-header]"))||t;return Ze(u),Jt(u),u}function Qt(e={}){const t=e.target??document.getElementById("site-footer")??document.querySelector("[data-site-footer]");if(!t)return null;const a=e.pageId||e.preset||t.dataset.footerId,n=Se(e.rootPrefix||t.dataset.footerRoot);t.dataset.siteFooter="true",t.dataset.footerId=a||"home",t.dataset.footerRoot=n||"";const r=Xt({target:t,preset:a||"home",rootPrefix:n});return r&&Ut(),r}function es(e="home",t={}){var r,o;const a=e||((o=(r=document.body)==null?void 0:r.dataset)==null?void 0:o.currentLab)||"home",n=Se(t.rootPrefix);Zt({pageId:a,rootPrefix:n,showEditToggle:t.showEditToggle,useLocalAnchors:t.useLocalAnchors}),Kt(t.themeOptions||{}),a!=="circuit-lab"&&Qt({pageId:a,rootPrefix:n})}let Xe=!1,je=!1;function ts(){if(je)return;const t=Je()??document.querySelector(".nav"),a=(t==null?void 0:t.querySelector(".nav-toggle"))??document.querySelector(".nav-toggle"),n=(t==null?void 0:t.querySelector(".nav-links"))??document.querySelector(".nav-links");if(!t||!a||!n)return;if(t.dataset.navEnhanced==="true"){je=!0;return}const r=document.body,o=Array.from(t.querySelectorAll(".nav-item--dropdown")),d=[],u=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(hover: none)"):null,h=({except:c}={})=>{let f=!1;return d.forEach(g=>{g!==c&&g.isOpen()&&(g.close(),f=!0)}),f};if(o.forEach(c=>{const f=c.querySelector(".nav-dropdown-toggle"),g=c.querySelector(".nav-dropdown-menu");if(!(f instanceof HTMLElement)||!(g instanceof HTMLElement))return;const v={wrapper:c,toggle:f,menu:g,isOpen:()=>f.getAttribute("aria-expanded")==="true",open:()=>{f.setAttribute("aria-expanded","true"),c.setAttribute("data-open","true"),g.hidden=!1},close:()=>{f.setAttribute("aria-expanded","false"),c.setAttribute("data-open","false"),g.hidden=!0}};v.close(),d.push(v);const y=()=>{h({except:v}),v.open()},w=()=>{},x=()=>{};c.addEventListener("pointerenter",w),c.addEventListener("pointerleave",x),f.addEventListener("pointerenter",w),f.addEventListener("pointerleave",x),g.addEventListener("pointerenter",w),g.addEventListener("pointerleave",x),c.addEventListener("focusin",b=>{const M=b.target;M instanceof HTMLElement&&!M.matches(":focus-visible")||y()}),c.addEventListener("focusout",b=>{const M=b.relatedTarget;(!(M instanceof Node)||!c.contains(M))&&v.close()}),f.addEventListener("click",b=>{b.preventDefault(),b.stopPropagation(),v.isOpen()?v.close():y()}),f.addEventListener("keydown",b=>{if(b.key==="ArrowDown"){b.preventDefault(),v.isOpen()||y();const M=g.querySelector("a");M instanceof HTMLElement&&M.focus()}else b.key==="Escape"&&v.close()}),g.addEventListener("click",b=>{b.target instanceof HTMLAnchorElement&&h()}),g.addEventListener("keydown",b=>{b.key==="Escape"&&(b.stopPropagation(),v.close(),f.focus())})}),u){const c=()=>{h()};typeof u.addEventListener=="function"?u.addEventListener("change",c):typeof u.addListener=="function"&&u.addListener(c)}window.addEventListener("resize",()=>{h()}),d.length>0&&!Xe&&(document.addEventListener("pointerdown",c=>{const f=c.target;f instanceof Node&&d.some(({wrapper:g})=>g.contains(f))||h()}),document.addEventListener("keydown",c=>{c.key==="Escape"&&h()}),Xe=!0),a&&(a.addEventListener("click",()=>{const c=a.getAttribute("aria-expanded")==="true";h(),a.setAttribute("aria-expanded",String(!c)),n==null||n.setAttribute("data-visible",String(!c)),r.classList.toggle("nav-open",!c)}),window.addEventListener("keydown",c=>{c.key==="Escape"&&a.getAttribute("aria-expanded")==="true"&&(a.setAttribute("aria-expanded","false"),n==null||n.setAttribute("data-visible","false"),r.classList.remove("nav-open"),h(),a.focus())}),window.addEventListener("resize",()=>{window.innerWidth>=720&&(a.setAttribute("aria-expanded","false"),n==null||n.setAttribute("data-visible","false"),r.classList.remove("nav-open"),h())})),n==null||n.addEventListener("click",c=>{c.target instanceof HTMLAnchorElement&&(a==null||a.setAttribute("aria-expanded","false"),n.setAttribute("data-visible","false"),r.classList.remove("nav-open"),h())}),t.dataset.navEnhanced="true",je=!0}const Ue=()=>ts();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ue,{once:!0}):Ue();const ss=e=>{const t=[],a=e.length;for(let n=0;n<a;n++){let r=0,o=0;for(let c=0;c<a;c++){const f=Math.PI*2*n*c/a,g=Math.cos(f),v=Math.sin(f),y=e[c].re,w=e[c].im;r+=y*g+w*v,o+=w*g-y*v}r=r/a,o=o/a;const d=n,u=Math.sqrt(r*r+o*o),h=Math.atan2(o,r);t.push({re:r,im:o,freq:d,amp:u,phase:h})}return t.sort((n,r)=>r.amp-n.amp)},ns=(e,t)=>{if(t<=0||e.length<2)return[...e];const a=[];for(let n=0;n<e.length;n++){let r=0,o=0,d=0;for(let u=-t;u<=t;u++){const h=n+u;h>=0&&h<e.length&&(r+=e[h].x,o+=e[h].y,d++)}a.push({x:r/d,y:o/d})}return a},as=()=>{const e=[];for(let n=0;n<50;n++)e.push({x:-200+n*2*200/50,y:-200});for(let n=0;n<50;n++)e.push({x:200,y:-200+n*2*200/50});for(let n=0;n<50;n++)e.push({x:200-n*2*200/50,y:200});for(let n=0;n<50;n++)e.push({x:-200,y:200-n*2*200/50});return e},rs=()=>{const e=[];for(let n=0;n<200;n++){const r=Math.PI*2*n/200;e.push({x:200*Math.cos(r),y:200*Math.sin(r)})}return e},os=()=>{const e=[];for(let a=0;a<300;a++){const n=Math.PI*2*a/300,r=16*Math.pow(Math.sin(n),3),o=-(13*Math.cos(n)-5*Math.cos(2*n)-2*Math.cos(3*n)-Math.cos(4*n));e.push({x:r*15,y:o*15})}return e},is=()=>{const e=[];for(let n=0;n<300;n++){const r=Math.PI*2*n/300,o=150*Math.cos(r),d=150*Math.sin(r)*Math.cos(r);e.push({x:o,y:d})}return e},ls=()=>{const e=[];for(let a=0;a<100;a++){const n=Math.PI*2*a/100;e.push({x:40*Math.cos(n)-50,y:30*Math.sin(n)+100})}for(let a=0;a<20;a++)e.push({x:-10,y:100-200*a/20});for(let a=0;a<30;a++){const n=a/30;e.push({x:-10+50*Math.sin(n*Math.PI),y:-100+50*n})}for(let a=0;a<20;a++)e.push({x:-10,y:-50+150*a/20});return e},cs={threshold:30,sampleRate:3,maxPoints:1500,smoothingWindow:4},ds=e=>{if(e.length===0)return[];const t=[],a=new Set;let n=0;for(t.push(e[0]),a.add(0);t.length<e.length;){let r=1/0,o=-1;const d=e[n];for(let u=0;u<e.length;u++)if(!a.has(u)){const h=e[u],c=(d.x-h.x)**2+(d.y-h.y)**2;c<r&&(r=c,o=u)}if(o!==-1)a.add(o),t.push(e[o]),n=o;else break}return t},us=(e,t,a,n={})=>{const{threshold:r,sampleRate:o,maxPoints:d,smoothingWindow:u}={...cs,...n},h=[],c=y=>(e[y]+e[y+1]+e[y+2])/3;for(let y=0;y<a;y+=o)for(let w=0;w<t;w+=o){const x=(y*t+w)*4,b=(y*t+(w-1))*4,M=((y-1)*t+w)*4;if(w>0&&y>0){const j=c(x),S=c(b),L=c(M);Math.abs(j-S)+Math.abs(j-L)>r&&h.push({x:w-t/2,y:y-a/2})}}if(h.length===0)return[];let f=h;if(h.length>d){const y=Math.ceil(h.length/d);f=h.filter((w,x)=>x%y===0)}const g=ds(f),v=[];for(let y=0;y<g.length;y++){let w=0,x=0,b=0;for(let M=-u;M<=u;M++){const j=(y+M+g.length)%g.length;w+=g[j].x,x+=g[j].y,b++}v.push({x:w/b,y:x/b})}return v},hs=async(e,t=800,a={})=>new Promise((n,r)=>{const o=new Image,d=URL.createObjectURL(e);o.onload=()=>{const u=document.createElement("canvas"),h=u.getContext("2d");if(!h){r(new Error("Could not get canvas context"));return}let c=o.width,f=o.height;if(c>t){const y=t/c;c=t,f=f*y}u.width=c,u.height=f,h.drawImage(o,0,0,c,f);const g=h.getImageData(0,0,c,f),v=us(g.data,c,f,a);URL.revokeObjectURL(d),n(v)},o.onerror=u=>r(u),o.src=d}),he=1500,fs=e=>e.map(t=>({re:t.x,im:t.y})),ms=e=>e&&e>0?e:he,ps=(e,t=he)=>{const a=ms(t);if(e.length<=a)return[...e];const n=Math.ceil(e.length/a);return e.filter((r,o)=>o%n===0)},Qe=(e,t,a=he)=>{const n=ps(e,a);return ns(n,t)},Ve=(e,t={})=>{const{smoothing:a=0,limit:n=he}=t,r=Qe(e,a,n),o=ss(fs(r));return{prepared:r,spectrum:o}},gs=(e,t,a,n=600)=>{if(!e.length||!t.length)return{energyPct:0,rmsError:0,topTerms:[],breakdown:[]};const r=e.map(j=>j.amp*j.amp),o=r.reduce((j,S)=>j+S,0)||1,d=Math.max(Math.min(a||e.length,e.length),1),u=r.slice(0,d).reduce((j,S)=>j+S,0);let h=0;const c=r.map(j=>(h+=j,{energyPct:j/o*100,cumulativePct:h/o*100}));let f=0;const g=e.slice(0,6).map((j,S)=>{const L=r[S];return f+=L,{freq:j.freq,amp:j.amp,phase:j.phase,energyPct:L/o*100,cumulativePct:f/o*100}}),v=t.length,y=Math.max(1,Math.floor(v/n)),w=e.slice(0,d);let x=0,b=0;for(let j=0;j<v;j+=y){let S=0,L=0;for(let q=0;q<w.length;q++){const D=w[q],W=2*Math.PI*D.freq*j/v,Y=Math.cos(W),G=Math.sin(W);S+=D.re*Y-D.im*G,L+=D.re*G+D.im*Y}const A=S-t[j].x,_=L-t[j].y;x+=A*A+_*_,b++}const M=Math.sqrt(x/Math.max(b,1));return{energyPct:Number((u/o*100).toFixed(2)),rmsError:Number(M.toFixed(2)),topTerms:g,breakdown:c}},xs=e=>Math.min(1,Math.max(0,e)),bs=(e,t)=>!isFinite(e)||t<=0?0:xs(e/t),de=(e,t,a=!1)=>{const n=bs(e,t),r=210+110*n,o=a?62:48+6*n,d=a?.95:.6;return`hsla(${r.toFixed(1)}, 82%, ${o.toFixed(1)}%, ${d})`},ys=e=>`linear-gradient(90deg, ${de(0,e)} 0%, ${de(e*.5,e)} 50%, ${de(e,e,!0)} 100%)`,vs=(e,t,a)=>de(e.amp,t,a),js=({mode:e,setMode:t,isPlaying:a,setIsPlaying:n,clear:r,numEpicycles:o,maxEpicycles:d,setNumEpicycles:u,onUpload:h,showMath:c,setShowMath:f,onPreset:g,speed:v,setSpeed:y,onReset:w,brushColor:x,setBrushColor:b,brushSize:M,setBrushSize:j,smoothing:S,setSmoothing:L,isDrawing:A,onSave:_,onLoad:q,savedDrawings:D,isFullscreen:W,onToggleFullscreen:Y,safeMode:G,onToggleSafeMode:U,stepMode:oe,onToggleStepMode:C,stepIndex:Z,stepMax:F,onStepPrev:V,onStepNext:Q,onStepPlayOnce:fe})=>{const K=m.useRef(null),$=k=>`
    p-2.5 rounded-lg transition-all duration-200 flex items-center justify-center
    ${k?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50 shadow-[0_0_15px_rgba(6,182,212,0.3)]":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 hover:text-slate-200 border border-transparent"}
  `;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"fourier-toolbar fourier-toolbar--top",children:[s.jsxs("div",{className:"flex gap-1 mr-4 pl-2",children:[s.jsx(gt,{className:"w-5 h-5 text-fuchsia-500"}),s.jsxs("span",{className:"font-bold text-slate-100 hidden sm:block",children:["Fourier",s.jsx("span",{className:"text-fuchsia-500",children:"Viz"})]})]}),s.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),s.jsx("button",{onClick:()=>t("DRAW"),className:$(e==="DRAW"),title:"Freehand Draw",children:s.jsx(xt,{size:20})}),s.jsxs("div",{className:"relative group",children:[s.jsx("button",{className:$(e==="PRESET"),title:"Presets",children:s.jsx(bt,{size:20})}),s.jsxs("div",{className:"absolute top-full left-0 mt-2 w-32 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden hidden group-hover:block",children:[s.jsx("button",{onClick:()=>g("circle"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Circle"}),s.jsx("button",{onClick:()=>g("square"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Square"}),s.jsx("button",{onClick:()=>g("heart"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Heart"}),s.jsx("button",{onClick:()=>g("infinity"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Infinity"}),s.jsx("button",{onClick:()=>g("note"),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Note"})]})]}),s.jsxs("div",{className:"relative group",children:[s.jsx("button",{className:$(!1),title:"Load Saved Drawing",children:s.jsx(yt,{size:20})}),s.jsx("div",{className:"absolute top-full left-0 mt-2 w-48 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden hidden group-hover:block max-h-60 overflow-y-auto custom-scrollbar",children:D.length===0?s.jsx("div",{className:"px-4 py-2 text-sm text-slate-500 italic",children:"No saved drawings"}):D.map(k=>s.jsx("button",{onClick:()=>q(k),className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400 truncate border-b border-slate-800 last:border-0",children:k},k))})]}),s.jsx("button",{onClick:_,className:$(!1),title:"Save Current Drawing",children:s.jsx(vt,{size:20})}),s.jsx("button",{onClick:()=>{var k;return(k=K.current)==null?void 0:k.click()},className:$(e==="UPLOAD"),title:"Upload Image",children:s.jsx(jt,{size:20})}),s.jsx("input",{type:"file",ref:K,onChange:h,accept:"image/*",className:"hidden"}),s.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),s.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-lg transition-all duration-300 ${A?"bg-fuchsia-900/20 ring-1 ring-fuchsia-500/50":""}`,children:[s.jsxs("div",{className:"relative flex items-center group",title:"Brush Color",children:[s.jsx(wt,{size:18,className:`${A?"text-fuchsia-400":"text-slate-400"} mr-2 transition-colors`}),s.jsx("input",{type:"color",value:x,onChange:k=>b(k.target.value),className:"w-6 h-6 rounded border-none cursor-pointer bg-transparent"})]}),s.jsxs("div",{className:"flex items-center gap-2",title:"Brush Size",children:[s.jsx(Be,{size:10,className:"text-slate-400"}),s.jsx("input",{type:"range",min:"1",max:"10",step:"0.5",value:M,onChange:k=>j(parseFloat(k.target.value)),className:"w-16 h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-slate-400"}),s.jsx(Be,{size:16,className:`text-slate-400 transition-all ${A?"scale-110 text-fuchsia-300":""}`})]})]}),s.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),s.jsx("button",{onClick:r,className:"p-2.5 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors",title:"Clear Canvas",children:s.jsx(Mt,{size:20})}),s.jsx("button",{onClick:()=>f(!c),className:$(c),title:"Toggle Math Panel",children:s.jsx(Et,{size:20})}),s.jsx("button",{onClick:U,className:$(G),title:"Toggle safe mode (cap epicycles / lighten rendering)",children:s.jsx(Nt,{size:20})}),s.jsx("button",{onClick:C,className:$(oe),title:"Toggle step-through playback",children:s.jsx(kt,{size:20})}),s.jsx("button",{onClick:Y,className:$(W),title:W?"Exit Fullscreen":"Fullscreen Play",children:W?s.jsx(St,{size:20}):s.jsx(Pt,{size:20})})]}),s.jsx("div",{className:"fourier-toolbar fourier-toolbar--bottom",children:s.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:w,className:"p-3 rounded-full bg-slate-800 text-slate-300 hover:bg-slate-700 hover:text-white transition-all",title:"Reset Animation",children:s.jsx(Lt,{size:18})}),s.jsx("button",{onClick:()=>n(!a),className:"w-14 h-14 flex items-center justify-center rounded-full bg-cyan-500 text-slate-950 hover:bg-cyan-400 transition-all shadow-[0_0_20px_rgba(6,182,212,0.4)]",children:a?s.jsx(Tt,{fill:"currentColor",size:24}):s.jsx(Ct,{fill:"currentColor",className:"ml-1",size:24})}),oe&&s.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/70 rounded-full px-3 py-2 border border-slate-700",children:[s.jsx("button",{onClick:V,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Previous term",children:s.jsx(Rt,{size:16})}),s.jsx("button",{onClick:fe,className:"px-3 py-2 rounded-full bg-amber-400 text-slate-900 font-semibold hover:bg-amber-300 transition",title:"Play this term once",children:"Step"}),s.jsx("button",{onClick:Q,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Next term",children:s.jsx(_t,{size:16})}),s.jsxs("span",{className:"text-xs text-slate-300 font-semibold ml-1",children:["Term ",Z+1," / ",Math.max(F,1)]})]})]}),s.jsxs("div",{className:"flex-1 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 w-full",children:[s.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[s.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[s.jsx("span",{children:"Precision"}),s.jsxs("span",{className:"text-cyan-400",children:[o," / ",d,G?" (capped)":""]})]}),s.jsx("input",{type:"range",min:"1",max:d||1,value:o,onChange:k=>u(parseInt(k.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),s.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[s.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(It,{size:12}),s.jsx("span",{children:"Speed"})]}),s.jsxs("span",{className:"text-amber-400",children:[v.toFixed(2),"x"]})]}),s.jsx("input",{type:"range",min:"0.05",max:"3",step:"0.05",value:v,onChange:k=>y(parseFloat(k.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-amber-500"})]}),s.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[s.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(At,{size:12}),s.jsx("span",{children:"Smoothness"})]}),s.jsxs("span",{className:"text-emerald-400",children:[S,"px"]})]}),s.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:S,onChange:k=>L(parseInt(k.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]})]})]})})]})},ws=({terms:e,time:t,epicycles:a,metrics:n,focusIndex:r,stepMode:o=!1})=>{var w;const d=m.useRef(null),[u,h]=m.useState("dft"),[c,f]=m.useState(0),g=m.useMemo(()=>{const x=e[0],b=e.length||1,M=(t/(2*Math.PI)).toFixed(2);return{n:b,largestRadius:x?x.amp.toFixed(1):"0.0",maxFreq:x?x.freq:0,phaseTurns:M,dominantPhase:x?x.phase.toFixed(2):"0.00"}},[e,t]),v=m.useMemo(()=>{const x=e[Math.min(c,Math.max(e.length-1,0))];return x||{freq:0,amp:0,phase:0}},[c,e]),y=n.breakdown?n.breakdown[Math.min(c,Math.max(n.breakdown.length-1,0))]??{energyPct:0,cumulativePct:0}:{energyPct:0,cumulativePct:0};return m.useEffect(()=>{var _,q;if(!d.current)return;const{n:x,phaseTurns:b,dominantPhase:M}=g,j=Math.max(a,1),S=((_=e[0])==null?void 0:_.freq)??0,L=((q=e[0])==null?void 0:q.amp)??0,A={dft:`
      \\begin{aligned}
        X_k &= \\frac{1}{N} \\sum_{n=0}^{N-1} x_n e^{-i 2\\pi kn / N} \\\\
        &\\textcolor{#f472b6}{N = ${x}},\\; \\textcolor{#22c55e}{k \\in [0, N-1]}
      \\end{aligned}
      `,reconstruction:`
      \\begin{aligned}
        x(t) &\\approx \\sum_{k=0}^{${j-1}} \\left|X_k\\right| e^{i\\left(2\\pi kt/${x} + \\phi_k\\right)} \\\\
        &\\textcolor{#22c55e}{\\left|X_{${S}}\\right| = ${L.toFixed(2)}},\\;
          \\textcolor{#f472b6}{\\phi_{${S}} = ${M}}\\;\\text{rad}
      \\end{aligned}
      `,phasor:`
      \\begin{aligned}
        \\text{Epicycle}_k(t) &= r_k e^{i(\\omega_k t + \\phi_k)} \\\\
        r_k &= \\left|X_k\\right|,\\;
        \\omega_k = 2\\pi k / N,\\;
        t = ${b}\\,\\tau
      \\end{aligned}
      `};Ft.render(A[u],d.current,{throwOnError:!1,displayMode:!0})},[u,a,g,e]),m.useEffect(()=>{h("dft"),f(0)},[e.length]),m.useEffect(()=>{if(typeof r=="number"&&e.length>0){const x=Math.min(Math.max(r,0),e.length-1);f(x)}},[r,e.length]),s.jsxs("div",{className:"fourier-math-panel",children:[s.jsx("h3",{className:"text-xl font-bold mb-4 text-cyan-400",children:"Fourier Engine"}),s.jsxs("div",{className:"fourier-math-toggle",role:"group","aria-label":"Toggle formulas",children:[s.jsx("button",{type:"button",className:u==="dft"?"is-active":"",onClick:()=>h("dft"),children:"DFT basis"}),s.jsx("button",{type:"button",className:u==="reconstruction"?"is-active":"",onClick:()=>h("reconstruction"),children:"Reconstruction"}),s.jsx("button",{type:"button",className:u==="phasor"?"is-active":"",onClick:()=>h("phasor"),children:"Phasor anatomy"})]}),s.jsx("div",{className:"mb-4",ref:d,"aria-live":"polite"}),s.jsxs("div",{className:"space-y-4 text-sm font-mono",children:[s.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[s.jsx("span",{className:"text-slate-400",children:"Total Vectors (N)"}),s.jsx("span",{className:"text-cyan-300",children:e.length})]}),s.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[s.jsx("span",{className:"text-slate-400",children:"Active Epicycles"}),s.jsx("span",{className:"text-fuchsia-400",children:a})]}),s.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[s.jsx("span",{className:"text-slate-400",children:"Current Phase (t)"}),s.jsxs("span",{className:"text-amber-400",children:[(t/(2*Math.PI)).toFixed(2),"œÑ"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-400",children:"Largest Radius"}),s.jsxs("span",{className:"text-emerald-400",children:[e.length>0?e[0].amp.toFixed(1):"0.0"," px"]})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Amplitude color map"}),s.jsx("div",{className:"fourier-legend",style:{backgroundImage:ys(((w=e[0])==null?void 0:w.amp)||1)},"aria-label":"Amplitude legend from low to high magnitude"}),s.jsxs("div",{className:"flex justify-between text-[11px] text-slate-500 mt-1",children:[s.jsx("span",{children:"low |X_k|"}),s.jsx("span",{children:"high |X_k|"})]})]}),s.jsxs("div",{className:"mt-4 space-y-2 text-sm font-mono",children:[s.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[s.jsx("span",{className:"text-slate-400",children:"Energy captured (M terms)"}),s.jsxs("span",{className:"text-cyan-300",children:[n.energyPct.toFixed(2),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-400",children:"RMS error vs. original path"}),s.jsxs("span",{className:"text-amber-300",children:[n.rmsError.toFixed(2)," px"]})]})]}),n.topTerms.length>0&&s.jsxs("div",{className:"mt-4",children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Top terms (by amplitude)"}),s.jsxs("div",{className:"grid grid-cols-5 text-[11px] text-slate-300 gap-2 border border-slate-800 rounded-lg p-2",children:[s.jsx("span",{className:"font-semibold text-slate-200",children:"k"}),s.jsx("span",{className:"font-semibold text-slate-200",children:"|X_k|"}),s.jsx("span",{className:"font-semibold text-slate-200",children:"phase"}),s.jsx("span",{className:"font-semibold text-slate-200",children:"energy"}),s.jsx("span",{className:"font-semibold text-slate-200",children:"cum."}),n.topTerms.map((x,b)=>s.jsxs(Ee.Fragment,{children:[s.jsx("span",{children:x.freq}),s.jsx("span",{children:x.amp.toFixed(2)}),s.jsxs("span",{children:[x.phase.toFixed(2)," rad"]}),s.jsxs("span",{children:[x.energyPct.toFixed(1),"%"]}),s.jsxs("span",{children:[x.cumulativePct.toFixed(1),"%"]})]},b))]})]}),s.jsxs("div",{className:"mt-5 border border-slate-800 rounded-lg p-3 space-y-2 bg-slate-900/40",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-slate-400",children:[s.jsx("span",{children:"Term inspector"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>f(x=>Math.max(0,x-1)),"aria-label":"Previous term",children:"‚Äπ"}),s.jsxs("span",{className:"text-slate-200",children:[c+1," / ",e.length||1]}),s.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>f(x=>Math.min(e.length-1,x+1)),"aria-label":"Next term",children:"‚Ä∫"})]})]}),s.jsxs("div",{className:"text-xs text-slate-200 font-mono leading-relaxed",children:[s.jsxs("p",{children:["k = ",v.freq,", |X_k| = ",v.amp.toFixed(3),", œÜ_k = ",v.phase.toFixed(3)," rad"]}),s.jsxs("p",{children:["Vector(t) = |X_k| ¬∑ e",s.jsx("sup",{children:"i(2œÄkt/N + œÜ_k)"})]}),s.jsxs("p",{children:["Œîenergy = ",y.energyPct.toFixed(2),"% ¬∑ Cumulative = ",y.cumulativePct.toFixed(2),"%"]}),s.jsx("p",{children:o?"Step mode: play once to view this term, then advance.":"Track this circle while playing to see how its phase and magnitude shape the trace."})]})]}),s.jsxs("div",{className:"mt-5 text-xs text-slate-500 italic space-y-2",children:[s.jsx("p",{children:"* Sorted by amplitude so the largest circles draw first."}),s.jsx("p",{children:"Tip: switch formulas to see how truncating to M epicycles shapes the path."})]})]})},we=1600,Me=700,Ms=2.5,Es=.6,Ns=3e6,Ye="fourier_viz__last_session",ks=()=>{var Fe,$e,ze,Oe,qe;const[e,t]=m.useState("DRAW"),[a,n]=m.useState([]),[r,o]=m.useState([]),[d,u]=m.useState(0),[h,c]=m.useState(!1),[f,g]=m.useState(0),[v,y]=m.useState(!0),[w,x]=m.useState(!1),[b,M]=m.useState("#0f172a"),[j,S]=m.useState("rgba(148, 163, 184, 0.22)"),[L,A]=m.useState(Es),[_,q]=m.useState(0),[D,W]=m.useState([]),[Y,G]=m.useState(!1),[U,oe]=m.useState(!1),[C,Z]=m.useState(!1),[F,V]=m.useState(0),[Q,fe]=m.useState("#ec4899"),[K,$]=m.useState(2),[k,Pe]=m.useState(!1),ee=m.useRef(null),ae=m.useRef(null),me=m.useRef(),B=m.useRef([]),re=m.useRef(!1),I=m.useRef(null),J=m.useRef(null),H=m.useCallback(()=>{if(I.current){const i=I.current.getContext("2d");i==null||i.clearRect(0,0,I.current.width,I.current.height)}J.current=null},[]),ie=m.useCallback(()=>{const i=ae.current,l=ee.current;if(!i||!l)return;const{width:p,height:N}=l.getBoundingClientRect(),P=Math.max(p,360),E=Math.max(N,360);i.width=P,i.height=E,i.style.width=`${P}px`,i.style.height=`${E}px`,I.current||(I.current=document.createElement("canvas")),I.current.width=P,I.current.height=E,H()},[H]),Le=()=>{u(0),H()},tt=()=>{Le()};m.useEffect(()=>{const i=Object.keys(localStorage).filter(p=>p.startsWith("fourier_viz_")).map(p=>p.replace("fourier_viz_","")).sort();W(i);const l=localStorage.getItem(Ye);if(l)try{const p=JSON.parse(l);p.length&&(t("PRESET"),n(p),te(p))}catch{}},[te]),m.useEffect(()=>{const i=()=>{const p=getComputedStyle(document.documentElement),N=p.getPropertyValue("--color-code-bg").trim(),P=p.getPropertyValue("--fourier-grid").trim();M(N||"#0f172a"),S(P||"rgba(148, 163, 184, 0.22)")};i();const l=typeof MutationObserver<"u"?new MutationObserver(i):null;return l&&(l.observe(document.documentElement,{attributes:!0,attributeFilter:["class","data-theme"]}),l.observe(document.body,{attributes:!0,attributeFilter:["class","data-theme"]})),()=>l==null?void 0:l.disconnect()},[]),m.useEffect(()=>{const i=U?Math.min(r.length,Me):r.length;i!==0&&g(l=>Math.min(Math.max(l||1,1),i))},[r.length,U]),m.useEffect(()=>{!C&&F!==0&&V(0)},[C,F]),m.useEffect(()=>{const i=()=>{G(document.fullscreenElement===ee.current),ie()};return document.addEventListener("fullscreenchange",i),()=>document.removeEventListener("fullscreenchange",i)},[ie]);const st=m.useCallback(()=>{const i=ee.current;i&&(document.fullscreenElement?document.exitFullscreen().catch(()=>{}):i.requestFullscreen().catch(()=>{}))},[]),te=m.useCallback(i=>{if(i.length===0)return;const l=U?Me:we,{prepared:p,spectrum:N}=Ve(i,{smoothing:_,limit:l});n(p),o(N),g(Math.min(N.length,l));try{localStorage.setItem(Ye,JSON.stringify(p))}catch{}Le(),c(!0),V(0)},[_,U]),se=Ee.useMemo(()=>gs(r,a,f),[r,f,a]),Te=i=>{if(e!=="DRAW")return;re.current=!0,Pe(!0),n([]),H(),o([]),c(!1);const l=ae.current.getBoundingClientRect(),p=i.clientX-l.left-l.width/2,N=i.clientY-l.top-l.height/2,P={x:p,y:N};n([P]),B.current=[P]},Ce=i=>{if(!re.current||e!=="DRAW")return;const l=ae.current.getBoundingClientRect(),p=i.clientX-l.left-l.width/2,N=i.clientY-l.top-l.height/2,P={x:p,y:N},E=B.current[B.current.length-1];if(Math.hypot(P.x-E.x,P.y-E.y)>Ms&&(n(T=>[...T,P]),B.current.push(P),B.current.length%5===0&&B.current.length>2)){const T=B.current,X=Ve(T,{smoothing:_,limit:we});o(X.spectrum),g(X.spectrum.length),H(),c(!0)}},Re=()=>{if(!re.current)return;re.current=!1,Pe(!1);const i=B.current,l=Qe(i,_,we);n(l),te(l)},nt=()=>{n([]),H(),o([]),c(!1),t("DRAW"),V(0),Z(!1),B.current=[]},at=i=>{let l=[];switch(i){case"circle":l=rs();break;case"square":l=as();break;case"heart":l=os();break;case"infinity":l=is();break;case"note":l=ls();break}t("PRESET"),n(l),te(l)},rt=()=>{if(a.length<2){alert("Draw something first!");return}const i=prompt("Enter a name for this drawing:");if(i)try{localStorage.setItem(`fourier_viz_${i}`,JSON.stringify(a)),W(l=>{const p=[...l];return p.includes(i)||p.push(i),p.sort()})}catch{alert("Failed to save. Storage might be full.")}},ot=i=>{const l=localStorage.getItem(`fourier_viz_${i}`);if(l)try{const p=JSON.parse(l);n(p),t("PRESET"),te(p)}catch(p){console.error("Error loading drawing",p)}},it=async i=>{if(i.target.files&&i.target.files[0]){const l=i.target.files[0];if(l.size>Ns){alert("File too large for browser processing. Please pick an image under 3MB.");return}x(!0);try{const p=await hs(l);p.length>0?(n(p),t("UPLOAD"),te(p)):alert("No clear shape found. Try an image with higher contrast.")}catch(p){console.error(p),alert("Error processing image.")}finally{x(!1)}}},_e=i=>{if(!r.length)return;Z(!0);const l=Math.min(Math.max(i,0),Math.max(z-1,0));V(l);const p=l+1;f!==p&&g(p),u(0),H(),J.current=null},lt=()=>_e(F-1),ct=()=>_e(F+1),dt=()=>{C||Z(!0),c(!0)},ut=(i,l,p,N,P)=>{let E=l/2,T=p/2;const X=r.slice(0,Math.max(f,1));for(let O=0;O<X.length;O++){const R=E,pe=T,{freq:ge,amp:ne,phase:De}=X[O],le=ge*d+De,xe=O===N,be=vs(X[O],P,xe),mt=C&&xe?1+.25*Math.sin(d*6):1;E+=ne*Math.cos(le),T+=ne*Math.sin(le),i.strokeStyle=be,i.lineWidth=xe?1.6*mt:1,i.beginPath(),i.arc(R,pe,ne,0,2*Math.PI),i.stroke(),i.strokeStyle=be,i.beginPath(),i.moveTo(R,pe),i.lineTo(E,T),i.stroke(),O===X.length-1&&(i.fillStyle=be,i.beginPath(),i.arc(E,T,3,0,2*Math.PI),i.fill())}return{x:E,y:T}},Ie=m.useCallback(()=>{var P;const i=ae.current;if(!i)return;const l=i.getContext("2d");if(!l)return;const p=i.width,N=i.height;if(l.fillStyle=b,l.fillRect(0,0,p,N),l.strokeStyle=j,l.lineWidth=.5,l.beginPath(),l.moveTo(p/2,0),l.lineTo(p/2,N),l.moveTo(0,N/2),l.lineTo(p,N/2),l.stroke(),a.length>0&&e!=="DRAW"&&(l.strokeStyle="rgba(255, 255, 255, 0.1)",l.lineWidth=1,l.beginPath(),a.forEach((E,T)=>{T===0?l.moveTo(E.x+p/2,E.y+N/2):l.lineTo(E.x+p/2,E.y+N/2)}),l.stroke()),e==="DRAW"&&re.current&&(l.strokeStyle=Q,l.lineWidth=K,l.beginPath(),B.current.forEach((E,T)=>{T===0?l.moveTo(E.x+p/2,E.y+N/2):l.lineTo(E.x+p/2,E.y+N/2)}),l.stroke()),r.length>0){I.current&&l.drawImage(I.current,0,0);const E=Math.min(Math.max(f,1),r.length),T=Math.max(E-1,0),X=((P=r[0])==null?void 0:P.amp)||1,O=ut(l,p,N,T,X);if(I.current){const R=I.current.getContext("2d");R&&(R.strokeStyle=Q,R.lineWidth=K,R.lineCap="round",R.lineJoin="round",J.current&&(R.beginPath(),R.moveTo(J.current.x,J.current.y),R.lineTo(O.x,O.y),R.stroke()))}if(J.current={x:O.x,y:O.y},h){const R=Math.max(f||r.length,1),ge=2*Math.PI/R*L,ne=d+ge;ne>=2*Math.PI?(u(0),H(),J.current=null,C&&(c(!1),V(le=>Math.min(le+1,Math.max(z-1,0))))):u(ne)}}},[r,h,d,e,a,f,L,Q,K,b,j,C,z]);m.useEffect(()=>(me.current=requestAnimationFrame(Ie),()=>{me.current&&cancelAnimationFrame(me.current)}),[Ie]),m.useEffect(()=>{const i=()=>ie();i();const l=typeof ResizeObserver<"u"?new ResizeObserver(i):null;return l&&ee.current&&l.observe(ee.current),window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i),l==null||l.disconnect()}},[ie]),m.useEffect(()=>{H()},[f,r]),m.useEffect(()=>{const i=document.getElementById("fourier-root");return i==null||i.classList.add("is-mounted"),()=>{i==null||i.classList.remove("is-mounted")}},[]);const z=U?Math.min(r.length,Me):r.length,Ae=Math.max(Math.min(f-1,(((Fe=se.breakdown)==null?void 0:Fe.length)||1)-1),0),ht=((ze=($e=se.breakdown)==null?void 0:$e[Ae])==null?void 0:ze.energyPct)??0,ft=((qe=(Oe=se.breakdown)==null?void 0:Oe[Ae])==null?void 0:qe.cumulativePct)??se.energyPct;return m.useEffect(()=>{if(!C)return;const i=Math.min(Math.max(F+1,1),Math.max(z,1));f!==i&&g(i)},[C,F,z,f]),m.useEffect(()=>{const i=Math.max(Math.min(f-1,z-1),0);F>i&&V(i)},[f,z,F]),s.jsxs("div",{className:`fourier-stage select-none ${Y?"is-fullscreen":""}`,ref:ee,children:[s.jsx("canvas",{ref:ae,onMouseDown:Te,onMouseMove:Ce,onMouseUp:Re,onTouchStart:i=>{const l=i.touches[0];Te({clientX:l.clientX,clientY:l.clientY})},onTouchMove:i=>{const l=i.touches[0];Ce({clientX:l.clientX,clientY:l.clientY})},onTouchEnd:Re,className:`fourier-canvas cursor-${e==="DRAW"?"crosshair":"default"}`}),s.jsx(js,{mode:e,setMode:t,isPlaying:h,setIsPlaying:c,clear:nt,numEpicycles:f,maxEpicycles:z,setNumEpicycles:g,onUpload:it,showMath:v,setShowMath:y,onPreset:at,speed:L,setSpeed:A,onReset:tt,brushColor:Q,setBrushColor:fe,brushSize:K,setBrushSize:$,smoothing:_,setSmoothing:q,isDrawing:k,onSave:rt,onLoad:ot,savedDrawings:D,isFullscreen:Y,onToggleFullscreen:st,safeMode:U,onToggleSafeMode:()=>oe(i=>!i),stepMode:C,onToggleStepMode:()=>Z(i=>!i),stepIndex:F,stepMax:z,onStepPrev:lt,onStepNext:ct,onStepPlayOnce:dt}),v&&r.length>0&&s.jsx(ws,{terms:r,time:d,epicycles:f,metrics:se,focusIndex:C?Math.max(f-1,0):void 0,stepMode:C}),C&&r.length>0&&s.jsxs("div",{className:"absolute top-4 left-4 z-[60] bg-slate-900/80 text-slate-100 border border-slate-700 rounded-lg px-4 py-3 shadow-lg space-y-1",children:[s.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Step mode"}),s.jsxs("div",{className:"text-sm font-semibold",children:["Term ",Math.min(f,z)," / ",Math.max(z,1)]}),s.jsxs("div",{className:"text-xs text-slate-200",children:["Œîenergy ",ht.toFixed(2),"% ¬∑ Cumulative ",ft.toFixed(2),"% ¬∑ RMS ",se.rmsError.toFixed(2)," px"]})]}),w&&s.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100]",children:s.jsx("div",{className:"text-cyan-400 font-mono text-xl animate-pulse",children:"Processing Image..."})}),e==="DRAW"&&a.length===0&&s.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none text-center",children:[s.jsx("h1",{className:"text-4xl font-bold text-slate-700 mb-2",children:"Draw Something"}),s.jsx("p",{className:"text-slate-500",children:"Trace a continuous line to begin"})]})]})};es("fourier-epicycles");const et=document.getElementById("fourier-root");if(!et)throw new Error("Could not find root element to mount to");const Ss=pt.createRoot(et);Ss.render(s.jsx(Ee.StrictMode,{children:s.jsx(ks,{})}));
