import{r as b,j as i,R as pt,a as Mn}from"./react-vendor-CkISVyWX.js";import{A as jn,P as kn,S as En,F as Nn,a as Sn,I as Pn,b as Ln,C as At,T as Tn,c as Cn,d as In,e as Ft,Z as Rn,f as An,L as Fn,H as _n,M as zn,g as $n,R as Dn,h as On,i as qn,j as Xn,k as Un,l as Wn,G as Bn,W as Hn,m as Vn,n as Yn}from"./icons-vendor-bBDW9dcb.js";import{k as Je}from"./math-vendor-Ca7EfnBD.js";import"./vendor-Bb8JjhAW.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Kn=[{id:"about",label:"About"},{id:"learning",label:"Learning"},{id:"posts",label:"Posts"},{id:"projects",label:"Projects"},{id:"experience",label:"Experience"},{id:"education",label:"Education"},{id:"contact",label:"Contact"}],Vt=[{id:"circuit-lab",label:"Circuit Lab",href:"pages/circuit-lab/"},{id:"transformer-lab",label:"Transformer Lab",href:"pages/transformer-lab/"},{id:"ml-playground",label:"ML Playground",href:"pages/ml-playground/"},{id:"fourier-epicycles",label:"Fourier Epicycles",href:"pages/fourier-epicycles/"},{id:"endless-depths",label:"Endless Depths",href:"pages/endless-depths/"}],Gn="Ka Ming Lui";function Yt(e){return e?e==="/"?"/":e.endsWith("/")?e:`${e}/`:""}function gt(e=""){var o,c;const t=((o=document.documentElement)==null?void 0:o.dataset.navRoot)??((c=document.body)==null?void 0:c.dataset.navRoot)??null;if(typeof t=="string"&&t.trim())return Yt(t.trim());const s=(typeof e=="string"?e:"").split(/[?#]/)[0].replace(/\\/g,"/").split("/").filter(Boolean);return s.length&&s[s.length-1].includes(".")&&s.pop(),s.length===0?"":"../".repeat(s.length)}function Zn(e=""){var o,c;const t=((o=document.body)==null?void 0:o.dataset.currentLab)??((c=document.documentElement)==null?void 0:c.dataset.currentLab)??null;if(t)return t;const r=(typeof e=="string"?e:"").toLowerCase().replace(/\\/g,"/"),s=Vt.find(l=>r.includes(`/${l.id.toLowerCase()}/`));return(s==null?void 0:s.id)??null}function Jn({rootPrefix:e,useLocalAnchors:t}){return Kn.map(({id:n,label:r})=>`<li><a href="${t?`#${n}`:`${e}index.html#${n}`}">${r}</a></li>`).join("")}function Qn({rootPrefix:e,currentLabId:t}){return Vt.map(({id:n,label:r,href:s})=>`<li><a href="${s.startsWith("http")?s:`${e}${s}`}"${n===t?' aria-current="page"':""}>${r}</a></li>`).join("")}function Kt(e={}){var m,M,k;const t=e.target??document.querySelector("[data-site-header]")??document.querySelector(".site-header");if(!t)return null;const n=t.querySelector(".nav");if(!(t.hasAttribute("data-site-header")||e.forceRender===!0)&&n||t.dataset.navRendered==="true"&&n)return n;const s=typeof e.rootPrefix=="string"&&e.rootPrefix.trim()||typeof((m=t==null?void 0:t.dataset)==null?void 0:m.navRoot)=="string"&&t.dataset.navRoot.trim(),o=Yt(s??gt((M=window.location)==null?void 0:M.pathname)),c=e.useLocalAnchors??(o===""||t.dataset.useLocalAnchors==="true"),l=e.currentLab??t.dataset.currentLab??Zn((k=window.location)==null?void 0:k.pathname),f=e.showEditToggle===!0||t.dataset.showEditToggle==="true",p=c?"#hero":`${o}index.html#hero`,u=Jn({rootPrefix:o,useLocalAnchors:c}),x=Qn({rootPrefix:o,currentLabId:l}),g=`
    <div class="container">
      <nav class="nav" aria-label="Primary">
        <a class="logo" href="${p}">${Gn}</a>
        <button class="nav-toggle" type="button" aria-expanded="false" aria-controls="primary-navigation">
          <span class="nav-toggle__bar"></span>
          <span class="nav-toggle__bar"></span>
          <span class="nav-toggle__bar"></span>
          <span class="sr-only">Toggle navigation</span>
        </button>
        <ul class="nav-links" id="primary-navigation" data-visible="false">
          <li class="nav-item nav-item--dropdown">
            <button class="nav-dropdown-toggle nav-pill" type="button" aria-expanded="false" aria-controls="section-menu">
              Sections
              <svg class="nav-dropdown__icon" aria-hidden="true" focusable="false" viewBox="0 0 12 12">
                <path d="M2.47 4.47a.75.75 0 0 1 1.06 0L6 6.94l2.47-2.47a.75.75 0 0 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 0 1 0-1.06Z" />
              </svg>
            </button>
            <ul class="nav-dropdown-menu" id="section-menu" hidden>
              ${u}
            </ul>
          </li>
          <li class="nav-item nav-item--dropdown">
            <button class="nav-dropdown-toggle nav-pill" type="button" aria-expanded="false" aria-controls="labs-menu">
              Labs
              <svg class="nav-dropdown__icon" aria-hidden="true" focusable="false" viewBox="0 0 12 12">
                <path d="M2.47 4.47a.75.75 0 0 1 1.06 0L6 6.94l2.47-2.47a.75.75 0 0 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 0 1 0-1.06Z" />
              </svg>
            </button>
            <ul class="nav-dropdown-menu" id="labs-menu" hidden>
              ${x}
            </ul>
          </li>
        </ul>
        <div class="nav-actions">
          ${f?'<button class="edit-toggle" type="button" aria-pressed="false" hidden>Edit mode</button>':""}
          <button class="theme-toggle" type="button" aria-label="Toggle color theme">
            <span aria-hidden="true">üåô</span>
          </button>
        </div>
      </nav>
    </div>
  `;return t.innerHTML=g.trim(),t.id=t.id||"top",t.classList.add("site-header"),t.dataset.navRendered="true",t.querySelector(".nav")}const nt='&copy; <span id="year"></span> Ka Ming Lui. Built with accessibility and performance in mind.',_t={home:{id:"home",layoutClass:"footer__layout",useContentBindings:!0,backToTopLabel:"Back to top"},"ml-playground":{layoutClass:"footer__layout",heading:"Want to explore more ML demos?",body:"Try the transformer lab or reach out to share your favorite visualization ideas.",actions:[{label:"Visit Transformer Lab",href:"pages/transformer-lab/",variant:"primary"},{label:"Email Ka-Ming",href:"mailto:contact@kaminglui.com",variant:"ghost"}],meta:["Curious how this playground works? Inspect the source on GitHub to tweak the algorithm.",nt]},"transformer-lab":{layoutClass:"footer__layout",heading:"Ready for more machine learning stories?",body:"Head back to the main site to explore projects, journal entries, and the learning roadmap behind this transformer lab.",actions:[{label:"View projects",href:"index.html#projects",variant:"primary"},{label:"Get in touch",href:"index.html#contact",variant:"ghost"}],meta:["Enjoyed the walkthrough? Share it with fellow ML explorers.",nt]},"endless-depths":{layoutClass:"footer__layout",heading:"Back to the main site?",body:"Check out projects, posts, and the ML roadmap that inspired this mini-game.",actions:[{label:"View projects",href:"index.html#projects",variant:"primary"},{label:"Get in touch",href:"index.html#contact",variant:"ghost"}],meta:["Progress saves to your browser so you can pick up where you left off.",'&copy; <span id="year"></span> Ka Ming Lui. Built for performance and accessibility.']}};function et(e){return e?e==="/"?"/":e.endsWith("/")?e:`${e}/`:""}function es(e,t){var r,s,o;if(typeof t=="string"&&t.trim())return et(t.trim());const n=((r=e==null?void 0:e.dataset)==null?void 0:r.footerRoot)||((s=e==null?void 0:e.dataset)==null?void 0:s.navRoot);return typeof n=="string"&&n.trim()?et(n.trim()):et(gt((o=window.location)==null?void 0:o.pathname))}function ts(e,t){var r,s;const n=t||((r=e==null?void 0:e.dataset)==null?void 0:r.footerId)||((s=e==null?void 0:e.dataset)==null?void 0:s.footerPreset)||"home";return _t[n]||_t.home}function ns(e=[],t=""){if(!Array.isArray(e)||e.length===0)return"";const n=et(t);return e.map(({label:r,href:s,variant:o})=>{if(!r||!s)return"";const l=/^(https?:)?\/\//i.test(s)||s.startsWith("mailto:")||s.startsWith("#")?s:`${n}${s}`,f=["button"];return o==="primary"&&f.push("button--primary"),o==="ghost"&&f.push("button--ghost"),`<a class="${f.join(" ")}" href="${l}">${r}</a>`}).filter(Boolean).join("")}function zt(e=[]){return!Array.isArray(e)||e.length===0?"":e.map(t=>`<p>${t}</p>`).join("")}function ss(e={}){const t=e.target??document.querySelector("[data-site-footer]")??document.querySelector(".site-footer");if(!t)return null;if(t.dataset.footerRendered==="true"||!t.hasAttribute("data-site-footer")&&e.forceRender!==!0)return t;const n=ts(t,e.preset),r=es(t,e.rootPrefix),s=n.layoutClass||"footer__layout";let o="",c="",l="",f="";n.useContentBindings?(o='<h2 data-content="contact.title"></h2>',c='<p data-content="contact.body"></p>',l='<div class="footer__actions" data-contact-actions></div>',f='<p data-content="contact.meta"></p>'+zt([nt])):(o=n.heading?`<h2>${n.heading}</h2>`:"",c=n.body?`<p>${n.body}</p>`:"",l=`<div class="footer__actions">${ns(n.actions,r)}</div>`,f=zt(n.meta||[nt]));const p=n.backToTopLabel||"Back to top";return t.innerHTML=`
    <div class="container ${s}">
      <div>
        ${o}
        ${c}
        ${l}
      </div>
      <div class="footer__meta">
        ${f}
      </div>
    </div>
    <a class="back-to-top" href="#top">${p}</a>
  `.trim(),t.classList.add("site-footer"),t.dataset.footerRendered="true",t}function rs(){const e=document.getElementById("year")||document.querySelector("[data-year]");e&&(e.textContent=String(new Date().getFullYear()))}const xt=["theme","circuitforge-theme"];function os(){if(typeof localStorage>"u")return null;for(const e of xt){const t=localStorage.getItem(e);if(t==="dark"||t==="light")return t}return null}function as(e){typeof localStorage>"u"||xt.forEach(t=>{try{localStorage.setItem(t,e)}catch(n){console.warn("Unable to store theme preference",n)}})}function ut(e){const t=e==="light"?"light":"dark";return typeof document>"u"||(document.body.classList.toggle("theme-dark",t==="dark"),document.body.classList.toggle("theme-light",t==="light"),document.documentElement.classList.toggle("dark",t==="dark"),as(t)),t}function dt(e,t){e&&(e.setAttribute("aria-pressed",t==="dark"?"true":"false"),e.innerHTML=t==="dark"?'<span aria-hidden="true">üåô</span>':'<span aria-hidden="true">‚òÄÔ∏è</span>')}function is(){const e=os();return e||(typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}function cs({onChange:e}={}){const t=document.querySelector(".theme-toggle"),n=(t==null?void 0:t.dataset.themeBound)==="true",r=ut(is());dt(t,r);const s=l=>{typeof e=="function"&&e(l)},o=l=>{if(typeof localStorage<"u"&&localStorage.getItem(xt[0]))return;const f=ut(l.matches?"dark":"light");dt(t,f),s(f)},c=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-color-scheme: dark)"):null;return c&&(typeof c.addEventListener=="function"?c.addEventListener("change",o):typeof c.addListener=="function"&&c.addListener(o)),t&&!n&&(t.dataset.themeBound="true",t.addEventListener("click",()=>{const l=document.body.classList.contains("theme-dark")?"dark":"light",f=ut(l==="dark"?"light":"dark");dt(t,f),s(f)})),s(r),r}function Gt(e){if(!e||!e.getBoundingClientRect)return;const{height:t}=e.getBoundingClientRect();Number.isFinite(t)&&t>0&&(document.documentElement.style.setProperty("--nav-height",`${t}px`),document.documentElement.style.setProperty("--header-h",`${t}px`))}function ls(e){if(!e)return;const t=()=>Gt(e);if(typeof ResizeObserver<"u"){const n=new ResizeObserver(t);return n.observe(e),n}return window.addEventListener("resize",t),null}function yt(e){var t;return typeof e=="string"&&e.trim()?e.trim():typeof document<"u"?gt((t=window.location)==null?void 0:t.pathname):""}function us(e={}){const t=e.target??document.getElementById("site-header")??document.querySelector("[data-site-header]");if(!t)return null;const n=e.pageId||e.currentLab||t.dataset.currentLab,r=yt(e.rootPrefix||t.dataset.navRoot),s=e.showEditToggle??t.dataset.showEditToggle==="true",o=e.useLocalAnchors??n==="home";t.id="top",t.dataset.siteHeader="true",t.dataset.currentLab=n||"",t.dataset.navRoot=r||"";const c=Kt({target:t,currentLab:n,rootPrefix:r,useLocalAnchors:o,showEditToggle:s}),l=(c==null?void 0:c.closest("[data-site-header]"))||t;return Gt(l),ls(l),l}function ds(e={}){const t=e.target??document.getElementById("site-footer")??document.querySelector("[data-site-footer]");if(!t)return null;const n=e.pageId||e.preset||t.dataset.footerId,r=yt(e.rootPrefix||t.dataset.footerRoot);t.dataset.siteFooter="true",t.dataset.footerId=n||"home",t.dataset.footerRoot=r||"";const s=ss({target:t,preset:n||"home",rootPrefix:r});return s&&rs(),s}function fs(e="home",t={}){var s,o;const n=e||((o=(s=document.body)==null?void 0:s.dataset)==null?void 0:o.currentLab)||"home",r=yt(t.rootPrefix);us({pageId:n,rootPrefix:r,showEditToggle:t.showEditToggle,useLocalAnchors:t.useLocalAnchors}),cs(t.themeOptions||{}),n!=="circuit-lab"&&ds({pageId:n,rootPrefix:r})}fs("fourier-epicycles");let $t=!1,ft=!1;function hs(){if(ft)return;const t=Kt()??document.querySelector(".nav"),n=(t==null?void 0:t.querySelector(".nav-toggle"))??document.querySelector(".nav-toggle"),r=(t==null?void 0:t.querySelector(".nav-links"))??document.querySelector(".nav-links");if(!t||!n||!r)return;if(t.dataset.navEnhanced==="true"){ft=!0;return}const s=document.body,o=Array.from(t.querySelectorAll(".nav-item--dropdown")),c=[],l=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(hover: none)"):null,f=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(hover: hover)"):null,p=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(pointer: fine)"):null,u=()=>{const h=(l==null?void 0:l.matches)??!1,g=(f==null?void 0:f.matches)??!1,m=(p==null?void 0:p.matches)??!1;return h||!g||!m},x=({except:h}={})=>{let g=!1;return c.forEach(m=>{m!==h&&m.isOpen()&&(m.close(),g=!0)}),g};if(o.forEach(h=>{const g=h.querySelector(".nav-dropdown-toggle"),m=h.querySelector(".nav-dropdown-menu");if(!(g instanceof HTMLElement)||!(m instanceof HTMLElement))return;let M=null;const k=()=>{M!==null&&(window.clearTimeout(M),M=null)},E=()=>{u()||(k(),M=window.setTimeout(()=>{!h.matches(":hover")&&!m.matches(":hover")&&!g.matches(":hover")&&y.close()},220))},y={wrapper:h,toggle:g,menu:m,isOpen:()=>g.getAttribute("aria-expanded")==="true",open:()=>{g.setAttribute("aria-expanded","true"),h.setAttribute("data-open","true"),m.hidden=!1,k()},close:()=>{g.setAttribute("aria-expanded","false"),h.setAttribute("data-open","false"),m.hidden=!0,k()}};y.close(),c.push(y);const j=()=>{x({except:y}),y.open()},T=()=>{u()||(k(),j())},z=()=>{u()||E()};h.addEventListener("pointerenter",T),h.addEventListener("pointerleave",z),g.addEventListener("pointerenter",T),g.addEventListener("pointerleave",z),m.addEventListener("pointerenter",T),m.addEventListener("pointerleave",z),h.addEventListener("focusin",N=>{const C=N.target;u()&&C instanceof HTMLElement&&!C.matches(":focus-visible")||j()}),h.addEventListener("focusout",N=>{const C=N.relatedTarget;(!(C instanceof Node)||!h.contains(C))&&y.close()}),g.addEventListener("click",N=>{u()&&(N.preventDefault(),N.stopPropagation(),y.isOpen()?y.close():j())}),g.addEventListener("keydown",N=>{if(N.key==="ArrowDown"){N.preventDefault(),y.isOpen()||j();const C=m.querySelector("a");C instanceof HTMLElement&&C.focus()}else N.key==="Escape"&&y.close()}),m.addEventListener("click",N=>{N.target instanceof HTMLAnchorElement&&x()}),m.addEventListener("keydown",N=>{N.key==="Escape"&&(N.stopPropagation(),y.close(),g.focus())})}),l){const h=()=>{x()};typeof l.addEventListener=="function"?l.addEventListener("change",h):typeof l.addListener=="function"&&l.addListener(h)}window.addEventListener("resize",()=>{x()}),c.length>0&&!$t&&(document.addEventListener("pointerdown",h=>{const g=h.target;g instanceof Node&&c.some(({wrapper:m})=>m.contains(g))||x()}),document.addEventListener("keydown",h=>{h.key==="Escape"&&x()}),$t=!0),n&&(n.addEventListener("click",()=>{const h=n.getAttribute("aria-expanded")==="true";x(),n.setAttribute("aria-expanded",String(!h)),r==null||r.setAttribute("data-visible",String(!h)),s.classList.toggle("nav-open",!h)}),window.addEventListener("keydown",h=>{h.key==="Escape"&&n.getAttribute("aria-expanded")==="true"&&(n.setAttribute("aria-expanded","false"),r==null||r.setAttribute("data-visible","false"),s.classList.remove("nav-open"),x(),n.focus())}),window.addEventListener("resize",()=>{window.innerWidth>=720&&(n.setAttribute("aria-expanded","false"),r==null||r.setAttribute("data-visible","false"),s.classList.remove("nav-open"),x())})),r==null||r.addEventListener("click",h=>{h.target instanceof HTMLAnchorElement&&(n==null||n.setAttribute("aria-expanded","false"),r.setAttribute("data-visible","false"),s.classList.remove("nav-open"),x())}),t.dataset.navEnhanced="true",ft=!0}const Dt=()=>hs();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Dt,{once:!0}):Dt();const ms=e=>{const t=[],n=e.length;for(let r=0;r<n;r++){let s=0,o=0;for(let p=0;p<n;p++){const u=Math.PI*2*r*p/n,x=Math.cos(u),h=Math.sin(u),g=e[p].re,m=e[p].im;s+=g*x+m*h,o+=m*x-g*h}s=s/n,o=o/n;const c=r>n/2?r-n:r,l=Math.sqrt(s*s+o*o),f=Math.atan2(o,s);t.push({re:s,im:o,freq:c,amp:l,phase:f})}return t.sort((r,s)=>s.amp-r.amp)},ps=(e,t)=>{if(t<=0||e.length<2)return[...e];const n=[];for(let r=0;r<e.length;r++){let s=0,o=0,c=0;for(let l=-t;l<=t;l++){const f=r+l;f>=0&&f<e.length&&(s+=e[f].x,o+=e[f].y,c++)}n.push({x:s/c,y:o/c})}return n},gs=()=>{const e=[];for(let r=0;r<50;r++)e.push({x:-200+r*2*200/50,y:-200});for(let r=0;r<50;r++)e.push({x:200,y:-200+r*2*200/50});for(let r=0;r<50;r++)e.push({x:200-r*2*200/50,y:200});for(let r=0;r<50;r++)e.push({x:-200,y:200-r*2*200/50});return e},xs=()=>{const e=[];for(let r=0;r<200;r++){const s=Math.PI*2*r/200;e.push({x:200*Math.cos(s),y:200*Math.sin(s)})}return e},ys=()=>{const e=[];for(let n=0;n<300;n++){const r=Math.PI*2*n/300,s=16*Math.pow(Math.sin(r),3),o=-(13*Math.cos(r)-5*Math.cos(2*r)-2*Math.cos(3*r)-Math.cos(4*r));e.push({x:s*15,y:o*15})}return e},bs=()=>{const e=[];for(let r=0;r<300;r++){const s=Math.PI*2*r/300,o=150*Math.cos(s),c=150*Math.sin(s)*Math.cos(s);e.push({x:o,y:c})}return e},vs=()=>{const e=[];for(let n=0;n<100;n++){const r=Math.PI*2*n/100;e.push({x:40*Math.cos(r)-50,y:30*Math.sin(r)+100})}for(let n=0;n<20;n++)e.push({x:-10,y:100-200*n/20});for(let n=0;n<30;n++){const r=n/30;e.push({x:-10+50*Math.sin(r*Math.PI),y:-100+50*r})}for(let n=0;n<20;n++)e.push({x:-10,y:-50+150*n/20});return e},ws={threshold:30,sampleRate:2,maxPoints:1500,smoothingWindow:4,blurRadius:1,morphRadius:2,detail:.9},Ms=e=>{if(e.length===0)return[];const t=[],n=new Set;let r=0;for(t.push(e[0]),n.add(0);t.length<e.length;){let s=1/0,o=-1;const c=e[r];for(let l=0;l<e.length;l++)if(!n.has(l)){const f=e[l],p=(c.x-f.x)**2+(c.y-f.y)**2;p<s&&(s=p,o=l)}if(o!==-1)n.add(o),t.push(e[o]),r=o;else break}return t},je=(e,t,n)=>Math.max(t,Math.min(n,e)),js=e=>Math.max(0,Math.min(1,e)),Ie=(e,t,n)=>e+(t-e)*n,ks=(e,t,n,r)=>{const s=Math.max(1,Math.floor(r||1)),o=Math.max(1,Math.floor(t/s)),c=Math.max(1,Math.floor(n/s)),l=new Uint8Array(o*c);for(let f=0;f<c;f++){const p=je(f*s,0,n-1);for(let u=0;u<o;u++){const x=je(u*s,0,t-1),h=(p*t+x)*4,g=e[h]??0,m=e[h+1]??0,M=e[h+2]??0;l[f*o+u]=Math.round(.2126*g+.7152*m+.0722*M)}}return{gray:l,w:o,h:c,step:s}},Es=(e,t,n,r)=>{const s=Math.max(1,Math.floor(r||1)),o=new Uint8Array(e.length);for(let c=0;c<n;c++)for(let l=0;l<t;l++){let f=0;for(let p=-s;p<=s&&!f;p++){const u=c+p;if(!(u<0||u>=n))for(let x=-s;x<=s;x++){const h=l+x;if(!(h<0||h>=t)&&e[u*t+h]){f=1;break}}}o[c*t+l]=f}return o},Ns=(e,t,n,r)=>{const s=Math.max(1,Math.floor(r||1)),o=new Uint8Array(e.length);for(let c=0;c<n;c++)for(let l=0;l<t;l++){let f=1;for(let p=-s;p<=s&&f;p++){const u=c+p;if(u<0||u>=n){f=0;break}for(let x=-s;x<=s;x++){const h=l+x;if(h<0||h>=t||!e[u*t+h]){f=0;break}}}o[c*t+l]=f}return o},Ss=(e,t,n,r)=>{const s=Math.max(1,Math.floor(r||1));return Ns(Es(e,t,n,s),t,n,s)},Ps=(e,t)=>{const n=Math.max(0,Math.floor(t||0));if(n<=0||e.length<3)return e;const r=[],s=e.length;for(let o=0;o<s;o++){let c=0,l=0,f=0;for(let p=-n;p<=n;p++){const u=(o+p+s)%s;c+=e[u].x,l+=e[u].y,f++}r.push({x:c/f,y:l/f})}return r},De=e=>{if(e.length<2)return e;const t=e[0],n=e[e.length-1];return t.x===n.x&&t.y===n.y?e:[...e,{...t}]},Ls=(e,t,n)=>{if(t<3||n<3)return new Uint8Array(e.length);const r=new Uint16Array(e.length),s=new Uint32Array(1025);for(let u=1;u<n-1;u++)for(let x=1;x<t-1;x++){const h=u*t+x,g=e[h-t-1],m=e[h-t],M=e[h-t+1],k=e[h-1],E=e[h+1],y=e[h+t-1],j=e[h+t],T=e[h+t+1],z=-g+M-2*k+2*E-y+T,N=-g-2*m-M+y+2*j+T,C=Math.min(1024,Math.abs(z)+Math.abs(N));r[h]=C,s[C]++}const o=(t-2)*(n-2);let c=Math.floor(o*.08);c=je(c,50,o);let l=0,f=1024;for(let u=1024;u>=0;u--)if(l+=s[u],l>=c){f=u;break}const p=new Uint8Array(e.length);for(let u=0;u<r.length;u++)p[u]=r[u]>=f&&r[u]>0?1:0;return p},Ts=e=>{let t=0;for(let n=0;n<e.length;n++)t+=e[n]?1:0;return t},Cs=e=>{const t=Math.max(.01,e),n=Math.max(1,Math.ceil(3*t)),r=n*2+1,s=new Float32Array(r),o=2*t*t;let c=0;for(let l=-n;l<=n;l++){const f=Math.exp(-(l*l)/o);s[l+n]=f,c+=f}if(c>0)for(let l=0;l<s.length;l++)s[l]/=c;return s},Ot=(e,t,n,r)=>{const s=t*n,o=Math.max(0,r);if(s===0)return new Float32Array(0);if(o<=.01){const u=new Float32Array(s);for(let x=0;x<s;x++)u[x]=e[x];return u}const c=Cs(o),l=(c.length-1)/2,f=new Float32Array(s),p=new Float32Array(s);for(let u=0;u<n;u++){const x=u*t;for(let h=0;h<t;h++){let g=0;for(let m=-l;m<=l;m++){const M=je(h+m,0,t-1);g+=c[m+l]*(e[x+M]??0)}f[x+h]=g}}for(let u=0;u<n;u++){const x=u*t;for(let h=0;h<t;h++){let g=0;for(let m=-l;m<=l;m++){const M=je(u+m,0,n-1);g+=c[m+l]*(f[M*t+h]??0)}p[x+h]=g}}return p},Is=(e,t,n,r,s)=>{const o=t*n;if(t<3||n<3||o===0)return new Uint8Array(o);const c=Math.min(t,n),l=Math.max(.35,s||1),f=Ie(2.4,.7,r)*l,p=Math.max(.35,c/4),u=Math.min(Math.max(.35,f),p),x=Math.min(Math.max(u*1.6,u+.15),p*1.6),h=Ot(e,t,n,u),g=Ot(e,t,n,x),m=new Float32Array(o);for(let L=0;L<o;L++)m[L]=h[L]-g[L];const M=new Uint16Array(o),k=new Uint32Array(1025);let E=0;const y=4,j=[-t-1,-t,-t+1,-1,1,t-1,t,t+1];for(let L=1;L<n-1;L++){const X=L*t;for(let H=1;H<t-1;H++){const Q=X+H,V=m[Q],ie=V>=0;let U=0;for(let ne=0;ne<j.length;ne++){const ye=Q+j[ne],de=m[ye];if(de>=0===ie)continue;const ke=Math.abs(V-de);ke>U&&(U=ke)}if(U>0){const ne=je(Math.round(U*y),0,1024);M[Q]=ne,k[ne]++,E++}}}if(E===0)return new Uint8Array(o);const T=Ie(.02,.08,r),z=je(Math.floor(E*T),1,E);let N=0,C=1024;for(let L=1024;L>=1;L--)if(N+=k[L],N>=z){C=L;break}const O=Ie(.6,.22,r),te=Math.max(1,Math.floor(C*O)),q=new Uint8Array(o),J=[];for(let L=0;L<o;L++)M[L]>=C&&(q[L]=1,J.push(L));const A=[1,1,0,-1,-1,-1,0,1],I=[0,1,1,1,0,-1,-1,-1];for(;J.length;){const L=J.pop(),X=L%t,H=(L-X)/t;for(let Q=0;Q<8;Q++){const V=X+A[Q],ie=H+I[Q];if(V<0||V>=t||ie<0||ie>=n)continue;const U=ie*t+V;q[U]||M[U]>=te&&(q[U]=1,J.push(U))}}return q},Rs=(e,t,n)=>{const r=[1,1,0,-1,-1,-1,0,1],s=[0,1,1,1,0,-1,-1,-1],o=[4,5,6,7,0,1,2,3],c=new Uint8Array(e.length),l=[];for(let g=0;g<e.length;g++){if(!e[g])continue;const m=g%t,M=(g-m)/t;let k=0;for(let E=0;E<8;E++){const y=m+r[E],j=M+s[E];y<0||y>=t||j<0||j>=n||e[j*t+y]&&k++}c[g]=k,k>0&&l.push(g)}const f=new Uint8Array(e.length),p=[],u=(g,m)=>{const M=g%t,k=(g-M)/t,E=M+r[m],y=k+s[m];if(E<0||E>=t||y<0||y>=n)return-1;const j=y*t+E;return e[j]?j:-1},x=(g,m,M)=>{f[g]|=1<<m,f[M]|=1<<o[m]},h=(g,m,M)=>{const k=u(g,m);if(k<0)return[];const E=[g];let y=m,j=k;x(g,m,j),E.push(j);const T=t*n*2;for(let z=0;z<T;z++){const N=c[j];if(M&&N!==2)break;const C=o[y];let O=-1;for(let q=0;q<8;q++){if(q===C)continue;if(u(j,q)>=0){O=q;break}}if(O<0||f[j]&1<<O)break;const te=u(j,O);if(te<0||(x(j,O,te),j=te,y=O,E.push(j),!M&&j===g))break}return E};for(const g of l){const m=c[g];if(!(m===0||m===2))for(let M=0;M<8;M++){if(u(g,M)<0||f[g]&1<<M)continue;const E=h(g,M,!0);E.length>1&&p.push(E)}}for(const g of l)for(let m=0;m<8;m++){if(u(g,m)<0||f[g]&1<<m)continue;const k=h(g,m,!1);k.length>1&&(k[0]===k[k.length-1]?p.push(k):p.push([...k,k[0]]))}return p},As=(e,t,n,r,s)=>{const o=e%t,c=(e-o)/t;return{x:o*n-r/2,y:c*n-s/2}},ht=e=>{if(e.length===0)return[];const t=[e[0]];for(let n=1;n<e.length;n++){const r=t[t.length-1],s=e[n];(r.x!==s.x||r.y!==s.y)&&t.push(s)}return t},qt=(e,t)=>{if(e.length<3||t<=0)return e;const n=t*t,r=new Uint8Array(e.length);r[0]=1,r[e.length-1]=1;const s=(l,f,p)=>{const u=p.x-f.x,x=p.y-f.y,h=l.x-f.x,g=l.y-f.y,m=u*h+x*g;if(m<=0)return h*h+g*g;const M=u*u+x*x;if(M<=m){const z=l.x-p.x,N=l.y-p.y;return z*z+N*N}const k=m/M,E=f.x+k*u,y=f.y+k*x,j=l.x-E,T=l.y-y;return j*j+T*T},o=[[0,e.length-1]];for(;o.length;){const[l,f]=o.pop();let p=0,u=-1;const x=e[l],h=e[f];for(let g=l+1;g<f;g++){const m=s(e[g],x,h);m>p&&(p=m,u=g)}u!==-1&&p>n&&(r[u]=1,o.push([l,u],[u,f]))}const c=[];for(let l=0;l<e.length;l++)r[l]&&c.push(e[l]);return c},Fs=(e,t)=>{if(e.length===0)return[];const n=[...e].sort((c,l)=>l.length-c.length);let r=[...n.shift()];const s=(c,l)=>{const f=c.x-l.x,p=c.y-l.y;return f*f+p*p},o=je(Math.round(Ie(2,10,t)),2,12);for(;n.length;){const c=r[r.length-1];let l=0,f=!1,p=1/0;for(let M=0;M<n.length;M++){const k=n[M],E=s(c,k[0]),y=s(c,k[k.length-1]);E<p&&(p=E,l=M,f=!1),y<p&&(p=y,l=M,f=!0)}const u=n.splice(l,1)[0];f&&u.reverse();const x=u[0],h=x.x-c.x,g=x.y-c.y;if(Math.hypot(h,g)>1e-6)for(let M=1;M<=o;M++){const k=M/(o+1);r.push({x:c.x+h*k,y:c.y+g*k})}r[r.length-1].x===x.x&&r[r.length-1].y===x.y?r.push(...u.slice(1)):r.push(...u)}return r},_s=(e,t)=>{const n=Math.max(8,Math.floor(t)),r=De(ht(e));if(r.length<4)return r;const s=r.slice(0,-1),o=s.length,c=new Float64Array(o);let l=0;for(let y=0;y<o;y++){const j=s[y],T=s[(y+1)%o],z=Math.hypot(T.x-j.x,T.y-j.y);c[y]=z,l+=z}if(!Number.isFinite(l)||l<=0)return De(s);const f=l/n,p=[{...s[0]}];let u=0,x=s[0],h=s[1%o],g=c[0],m=0,M=f;const k=n*(o+4);let E=0;for(;p.length<n&&E++<k;){if(g===0){u=(u+1)%o,x=s[u],h=s[(u+1)%o],g=c[u];continue}if(m+g>=M-1e-9){const y=(M-m)/g;p.push({x:x.x+(h.x-x.x)*y,y:x.y+(h.y-x.y)*y}),M+=f}else m+=g,u=(u+1)%o,x=s[u],h=s[(u+1)%o],g=c[u]}return p.length>n&&(p.length=n),De(p)},zs=(e,t,n,r={})=>{const s={...ws,...r},o=js(s.detail),c=typeof r.sampleRate=="number"?Math.max(1,Math.floor(s.sampleRate)):o>=.88?1:o>=.55?2:3,l=Math.max(200,Math.floor(s.maxPoints)),f=Math.max(0,Math.floor(s.smoothingWindow)),p=Math.max(0,Math.floor(s.blurRadius)),u=Math.max(0,Math.floor(s.morphRadius)),x=Math.max(1,Math.floor(s.threshold)),{gray:h,w:g,h:m,step:M}=ks(e,t,n,c),k=h;let E=Is(k,g,m,o,p);Ts(E)<Math.max(10,Math.floor(g*m*.001))&&(E=Ls(k,g,m)),u>0&&(E=Ss(E,g,m,u));const y=Rs(E,g,m),j=je(Math.round(Ie(40,10,o)),6,80),T=Ie(6,1.2,o)*M,z=y.filter(A=>A.length>=j).map(A=>A.map(I=>As(I,g,M,t,n))).map(A=>{const I=ht(A);if(I.length>2&&I[0].x===I[I.length-1].x&&I[0].y===I[I.length-1].y){const X=I.slice(0,-1);return De(qt(X,T))}return qt(I,T)}).filter(A=>A.length>=2);if(z.length>0){const A=Fs(z,o),I=De(ht(A)),L=f>0?Ps(I,f):I,X=je(Math.round(Ie(400,l,o)),120,l);return _s(L,X)}const N=[],C=A=>(e[A]+e[A+1]+e[A+2])/3;for(let A=0;A<n;A+=c)for(let I=0;I<t;I+=c){if(I<=0||A<=0)continue;const L=(A*t+I)*4,X=(A*t+(I-1))*4,H=((A-1)*t+I)*4,Q=C(L),V=C(X),ie=C(H);Math.abs(Q-V)+Math.abs(Q-ie)>x&&N.push({x:I-t/2,y:A-n/2})}if(N.length===0)return[];const O=N.length>l?Math.ceil(N.length/l):1,te=O===1?N:N.filter((A,I)=>I%O===0),q=Ms(te),J=[];for(let A=0;A<q.length;A++){let I=0,L=0,X=0;for(let H=-f;H<=f;H++){const Q=(A+H+q.length)%q.length;I+=q[Q].x,L+=q[Q].y,X++}J.push({x:I/X,y:L/X})}return De(J)},Xt=async(e,t=900,n={})=>new Promise((r,s)=>{const o=new Image,c=URL.createObjectURL(e);o.onload=()=>{const l=document.createElement("canvas"),f=l.getContext("2d");if(!f){s(new Error("Could not get canvas context"));return}let p=o.width,u=o.height;const x=Math.max(p,u),h=t&&t>0?t:900;if(x>h){const M=h/x;p=Math.round(p*M),u=Math.round(u*M)}l.width=p,l.height=u,f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.drawImage(o,0,0,p,u);const g=f.getImageData(0,0,p,u),m=zs(g.data,p,u,n);URL.revokeObjectURL(c),r(m)},o.onerror=l=>s(l),o.src=c}),bt=1500,$s=300,Ds=600,Os=e=>e.map(t=>({re:t.x,im:t.y})),qs=e=>e&&e>0?e:bt,vt=(e,t)=>Math.hypot(e.x-t.x,e.y-t.y),wt=(e,t,n)=>Math.max(t,Math.min(n,Math.round(e))),Xs=e=>{let t=1/0,n=1/0,r=-1/0,s=-1/0;for(const o of e)o.x<t&&(t=o.x),o.y<n&&(n=o.y),o.x>r&&(r=o.x),o.y>s&&(s=o.y);return!Number.isFinite(t)||!Number.isFinite(n)||!Number.isFinite(r)||!Number.isFinite(s)?0:Math.hypot(r-t,s-n)},Us=e=>{if(e.length<3)return!1;const t=e[0],n=e[e.length-1],r=Xs(e),s=Math.max(10,r*.04);return vt(t,n)<=s},Ws=(e,t=.25)=>{if(e.length<2)return[...e];const n=[e[0]];for(let r=1;r<e.length;r++){const s=n[n.length-1],o=e[r];vt(s,o)>=t&&n.push(o)}return n},Bs=(e,t,n)=>{const r=e.length;if(r===0)return[];if(r===1)return[{...e[0]}];const s=wt(t,2,1e4),o=n?r:r-1,c=new Array(o);let l=0;for(let x=0;x<o;x++){const h=e[x],g=e[(x+1)%r],m=vt(h,g);c[x]=m,l+=m}if(l<=0)return Array.from({length:s},()=>({...e[0]}));const f=l/(n?s:s-1),p=[],u=x=>{let h=0,g=0;for(;h<o-1&&g+c[h]<x;)g+=c[h],h++;const m=e[h],M=e[(h+1)%r],k=c[h]||1,E=Math.max(0,Math.min(1,(x-g)/k));return{x:m.x+(M.x-m.x)*E,y:m.y+(M.y-m.y)*E}};if(n){for(let x=0;x<s;x++)p.push(u(f*x));return p}p.push({...e[0]});for(let x=1;x<s-1;x++)p.push(u(f*x));return p.push({...e[r-1]}),p},Hs=(e,t)=>{if(t<=0||e.length<2)return[...e];const n=e.length,r=wt(t,1,Math.floor(n/2)),s=[];for(let o=0;o<n;o++){let c=0,l=0,f=0;for(let p=-r;p<=r;p++){const u=(o+p+n)%n;c+=e[u].x,l+=e[u].y,f++}s.push({x:c/f,y:l/f})}return s},Vs=(e,t,n=bt)=>{const r=qs(n),s=Ws(e);if(s.length===0)return[];const o=Us(s),c=o?Ds:$s,l=Math.min(r,Math.max(s.length,c)),f=Bs(s,l,o),p=t>0?wt(t,0,999):0;return o?Hs(f,p):ps(f,p)},Ys=(e,t={})=>{const{smoothing:n=0,limit:r=bt}=t,s=Vs(e,n,r),o=ms(Os(s));return{prepared:s,spectrum:o}},Ks=(e,t,n,r=600)=>{if(!e.length||!t.length)return{energyPct:0,rmsError:0,topTerms:[],breakdown:[]};const s=e.map(y=>y.amp*y.amp),o=s.reduce((y,j)=>y+j,0)||1,c=Math.max(Math.min(n||e.length,e.length),1),l=s.slice(0,c).reduce((y,j)=>y+j,0);let f=0;const p=s.map(y=>(f+=y,{energyPct:y/o*100,cumulativePct:f/o*100}));let u=0;const x=e.slice(0,6).map((y,j)=>{const T=s[j];return u+=T,{freq:y.freq,amp:y.amp,phase:y.phase,energyPct:T/o*100,cumulativePct:u/o*100}}),h=t.length,g=Math.max(1,Math.floor(h/r)),m=e.slice(0,c);let M=0,k=0;for(let y=0;y<h;y+=g){let j=0,T=0;for(let C=0;C<m.length;C++){const O=m[C],te=2*Math.PI*O.freq*y/h,q=Math.cos(te),J=Math.sin(te);j+=O.re*q-O.im*J,T+=O.re*J+O.im*q}const z=j-t[y].x,N=T-t[y].y;M+=z*z+N*N,k++}const E=Math.sqrt(M/Math.max(k,1));return{energyPct:Number((l/o*100).toFixed(2)),rmsError:Number(E.toFixed(2)),topTerms:x,breakdown:p}},Ce={scale:1,offsetX:0,offsetY:0},mt=(e,t,n)=>Math.max(t,Math.min(n,e)),Zt=(e,t,n)=>Number.isFinite(e)?mt(e,t,n):mt(1,t,n),$e=e=>Number.isFinite(e.width)&&Number.isFinite(e.height)&&e.width>0&&e.height>0,Ve=(e,t,n)=>{const r=t.width/2,s=t.height/2,o=n.scale!==0?1/n.scale:1;return{x:(e.x-r-n.offsetX)*o,y:(e.y-s-n.offsetY)*o}},Jt=(e,t,n,r,s,o)=>{const c=Zt(r,s,o),l=t.width/2,f=t.height/2;return{scale:c,offsetX:n.x-l-e.x*c,offsetY:n.y-f-e.y*c}},Gs=(e,t,n,r,s,o)=>{const c=Ve(n,t,e);return Jt(c,t,n,r,s,o)},Ut=(e,t,n,r,s,o)=>{const c=e.scale*r;return Gs(e,t,n,c,s,o)},Wt=(e,t,n={padding:.9,minScale:.25,maxScale:6})=>{if(!$e(t)||e.length===0)return Ce;let r=1/0,s=1/0,o=-1/0,c=-1/0;for(const m of e)m.x<r&&(r=m.x),m.y<s&&(s=m.y),m.x>o&&(o=m.x),m.y>c&&(c=m.y);if(!Number.isFinite(r)||!Number.isFinite(s)||!Number.isFinite(o)||!Number.isFinite(c))return Ce;const l=Math.max(o-r,1e-6),f=Math.max(c-s,1e-6),u=mt(n.padding??.9,.1,1)*Math.min(t.width/l,t.height/f),x=Zt(u,n.minScale,n.maxScale),h=(r+o)/2,g=(s+c)/2;return{scale:x,offsetX:-h*x,offsetY:-g*x}},Zs=e=>Math.min(1,Math.max(0,e)),Js=(e,t)=>!isFinite(e)||t<=0?0:Zs(e/t),tt=(e,t,n=!1)=>{const r=Js(e,t),s=210+110*r,o=n?62:48+6*r,c=n?.95:.6;return`hsla(${s.toFixed(1)}, 82%, ${o.toFixed(1)}%, ${c})`},Qs=e=>`linear-gradient(90deg, ${tt(0,e)} 0%, ${tt(e*.5,e)} 50%, ${tt(e,e,!0)} 100%)`,er=(e,t,n)=>tt(e.amp,t,n),tr=({mode:e,setMode:t,isPlaying:n,setIsPlaying:r,clear:s,numEpicycles:o,maxEpicycles:c,setNumEpicycles:l,onUpload:f,showMath:p,setShowMath:u,onPreset:x,speed:h,setSpeed:g,onReset:m,brushColor:M,setBrushColor:k,brushSize:E,setBrushSize:y,smoothing:j,setSmoothing:T,outlineDetail:z,setOutlineDetail:N,isDrawing:C,onSave:O,onLoad:te,savedDrawings:q,isFullscreen:J,onToggleFullscreen:A,safeMode:I,onToggleSafeMode:L,stepMode:X,onToggleStepMode:H,stepIndex:Q,stepMax:V,onStepPrev:ie,onStepNext:U,onStepPlayOnce:ne,viewScale:ye,onZoomIn:de,onZoomOut:ke,onFitView:st,onResetView:Re})=>{const Ye=b.useRef(null),Oe=b.useRef(null),Ee=b.useRef(null),[fe,W]=b.useState(null),[Pe,he]=b.useState(!0),[K,me]=b.useState(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return!0;const S=window.matchMedia("(hover: none)").matches,ee=window.matchMedia("(hover: hover)").matches,le=window.matchMedia("(pointer: fine)").matches;return S||!ee||!le});b.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const S=window.matchMedia("(hover: none)"),ee=window.matchMedia("(hover: hover)"),le=window.matchMedia("(pointer: fine)"),pe=()=>{const ue=S.matches,Xe=ee.matches,Ae=le.matches;me(ue||!Xe||!Ae)},we=ue=>{typeof ue.addEventListener=="function"?ue.addEventListener("change",pe):typeof ue.addListener=="function"&&ue.addListener(pe)},Y=ue=>{typeof ue.removeEventListener=="function"?ue.removeEventListener("change",pe):typeof ue.removeListener=="function"&&ue.removeListener(pe)};return we(S),we(ee),we(le),pe(),()=>{Y(S),Y(ee),Y(le)}},[]),b.useEffect(()=>{if(!fe)return;const S=le=>{var we,Y;const pe=le.target;pe instanceof Node&&((we=Oe.current)!=null&&we.contains(pe)||(Y=Ee.current)!=null&&Y.contains(pe)||W(null))},ee=le=>{le.key==="Escape"&&W(null)};return document.addEventListener("pointerdown",S),document.addEventListener("keydown",ee),()=>{document.removeEventListener("pointerdown",S),document.removeEventListener("keydown",ee)}},[fe]);const qe=b.useCallback(S=>{W(ee=>ee===S?null:S)},[]),se=S=>`
    p-2.5 rounded-lg transition-all duration-200 flex items-center justify-center
    ${S?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50 shadow-[0_0_15px_rgba(6,182,212,0.3)]":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 hover:text-slate-200 border border-transparent"}
  `;return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"fourier-toolbar fourier-toolbar--top",children:[i.jsxs("div",{className:"flex gap-1 mr-4 pl-2",children:[i.jsx(jn,{className:"w-5 h-5 text-fuchsia-500"}),i.jsxs("span",{className:"font-bold text-slate-100 hidden sm:block",children:["Fourier",i.jsx("span",{className:"text-fuchsia-500",children:"Viz"})]})]}),i.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),i.jsx("button",{onClick:()=>t("DRAW"),className:se(e==="DRAW"),title:"Freehand Draw",children:i.jsx(kn,{size:20})}),i.jsxs("div",{className:"relative",ref:Oe,onPointerEnter:()=>{K||W("presets")},onPointerLeave:()=>{K||W(S=>S==="presets"?null:S)},children:[i.jsx("button",{type:"button",className:se(e==="PRESET"),title:"Presets","aria-expanded":fe==="presets","aria-controls":"fourier-presets-menu",onClick:()=>qe("presets"),children:i.jsx(En,{size:20})}),i.jsxs("div",{id:"fourier-presets-menu",role:"menu",style:{display:fe==="presets"?"block":"none"},className:"absolute top-full left-0 w-32 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden z-50",children:[i.jsx("button",{type:"button",role:"menuitem",onClick:()=>{x("circle"),W(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Circle"}),i.jsx("button",{type:"button",role:"menuitem",onClick:()=>{x("square"),W(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Square"}),i.jsx("button",{type:"button",role:"menuitem",onClick:()=>{x("heart"),W(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Heart"}),i.jsx("button",{type:"button",role:"menuitem",onClick:()=>{x("infinity"),W(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Infinity"}),i.jsx("button",{type:"button",role:"menuitem",onClick:()=>{x("note"),W(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400",children:"Note"})]})]}),i.jsxs("div",{className:"relative",ref:Ee,onPointerEnter:()=>{K||W("load")},onPointerLeave:()=>{K||W(S=>S==="load"?null:S)},children:[i.jsx("button",{type:"button",className:se(!1),title:"Load Saved Drawing","aria-expanded":fe==="load","aria-controls":"fourier-load-menu",onClick:()=>qe("load"),children:i.jsx(Nn,{size:20})}),i.jsx("div",{id:"fourier-load-menu",role:"menu",style:{display:fe==="load"?"block":"none"},className:"absolute top-full left-0 w-48 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden max-h-60 overflow-y-auto custom-scrollbar z-50",children:q.length===0?i.jsx("div",{className:"px-4 py-2 text-sm text-slate-500 italic",children:"No saved drawings"}):q.map(S=>i.jsx("button",{type:"button",role:"menuitem",onClick:()=>{te(S),W(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-slate-800 hover:text-cyan-400 truncate border-b border-slate-800 last:border-0",children:S},S))})]}),i.jsx("button",{onClick:O,className:se(!1),title:"Save Current Drawing",children:i.jsx(Sn,{size:20})}),i.jsx("button",{onClick:()=>{var S;return(S=Ye.current)==null?void 0:S.click()},className:se(e==="UPLOAD"),title:"Upload Image",children:i.jsx(Pn,{size:20})}),i.jsx("input",{type:"file",ref:Ye,onChange:f,accept:"image/*",className:"hidden"}),i.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),i.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-lg transition-all duration-300 ${C?"bg-fuchsia-900/20 ring-1 ring-fuchsia-500/50":""}`,children:[i.jsxs("div",{className:"relative flex items-center group",title:"Brush Color",children:[i.jsx(Ln,{size:18,className:`${C?"text-fuchsia-400":"text-slate-400"} mr-2 transition-colors`}),i.jsx("input",{type:"color",value:M,onChange:S=>k(S.target.value),className:"w-6 h-6 rounded border-none cursor-pointer bg-transparent"})]}),i.jsxs("div",{className:"flex items-center gap-2",title:"Brush Size",children:[i.jsx(At,{size:10,className:"text-slate-400"}),i.jsx("input",{type:"range",min:"1",max:"10",step:"0.5",value:E,onChange:S=>y(parseFloat(S.target.value)),className:"w-16 h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-slate-400"}),i.jsx(At,{size:16,className:`text-slate-400 transition-all ${C?"scale-110 text-fuchsia-300":""}`})]})]}),i.jsx("div",{className:"h-6 w-px bg-slate-700 mx-1"}),i.jsx("button",{onClick:s,className:"p-2.5 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors",title:"Clear Canvas",children:i.jsx(Tn,{size:20})}),i.jsx("button",{onClick:()=>u(!p),className:se(p),title:"Toggle Math Panel",children:i.jsx(Cn,{size:20})}),i.jsx("button",{onClick:L,className:se(I),title:"Toggle safe mode (cap epicycles / lighten rendering)",children:i.jsx(In,{size:20})}),i.jsx("button",{onClick:H,className:se(X),title:"Toggle step-through playback",children:i.jsx(Ft,{size:20})}),i.jsx("button",{onClick:ke,className:se(!1),title:"Zoom Out","aria-label":"Zoom out",children:i.jsx(Rn,{size:20})}),i.jsx("button",{onClick:de,className:se(!1),title:"Zoom In","aria-label":"Zoom in",children:i.jsx(An,{size:20})}),i.jsx("button",{onClick:st,className:se(!1),title:"Fit View","aria-label":"Fit view to drawing",children:i.jsx(Fn,{size:20})}),i.jsx("button",{onClick:Re,className:se(!1),title:"Reset View","aria-label":`Reset view (${Math.round(ye*100)}%)`,children:i.jsx(_n,{size:20})}),i.jsx("button",{onClick:A,className:se(J),title:J?"Exit Fullscreen":"Fullscreen Play",children:J?i.jsx(zn,{size:20}):i.jsx($n,{size:20})})]}),i.jsx("div",{className:"fourier-toolbar fourier-toolbar--bottom",children:i.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[i.jsxs("div",{className:"flex items-center justify-between w-full md:w-auto gap-3",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:m,className:"p-3 rounded-full bg-slate-800 text-slate-300 hover:bg-slate-700 hover:text-white transition-all",title:"Reset Animation",children:i.jsx(Dn,{size:18})}),i.jsx("button",{onClick:()=>r(!n),className:"w-14 h-14 flex items-center justify-center rounded-full bg-cyan-500 text-slate-950 hover:bg-cyan-400 transition-all shadow-[0_0_20px_rgba(6,182,212,0.4)]",children:n?i.jsx(On,{fill:"currentColor",size:24}):i.jsx(qn,{fill:"currentColor",className:"ml-1",size:24})}),X&&i.jsxs("div",{className:"flex items-center gap-2 bg-slate-800/70 rounded-full px-3 py-2 border border-slate-700",children:[i.jsx("button",{onClick:ie,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Previous term",children:i.jsx(Xn,{size:16})}),i.jsx("button",{onClick:ne,className:"px-3 py-2 rounded-full bg-amber-400 text-slate-900 font-semibold hover:bg-amber-300 transition",title:"Play this term once",children:"Step"}),i.jsx("button",{onClick:U,className:"p-2 rounded-full bg-slate-900 text-slate-200 hover:bg-slate-700 transition",title:"Next term",children:i.jsx(Un,{size:16})}),i.jsxs("span",{className:"text-xs text-slate-300 font-semibold ml-1",children:["Term ",Q+1," / ",Math.max(V,1)]})]})]}),i.jsx("button",{type:"button",onClick:()=>he(S=>!S),className:`md:hidden ${se(Pe)}`,title:"Toggle sliders","aria-label":"Toggle sliders","aria-controls":"fourier-sliders","aria-expanded":Pe,children:i.jsx(Wn,{size:20})})]}),i.jsxs("div",{id:"fourier-sliders",className:`${Pe?"grid":"hidden"} md:grid flex-1 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 w-full`,children:[i.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[i.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[i.jsx("span",{children:"Precision"}),i.jsxs("span",{className:"text-cyan-400",children:[o," / ",c,I?" (capped)":""]})]}),i.jsx("input",{type:"range",min:"1",max:c||1,value:o,onChange:S=>l(parseInt(S.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),i.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[i.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Bn,{size:12}),i.jsx("span",{children:"Speed"})]}),i.jsxs("span",{className:"text-amber-400",children:[h.toFixed(2),"x"]})]}),i.jsx("input",{type:"range",min:"0.05",max:"3",step:"0.05",value:h,onChange:S=>g(parseFloat(S.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-amber-500"})]}),i.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[i.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Hn,{size:12}),i.jsx("span",{children:"Smoothness"})]}),i.jsxs("span",{className:"text-emerald-400",children:[j,"px"]})]}),i.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:j,onChange:S=>T(parseInt(S.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]}),i.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[i.jsxs("div",{className:"flex justify-between text-xs font-semibold uppercase tracking-wider text-slate-400",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Ft,{size:12}),i.jsx("span",{children:"Outline detail"})]}),i.jsxs("span",{className:"text-violet-300",children:[z,"%"]})]}),i.jsx("input",{type:"range",min:"10",max:"100",step:"1",value:z,onChange:S=>N(parseInt(S.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-violet-400"})]})]})]})})]})},nr=({terms:e,time:t,epicycles:n,metrics:r,focusIndex:s,stepMode:o=!1})=>{var E;const c=b.useRef(null),l=(y,j)=>Math.max(Math.min(y-1,j-1),0),[f,p]=b.useState("dft"),[u,x]=b.useState(()=>l(n,e.length)),h=b.useRef(l(n,e.length)),g=b.useMemo(()=>{const y=e[0],j=e.length||1,T=(t/(2*Math.PI)).toFixed(2);return{n:j,largestRadius:y?y.amp.toFixed(1):"0.0",maxFreq:y?y.freq:0,phaseTurns:T,dominantPhase:y?y.phase.toFixed(2):"0.00"}},[e,t]),m=b.useMemo(()=>{const y=e[Math.min(u,Math.max(e.length-1,0))];return y||{freq:0,amp:0,phase:0}},[u,e]),M=r.breakdown?r.breakdown[Math.min(u,Math.max(r.breakdown.length-1,0))]??{energyPct:0,cumulativePct:0}:{energyPct:0,cumulativePct:0},k=b.useMemo(()=>{const y={throwOnError:!1},j=g.n||1,T=m.freq,z=m.amp.toFixed(3),N=m.phase.toFixed(3),C=M.energyPct.toFixed(2),O=M.cumulativePct.toFixed(2);return{paramsHtml:Je.renderToString(`k = ${T},\\quad |X_k| = ${z},\\quad \\phi_k = ${N}\\,\\text{rad}`,y),vectorHtml:Je.renderToString(`\\text{Vector}_k(t) = |X_k|\\,e^{i\\left(2\\pi k t/${j} + \\phi_k\\right)}`,y),energyHtml:Je.renderToString(`\\Delta\\text{energy} = ${C}\\%\\quad \\text{cum.} = ${O}\\%`,y)}},[M,m.amp,m.freq,m.phase,g.n]);return b.useEffect(()=>{var te,q;if(!c.current)return;const{n:y,phaseTurns:j,dominantPhase:T}=g,z=Math.max(n,1),N=((te=e[0])==null?void 0:te.freq)??0,C=((q=e[0])==null?void 0:q.amp)??0,O={dft:`
      \\begin{aligned}
        X_k &= \\frac{1}{N} \\sum_{n=0}^{N-1} x_n e^{-i 2\\pi kn / N} \\\\
        &\\textcolor{#f472b6}{N = ${y}},\\; \\textcolor{#22c55e}{k \\in [0, N-1]}
      \\end{aligned}
      `,reconstruction:`
      \\begin{aligned}
        x(t) &\\approx \\sum_{j=1}^{${z}} \\left|X_{k_j}\\right| e^{i\\left(k_j t + \\phi_{k_j}\\right)} \\\\
        t &= 2\\pi n/N,\\; k_j \\in \\left[-\\frac{N}{2}, \\frac{N}{2}\\right] \\\\
        &\\textcolor{#22c55e}{\\left|X_{${N}}\\right| = ${C.toFixed(2)}},\\;
          \\textcolor{#f472b6}{\\phi_{${N}} = ${T}}\\;\\text{rad}
      \\end{aligned}
      `,phasor:`
      \\begin{aligned}
        \\text{Epicycle}_k(t) &= r_k \\\\
        &\\cdot e^{i(\\omega_k t + \\phi_k)} \\\\
        r_k &= \\left|X_k\\right| \\\\
        \\omega_k &= k \\\\
        t &= ${j}\\,\\tau
      \\end{aligned}
      `};Je.render(O[f],c.current,{throwOnError:!1,displayMode:!0})},[f,n,g,e]),b.useEffect(()=>{p("dft");const y=l(n,e.length);h.current=y,x(y)},[e.length]),b.useEffect(()=>{const y=l(n,e.length),j=h.current;h.current=y,typeof s!="number"&&x(T=>T===j?y:T)},[n,s,e.length]),b.useEffect(()=>{if(typeof s=="number"&&e.length>0){const y=Math.min(Math.max(s,0),e.length-1);x(y)}},[s,e.length]),i.jsxs("div",{className:"fourier-math-panel custom-scrollbar",children:[i.jsx("h3",{className:"text-xl font-bold mb-4 text-cyan-400",children:"Fourier Engine"}),i.jsxs("div",{className:"fourier-math-toggle",role:"group","aria-label":"Toggle formulas",children:[i.jsx("button",{type:"button",className:f==="dft"?"is-active":"",onClick:()=>p("dft"),children:"DFT basis"}),i.jsx("button",{type:"button",className:f==="reconstruction"?"is-active":"",onClick:()=>p("reconstruction"),children:"Reconstruction"}),i.jsx("button",{type:"button",className:f==="phasor"?"is-active":"",onClick:()=>p("phasor"),children:"Phasor anatomy"})]}),i.jsx("div",{className:"mb-4",ref:c,"aria-live":"polite"}),i.jsxs("div",{className:"space-y-4 text-sm font-mono",children:[i.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[i.jsx("span",{className:"text-slate-400",children:"Total Vectors (N)"}),i.jsx("span",{className:"text-cyan-300",children:e.length})]}),i.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[i.jsx("span",{className:"text-slate-400",children:"Active Epicycles"}),i.jsx("span",{className:"text-fuchsia-400",children:n})]}),i.jsxs("div",{className:"flex justify-between border-b border-slate-700 pb-2",children:[i.jsx("span",{className:"text-slate-400",children:"Current Phase (t)"}),i.jsxs("span",{className:"text-amber-400",children:[(t/(2*Math.PI)).toFixed(2),"œÑ"]})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-slate-400",children:"Largest Radius"}),i.jsxs("span",{className:"text-emerald-400",children:[e.length>0?e[0].amp.toFixed(1):"0.0"," px"]})]})]}),i.jsxs("div",{className:"mt-4",children:[i.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Amplitude color map"}),i.jsx("div",{className:"fourier-legend",style:{backgroundImage:Qs(((E=e[0])==null?void 0:E.amp)||1)},"aria-label":"Amplitude legend from low to high magnitude"}),i.jsxs("div",{className:"flex justify-between text-[11px] text-slate-500 mt-1",children:[i.jsx("span",{children:"low |X_k|"}),i.jsx("span",{children:"high |X_k|"})]})]}),i.jsxs("div",{className:"mt-4 space-y-2 text-sm font-mono",children:[i.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[i.jsx("span",{className:"text-slate-400",children:"Energy captured (M terms)"}),i.jsxs("span",{className:"text-cyan-300",children:[r.energyPct.toFixed(2),"%"]})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-slate-400",children:"RMS error vs. original path"}),i.jsxs("span",{className:"text-amber-300",children:[r.rmsError.toFixed(2)," px"]})]})]}),r.topTerms.length>0&&i.jsxs("div",{className:"mt-4",children:[i.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Top terms (by amplitude)"}),i.jsxs("div",{className:"grid grid-cols-5 text-[11px] text-slate-300 gap-2 border border-slate-800 rounded-lg p-2",children:[i.jsx("span",{className:"font-semibold text-slate-200",children:"k"}),i.jsx("span",{className:"font-semibold text-slate-200",children:"|X_k|"}),i.jsx("span",{className:"font-semibold text-slate-200",children:"phase"}),i.jsx("span",{className:"font-semibold text-slate-200",children:"energy"}),i.jsx("span",{className:"font-semibold text-slate-200",children:"cum."}),r.topTerms.map((y,j)=>i.jsxs(pt.Fragment,{children:[i.jsx("span",{children:y.freq}),i.jsx("span",{children:y.amp.toFixed(2)}),i.jsxs("span",{children:[y.phase.toFixed(2)," rad"]}),i.jsxs("span",{children:[y.energyPct.toFixed(1),"%"]}),i.jsxs("span",{children:[y.cumulativePct.toFixed(1),"%"]})]},j))]})]}),i.jsxs("div",{className:"mt-5 border border-slate-800 rounded-lg p-3 space-y-2 bg-slate-900/40",children:[i.jsxs("div",{className:"flex items-center justify-between text-xs uppercase tracking-wide text-slate-400",children:[i.jsx("span",{children:"Term inspector"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>x(y=>Math.max(0,y-1)),"aria-label":"Previous term",children:i.jsx(Vn,{size:18,"aria-hidden":"true"})}),i.jsxs("span",{className:"text-slate-200",children:[u+1," / ",e.length||1]}),i.jsx("button",{type:"button",className:"text-cyan-300 hover:text-cyan-100",onClick:()=>x(y=>Math.min(e.length-1,y+1)),"aria-label":"Next term",children:i.jsx(Yn,{size:18,"aria-hidden":"true"})})]})]}),i.jsxs("div",{className:"text-xs text-slate-200 leading-relaxed space-y-2",children:[i.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:k.paramsHtml}}),i.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:k.vectorHtml}}),i.jsx("div",{className:"fourier-katex-inline",dangerouslySetInnerHTML:{__html:k.energyHtml}}),i.jsx("p",{children:o?"Step mode: play once to view this term, then advance.":"Track this circle while playing to see how its phase and magnitude shape the trace."})]})]}),i.jsxs("div",{className:"mt-5 text-xs text-slate-500 italic space-y-2",children:[i.jsx("p",{children:"* Sorted by amplitude so the largest circles draw first."}),i.jsx("p",{children:"Tip: switch formulas to see how truncating to M epicycles shapes the path."})]})]})},sr=2400,Qe=700,rr=1.75,or=.45,ar=1e7,Bt="fourier_viz__last_session",Be=.25,He=6,Ht=1.25,ir=()=>{var Lt,Tt,Ct,It,Rt;const[e,t]=b.useState("DRAW"),[n,r]=b.useState([]),[s,o]=b.useState([]),[c,l]=b.useState(0),[f,p]=b.useState(!1),[u,x]=b.useState(0),[h,g]=b.useState(!1),[m,M]=b.useState(!1),[k,E]=b.useState("#0f172a"),[y,j]=b.useState("rgba(148, 163, 184, 0.22)"),[T,z]=b.useState(or),[N,C]=b.useState(0),[O,te]=b.useState(90),[q,J]=b.useState([]),[A,I]=b.useState(!1),[L,X]=b.useState(!1),[H,Q]=b.useState(!1),[V,ie]=b.useState(!1),[U,ne]=b.useState(0),[ye,de]=b.useState(Ce),[ke,st]=b.useState("#ec4899"),[Re,Ye]=b.useState(2),[Oe,Ee]=b.useState(!1),fe=b.useRef(null),W=b.useRef(null),Pe=b.useRef(),he=b.useRef([]),K=b.useRef(!1),me=b.useRef(null),qe=b.useRef(1),se=b.useRef(null),S=b.useRef(0),ee=b.useRef(null),le=b.useRef(null),pe=b.useRef(!1),we=b.useRef(!0),Y=b.useRef(null),ue=b.useRef(null),Xe=b.useRef([]),Ae=b.useRef(!1),Me=b.useRef(null),ge=b.useRef(null),xe=b.useRef(new Map),be=b.useRef(null),Ke=b.useRef(!1),Le=b.useRef({mode:e,points:n,fourierX:s,time:c,isPlaying:f,numEpicycles:u,showMath:h,canvasBg:k,gridColor:y,speed:T,brushColor:ke,brushSize:Re,stepMode:V,safeMode:H,stepIndex:U,view:ye}),ve=b.useCallback(()=>{if(Y.current){const a=Y.current.getContext("2d");a&&(a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,Y.current.width,Y.current.height))}ue.current=null,Xe.current=[],Ae.current=!1},[]),Fe=b.useCallback(()=>{const a=W.current,w=fe.current;if(!a||!w)return;const{width:d,height:v}=a.getBoundingClientRect(),P=Math.max(1,Math.floor(d)),B=Math.max(1,Math.floor(v));if(P<=1||B<=1)return;const F=window.devicePixelRatio||1;qe.current=F,a.width=Math.round(P*F),a.height=Math.round(B*F),Y.current||(Y.current=document.createElement("canvas")),Y.current.width=a.width,Y.current.height=a.height,ve()},[ve]),rt=b.useCallback(a=>{S.current=a,ee.current=null,le.current=null,l(a)},[]),ot=b.useCallback(()=>{rt(0),ve()},[ve,rt]),en=()=>{ot()},tn=b.useCallback(()=>{de(Ce)},[]),nn=b.useCallback(()=>{const a=W.current;if(!a)return;const w=a.getBoundingClientRect(),d={width:w.width,height:w.height};if(!$e(d))return;const v=he.current.length?he.current:n;if(!v.length){de(Ce);return}de(Wt(v,d,{padding:.9,minScale:Be,maxScale:He}))},[n]),Ge=b.useCallback(a=>{const w=W.current;if(!w)return;const d=w.getBoundingClientRect(),v={width:d.width,height:d.height};if(!$e(v))return;const P={x:v.width/2,y:v.height/2};de(B=>Ut(B,v,P,a,Be,He))},[]),sn=b.useCallback(()=>Ge(Ht),[Ge]),rn=b.useCallback(()=>Ge(1/Ht),[Ge]),Ne=b.useCallback(a=>{var _;if(a.length===0)return;const w=H?Qe:sr,{prepared:d,spectrum:v}=Ys(a,{smoothing:N,limit:w});r(d),o(v);const P=Math.min(v.length,w);x(Math.max(1,P));const B=(_=W.current)==null?void 0:_.getBoundingClientRect(),F=B?{width:B.width,height:B.height}:null;de(F&&$e(F)?Wt(d,F,{padding:.9,minScale:Be,maxScale:He}):Ce);try{localStorage.setItem(Bt,JSON.stringify(d))}catch{}ot(),p(!0),ne(0)},[ot,H,N]);b.useEffect(()=>{const a=Object.keys(localStorage).filter(d=>d.startsWith("fourier_viz_")).map(d=>d.replace("fourier_viz_","")).sort();J(a);const w=localStorage.getItem(Bt);if(w)try{const d=JSON.parse(w);d.length&&(t("PRESET"),r(d),Ne(d))}catch{}},[]),b.useEffect(()=>{const a=()=>{const d=getComputedStyle(document.documentElement),v=d.getPropertyValue("--color-code-bg").trim(),P=d.getPropertyValue("--fourier-grid").trim();E(v||"#0f172a"),j(P||"rgba(148, 163, 184, 0.22)")};a();const w=typeof MutationObserver<"u"?new MutationObserver(a):null;return w&&(w.observe(document.documentElement,{attributes:!0,attributeFilter:["class","data-theme"]}),w.observe(document.body,{attributes:!0,attributeFilter:["class","data-theme"]})),()=>w==null?void 0:w.disconnect()},[]),b.useEffect(()=>{const a=H?Math.min(s.length,Qe):s.length;a!==0&&x(w=>Math.min(Math.max(w||1,1),a))},[s.length,H]),b.useEffect(()=>{!V&&U!==0&&ne(0)},[V,U]),b.useEffect(()=>{const a=()=>{I(document.fullscreenElement===fe.current),document.fullscreenElement&&X(!1),Fe()};return document.addEventListener("fullscreenchange",a),()=>document.removeEventListener("fullscreenchange",a)},[Fe]),b.useEffect(()=>{document.body.classList.toggle("fourier-pseudo-fullscreen",L);const a=window.requestAnimationFrame(()=>{Fe()});return()=>{window.cancelAnimationFrame(a),document.body.classList.remove("fourier-pseudo-fullscreen")}},[L,Fe]),b.useEffect(()=>{if(!L)return;const a=w=>{w.key==="Escape"&&X(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[L]);const on=b.useCallback(()=>{const a=fe.current;if(!a)return;const w=document.fullscreenElement===a;if(w||L){w?document.exitFullscreen().catch(()=>{}):X(!1);return}if(typeof a.requestFullscreen=="function"){const d=window.setTimeout(()=>{document.fullscreenElement!==a&&X(!0)},450);let v=null;try{v=a.requestFullscreen()}catch{window.clearTimeout(d),X(!0);return}Promise.resolve(v).catch(()=>{X(!0)}).finally(()=>{window.clearTimeout(d),document.fullscreenElement!==a&&X(!0)});return}X(!0)},[L]),_e=pt.useMemo(()=>Ks(s,n,u),[s,u,n]),Mt=(a,w)=>{const d=W.current;if(!d)return null;const v=d.getBoundingClientRect(),P={width:v.width,height:v.height};return $e(P)?{viewport:P,screen:{x:a-v.left,y:w-v.top}}:null},jt=(a,w)=>{const d=Le.current.view;Me.current={pointerId:a,start:w,startOffsetX:d.offsetX,startOffsetY:d.offsetY}},an=a=>{const w=Array.from(xe.current.entries());if(w.length<2)return;const[d,v]=w,P=d[0],B=v[0],F=d[1],_=v[1],re=_.x-F.x,$=_.y-F.y,oe=Math.hypot(re,$);if(!Number.isFinite(oe)||oe<2)return;const D=Le.current.view,ce={x:(F.x+_.x)/2,y:(F.y+_.y)/2};be.current={ids:[P,B],startDist:oe,startView:D,worldAtMid:Ve(ce,a,D),viewport:a},Me.current=null},cn=a=>{const w=Mt(a.clientX,a.clientY);if(!w)return;const{viewport:d,screen:v}=w;if(a.pointerType==="touch"){if(K.current&&me.current!==a.pointerId)return;if(xe.current.set(a.pointerId,v),xe.current.size===2){ge.current=null,an(d);try{a.currentTarget.setPointerCapture(a.pointerId)}catch{}return}if(xe.current.size>1)return;if(e!=="DRAW"){ge.current=null,jt(a.pointerId,v);try{a.currentTarget.setPointerCapture(a.pointerId)}catch{}return}ge.current={pointerId:a.pointerId,start:v,viewport:d,startView:Le.current.view};try{a.currentTarget.setPointerCapture(a.pointerId)}catch{}return}if(a.pointerType==="mouse"&&a.button===0&&Ke.current){jt(a.pointerId,v);try{a.currentTarget.setPointerCapture(a.pointerId)}catch{}return}if(e!=="DRAW"||K.current||a.pointerType==="mouse"&&a.button!==0)return;K.current=!0,me.current=a.pointerId,Ee(!0),r([]),ve(),o([]),p(!1),ne(0),ie(!1);const P=Ve(v,d,Le.current.view);r([P]),he.current=[P],ge.current=null;try{a.currentTarget.setPointerCapture(a.pointerId)}catch{}},ln=a=>{const w=Mt(a.clientX,a.clientY);if(!w)return;const{viewport:d,screen:v}=w;if(a.pointerType==="touch"&&xe.current.has(a.pointerId)){xe.current.set(a.pointerId,v);const $=be.current;if($&&(a.pointerId===$.ids[0]||a.pointerId===$.ids[1])){const oe=xe.current.get($.ids[0]),D=xe.current.get($.ids[1]);if(!oe||!D)return;const ce=D.x-oe.x,R=D.y-oe.y,G=Math.hypot(ce,R);if(!Number.isFinite(G)||G<2)return;const ae={x:(oe.x+D.x)/2,y:(oe.y+D.y)/2},Z=G/$.startDist,Te=$.startView.scale*Z;de(()=>Jt($.worldAtMid,$.viewport,ae,Te,Be,He));return}}const P=Me.current;if(P&&P.pointerId===a.pointerId){const $=v.x-P.start.x,oe=v.y-P.start.y;de(D=>({...D,offsetX:P.startOffsetX+$,offsetY:P.startOffsetY+oe}));return}if(a.pointerType==="touch"&&e==="DRAW"&&!K.current){const $=ge.current;if($&&$.pointerId===a.pointerId&&xe.current.size===1){if(Math.hypot(v.x-$.start.x,v.y-$.start.y)<3)return;K.current=!0,me.current=a.pointerId,Ee(!0),ve(),o([]),p(!1),ne(0),ie(!1);const D=Ve($.start,$.viewport,$.startView);he.current=[D],r([D]),ge.current=null}}if(!K.current||e!=="DRAW"||me.current!==a.pointerId)return;if(a.pointerType==="mouse"&&(a.buttons&1)===0){K.current=!1,me.current=null,Ee(!1);return}const B=Le.current.view,F=Ve(v,d,B),_=he.current[he.current.length-1],re=rr/Math.max(B.scale,.001);Math.hypot(F.x-_.x,F.y-_.y)>re&&he.current.push(F)},un=a=>{var d,v;if(!a)return;if(a.pointerType==="touch"&&(xe.current.delete(a.pointerId),be.current&&(be.current.ids[0]===a.pointerId||be.current.ids[1]===a.pointerId)&&(be.current=null),!K.current&&((d=ge.current)==null?void 0:d.pointerId)===a.pointerId)){ge.current=null;return}if(((v=Me.current)==null?void 0:v.pointerId)===a.pointerId&&(Me.current=null),!K.current||typeof a.pointerId=="number"&&me.current!==a.pointerId)return;K.current=!1,me.current=null,Ee(!1);const w=he.current;w.length>1?Ne(w):(r([]),o([]),p(!1))},dn=a=>{var w,d;(a==null?void 0:a.pointerType)==="touch"&&(xe.current.delete(a.pointerId),be.current=null,typeof a.pointerId=="number"&&((w=ge.current)==null?void 0:w.pointerId)===a.pointerId&&(ge.current=null)),typeof(a==null?void 0:a.pointerId)=="number"&&((d=Me.current)==null?void 0:d.pointerId)===a.pointerId&&(Me.current=null),K.current&&(K.current=!1,me.current=null,Ee(!1))},at=b.useCallback(a=>{if(!a.ctrlKey&&!a.metaKey)return;const w=W.current;if(!w)return;const d=w.getBoundingClientRect(),v={width:d.width,height:d.height};if(!$e(v))return;const P={x:a.clientX-d.left,y:a.clientY-d.top};a.preventDefault();const B=Math.exp(-a.deltaY*.0015);de(F=>Ut(F,v,P,B,Be,He))},[]);b.useEffect(()=>{const a=W.current;if(a)return a.addEventListener("wheel",at,{passive:!1}),()=>{a.removeEventListener("wheel",at)}},[at]),b.useEffect(()=>{const a=d=>{var B,F;const v=d.pointerId;if(typeof v=="number"&&(xe.current.delete(v),((B=ge.current)==null?void 0:B.pointerId)===v&&(ge.current=null),((F=Me.current)==null?void 0:F.pointerId)===v&&(Me.current=null),be.current&&(be.current.ids[0]===v||be.current.ids[1]===v)&&(be.current=null)),!K.current||typeof v=="number"&&me.current!==null&&v!==me.current)return;K.current=!1,me.current=null,Ee(!1);const P=he.current;P.length>1?Ne(P):(r([]),o([]),p(!1))},w=()=>{Me.current=null,be.current=null,xe.current.clear(),ge.current=null,Ke.current=!1,a(new Event("blur"))};return window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a),window.addEventListener("blur",w),()=>{window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a),window.removeEventListener("blur",w)}},[Ne]),b.useEffect(()=>{const a=v=>{if(!(v instanceof HTMLElement))return!1;const P=v.tagName.toLowerCase();return P==="input"||P==="textarea"||P==="select"?!0:v.isContentEditable},w=v=>{v.code==="Space"&&(a(v.target)||(Ke.current=!0,v.preventDefault()))},d=v=>{v.code==="Space"&&(Ke.current=!1)};return window.addEventListener("keydown",w),window.addEventListener("keyup",d),()=>{window.removeEventListener("keydown",w),window.removeEventListener("keyup",d)}},[]);const fn=()=>{r([]),ve(),o([]),p(!1),t("DRAW"),ne(0),ie(!1),de(Ce),he.current=[]},hn=a=>{let w=[];switch(a){case"circle":w=xs();break;case"square":w=gs();break;case"heart":w=ys();break;case"infinity":w=bs();break;case"note":w=vs();break}t("PRESET"),r(w),Ne(w)},mn=()=>{if(n.length<2){alert("Draw something first!");return}const a=prompt("Enter a name for this drawing:");if(a)try{localStorage.setItem(`fourier_viz_${a}`,JSON.stringify(n)),J(w=>{const d=[...w];return d.includes(a)||d.push(a),d.sort()})}catch{alert("Failed to save. Storage might be full.")}},pn=a=>{const w=localStorage.getItem(`fourier_viz_${a}`);if(w)try{const d=JSON.parse(w);r(d),t("PRESET"),Ne(d)}catch(d){console.error("Error loading drawing",d)}},gn=async a=>{if(a.target.files&&a.target.files[0]){const w=a.target.files[0];if(w.type&&!w.type.startsWith("image/")){alert("Please upload an image file.");return}if(w.size>ar){alert("File too large for in-browser processing. Please pick an image under 10MB.");return}M(!0),se.current=w;try{const d=await Xt(w,900,{detail:O/100});d.length>0?(r(d),t("UPLOAD"),Ne(d)):alert("No clear shape found. Try an image with higher contrast.")}catch(d){console.error(d),alert("Error processing image.")}finally{M(!1),a.target.value=""}}};b.useEffect(()=>{if(e!=="UPLOAD")return;const a=se.current;if(!a)return;const w=window.setTimeout(async()=>{M(!0);try{const d=await Xt(a,900,{detail:O/100});d.length>0&&(r(d),Ne(d))}catch(d){console.error(d)}finally{M(!1)}},250);return()=>window.clearTimeout(w)},[e,O,Ne]);const kt=a=>{if(!s.length)return;ie(!0);const w=Math.min(Math.max(a,0),Math.max(Se-1,0));ne(w);const d=w+1;u!==d&&x(d),rt(0),ve()},xn=()=>kt(U-1),yn=()=>kt(U+1),bn=()=>{V||ie(!0),p(!0)},Et=b.useCallback((a,w,d,v,P,B)=>{var ce;let F=0,_=0;const re=w.slice(0,Math.max(d,1)),$=Math.max(re.length-1,0),oe=((ce=w[0])==null?void 0:ce.amp)||1,D=1/Math.max(B,.001);for(let R=0;R<re.length;R++){const G=F,ae=_,{freq:Z,amp:Te,phase:ct}=re[R],Ue=Z*v+ct,Ze=R===$,We=er(re[R],oe,Ze),lt=P&&Ze?1+.25*Math.sin(v*6):1;F+=Te*Math.cos(Ue),_+=Te*Math.sin(Ue),a.strokeStyle=We,a.lineWidth=(Ze?1.6*lt:1)*D,a.beginPath(),a.arc(G,ae,Te,0,2*Math.PI),a.stroke(),a.strokeStyle=We,a.beginPath(),a.moveTo(G,ae),a.lineTo(F,_),a.stroke(),R===re.length-1&&(a.fillStyle=We,a.beginPath(),a.arc(F,_,3*D,0,2*Math.PI),a.fill())}return{x:F,y:_}},[]),Nt=b.useCallback(a=>{const w=W.current;if(!w)return;const d=w.getContext("2d");if(!d)return;const v=Le.current,P=qe.current||1,B=w.width/P,F=w.height/P,_=Math.max(v.view.scale,.001),re=B/2+v.view.offsetX,$=F/2+v.view.offsetY;d.setTransform(1,0,0,1,0,0),d.scale(P,P),d.lineCap="round",d.lineJoin="round",d.fillStyle=v.canvasBg,d.fillRect(0,0,B,F),d.strokeStyle=v.gridColor,d.lineWidth=.5,d.beginPath(),d.moveTo(re,0),d.lineTo(re,F),d.moveTo(0,$),d.lineTo(B,$),d.stroke(),v.points.length>0&&v.mode!=="DRAW"&&(d.save(),d.translate(re,$),d.scale(_,_),d.strokeStyle="rgba(255, 255, 255, 0.1)",d.lineWidth=1/_,d.beginPath(),v.points.forEach((D,ce)=>{ce===0?d.moveTo(D.x,D.y):d.lineTo(D.x,D.y)}),d.stroke(),d.restore()),v.mode==="DRAW"&&K.current&&(d.save(),d.translate(re,$),d.scale(_,_),d.strokeStyle=v.brushColor,d.lineWidth=v.brushSize/_,d.beginPath(),he.current.forEach((D,ce)=>{ce===0?d.moveTo(D.x,D.y):d.lineTo(D.x,D.y)}),d.stroke(),d.restore());const oe=S.current;if(v.fourierX.length>0){if(Y.current){const R=Y.current.getContext("2d");if(R&&Ae.current){Ae.current=!1,R.setTransform(1,0,0,1,0,0),R.clearRect(0,0,Y.current.width,Y.current.height);const G=Xe.current;if(G.length>1){R.setTransform(1,0,0,1,0,0),R.scale(P,P),R.lineCap="round",R.lineJoin="round",R.translate(re,$),R.scale(_,_),R.strokeStyle=v.brushColor,R.lineWidth=v.brushSize/_,R.beginPath(),R.moveTo(G[0].x,G[0].y);for(let ae=1;ae<G.length;ae++)R.lineTo(G[ae].x,G[ae].y);R.stroke()}}d.drawImage(Y.current,0,0,B,F)}const D=Math.min(Math.max(v.numEpicycles,1),v.fourierX.length);d.save(),d.translate(re,$),d.scale(_,_);const ce=Et(d,v.fourierX,D,oe,v.stepMode,_);if(d.restore(),v.isPlaying){const R={x:ce.x,y:ce.y},G=Xe.current;if(G.length===0)G.push(R);else{const ae=G[G.length-1];if((ae.x!==R.x||ae.y!==R.y)&&(G.push(R),Y.current)){const Z=Y.current.getContext("2d");Z&&(Z.setTransform(1,0,0,1,0,0),Z.scale(P,P),Z.lineCap="round",Z.lineJoin="round",Z.translate(re,$),Z.scale(_,_),Z.strokeStyle=v.brushColor,Z.lineWidth=v.brushSize/_,Z.beginPath(),Z.moveTo(ae.x,ae.y),Z.lineTo(R.x,R.y),Z.stroke())}}ue.current=R}else ue.current={x:ce.x,y:ce.y};if(v.isPlaying){const R=Math.max(v.points.length||v.fourierX.length,1),G=2*Math.PI/R,ae=ee.current,Z=ae==null?0:Math.min(Math.max(a-ae,0),80);ee.current=a;const Te=Z/(1e3/60),ct=G*v.speed*Te,Ue=oe+ct;if(Ue>=2*Math.PI){if(S.current=0,ve(),v.stepMode){p(!1);const We=v.safeMode?Math.min(v.fourierX.length,Qe):v.fourierX.length;ne(lt=>Math.min(lt+1,Math.max(We-1,0)))}}else S.current=Ue}else ee.current=a}else ee.current=a;if(v.showMath){const D=le.current;(D==null||a-D>=50)&&(l(S.current),le.current=a)}else le.current=null},[ve,Et]),it=b.useCallback(a=>{const d=Le.current.isPlaying||K.current;(we.current||d)&&(Nt(a),we.current=!1),d?Pe.current=requestAnimationFrame(it):(pe.current=!1,ee.current=null,le.current=null)},[Nt]),ze=b.useCallback(()=>{we.current=!0,!pe.current&&(pe.current=!0,ee.current=null,Pe.current=requestAnimationFrame(it))},[it]);b.useEffect(()=>{Le.current={mode:e,points:n,fourierX:s,time:c,isPlaying:f,numEpicycles:u,showMath:h,canvasBg:k,gridColor:y,speed:T,brushColor:ke,brushSize:Re,stepMode:V,safeMode:H,stepIndex:U,view:ye},ze()},[e,n,s,c,f,u,h,k,y,T,ke,Re,V,H,U,ye,ze]),b.useEffect(()=>{Ae.current=!0},[ye.offsetX,ye.offsetY,ye.scale]),b.useEffect(()=>(ze(),()=>{Pe.current&&cancelAnimationFrame(Pe.current)}),[ze]),b.useEffect(()=>{const a=()=>{Fe(),ze()};a();const w=typeof ResizeObserver<"u"?new ResizeObserver(a):null;return w&&(fe.current&&w.observe(fe.current),W.current&&w.observe(W.current)),window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a),w==null||w.disconnect()}},[Fe,ze]),b.useEffect(()=>{ve()},[u,s]),b.useEffect(()=>{const a=document.getElementById("fourier-root");return a==null||a.classList.add("is-mounted"),()=>{a==null||a.classList.remove("is-mounted")}},[]);const Se=H?Math.min(s.length,Qe):s.length,St=Math.max(Math.min(u-1,(((Lt=_e.breakdown)==null?void 0:Lt.length)||1)-1),0),vn=((Ct=(Tt=_e.breakdown)==null?void 0:Tt[St])==null?void 0:Ct.energyPct)??0,wn=((Rt=(It=_e.breakdown)==null?void 0:It[St])==null?void 0:Rt.cumulativePct)??_e.energyPct,Pt=A||L;return b.useEffect(()=>{if(!V)return;const a=Math.min(Math.max(U+1,1),Math.max(Se,1));u!==a&&x(a)},[V,U,Se,u]),b.useEffect(()=>{const a=Math.max(Math.min(u-1,Se-1),0);U>a&&ne(a)},[u,Se,U]),i.jsxs("div",{className:`fourier-stage select-none ${Pt?"is-fullscreen":""} ${L?"is-pseudo-fullscreen":""}`,ref:fe,"data-mode":e,"data-drawing":Oe?"true":"false","data-has-spectrum":s.length>0?"true":"false","data-points":n.length,"data-epicycles":u,"data-terms":s.length,"data-view-scale":ye.scale.toFixed(4),children:[i.jsx("canvas",{ref:W,onPointerDown:cn,onPointerMove:ln,onPointerUp:un,onPointerCancel:dn,className:`fourier-canvas cursor-${e==="DRAW"?"crosshair":"default"}`}),i.jsx(tr,{mode:e,setMode:t,isPlaying:f,setIsPlaying:p,clear:fn,numEpicycles:u,maxEpicycles:Se,setNumEpicycles:x,onUpload:gn,showMath:h,setShowMath:g,onPreset:hn,speed:T,setSpeed:z,onReset:en,brushColor:ke,setBrushColor:st,brushSize:Re,setBrushSize:Ye,smoothing:N,setSmoothing:C,outlineDetail:O,setOutlineDetail:te,isDrawing:Oe,onSave:mn,onLoad:pn,savedDrawings:q,isFullscreen:Pt,onToggleFullscreen:on,safeMode:H,onToggleSafeMode:()=>Q(a=>!a),stepMode:V,onToggleStepMode:()=>ie(a=>!a),stepIndex:U,stepMax:Se,onStepPrev:xn,onStepNext:yn,onStepPlayOnce:bn,viewScale:ye.scale,onZoomIn:sn,onZoomOut:rn,onFitView:nn,onResetView:tn}),h&&s.length>0&&i.jsx(nr,{terms:s,time:c,epicycles:u,metrics:_e,focusIndex:V?Math.max(u-1,0):void 0,stepMode:V}),V&&s.length>0&&i.jsxs("div",{className:"absolute top-4 left-4 z-[60] bg-slate-900/80 text-slate-100 border border-slate-700 rounded-lg px-4 py-3 shadow-lg space-y-1",children:[i.jsx("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Step mode"}),i.jsxs("div",{className:"text-sm font-semibold",children:["Term ",Math.min(u,Se)," / ",Math.max(Se,1)]}),i.jsxs("div",{className:"text-xs text-slate-200",children:["Œîenergy ",vn.toFixed(2),"% ¬∑ Cumulative ",wn.toFixed(2),"% ¬∑ RMS ",_e.rmsError.toFixed(2)," px"]})]}),m&&i.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100]",children:i.jsx("div",{className:"text-cyan-400 font-mono text-xl animate-pulse",children:"Processing Image..."})}),e==="DRAW"&&n.length===0&&i.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none text-center",children:[i.jsx("h1",{className:"text-4xl font-bold text-slate-200 mb-2 drop-shadow",children:"Draw Something"}),i.jsx("p",{className:"text-slate-300",children:"Trace a continuous line to begin"})]})]})},Qt=document.getElementById("fourier-root");if(!Qt)throw new Error("Could not find root element to mount to");const cr=Mn.createRoot(Qt);cr.render(i.jsx(pt.StrictMode,{children:i.jsx(ir,{})}));
