<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Fourier Epicycles Lab - Ka Ming Lui</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" />
    <link rel="stylesheet" href="../../assets/css/style.css" data-vite-ignore />
    <link rel="stylesheet" href="../../assets/css/fourier-epicycles.css" data-vite-ignore />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      window.tailwind = window.tailwind || {};
      tailwind.config = { darkMode: 'class' };
    </script>
  </head>
  <body class="theme-light">
    <div id="site-header"></div>

    <main class="lab-main">
      <section class="lab-hero">
        <div class="container">
          <div class="lab-hero__inner">
            <p class="lab-hero__eyebrow">Interactive lab</p>
            <h1 class="lab-hero__title">Fourier Epicycles Visualizer</h1>
            <p class="lab-hero__lead">
              Draw freehand paths or load presets to see how the discrete Fourier transform rebuilds your strokes with
              spinning vectors.
            </p>
            <p class="lab-panel__note">
              Everything runs client-side - no API keys or uploads - so GitHub Pages can host it as a static experience.
            </p>
          </div>
        </div>
      </section>

      <section class="lab-section" aria-labelledby="fourier-title">
        <div class="container">
          <article class="card lab-card fourier-card">
            <header class="lab-card__header">
              <p class="lab-card__eyebrow">Signals into circles</p>
              <div class="lab-card__title-row">
                <h2 class="lab-card__title" id="fourier-title">Sketch, transform, and watch the epicycles trace back</h2>
                <div class="lab-card__chips">
                  <span class="lab-chip">DFT</span>
                  <span class="lab-chip">Client-only</span>
                  <span class="lab-chip">Canvas</span>
                </div>
              </div>
              <p class="lab-card__lead">
                Use the toolbar to swap between presets, adjust speed, smoothness, and stroke styling, or save and reload
                your own drawings. The math panel is always one toggle away if you want to see the series details.
              </p>
            </header>

            <div class="fourier-shell">
              <div id="fourier-root" class="fourier-root" aria-live="polite">
                <div class="fourier-placeholder">
                  <p class="placeholder-title">Loading playground...</p>
                  <p class="placeholder-body">If it does not appear, refresh or enable JavaScript.</p>
                </div>
                <noscript>
                  <div class="fourier-placeholder">
                    <p class="placeholder-title">JavaScript required</p>
                    <p class="placeholder-body">Enable JavaScript to load the Fourier playground.</p>
                  </div>
                </noscript>
              </div>
            </div>

            <div class="fourier-notes">
              <div>
                <h3>How it works</h3>
                <ul>
                  <li>
                    Draw or upload a shape - the path is sampled into points
                    <span class="fourier-inline-math" data-katex="x_n"></span>
                    and smoothed.
                  </li>
                  <li>
                    The Discrete Fourier Transform (DFT) converts those points into complex coefficients
                    <span class="fourier-inline-math" data-katex="X_k"></span>.
                  </li>
                  <li>
                    Epicycles are drawn largest-to-smallest so you can see how each term changes the reconstruction
                    <span class="fourier-inline-math" data-katex="x(t)"></span>.
                  </li>
                  <li>
                    Toggle the math panel to inspect coefficient magnitude
                    <span class="fourier-inline-math" data-katex="|X_k|"></span>
                    and phase
                    <span class="fourier-inline-math" data-katex="\phi_k"></span>.
                  </li>
                </ul>
              </div>
              <div>
                <h3>What to try</h3>
                <ul>
                  <li>Switch to presets to see classic shapes rebuilt by the series.</li>
                  <li>Drag "Precision" to limit how many epicycles you keep in the partial sum.</li>
                  <li>Experiment with "Smoothness" to reduce drawing noise before the transform.</li>
                  <li>Save a drawing, reload it, then compare with a different speed factor.</li>
                </ul>
              </div>
              <div>
                <h3>Math checkpoints</h3>
                <div class="note math-checkpoints">
                  <span class="math-checkpoint__label">
                    DFT coefficients <span class="fourier-inline-math" data-katex="X_k"></span>:
                  </span>
                  <span id="math-dft" class="math-checkpoint__equation"></span>
                  <span class="math-checkpoint__label">
                    Reconstruction <span class="fourier-inline-math" data-katex="x(t)"></span>:
                  </span>
                  <span id="math-recon" class="math-checkpoint__equation"></span>
                </div>
              </div>
            </div>
          </article>
        </div>
      </section>
    </main>

    <div id="site-footer"></div>

    <script type="module">
      import { initMainLayout } from '../../assets/js/layout/mainLayout.js';
      initMainLayout('fourier-epicycles');
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        if (!window.katex) return;
        const render = (el, tex, displayMode) => {
          if (!el) return;
          window.katex.render(tex, el, { throwOnError: false, displayMode });
        };

        const dftEl = document.getElementById('math-dft');
        const reconEl = document.getElementById('math-recon');
        render(dftEl, 'X_k = \\frac{1}{N}\\sum_{n=0}^{N-1} x_n e^{-i 2\\pi k n / N}', true);
        render(reconEl, 'x(t) = \\sum_{k=0}^{N-1} |X_k| e^{i\\left(2\\pi kt/N + \\phi_k\\right)}', true);

        document.querySelectorAll('[data-katex]').forEach((el) => {
          const tex = el.getAttribute('data-katex');
          if (!tex) return;
          render(el, tex, false);
        });
      });
    </script>
    <script type="module" src="./index.tsx"></script>
  </body>
</html>
