<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Descend into Endless Depths, a roguelike mini-game that blends into Ka Ming Lui's portfolio."
    />
    <title>Endless Depths · Ka Ming Lui</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../../assets/css/style.css" />
    <link rel="stylesheet" href="../../assets/css/endless-depths.css" />
  </head>
  <body class="theme-dark">
    <header
      class="site-header"
      id="top"
      data-site-header
      data-nav-root="../.."
      data-current-lab="endless-depths"
    ></header>
    <script type="module" src="../../assets/js/site-header-init.js"></script>

    <main class="depths-main">
      <section class="lab-hero">
        <div class="container">
          <div class="lab-hero__inner">
            <p class="lab-hero__eyebrow">Side quest</p>
            <h1 class="lab-hero__title">Endless Depths</h1>
            <p class="lab-hero__lead">
              A compact roguelike built to live inside this portfolio. Continue your run from cache, loot smarter, and enjoy a
              UI tuned to the site's dark theme.
            </p>
          </div>
        </div>
      </section>

      <section class="depths-section" aria-labelledby="depths-heading">
        <div class="container">
          <article class="card depths-card">
            <header class="depths-card__header">
              <div>
                <p class="lab-card__eyebrow">Interactive mini-game</p>
                <h2 class="lab-card__title" id="depths-heading">Descend and survive</h2>
                <p class="lab-card__lead">
                  Grab loot, craft gear, and battle through layered biomes. Progress saves locally so you can step away and
                  return to the same descent.
                </p>
              </div>
              <div class="depths-actions">
                <button class="button button--ghost" type="button" id="layout-toggle" aria-pressed="false">Wide view</button>
                <button class="button button--ghost" type="button" id="clear-cache-btn">Reset saved run</button>
              </div>
            </header>

            <div id="game-wrapper" class="depths-layout">
              <div id="sidebar-left" class="panel-column">
                <div class="panel">
                  <h2>
                    Status
                    <button id="audio-toggle" class="audio-btn" onclick="toggleAudio()">♫ OFF</button>
                  </h2>
                  <div class="stat-row"><span>HP</span><span id="hp-val">--</span></div>
                  <div class="bar-container"><div id="hp-bar" class="bar-fill"></div></div>
                  <div class="stat-row"><span>Mana</span><span id="mp-val">--</span></div>
                  <div class="bar-container"><div id="mp-bar" class="bar-fill"></div></div>
                  <div class="stat-row"><span>Load</span><span id="weight-val">0/40</span></div>
                  <div class="bar-container"><div id="weight-bar" class="bar-fill" style="width: 0%"></div></div>
                  <div class="stat-subtext" id="weight-status">Light</div>
                  <div class="stat-grid">
                    <div>STR: <span id="str-val">0</span></div>
                    <div>DEF: <span id="def-val">0</span></div>
                    <div class="gold">Gold: <span id="gold-val">0</span></div>
                    <div class="job">Job: <span id="class-val">None</span></div>
                  </div>
                </div>

                <div class="panel">
                  <h2>Equipment <span class="panel-subtext">(Click to Unequip)</span></h2>
                  <div id="equip-weapon" class="equip-slot drop-zone" onclick="unequipItem('weapon')">
                    <div class="equip-label">Main Hand</div>
                    <div class="content">Empty</div>
                  </div>
                  <div id="equip-armor" class="equip-slot drop-zone" onclick="unequipItem('armor')">
                    <div class="equip-label">Body</div>
                    <div class="content">Empty</div>
                  </div>
                </div>
              </div>

              <div class="playfield">
                <div id="canvas-container">
                  <button id="fullscreen-btn" class="canvas-control" type="button" aria-pressed="false" aria-label="Enter fullscreen">
                    ⤢
                  </button>
                  <canvas id="gameCanvas"></canvas>
                  <div id="damage-flash"></div>
                  <div id="overlay">
                    <h1 id="overlay-title">ENDLESS DEPTHS</h1>
                    <div id="overlay-msg">Roguelike HD Edition</div>
                    <div class="overlay-actions">
                      <button class="main-btn" id="start-btn">Enter Dungeon</button>
                      <button class="main-btn hidden" id="purgatory-btn">Fight for Soul</button>
                      <button class="ghost-btn hidden" id="new-run-btn">Start New Run</button>
                    </div>
                  </div>
                  <div id="tooltip"></div>
                  <div id="fx-layer"></div>
                </div>
                <div id="controls-hint">WASD: Move • SPACE: Attack/Interact • F: Shoot • 1-3: Skills • Use Items via Bag</div>
              </div>

              <div id="sidebar-right" class="panel-column">
                <div class="panel panel-grow">
                  <h2>
                    <span>Inventory <span id="slots-val" class="panel-subtext">0/20</span></span>
                    <div class="tab-container">
                      <span id="tab-inv" class="tab-btn active" onclick="switchTab('inv')">Bag</span>
                      <span id="tab-craft" class="tab-btn" onclick="switchTab('craft')">Craft</span>
                      <span id="tab-skills" class="tab-btn" onclick="switchTab('skills')">Skills</span>
                      <span id="tab-journal" class="tab-btn" onclick="switchTab('journal')">Journal</span>
                    </div>
                  </h2>
                  <div id="inventory-list" class="inv-list"></div>
                  <div id="crafting-list" class="inv-list hidden"></div>
                  <div id="skills-list" class="inv-list hidden">
                    <div class="skill-note">Active (Hotkeys 1-3)</div>
                    <div id="active-skills-container"></div>
                    <hr class="divider" />
                    <div class="skill-note">Grimoire (Drag to Assign)</div>
                    <div id="grimoire-container"></div>
                  </div>
                  <div id="journal-list" class="inv-list hidden"></div>
                </div>

                <div class="panel log-panel">
                  <h2>Log</h2>
                  <div id="log"></div>
                </div>
              </div>
            </div>
          </article>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container footer__grid">
        <div>
          <h2>Back to the main site?</h2>
          <p>Check out projects, posts, and the ML roadmap that inspired this mini-game.</p>
          <div class="footer__actions">
            <a class="button button--primary" href="index.html#projects">View projects</a>
            <a class="button button--ghost" href="index.html#contact">Get in touch</a>
          </div>
        </div>
        <div class="footer__meta">
          <p>Progress saves to your browser so you can pick up where you left off.</p>
          <p>&copy; <span id="year"></span> Ka Ming Lui. Built for performance and accessibility.</p>
        </div>
      </div>
      <a class="back-to-top" href="#top">Back to top</a>
    </footer>

    <!-- Patch notes: Fixed layout fullscreen for entire wrapper, hardened game loop/input safety, and stabilized purgatory restore and crafting messaging. -->

    <script type="module" src="../../assets/js/nav.js"></script>
    <script type="module">
      const body = document.body;
      const themeToggle = document.querySelector('.theme-toggle');
      const yearElement = document.getElementById('year');
      const THEME_KEY = 'kaminglui-theme';

      yearElement.textContent = new Date().getFullYear();

      const savedTheme = localStorage.getItem(THEME_KEY);
      if (savedTheme) {
        body.classList.toggle('theme-dark', savedTheme === 'dark');
      }

      themeToggle?.addEventListener('click', () => {
        body.classList.toggle('theme-dark');
        const next = body.classList.contains('theme-dark') ? 'dark' : 'light';
        localStorage.setItem(THEME_KEY, next);
      });
    </script>

    <script src="../../assets/js/endless-depths.js" type="module"></script>
  </body>
</html>
